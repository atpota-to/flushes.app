(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{7105:function(e,t,n){Promise.resolve().then(n.bind(n,8291)),Promise.resolve().then(n.t.bind(n,2778,23)),Promise.resolve().then(n.bind(n,5165)),Promise.resolve().then(n.bind(n,4915)),Promise.resolve().then(n.bind(n,7758)),Promise.resolve().then(n.bind(n,6283))},5165:function(e,t,n){"use strict";n.d(t,{default:function(){return o}});var s=n(7437),a=n(2265);function o(e){let{children:t,fallback:n=null}=e,[o,r]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{r(!0)},[]),o)?(0,s.jsx)(s.Fragment,{children:t}):(0,s.jsx)(s.Fragment,{children:n})}},4915:function(e,t,n){"use strict";n.d(t,{default:function(){return y}});var s=n(7437),a=n(2265),o=n(7648),r=n(3145),i=n(9376),l=n(2457),c=n.n(l),u=n(8238),d=n.n(u);function h(){let[e,t]=(0,a.useState)(""),[n,o]=(0,a.useState)([]),[r,l]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!1),[h,m]=(0,a.useState)("Search user @handle"),g=(0,a.useRef)(null),f=(0,a.useRef)(null),v=(0,i.useRouter)(),_=(0,a.useRef)(null);(0,a.useEffect)(()=>{let e=()=>{window.innerWidth,m("Search handle")};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,a.useEffect)(()=>{let e=e=>{var t;!g.current||g.current.contains(e.target)||(null===(t=f.current)||void 0===t?void 0:t.contains(e.target))||u(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,a.useEffect)(()=>{if(_.current&&clearTimeout(_.current),!e||e.length<2){o([]),u(!1);return}return _.current=setTimeout(async()=>{try{l(!0);let t=e.trim().startsWith("@")?e.trim().substring(1):e.trim(),n=await fetch("https://public.api.bsky.app/xrpc/app.bsky.actor.searchActorsTypeahead?q=".concat(encodeURIComponent(t),"&limit=5"));if(n.ok){let e=await n.json();e.actors&&Array.isArray(e.actors)&&(o(e.actors.map(e=>({did:e.did,handle:e.handle,displayName:e.displayName,avatar:e.avatar}))),u(!0))}else console.error("Failed to fetch suggestions:",await n.text())}catch(e){console.error("Error fetching suggestions:",e)}finally{l(!1)}},300),()=>{_.current&&clearTimeout(_.current)}},[e]);let x=e=>{v.push("/profile/".concat(e.handle)),u(!1),t("")};return(0,s.jsxs)("div",{className:d().searchContainer,children:[(0,s.jsxs)("form",{onSubmit:t=>{if(t.preventDefault(),e.trim()){let t=e.trim().startsWith("@")?e.trim().substring(1):e.trim();v.push("/profile/".concat(t)),u(!1)}},className:d().searchForm,children:[(0,s.jsx)("input",{ref:f,type:"text",value:e,onChange:e=>t(e.target.value),placeholder:h,className:"".concat(d().searchInput," font-regular"),"aria-label":"Search for a user profile"}),(0,s.jsx)("button",{type:"submit",className:"".concat(d().searchButton," font-medium"),children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"18",height:"18",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("circle",{cx:"11",cy:"11",r:"8"}),(0,s.jsx)("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})})]}),c&&(0,s.jsx)("div",{className:d().suggestionsContainer,ref:g,children:r?(0,s.jsxs)("div",{className:d().loadingContainer,children:[(0,s.jsx)("div",{className:d().loadingDot}),(0,s.jsx)("div",{className:d().loadingDot}),(0,s.jsx)("div",{className:d().loadingDot})]}):n.length>0?(0,s.jsx)("ul",{className:d().suggestionsList,children:n.map(e=>(0,s.jsx)("li",{className:d().suggestionItem,children:(0,s.jsxs)("button",{type:"button",className:d().suggestionButton,onClick:()=>x(e),children:[e.avatar?(0,s.jsx)("img",{src:e.avatar,alt:e.handle,className:d().avatar,width:28,height:28}):(0,s.jsx)("div",{className:d().avatarPlaceholder}),(0,s.jsx)("div",{className:d().suggestionInfo,children:(0,s.jsxs)("span",{className:"".concat(d().handle," font-medium"),children:["@",e.handle]})})]})},e.did))}):(0,s.jsx)("div",{className:d().noResults,children:"No results found"})})]})}var m=n(6283),g=n(7764),f=n.n(g);let v=()=>(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"5"}),(0,s.jsx)("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),(0,s.jsx)("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),(0,s.jsx)("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),(0,s.jsx)("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),(0,s.jsx)("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),(0,s.jsx)("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),(0,s.jsx)("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),(0,s.jsx)("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]}),_=()=>(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}),x=()=>(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,s.jsx)("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),(0,s.jsx)("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})]});function p(){let e;let[t,n]=(0,a.useState)(!1),[o,r]=(0,a.useState)("system");try{e=(0,m.F)()}catch(e){}return((0,a.useEffect)(()=>{n(!0),e&&r(e.theme)},[e]),t)?(0,s.jsxs)("button",{className:"".concat(f().themeToggle," font-medium"),onClick:()=>{e&&("light"===o?(e.setTheme("dark"),r("dark")):"dark"===o?(e.setTheme("system"),r("system")):(e.setTheme("light"),r("light")))},"aria-label":"Switch to ".concat("light"===o?"dark":"dark"===o?"system":"light"," theme"),children:["light"===o?(0,s.jsx)(v,{}):"dark"===o?(0,s.jsx)(_,{}):(0,s.jsx)(x,{}),(0,s.jsx)("span",{className:"".concat(f().themeLabel," font-medium"),children:"light"===o?"Lights On":"dark"===o?"Lights Off":"System Lights"})]}):(0,s.jsxs)("button",{className:"".concat(f().themeToggle," font-medium"),"aria-label":"Theme toggle",children:[(0,s.jsx)(v,{}),(0,s.jsx)("span",{className:"".concat(f().themeLabel," font-medium"),children:"Lights On"})]})}var w=n(7758);function y(){let e=(0,i.usePathname)(),{isAuthenticated:t,signOut:n,session:a}=(0,w.a)(),l=async()=>{await n()};return(0,s.jsxs)("nav",{className:c().navbar,children:[(0,s.jsxs)("div",{className:c().navStart,children:[(0,s.jsx)(o.default,{href:"/",className:c().logo,children:(0,s.jsx)(r.default,{src:"/flushes-logo-horizontal.png",alt:"Flushes Logo",width:200,height:53,priority:!0,className:c().logoImage})}),(0,s.jsxs)("div",{className:c().navLinks,children:[(0,s.jsx)(o.default,{href:"/",className:"".concat(c().navLink," font-medium ").concat("/"===e?c().active:""),children:"Feed"}),(0,s.jsx)(o.default,{href:"/stats",className:"".concat(c().navLink," font-medium ").concat("/stats"===e?c().active:""),children:"Stats"}),(0,s.jsx)(o.default,{href:"/shortcut",className:"".concat(c().navLink," font-medium ").concat("/shortcut"===e?c().active:""),children:"Shortcut"}),(0,s.jsx)(o.default,{href:"/about",className:"".concat(c().navLink," font-medium ").concat("/about"===e?c().active:""),children:"About"}),t&&null]})]}),(0,s.jsxs)("div",{className:c().secondRow,children:[(0,s.jsx)("div",{className:c().navSearch,children:(0,s.jsx)(h,{})}),(0,s.jsxs)("div",{className:c().navEnd,children:[(0,s.jsx)(p,{}),t?(0,s.jsx)("button",{onClick:l,className:"".concat(c().authButton," font-medium"),children:"Logout"}):(0,s.jsx)(o.default,{href:"/auth/login",className:"".concat(c().authButton," font-medium"),children:"Login"})]})]})]})}},7758:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return d},a:function(){return h}});var s=n(7437),a=n(2265);let o=new(n(6297)).BrowserOAuthClient({clientMetadata:{client_id:"https://flushes.app/client-metadata.json",application_type:"web",client_name:"Flushes",client_uri:"https://flushes.app",logo_uri:"https://flushes.app/logo.png",tos_uri:"https://flushes.app/terms",policy_uri:"https://flushes.app/privacy",dpop_bound_access_tokens:!0,grant_types:["authorization_code","refresh_token"],redirect_uris:["https://flushes.app/auth/callback"],response_types:["code"],scope:"atproto transition:generic",token_endpoint_auth_method:"none"},handleResolver:"https://bsky.social",responseMode:"fragment"});async function r(){try{let e=await o.init();if(e){let{session:t}=e,n="state"in e?e.state:null;return console.log("OAuth client initialized with session for ".concat(t.sub)),n?console.log("User successfully authenticated with state: ".concat(n)):console.log("Restored previous session"),{session:t,state:n}}return console.log("OAuth client initialized without existing session"),null}catch(e){throw console.error("Failed to initialize OAuth client:",e),e}}async function i(e,t){try{console.log("Initiating OAuth flow for ".concat(e)),await o.signIn(e,{state:(null==t?void 0:t.state)||"signin-".concat(Date.now()),signal:null==t?void 0:t.signal})}catch(e){throw console.error("OAuth sign in failed:",e),e}}async function l(e){try{console.log("Restoring session for ".concat(e));let t=await o.restore(e);return console.log("Successfully restored session for ".concat(t.sub)),t}catch(t){throw console.error("Failed to restore session for ".concat(e,":"),t),t}}async function c(){try{console.log("Signing out user"),"undefined"!=typeof localStorage&&(localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("did"),localStorage.removeItem("handle"),localStorage.removeItem("keyPair"),localStorage.removeItem("dpopNonce"),localStorage.removeItem("pdsEndpoint"),localStorage.removeItem("bsky_auth_pdsEndpoint")),console.log("User signed out")}catch(e){throw console.error("Error during sign out:",e),e}}let u=(0,a.createContext)(void 0);function d(e){let{children:t}=e,[n,d]=(0,a.useState)(null),[h,m]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(async function(){try{m(!0);let e=await r();e&&(console.log("Initialized with existing session:",e.session.sub),d(e.session))}catch(e){console.error("Failed to initialize OAuth client:",e)}finally{m(!1)}})()},[]),(0,a.useEffect)(()=>{var e;e=e=>{let{sub:t,cause:n}=e;console.error("Session for ".concat(t," was invalidated:"),n),d(null)},o.addEventListener("deleted",t=>{let{sub:n,cause:s}=t.detail;console.error("Session for ".concat(n," was invalidated:"),s),e({sub:n,cause:s})})},[]);let g={session:n,isAuthenticated:!!n,isLoading:h,signIn:async e=>{try{await i(e)}catch(e){throw console.error("Sign in failed:",e),e}},signOut:async()=>{try{await c(),d(null)}catch(e){throw console.error("Sign out failed:",e),e}},restoreSession:async e=>{try{let t=await l(e);return d(t),t}catch(e){throw console.error("Failed to restore session:",e),e}},accessToken:n?"available":null,refreshToken:n?"available":null,did:(null==n?void 0:n.sub)||null,handle:null,pdsEndpoint:null};return(0,s.jsx)(u.Provider,{value:g,children:t})}function h(){let e=(0,a.useContext)(u);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6283:function(e,t,n){"use strict";n.d(t,{F:function(){return l},ThemeProvider:function(){return i}});var s=n(7437),a=n(2265);let o={theme:"system",setTheme:()=>{}},r=(0,a.createContext)(o);function i(e){let{children:t}=e,[n,i]=(0,a.useState)("system"),[l,c]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{{let e=localStorage.getItem("theme");e&&i(e),c(!0)}},[]),(0,a.useEffect)(()=>{if(!l)return;localStorage.setItem("theme",n);let e=window.document.documentElement;if("system"===n){let t=window.matchMedia("(prefers-color-scheme: dark)").matches;e.removeAttribute("data-theme"),t?e.classList.add("dark"):e.classList.remove("dark")}else e.setAttribute("data-theme",n),"dark"===n?e.classList.add("dark"):e.classList.remove("dark")},[n,l]),(0,a.useEffect)(()=>{if(!l)return;let e=window.matchMedia("(prefers-color-scheme: dark)"),t=()=>{if("system"===n){let t=window.document.documentElement;e.matches?t.classList.add("dark"):t.classList.remove("dark")}};return e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[n,l]),(0,s.jsx)(r.Provider,{value:l?{theme:n,setTheme:i}:o,children:t})}function l(){return(0,a.useContext)(r)}},2778:function(){},2457:function(e){e.exports={navbar:"NavigationBar_navbar___sCt7",navStart:"NavigationBar_navStart__5TUuk",navEnd:"NavigationBar_navEnd__nvGO6",navSearch:"NavigationBar_navSearch__zgfXx",secondRow:"NavigationBar_secondRow__OhkeH",logo:"NavigationBar_logo__vQNJd",logoImage:"NavigationBar_logoImage__iGztJ",navLinks:"NavigationBar_navLinks__omNwI",navLink:"NavigationBar_navLink__PLvAq",active:"NavigationBar_active__alj8w",authButton:"NavigationBar_authButton__cVaHE"}},8238:function(e){e.exports={searchContainer:"ProfileSearch_searchContainer__nkryP",searchForm:"ProfileSearch_searchForm__Rs543",searchInput:"ProfileSearch_searchInput__TJsTP",searchButton:"ProfileSearch_searchButton__AtwMw",suggestionsContainer:"ProfileSearch_suggestionsContainer__u1Ehi",suggestionsList:"ProfileSearch_suggestionsList__pCc7t",suggestionItem:"ProfileSearch_suggestionItem__M3kdV",suggestionButton:"ProfileSearch_suggestionButton__XgZKC",avatar:"ProfileSearch_avatar__mhRwa",avatarPlaceholder:"ProfileSearch_avatarPlaceholder__BnGoB",suggestionInfo:"ProfileSearch_suggestionInfo__iKQgP",displayName:"ProfileSearch_displayName__FGK0Y",handle:"ProfileSearch_handle__n7546",noResults:"ProfileSearch_noResults__dxeQv",loadingContainer:"ProfileSearch_loadingContainer__TSs7l",loadingDot:"ProfileSearch_loadingDot__hSDF_",dotPulse:"ProfileSearch_dotPulse__u_w4T"}},7764:function(e){e.exports={themeToggle:"ThemeToggle_themeToggle__4_hy9",themeLabel:"ThemeToggle_themeLabel__HmoV6"}}},function(e){e.O(0,[633,297,972,961,971,117,744],function(){return e(e.s=7105)}),_N_E=e.O()}]);