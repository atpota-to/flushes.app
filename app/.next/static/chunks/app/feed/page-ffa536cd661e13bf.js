(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[826],{56793:function(e,t,n){Promise.resolve().then(n.bind(n,29167))},27648:function(e,t,n){"use strict";n.d(t,{default:function(){return r.a}});var o=n(72972),r=n.n(o)},29167:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var o=n(57437),r=n(2265),a=n(27648),i=n(16943),s=n.n(i),l=n(57420),c=n(7766);function d(){let[e,t]=(0,r.useState)([]),[n,i]=(0,r.useState)(!0),[d,u]=(0,r.useState)(null),{isAuthenticated:h,handle:f}=(0,c.a)();(0,r.useEffect)(()=>{_()},[]);let _=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{i(!0),u(null);let n=await fetch(e?"/api/bluesky/feed?refresh=true":"/api/bluesky/feed",{cache:"no-store",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});if(!n.ok)throw Error("Failed to fetch feed: ".concat(n.status));let o=await n.json();t(o.entries)}catch(e){console.error("Error fetching feed:",e),u(e.message||"Failed to load feed")}finally{i(!1)}},m=async()=>{try{let n=document.getElementById("load-more-button"),o=null==n?void 0:n.getBoundingClientRect();i(!0),u(null);let r=e[e.length-1];if(!r)return;let a="/api/bluesky/feed?before=".concat(r.id),s=await fetch(a,{cache:"no-store",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});if(!s.ok)throw Error("Failed to fetch older entries: ".concat(s.status));let l=await s.json();l.entries&&l.entries.length>0&&(document.body.scrollHeight,t(e=>[...e,...l.entries]),o&&requestAnimationFrame(()=>{let e=document.getElementById("load-more-button");if(e){let t=e.getBoundingClientRect(),n=window.scrollY+(t.top-o.top);window.scrollTo({top:n,behavior:"instant"})}}))}catch(e){console.error("Error fetching older entries:",e),u(e.message||"Failed to load older entries")}finally{i(!1)}};return(0,o.jsxs)("div",{className:s().container,children:[(0,o.jsxs)("header",{className:s().header,children:[(0,o.jsx)("h1",{children:"Flushing Feed"}),(0,o.jsx)("p",{className:s().subtitle,children:"See what everyone is doing in the bathroom right now"})]}),(0,o.jsxs)("div",{className:s().controls,children:[(0,o.jsx)("button",{onClick:()=>_(!0),className:s().refreshButton,disabled:n,children:n?"Loading...":"Refresh Feed"}),(0,o.jsx)(a.default,{href:"/",className:s().homeLink,children:"Go to Dashboard"})]}),d&&(0,o.jsxs)("div",{className:s().error,children:["Error: ",d]}),n&&(0,o.jsxs)("div",{className:s().loadingContainer,children:[(0,o.jsx)("div",{className:s().loader}),(0,o.jsx)("p",{children:"Loading latest entries..."})]}),(0,o.jsx)("div",{className:s().feedList,children:e.length>0?(0,o.jsxs)(o.Fragment,{children:[e.map(e=>(0,o.jsxs)("div",{className:s().feedItem,children:[(0,o.jsxs)("div",{className:s().feedHeader,children:[(0,o.jsxs)("a",{href:"https://bsky.app/profile/".concat(e.authorHandle),target:"_blank",rel:"noopener noreferrer",className:s().authorLink,children:["@",e.authorHandle]}),(0,o.jsx)("span",{className:s().timestamp,children:(0,l.S)(e.createdAt)})]}),(0,o.jsxs)("div",{className:s().content,children:[(0,o.jsx)("span",{className:s().emoji,children:e.emoji}),(0,o.jsx)("span",{className:s().text,children:e.text.length>60?"".concat(e.text.substring(0,60),"..."):e.text})]})]},e.id)),(0,o.jsxs)("button",{className:s().loadMoreButton,id:"load-more-button",onClick:e=>{e.preventDefault(),m()},disabled:n,children:[n?"Loading...":"Load older flushes",!n&&(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,o.jsx)("polyline",{points:"7 13 12 18 17 13"}),(0,o.jsx)("polyline",{points:"7 6 12 11 17 6"})]})]})]}):n?null:(0,o.jsxs)("div",{className:s().emptyState,children:[(0,o.jsx)("p",{children:"No entries found. Be the first to share your status!"}),(0,o.jsx)(a.default,{href:"/",className:s().createButton,children:"Create Status"})]})})]})}},7766:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return i},a:function(){return s}});var o=n(57437),r=n(2265);let a=(0,r.createContext)(void 0);function i(e){let{children:t}=e,[i,s]=(0,r.useState)(null),[l,c]=(0,r.useState)(!0),[d,u]=(0,r.useState)(!1);(0,r.useEffect)(()=>{u(!0)},[]),(0,r.useEffect)(()=>{d&&e();async function e(){try{c(!0);let{initializeOAuthClient:e}=await Promise.all([n.e(473),n.e(297),n.e(494)]).then(n.bind(n,62494)),t=await e();t&&(console.log("Initialized with existing session:",t.session.sub),s(t.session))}catch(e){console.error("Failed to initialize OAuth client:",e)}finally{c(!1)}}},[d]),(0,r.useEffect)(()=>{d&&e();async function e(){try{let{onSessionDeleted:e}=await Promise.all([n.e(473),n.e(297),n.e(494)]).then(n.bind(n,62494));e(e=>{let{sub:t,cause:n}=e;console.error("Session for ".concat(t," was invalidated:"),n),s(null)})}catch(e){console.error("Failed to set up session listener:",e)}}},[d]);let h=async e=>{if(!d)throw Error("Sign in can only be called on the client side");try{let{signIn:t}=await Promise.all([n.e(473),n.e(297),n.e(494)]).then(n.bind(n,62494));await t(e)}catch(e){throw console.error("Sign in failed:",e),e}},f=async()=>{if(!d)throw Error("Sign out can only be called on the client side");try{let{signOut:e}=await Promise.all([n.e(473),n.e(297),n.e(494)]).then(n.bind(n,62494));await e(),s(null)}catch(e){throw console.error("Sign out failed:",e),e}},_=async e=>{if(!d)throw Error("Restore session can only be called on the client side");try{let{restoreSession:t}=await Promise.all([n.e(473),n.e(297),n.e(494)]).then(n.bind(n,62494)),o=await t(e);return s(o),o}catch(e){throw console.error("Failed to restore session:",e),e}},m={session:i,isAuthenticated:!!i,isLoading:l||!d,signIn:h,signOut:f,restoreSession:_,accessToken:i?"available":null,refreshToken:i?"available":null,did:(null==i?void 0:i.sub)||null,handle:null,pdsEndpoint:null};return(0,o.jsx)(a.Provider,{value:m,children:t})}function s(){let e=(0,r.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},57420:function(e,t,n){"use strict";function o(e){if(!e)return"";let t=new Date(e),n=Math.floor((new Date().getTime()-t.getTime())/1e3);if(n<60)return"just now";let o=Math.floor(n/60);if(o<60)return"".concat(o,"m ago");let r=Math.floor(o/60);if(r<24)return"".concat(r,"h ago");let a=Math.floor(r/24);if(a<7)return"".concat(a,"d ago");let i=Math.floor(a/7);return i<5?"".concat(i,"w ago"):t.toLocaleDateString()}n.d(t,{S:function(){return o}})},16943:function(e){e.exports={container:"feed_container__nG1tI",header:"feed_header__4_ZHf",subtitle:"feed_subtitle__rTQWA",controls:"feed_controls__U5avg",refreshButton:"feed_refreshButton__7Bdqy",homeLink:"feed_homeLink__J_o_Z",error:"feed_error___6sQj",notice:"feed_notice__N9Fj6",noticePersonal:"feed_noticePersonal__EftxR",noticeLink:"feed_noticeLink__wkIBT",loadingContainer:"feed_loadingContainer__VS_Xq",loader:"feed_loader__BiqH5",spin:"feed_spin__G11M7",feedList:"feed_feedList___nxgR",feedItem:"feed_feedItem__c4y8q",feedHeader:"feed_feedHeader__5crAs",authorLink:"feed_authorLink____B3_",timestamp:"feed_timestamp__MUllz",content:"feed_content__9vYaL",emoji:"feed_emoji__yR154",text:"feed_text__6Ecm4",emptyState:"feed_emptyState__m_gzq",loadMoreButton:"feed_loadMoreButton__ax_9T",createButton:"feed_createButton__5Dkqy"}}},function(e){e.O(0,[579,972,971,117,744],function(){return e(e.s=56793)}),_N_E=e.O()}]);