(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[826],{6793:function(e,t,o){Promise.resolve().then(o.bind(o,9167))},7648:function(e,t,o){"use strict";o.d(t,{default:function(){return r.a}});var n=o(6779),r=o.n(n)},9167:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return d}});var n=o(7437),r=o(2265),s=o(7648),a=o(6943),i=o.n(a),l=o(5443),c=o(7758);function d(){let[e,t]=(0,r.useState)([]),[o,a]=(0,r.useState)(!0),[d,u]=(0,r.useState)(null),{isAuthenticated:h,handle:f}=(0,c.a)();(0,r.useEffect)(()=>{_()},[]);let _=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{a(!0),u(null);let o=await fetch(e?"/api/bluesky/feed?refresh=true":"/api/bluesky/feed",{cache:"no-store",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});if(!o.ok)throw Error("Failed to fetch feed: ".concat(o.status));let n=await o.json();t(n.entries)}catch(e){console.error("Error fetching feed:",e),u(e.message||"Failed to load feed")}finally{a(!1)}},g=async()=>{try{let o=document.getElementById("load-more-button"),n=null==o?void 0:o.getBoundingClientRect();a(!0),u(null);let r=e[e.length-1];if(!r)return;let s="/api/bluesky/feed?before=".concat(r.id),i=await fetch(s,{cache:"no-store",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});if(!i.ok)throw Error("Failed to fetch older entries: ".concat(i.status));let l=await i.json();l.entries&&l.entries.length>0&&(document.body.scrollHeight,t(e=>[...e,...l.entries]),n&&requestAnimationFrame(()=>{let e=document.getElementById("load-more-button");if(e){let t=e.getBoundingClientRect(),o=window.scrollY+(t.top-n.top);window.scrollTo({top:o,behavior:"instant"})}}))}catch(e){console.error("Error fetching older entries:",e),u(e.message||"Failed to load older entries")}finally{a(!1)}};return(0,n.jsxs)("div",{className:i().container,children:[(0,n.jsxs)("header",{className:i().header,children:[(0,n.jsx)("h1",{children:"Flushing Feed"}),(0,n.jsx)("p",{className:i().subtitle,children:"See what everyone is doing in the bathroom right now"})]}),(0,n.jsxs)("div",{className:i().controls,children:[(0,n.jsx)("button",{onClick:()=>_(!0),className:i().refreshButton,disabled:o,children:o?"Loading...":"Refresh Feed"}),(0,n.jsx)(s.default,{href:"/",className:i().homeLink,children:"Go to Dashboard"})]}),d&&(0,n.jsxs)("div",{className:i().error,children:["Error: ",d]}),o&&(0,n.jsxs)("div",{className:i().loadingContainer,children:[(0,n.jsx)("div",{className:i().loader}),(0,n.jsx)("p",{children:"Loading latest entries..."})]}),(0,n.jsx)("div",{className:i().feedList,children:e.length>0?(0,n.jsxs)(n.Fragment,{children:[e.map(e=>(0,n.jsxs)("div",{className:i().feedItem,children:[(0,n.jsxs)("div",{className:i().feedHeader,children:[(0,n.jsxs)("a",{href:"https://bsky.app/profile/".concat(e.authorHandle),target:"_blank",rel:"noopener noreferrer",className:i().authorLink,children:["@",e.authorHandle]}),(0,n.jsx)("span",{className:i().timestamp,children:(0,l.S)(e.createdAt)})]}),(0,n.jsxs)("div",{className:i().content,children:[(0,n.jsx)("span",{className:i().emoji,children:e.emoji}),(0,n.jsx)("span",{className:i().text,children:e.text.length>60?"".concat(e.text.substring(0,60),"..."):e.text})]})]},e.id)),(0,n.jsxs)("button",{className:i().loadMoreButton,id:"load-more-button",onClick:e=>{e.preventDefault(),g()},disabled:o,children:[o?"Loading...":"Load older flushes",!o&&(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)("polyline",{points:"7 13 12 18 17 13"}),(0,n.jsx)("polyline",{points:"7 6 12 11 17 6"})]})]})]}):o?null:(0,n.jsxs)("div",{className:i().emptyState,children:[(0,n.jsx)("p",{children:"No entries found. Be the first to share your status!"}),(0,n.jsx)(s.default,{href:"/",className:i().createButton,children:"Create Status"})]})})]})}},7758:function(e,t,o){"use strict";o.d(t,{AuthProvider:function(){return u},a:function(){return h}});var n=o(7437),r=o(2265);let s=new(o(6297)).BrowserOAuthClient({clientMetadata:{client_id:"https://flushes.app/client-metadata.json",application_type:"web",client_name:"Flushes",client_uri:"https://flushes.app",logo_uri:"https://flushes.app/logo.png",tos_uri:"https://flushes.app/terms",policy_uri:"https://flushes.app/privacy",dpop_bound_access_tokens:!0,grant_types:["authorization_code","refresh_token"],redirect_uris:["https://flushes.app/auth/callback"],response_types:["code"],scope:"atproto transition:generic",token_endpoint_auth_method:"none"},handleResolver:"https://bsky.social",responseMode:"fragment"});async function a(){try{let e=await s.init();if(e){let{session:t}=e,o="state"in e?e.state:null;return console.log("OAuth client initialized with session for ".concat(t.sub)),o?console.log("User successfully authenticated with state: ".concat(o)):console.log("Restored previous session"),{session:t,state:o}}return console.log("OAuth client initialized without existing session"),null}catch(e){throw console.error("Failed to initialize OAuth client:",e),e}}async function i(e,t){try{console.log("Initiating OAuth flow for ".concat(e)),await s.signIn(e,{state:(null==t?void 0:t.state)||"signin-".concat(Date.now()),signal:null==t?void 0:t.signal})}catch(e){throw console.error("OAuth sign in failed:",e),e}}async function l(e){try{console.log("Restoring session for ".concat(e));let t=await s.restore(e);return console.log("Successfully restored session for ".concat(t.sub)),t}catch(t){throw console.error("Failed to restore session for ".concat(e,":"),t),t}}async function c(){try{console.log("Signing out user"),"undefined"!=typeof localStorage&&(localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("did"),localStorage.removeItem("handle"),localStorage.removeItem("keyPair"),localStorage.removeItem("dpopNonce"),localStorage.removeItem("pdsEndpoint"),localStorage.removeItem("bsky_auth_pdsEndpoint")),console.log("User signed out")}catch(e){throw console.error("Error during sign out:",e),e}}let d=(0,r.createContext)(void 0);function u(e){let{children:t}=e,[o,u]=(0,r.useState)(null),[h,f]=(0,r.useState)(!0);(0,r.useEffect)(()=>{(async function(){try{f(!0);let e=await a();e&&(console.log("Initialized with existing session:",e.session.sub),u(e.session))}catch(e){console.error("Failed to initialize OAuth client:",e)}finally{f(!1)}})()},[]),(0,r.useEffect)(()=>{var e;e=e=>{let{sub:t,cause:o}=e;console.error("Session for ".concat(t," was invalidated:"),o),u(null)},s.addEventListener("deleted",t=>{let{sub:o,cause:n}=t.detail;console.error("Session for ".concat(o," was invalidated:"),n),e({sub:o,cause:n})})},[]);let _={session:o,isAuthenticated:!!o,isLoading:h,signIn:async e=>{try{await i(e)}catch(e){throw console.error("Sign in failed:",e),e}},signOut:async()=>{try{await c(),u(null)}catch(e){throw console.error("Sign out failed:",e),e}},restoreSession:async e=>{try{let t=await l(e);return u(t),t}catch(e){throw console.error("Failed to restore session:",e),e}},accessToken:o?"available":null,refreshToken:o?"available":null,did:(null==o?void 0:o.sub)||null,handle:null,pdsEndpoint:null};return(0,n.jsx)(d.Provider,{value:_,children:t})}function h(){let e=(0,r.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},5443:function(e,t,o){"use strict";function n(e){if(!e)return"";let t=new Date(e),o=Math.floor((new Date().getTime()-t.getTime())/1e3);if(o<60)return"just now";let n=Math.floor(o/60);if(n<60)return"".concat(n,"m ago");let r=Math.floor(n/60);if(r<24)return"".concat(r,"h ago");let s=Math.floor(r/24);if(s<7)return"".concat(s,"d ago");let a=Math.floor(s/7);return a<5?"".concat(a,"w ago"):t.toLocaleDateString()}o.d(t,{S:function(){return n}})},6943:function(e){e.exports={container:"feed_container__nG1tI",header:"feed_header__4_ZHf",subtitle:"feed_subtitle__rTQWA",controls:"feed_controls__U5avg",refreshButton:"feed_refreshButton__7Bdqy",homeLink:"feed_homeLink__J_o_Z",error:"feed_error___6sQj",notice:"feed_notice__N9Fj6",noticePersonal:"feed_noticePersonal__EftxR",noticeLink:"feed_noticeLink__wkIBT",loadingContainer:"feed_loadingContainer__VS_Xq",loader:"feed_loader__BiqH5",spin:"feed_spin__G11M7",feedList:"feed_feedList___nxgR",feedItem:"feed_feedItem__c4y8q",feedHeader:"feed_feedHeader__5crAs",authorLink:"feed_authorLink____B3_",timestamp:"feed_timestamp__MUllz",content:"feed_content__9vYaL",emoji:"feed_emoji__yR154",text:"feed_text__6Ecm4",emptyState:"feed_emptyState__m_gzq",loadMoreButton:"feed_loadMoreButton__ax_9T",createButton:"feed_createButton__5Dkqy"}}},function(e){e.O(0,[579,297,972,971,117,744],function(){return e(e.s=6793)}),_N_E=e.O()}]);