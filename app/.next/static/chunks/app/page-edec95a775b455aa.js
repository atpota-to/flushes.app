(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{27374:function(e,t,n){Promise.resolve().then(n.bind(n,16117))},27648:function(e,t,n){"use strict";n.d(t,{default:function(){return o.a}});var a=n(72972),o=n.n(a)},99376:function(e,t,n){"use strict";var a=n(35475);n.o(a,"useParams")&&n.d(t,{useParams:function(){return a.useParams}}),n.o(a,"usePathname")&&n.d(t,{usePathname:function(){return a.usePathname}}),n.o(a,"useRouter")&&n.d(t,{useRouter:function(){return a.useRouter}})},16117:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return h}});var a=n(57437),o=n(2265),s=n(27648),r=n(99376),i=n(42293),l=n.n(i),c=n(7766),u=n(68792),d=n(57420);function h(){(0,r.useRouter)();let{isAuthenticated:e,session:t,signOut:i}=(0,c.a)(),h=null==t?void 0:t.sub,[g,p]=(0,o.useState)("is "),[f,D]=(0,o.useState)("\uD83D\uDEBD"),[_,m]=(0,o.useState)(!1),[x,b]=(0,o.useState)(!1),[E,j]=(0,o.useState)(null),[w,v]=(0,o.useState)(null),[y,N]=(0,o.useState)([]),[C,k]=(0,o.useState)(!0),[L,S]=(0,o.useState)(null),[A,P]=(0,o.useState)(new Set);(0,o.useEffect)(()=>{T(!0)},[]);let F=e=>{D(e)},B=()=>{if("did:plc:fouf3svmcxzn6bpiw3lgwz22"===h)return console.log("Plumber account detected - bypassing rate limits"),!0;let e=Date.now()-18e5;return y.filter(t=>t.authorDid===h&&new Date(t.createdAt).getTime()>e).length<2},I=async a=>{if(a.preventDefault(),!t||!e){j("Please sign in to post a flush");return}if(g&&(0,u.Lt)(g)){j("Uh oh, looks like you have a potty mouth. Try flushing again, but go a bit easier on the language please... this is a semi-family-friendly restroom");return}if(!B()){j("Trying to make more than 2 flushes in 30 minutes?? Might be time to get the plunger. \uD83E\uDEA0 Regular users are limited to 2 flushes per 30 minutes.");return}b(!0),j(null),v(null);try{let{createPost:e}=await Promise.all([n.e(684),n.e(985),n.e(473),n.e(856),n.e(227)]).then(n.bind(n,3227)),a=g.trim();a&&"is"!==a?a.toLowerCase().startsWith("is ")||(a="is ".concat(a)):a="is flushing";let o="".concat("Someone"," ").concat(a," ").concat(f),s=await e(t,{text:o,langs:["en"]});console.log("Status update result:",s),p("is "),v("Your flushing status has been updated!"),setTimeout(()=>{m(!1)},2e3),setTimeout(()=>{console.log("Refreshing feed to show new entry..."),T(!0)},2500)}catch(e){console.error("Failed to update status:",e),j("Failed to update status: ".concat(e.message||"Unknown error"))}finally{b(!1)}},T=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{var t;k(!0),S(null);let n=Date.now(),a=e?"/api/bluesky/feed-simple?refresh=true&_t=".concat(n):"/api/bluesky/feed-simple?_t=".concat(n);console.log("Fetching feed from ".concat(a," at ").concat(new Date().toISOString()));let o=await fetch(a,{method:"GET",cache:"no-store",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});if(!o.ok)throw Error("Failed to fetch feed: ".concat(o.status));let s=await o.json();if(console.log("Received ".concat((null===(t=s.entries)||void 0===t?void 0:t.length)||0," entries from API")),s.entries&&s.entries.length>0){console.log("Latest entries from API:");for(let e=0;e<Math.min(3,s.entries.length);e++){let t=s.entries[e];console.log("  ".concat(e+1,". ID: ").concat(t.id,", Handle: @").concat(t.authorHandle,', Text: "').concat(t.text.substring(0,20),'..."'))}}if(y.length>0){let e=new Set(y.map(e=>e.id)),t=s.entries.filter(t=>!e.has(t.id));t.length>0?(console.log("Found ".concat(t.length," new entries")),P(new Set(t.map(e=>e.id))),setTimeout(()=>{P(new Set)},2e3)):console.log("No new entries found in this update")}N(s.entries)}catch(e){console.error("Error fetching feed:",e),S(e.message||"Failed to load feed")}finally{k(!1)}},O=async()=>{try{let e=window.scrollY;k(!0),S(null);let t=y[y.length-1];if(!t)return;console.log("Loading older entries before ID ".concat(t.id));let n="/api/bluesky/feed-simple?before=".concat(t.id,"&_t=").concat(Date.now()),a=await fetch(n,{cache:"no-store",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});if(!a.ok)throw Error("Failed to fetch older entries: ".concat(a.status));let o=await a.json();if(o.entries&&o.entries.length>0){console.log("Loaded ".concat(o.entries.length," older entries"));for(let e=0;e<Math.min(3,o.entries.length);e++){let t=o.entries[e];console.log("  Older ".concat(e+1,". ID: ").concat(t.id,", Handle: @").concat(t.authorHandle,', Text: "').concat(t.text.substring(0,20),'..."'))}N([...y,...o.entries]),setTimeout(()=>{window.scrollTo({top:e,behavior:"instant"})},0)}else console.log("No older entries found")}catch(e){console.error("Error fetching older entries:",e),S(e.message||"Failed to load older entries")}finally{k(!1)}};return(0,a.jsxs)("div",{className:l().container,children:[(0,a.jsx)("header",{className:l().header,children:(0,a.jsxs)("div",{className:l().headerContent,children:[(0,a.jsx)("h1",{className:l().tagline,children:"The Decentralized Toilet Network of Planet Earth & Simulation 12B"}),(0,a.jsx)("p",{className:l().description,children:'Share a "flush" whenever you\'re in the bathroom.'}),(0,a.jsxs)("p",{className:l().donateText,children:["Like the app? Donate to ",(0,a.jsx)("a",{href:"https://ko-fi.com/dameis",target:"_blank",rel:"noopener noreferrer",className:l().kofiLink,children:"our toilet paper fund"}),"."]}),(0,a.jsxs)("p",{className:l().creditLine,children:["Made by ",(0,a.jsx)("a",{href:"https://bsky.app/profile/dame.is",target:"_blank",rel:"noopener noreferrer",children:"@dame.is"})," and ",(0,a.jsx)("a",{href:"https://bsky.app/profile/atpota.to",target:"_blank",rel:"noopener noreferrer",children:"@atpota.to"})]})]})}),e&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{className:"".concat(l().toggleButton," ").concat(_?l().toggleButtonActive:""),onClick:()=>{m(!_),j(null),v(null)},children:[_?"Close":"Update your status",(0,a.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M19 9L12 16L5 9",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]}),(0,a.jsx)("div",{className:"".concat(l().statusUpdateContainer," ").concat(_?l().statusUpdateOpen:""),children:(0,a.jsxs)("div",{className:l().card,children:[E&&(0,a.jsx)("div",{className:l().error,children:E}),w&&(0,a.jsx)("div",{className:l().success,children:w}),(0,a.jsxs)("form",{onSubmit:I,className:l().form,children:[(0,a.jsxs)("div",{className:l().formGroup,children:[(0,a.jsx)("label",{children:"Select an emoji for your status"}),(0,a.jsx)("div",{className:l().emojiGrid,children:["\uD83D\uDEBD","\uD83E\uDDFB","\uD83D\uDCA9","\uD83D\uDCA8","\uD83D\uDEBE","\uD83E\uDDFC","\uD83E\uDEA0","\uD83D\uDEBB","\uD83E\uDE78","\uD83D\uDCA7","\uD83D\uDCA6","\uD83D\uDE0C","\uD83D\uDE23","\uD83E\uDD22","\uD83E\uDD2E","\uD83E\uDD74","\uD83D\uDE2E‍\uD83D\uDCA8","\uD83D\uDE33","\uD83D\uDE35","\uD83C\uDF3E","\uD83C\uDF66","\uD83D\uDCF1","\uD83D\uDCD6","\uD83D\uDCAD","1️⃣","2️⃣","\uD83D\uDFE1","\uD83D\uDFE4"].map(e=>(0,a.jsx)("button",{type:"button",className:"".concat(l().emojiButton," ").concat(e===f?l().selectedEmoji:""),onClick:()=>F(e),disabled:x,"aria-label":"Select emoji ".concat(e),children:e},e))})]}),(0,a.jsxs)("div",{className:l().formGroup,children:[(0,a.jsx)("label",{htmlFor:"status",children:"What's your status? (optional)"}),(0,a.jsxs)("div",{className:l().inputWrapper,children:[(0,a.jsx)("span",{className:l().inputPrefix,children:"is "}),(0,a.jsx)("input",{type:"text",id:"status",value:g.startsWith("is ")?g.substring(3):g,onChange:e=>p("is ".concat(e.target.value)),placeholder:"flushing",maxLength:56,className:l().inputWithPrefix,disabled:x})]}),(0,a.jsxs)("div",{className:l().charCount,children:[g.length,"/59"]})]}),(0,a.jsx)("button",{type:"submit",className:l().submitButton,disabled:x,children:x?"Flushing...":"Post Flush"})]})]})})]}),(0,a.jsxs)("div",{className:l().feedSection,children:[(0,a.jsxs)("div",{className:l().feedHeader,children:[(0,a.jsxs)("div",{className:l().feedHeaderLeft,children:[(0,a.jsx)("h2",{children:"Recent flushes"}),(0,a.jsx)("p",{className:l().feedSubheader,children:"Click on a username to see their flushes profile."})]}),(0,a.jsx)("button",{onClick:async()=>{try{var e;k(!0),S(null);let t=Date.now(),n="/api/bluesky/feed-simple?refresh=true&_t=".concat(t);console.log("\uD83D\uDD04 MANUAL REFRESH @ ".concat(new Date().toISOString())),console.log("Using simple API URL: ".concat(n));let a=await fetch(n,{method:"GET",cache:"no-store",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0","X-Force-Fresh-Data":"true"}});if(!a.ok)throw console.error("API error: ".concat(a.status,", ").concat(a.statusText)),Error("API error: ".concat(a.status));console.log("Response headers:",Object.fromEntries(a.headers.entries()));let o=await a.json();if(console.log("Refresh received ".concat((null===(e=o.entries)||void 0===e?void 0:e.length)||0," entries")),o.entries&&o.entries.length>0){console.log("\uD83D\uDD0D Highest ID from refresh: ".concat(o.entries[0].id));for(let e=0;e<Math.min(5,o.entries.length);e++)console.log("  ".concat(e+1,". ID: ").concat(o.entries[e].id,", Handle: @").concat(o.entries[e].authorHandle,', Text: "').concat(o.entries[e].text.substring(0,20),'..."'));if(y.length>0){let e=y[0].id,t=o.entries[0].id;console.log("\uD83D\uDCCA Comparison - Current highest ID: ".concat(e,", New highest ID: ").concat(t)),t>e?console.log("✅ Refresh successful! New entries are more recent."):t===e?console.log("⚠️ Refresh returned same highest ID - no newer entries available."):console.warn("❌ WARNING: New entries have lower IDs than existing ones!")}}else console.log("No entries returned from refresh");N(o.entries||[])}catch(e){console.error("Manual refresh error:",e),S("Failed to refresh. Try again.")}finally{k(!1)}},className:l().refreshButton,disabled:C,children:C?"Loading...":"Refresh"})]}),L&&(0,a.jsx)("div",{className:l().error,children:L}),y&&y.length>0&&(0,a.jsx)("div",{className:l().debugInfo,style:{fontSize:"10px",color:"#666",margin:"5px 0",display:"none"},children:(0,a.jsxs)("p",{children:["Debug: Latest entry ID: ",y[0].id,", Count: ",y.length]})}),C?(0,a.jsxs)("div",{className:l().loadingContainer,children:[(0,a.jsx)("div",{className:l().loader}),(0,a.jsx)("p",{children:"Loading latest entries..."})]}):(0,a.jsx)("div",{className:l().feedList,children:y.length>0?(()=>{let e=y.filter(e=>(0,u.$B)(e.emoji));return e.length>0?(0,a.jsxs)(a.Fragment,{children:[e.map(e=>(0,a.jsx)("div",{className:"".concat(l().feedItem," ").concat(A.has(e.id)?l().newFeedItem:""),children:(0,a.jsxs)("div",{className:l().content,children:[(0,a.jsxs)("div",{className:l().contentLeft,children:[(0,a.jsx)("span",{className:l().emoji,children:e.emoji}),(0,a.jsxs)(s.default,{href:"/profile/".concat(e.authorHandle),className:l().authorLink,children:["@",e.authorHandle]}),(0,a.jsx)("span",{className:l().text,children:e.text?e.authorHandle&&e.authorHandle.endsWith(".is")&&(0,u.oO)(e.text).toLowerCase().startsWith("is ")?e.text.length>63?"".concat((0,u.oO)(e.text.substring(3,63)),"..."):(0,u.oO)(e.text.substring(3)):e.text.length>60?"".concat((0,u.oO)(e.text.substring(0,60)),"..."):(0,u.oO)(e.text):e.authorHandle&&e.authorHandle.endsWith(".is")?"flushing":"is flushing"})]}),(0,a.jsx)("span",{className:l().timestamp,children:(0,d.S)(e.createdAt)})]})},e.id)),(0,a.jsxs)("button",{className:l().loadMoreButton,onClick:e=>{e.preventDefault(),O()},disabled:C,children:[C?"Loading...":"Load older flushes",!C&&(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("polyline",{points:"7 13 12 18 17 13"}),(0,a.jsx)("polyline",{points:"7 6 12 11 17 6"})]})]})]}):(0,a.jsx)("div",{className:l().emptyState,children:(0,a.jsx)("p",{children:"No valid entries found. Login and be the first to share your status!"})})})():(0,a.jsx)("div",{className:l().emptyState,children:(0,a.jsx)("p",{children:"No entries found. Login and be the first to share your status!"})})})]})]})}},7766:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return r},a:function(){return i}});var a=n(57437),o=n(2265);let s=(0,o.createContext)(void 0);function r(e){let{children:t}=e,[r,i]=(0,o.useState)(null),[l,c]=(0,o.useState)(!0),[u,d]=(0,o.useState)(!1);(0,o.useEffect)(()=>{d(!0)},[]),(0,o.useEffect)(()=>{u&&e();async function e(){try{c(!0);let{initializeOAuthClient:e}=await Promise.all([n.e(473),n.e(297),n.e(494)]).then(n.bind(n,62494)),t=await e();t&&(console.log("Initialized with existing session:",t.session.sub),i(t.session))}catch(e){console.error("Failed to initialize OAuth client:",e)}finally{c(!1)}}},[u]),(0,o.useEffect)(()=>{u&&e();async function e(){try{let{onSessionDeleted:e}=await Promise.all([n.e(473),n.e(297),n.e(494)]).then(n.bind(n,62494));e(e=>{let{sub:t,cause:n}=e;console.error("Session for ".concat(t," was invalidated:"),n),i(null)})}catch(e){console.error("Failed to set up session listener:",e)}}},[u]);let h=async e=>{if(!u)throw Error("Sign in can only be called on the client side");try{let{signIn:t}=await Promise.all([n.e(473),n.e(297),n.e(494)]).then(n.bind(n,62494));await t(e)}catch(e){throw console.error("Sign in failed:",e),e}},g=async()=>{if(!u)throw Error("Sign out can only be called on the client side");try{let{signOut:e}=await Promise.all([n.e(473),n.e(297),n.e(494)]).then(n.bind(n,62494));await e(),i(null)}catch(e){throw console.error("Sign out failed:",e),e}},p=async e=>{if(!u)throw Error("Restore session can only be called on the client side");try{let{restoreSession:t}=await Promise.all([n.e(473),n.e(297),n.e(494)]).then(n.bind(n,62494)),a=await t(e);return i(a),a}catch(e){throw console.error("Failed to restore session:",e),e}},f={session:r,isAuthenticated:!!r,isLoading:l||!u,signIn:h,signOut:g,restoreSession:p,accessToken:r?"available":null,refreshToken:r?"available":null,did:(null==r?void 0:r.sub)||null,handle:null,pdsEndpoint:null};return(0,a.jsx)(s.Provider,{value:f,children:t})}function i(){let e=(0,o.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},68792:function(e,t,n){"use strict";n.d(t,{$B:function(){return i},Lt:function(){return s},oO:function(){return r}});let a=["slur","racist","bigot","bigotry","homophobic","transphobic","fuck","damn","ass","asshole","bitch","kill","murder","attack","violence","harm","hurt","retard","retarded","idiot","stupid","dumb","penis","vagina","dick","cock","pussy","sex","masturbate","orgasm","horny","erection","blowjob","handjob","viagra","cialis","enlarge","cryptocurrency","bitcoin","ethereum","make money","get rich","earn fast","pyramid","scheme","discord.gg","telegram.me"],o=[/\bc[hH][iIl1][nN][kKsS]?\b/,/\bc[oO]{2}[nN][sS]?\b/,/\bf[aA][gG]{1,2}([oOeE][tT]?|[iIyY][nNeE]?)?s?\b/,/\bk[iIyY][kK][eE][sS]?\b/,/\bn[iIl1oO][gG]{2}([aAeE][rR]?|[lL][eE][tT]|[nNoO][gG])?s?\b/,/\bn[iIl1oO][gG]{2}[aAeE][sS]\b/,/\bt[rR][aA][nN][nN][iIyY][eE]?[sS]?\b/];function s(e){if(!e)return!1;let t=e.toLowerCase().replace(/0/g,"o").replace(/1/g,"i").replace(/3/g,"e").replace(/4/g,"a").replace(/5/g,"s").replace(/\$/g,"s").replace(/@/g,"a").replace(/!/g,"i").replace(/\*/g,"").replace(/\./g,"").replace(/-/g,"").replace(/_/g,"").replace(/\s+/g," ");for(let t of o)if(t.test(e))return!0;return a.some(e=>{if(RegExp("\\b".concat(e,"\\b"),"i").test(t))return!0;let n=e.split("").join("\\s*");return!!RegExp("\\b".concat(n,"\\b"),"i").test(t)||e.length<=4&&RegExp(e,"i").test(t)})}function r(e){if(!e)return e;let t=e;return a.forEach(e=>{let n=RegExp("\\b".concat(e,"\\b"),"gi");t=t.replace(n,"*".repeat(e.length))}),a.forEach(e=>{if(e.length>2){let n=e.split("").join("\\s*"),a=RegExp("\\b".concat(n,"\\b"),"gi");t=t.replace(a,e=>"*".repeat(e.replace(/\s+/g,"").length))}}),a.filter(e=>e.length<=4).forEach(e=>{let n=RegExp("(?<!\\w)".concat(e,"(?!\\w)"),"gi");t=t.replace(n,"*".repeat(e.length))}),t}function i(e){return["\uD83D\uDEBD","\uD83E\uDDFB","\uD83D\uDCA9","\uD83D\uDCA8","\uD83D\uDEBE","\uD83E\uDDFC","\uD83E\uDEA0","\uD83D\uDEBB","\uD83E\uDE78","\uD83D\uDCA7","\uD83D\uDCA6","\uD83D\uDE0C","\uD83D\uDE23","\uD83E\uDD22","\uD83E\uDD2E","\uD83E\uDD74","\uD83D\uDE2E‍\uD83D\uDCA8","\uD83D\uDE33","\uD83D\uDE35","\uD83C\uDF3E","\uD83C\uDF66","\uD83D\uDCF1","\uD83D\uDCD6","\uD83D\uDCAD","1️⃣","2️⃣","\uD83D\uDFE1","\uD83D\uDFE4"].includes(e)}},57420:function(e,t,n){"use strict";function a(e){if(!e)return"";let t=new Date(e),n=Math.floor((new Date().getTime()-t.getTime())/1e3);if(n<60)return"just now";let a=Math.floor(n/60);if(a<60)return"".concat(a,"m ago");let o=Math.floor(a/60);if(o<24)return"".concat(o,"h ago");let s=Math.floor(o/24);if(s<7)return"".concat(s,"d ago");let r=Math.floor(s/7);return r<5?"".concat(r,"w ago"):t.toLocaleDateString()}n.d(t,{S:function(){return a}})},42293:function(e){e.exports={container:"page_container__aoG4z",header:"page_header__kVzhN",headerContent:"page_headerContent__bPi_q",tagline:"page_tagline___8E6T",description:"page_description__86bsR",donateText:"page_donateText__y1qOw",creditLine:"page_creditLine__KP9GN",kofiLink:"page_kofiLink__3Ydr6",userInfo:"page_userInfo__EuccZ",logoutButton:"page_logoutButton__K4PKs",loginButton:"page_loginButton__KoiDv",statusUpdateContainer:"page_statusUpdateContainer__gmQ6p",statusUpdateOpen:"page_statusUpdateOpen__OjVrc",toggleButton:"page_toggleButton__8cAdz",toggleButtonActive:"page_toggleButtonActive__yVpt8",card:"page_card__QV0Om",form:"page_form__Ou5d6",formGroup:"page_formGroup__z71No",emojiNote:"page_emojiNote__EC6g5",input:"page_input___cVLA",inputWrapper:"page_inputWrapper__ApSA2",inputPrefix:"page_inputPrefix__80yQZ",inputWithPrefix:"page_inputWithPrefix__1V0o8",charCount:"page_charCount__pvQ1F",emojiGrid:"page_emojiGrid__OJb8z",emojiButton:"page_emojiButton__MpF11",selectedEmoji:"page_selectedEmoji__RwgbL",preview:"page_preview__ltt8S",previewTitle:"page_previewTitle__q11Le",previewContent:"page_previewContent__rZ9k8",previewEmoji:"page_previewEmoji__EYnc0",submitButton:"page_submitButton__6O8qB",success:"page_success__Xb9nl",feedSection:"page_feedSection__KCj_s",newFeedItem:"page_newFeedItem__k_9xP",slideIn:"page_slideIn__TYhrx",feedHeader:"page_feedHeader__Qudm2",feedHeaderLeft:"page_feedHeaderLeft__Oj10v",feedSubheader:"page_feedSubheader__LTbXG",statsLink:"page_statsLink__iZWzV",refreshButton:"page_refreshButton__DY9Yq",feedList:"page_feedList__ZPOTQ",feedItem:"page_feedItem__Arq8J",content:"page_content__kDoxQ",contentLeft:"page_contentLeft__HX8F4",userLine:"page_userLine___F_qs",emoji:"page_emoji__AOGjQ",authorLink:"page_authorLink__P8odq",text:"page_text__LcLL2",timestamp:"page_timestamp__JCy7J",loadingContainer:"page_loadingContainer__pshup",loader:"page_loader__g9BIl",spin:"page_spin__W_8_q",emptyState:"page_emptyState__Zyc7X",loadMoreButton:"page_loadMoreButton__f010N",error:"page_error__Jil8M",notice:"page_notice__83mqD",noticePersonal:"page_noticePersonal__YlkeM",noticeLink:"page_noticeLink__l4Q1x"}}},function(e){e.O(0,[591,972,971,117,744],function(){return e(e.s=27374)}),_N_E=e.O()}]);