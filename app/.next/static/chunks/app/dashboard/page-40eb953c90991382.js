(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{6872:function(e,t,s){Promise.resolve().then(s.bind(s,441))},9376:function(e,t,s){"use strict";var a=s(5475);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}})},441:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return c}});var a=s(7437),o=s(2265),n=s(9376),r=s(7758),i=s(6321),l=s.n(i);let d=["\uD83D\uDEBD","\uD83E\uDDFB","\uD83D\uDCA9","\uD83D\uDCA8","\uD83D\uDEBE","\uD83E\uDDFC","\uD83E\uDEA0","\uD83D\uDEBB","\uD83E\uDE78","\uD83D\uDCA7","\uD83D\uDCA6","\uD83D\uDE0C","\uD83D\uDE23","\uD83E\uDD22","\uD83E\uDD2E","\uD83E\uDD74","\uD83D\uDE2E‍\uD83D\uDCA8","\uD83D\uDE33","\uD83D\uDE35","\uD83C\uDF3E","\uD83C\uDF66","\uD83D\uDCF1","\uD83D\uDCD6","\uD83D\uDCAD","1️⃣","2️⃣","\uD83D\uDFE1","\uD83D\uDFE4"];function c(){let e=(0,n.useRouter)(),{isAuthenticated:t,session:i,signOut:c}=(0,r.a)();null==i||i.sub;let[u,h]=(0,o.useState)(""),[_,m]=(0,o.useState)(d[0]),[p,f]=(0,o.useState)(!1),[g,b]=(0,o.useState)(null),[D,v]=(0,o.useState)(null),[j,x]=(0,o.useState)(!1),[w,y]=(0,o.useState)([]),[N,E]=(0,o.useState)(!0),[S,C]=(0,o.useState)(null),[k,B]=(0,o.useState)(new Set);(0,o.useEffect)(()=>{t?F():e.push("/")},[t,e]);let F=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{E(!0),C(null);let t=await fetch(e?"/api/bluesky/feed?refresh=true":"/api/bluesky/feed",{cache:"no-store",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});if(!t.ok)throw Error("Failed to fetch feed: ".concat(t.status));let s=await t.json();if(w.length>0){let e=new Set(w.map(e=>e.id)),t=s.entries.filter(t=>!e.has(t.id));t.length>0&&(B(new Set(t.map(e=>e.id))),setTimeout(()=>{B(new Set)},2e3))}y(s.entries)}catch(e){console.error("Error fetching feed:",e),C(e.message||"Failed to load feed")}finally{E(!1)}},I=async()=>{await c(),e.push("/")},A=e=>{m(e)},L=async e=>{if(e.preventDefault(),!i||!t){b("Please sign in to post a flush");return}f(!0),b(null),v(null);try{let{createPost:e}=await s.e(227).then(s.bind(s,3227)),t="".concat("Someone"," is ").concat(u||"flushing"," ").concat(_),a=await e(i,{text:t,langs:["en"]});console.log("Status update result:",a),h(""),v("Your flushing status has been updated!"),setTimeout(()=>{x(!1)},2e3),setTimeout(()=>{F(!0)},1e3)}catch(e){console.error("Failed to update status:",e),b("Failed to update status: ".concat(e.message||"Unknown error"))}finally{f(!1)}};return t?(0,a.jsxs)("div",{className:l().container,children:[(0,a.jsxs)("header",{className:l().header,children:[(0,a.jsx)("h1",{children:"I'm Flushing"}),(0,a.jsxs)("div",{className:l().userInfo,children:[(0,a.jsxs)("span",{children:["Logged in as: @",null]}),(0,a.jsxs)("div",{className:l().actions,children:[(0,a.jsx)("button",{onClick:()=>F(!0),className:l().feedButton,children:"Refresh Feed"}),(0,a.jsx)("button",{onClick:I,className:l().logoutButton,children:"Logout"})]})]})]}),(0,a.jsxs)("button",{className:"".concat(l().toggleButton," ").concat(j?l().toggleButtonActive:""),onClick:()=>{x(!j),b(null),v(null)},children:[j?"Close":"Update Your Status",(0,a.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M19 9L12 16L5 9",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]}),(0,a.jsx)("div",{className:"".concat(l().statusUpdateContainer," ").concat(j?l().statusUpdateOpen:""),children:(0,a.jsxs)("div",{className:l().card,children:[g&&(0,a.jsx)("div",{className:l().error,children:g}),D&&(0,a.jsx)("div",{className:l().success,children:D}),(0,a.jsxs)("form",{onSubmit:L,className:l().form,children:[(0,a.jsxs)("div",{className:l().formGroup,children:[(0,a.jsx)("label",{children:"Select an emoji for your status"}),(0,a.jsx)("div",{className:l().emojiGrid,children:d.map(e=>(0,a.jsx)("button",{type:"button",className:"".concat(l().emojiButton," ").concat(e===_?l().selectedEmoji:""),onClick:()=>A(e),disabled:p,children:e},e))})]}),(0,a.jsxs)("div",{className:l().formGroup,children:[(0,a.jsx)("label",{htmlFor:"status",children:"What's your status? (optional)"}),(0,a.jsx)("input",{type:"text",id:"status",value:u,onChange:e=>h(e.target.value),placeholder:"What's happening in the bathroom... (optional)",maxLength:60,className:l().input,disabled:p}),(0,a.jsxs)("div",{className:l().charCount,children:[u.length,"/60"]})]}),(0,a.jsxs)("div",{className:l().preview,children:[(0,a.jsx)("div",{className:l().previewTitle,children:"Preview:"}),(0,a.jsxs)("div",{className:l().previewContent,children:[(0,a.jsx)("span",{className:l().previewEmoji,children:_}),(0,a.jsx)("span",{children:u||"is flushing"})]})]}),(0,a.jsx)("button",{type:"submit",className:l().submitButton,disabled:p,children:p?"Updating...":"Update Status"})]})]})}),(0,a.jsxs)("div",{className:l().feedSection,children:[(0,a.jsxs)("div",{className:l().feedTitle,children:[(0,a.jsx)("h2",{children:"Recent Bathroom Updates"}),(0,a.jsx)("button",{onClick:()=>F(!0),disabled:N,children:N?"Loading...":"Refresh"})]}),S&&(0,a.jsx)("div",{className:l().error,children:S}),N?(0,a.jsxs)("div",{className:l().loadingContainer,children:[(0,a.jsx)("div",{className:l().loader}),(0,a.jsx)("span",{children:"Loading feed..."})]}):(0,a.jsx)("div",{className:l().feedList,children:w.length>0?w.map(e=>(0,a.jsx)("div",{className:"".concat(l().feedItem," ").concat(k.has(e.id)?l().newFeedItem:""),children:(0,a.jsxs)("div",{className:l().content,children:[(0,a.jsxs)("div",{className:l().contentLeft,children:[(0,a.jsx)("span",{className:l().emoji,children:e.emoji}),(0,a.jsxs)("a",{href:"https://bsky.app/profile/".concat(e.authorHandle),target:"_blank",rel:"noopener noreferrer",className:l().authorLink,children:["@",e.authorHandle]}),(0,a.jsx)("span",{className:l().text,children:e.text?e.text.length>60?"".concat(e.text.substring(0,60),"..."):e.text:"is flushing"})]}),(0,a.jsx)("span",{className:l().timestamp,children:new Date(e.createdAt).toLocaleString()})]})},e.id)):(0,a.jsx)("div",{className:l().emptyState,children:(0,a.jsx)("p",{children:"No entries found. Be the first to share your status!"})})})]})]}):null}},7758:function(e,t,s){"use strict";s.d(t,{AuthProvider:function(){return u},a:function(){return h}});var a=s(7437),o=s(2265);let n=new(s(6297)).BrowserOAuthClient({clientMetadata:{client_id:"https://flushes.app/client-metadata.json",application_type:"web",client_name:"Flushes",client_uri:"https://flushes.app",logo_uri:"https://flushes.app/logo.png",tos_uri:"https://flushes.app/terms",policy_uri:"https://flushes.app/privacy",dpop_bound_access_tokens:!0,grant_types:["authorization_code","refresh_token"],redirect_uris:["https://flushes.app/auth/callback"],response_types:["code"],scope:"atproto transition:generic",token_endpoint_auth_method:"none"},handleResolver:"https://bsky.social",responseMode:"fragment"});async function r(){try{let e=await n.init();if(e){let{session:t}=e,s="state"in e?e.state:null;return console.log("OAuth client initialized with session for ".concat(t.sub)),s?console.log("User successfully authenticated with state: ".concat(s)):console.log("Restored previous session"),{session:t,state:s}}return console.log("OAuth client initialized without existing session"),null}catch(e){throw console.error("Failed to initialize OAuth client:",e),e}}async function i(e,t){try{console.log("Initiating OAuth flow for ".concat(e)),await n.signIn(e,{state:(null==t?void 0:t.state)||"signin-".concat(Date.now()),signal:null==t?void 0:t.signal})}catch(e){throw console.error("OAuth sign in failed:",e),e}}async function l(e){try{console.log("Restoring session for ".concat(e));let t=await n.restore(e);return console.log("Successfully restored session for ".concat(t.sub)),t}catch(t){throw console.error("Failed to restore session for ".concat(e,":"),t),t}}async function d(){try{console.log("Signing out user"),"undefined"!=typeof localStorage&&(localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("did"),localStorage.removeItem("handle"),localStorage.removeItem("keyPair"),localStorage.removeItem("dpopNonce"),localStorage.removeItem("pdsEndpoint"),localStorage.removeItem("bsky_auth_pdsEndpoint")),console.log("User signed out")}catch(e){throw console.error("Error during sign out:",e),e}}let c=(0,o.createContext)(void 0);function u(e){let{children:t}=e,[s,u]=(0,o.useState)(null),[h,_]=(0,o.useState)(!0);(0,o.useEffect)(()=>{(async function(){try{_(!0);let e=await r();e&&(console.log("Initialized with existing session:",e.session.sub),u(e.session))}catch(e){console.error("Failed to initialize OAuth client:",e)}finally{_(!1)}})()},[]),(0,o.useEffect)(()=>{var e;e=e=>{let{sub:t,cause:s}=e;console.error("Session for ".concat(t," was invalidated:"),s),u(null)},n.addEventListener("deleted",t=>{let{sub:s,cause:a}=t.detail;console.error("Session for ".concat(s," was invalidated:"),a),e({sub:s,cause:a})})},[]);let m={session:s,isAuthenticated:!!s,isLoading:h,signIn:async e=>{try{await i(e)}catch(e){throw console.error("Sign in failed:",e),e}},signOut:async()=>{try{await d(),u(null)}catch(e){throw console.error("Sign out failed:",e),e}},restoreSession:async e=>{try{let t=await l(e);return u(t),t}catch(e){throw console.error("Failed to restore session:",e),e}},accessToken:s?"available":null,refreshToken:s?"available":null,did:(null==s?void 0:s.sub)||null,handle:null,pdsEndpoint:null};return(0,a.jsx)(c.Provider,{value:m,children:t})}function h(){let e=(0,o.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6321:function(e){e.exports={container:"dashboard_container__Kdrrt",header:"dashboard_header__0IQ3E",userInfo:"dashboard_userInfo__J_gfr",actions:"dashboard_actions__c3bbO",feedButton:"dashboard_feedButton__GHwmr",logoutButton:"dashboard_logoutButton__YBR7L",card:"dashboard_card__uY0FF",description:"dashboard_description__SowcW",code:"dashboard_code__Twdmp",error:"dashboard_error__ih3px",success:"dashboard_success__yQeDz",form:"dashboard_form__2eBG3",formGroup:"dashboard_formGroup__xr6t0",statusUpdateContainer:"dashboard_statusUpdateContainer__8qgXn",statusUpdateOpen:"dashboard_statusUpdateOpen__cjWN2",toggleButton:"dashboard_toggleButton__A8QTo",toggleButtonActive:"dashboard_toggleButtonActive__xa96Q",input:"dashboard_input__5d_PV",charCount:"dashboard_charCount__VcNH8",emojiGrid:"dashboard_emojiGrid__1QgTK",emojiButton:"dashboard_emojiButton__NHK3w",selectedEmoji:"dashboard_selectedEmoji__7uk_7",preview:"dashboard_preview__oDbiu",previewTitle:"dashboard_previewTitle__my2eH",previewContent:"dashboard_previewContent__tEi9N",previewEmoji:"dashboard_previewEmoji__Y7zWA",submitButton:"dashboard_submitButton__SX1H6",feedSection:"dashboard_feedSection__ithG1",feedTitle:"dashboard_feedTitle__mw_DG",backButton:"dashboard_backButton__Fw6c0",feedList:"dashboard_feedList__rOyRk",feedItem:"dashboard_feedItem__vNBE0",feedHeader:"dashboard_feedHeader__OWx0_",authorLink:"dashboard_authorLink__RO_y9",timestamp:"dashboard_timestamp__ZHT5q",content:"dashboard_content__lgdH3",contentLeft:"dashboard_contentLeft__Ppg07",emoji:"dashboard_emoji__grbmJ",newFeedItem:"dashboard_newFeedItem__ffo7b",slideIn:"dashboard_slideIn__K8cik",text:"dashboard_text___6pcW",loadingContainer:"dashboard_loadingContainer__DQmdc",loader:"dashboard_loader__KY9QC",spin:"dashboard_spin__HizU5"}}},function(e){e.O(0,[767,297,971,117,744],function(){return e(e.s=6872)}),_N_E=e.O()}]);