(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{66872:function(e,t,a){Promise.resolve().then(a.bind(a,50441))},99376:function(e,t,a){"use strict";var s=a(35475);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}})},50441:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return u}});var s=a(57437),n=a(2265),o=a(99376),r=a(7766),i=a(66321),d=a.n(i);let l=["\uD83D\uDEBD","\uD83E\uDDFB","\uD83D\uDCA9","\uD83D\uDCA8","\uD83D\uDEBE","\uD83E\uDDFC","\uD83E\uDEA0","\uD83D\uDEBB","\uD83E\uDE78","\uD83D\uDCA7","\uD83D\uDCA6","\uD83D\uDE0C","\uD83D\uDE23","\uD83E\uDD22","\uD83E\uDD2E","\uD83E\uDD74","\uD83D\uDE2E‍\uD83D\uDCA8","\uD83D\uDE33","\uD83D\uDE35","\uD83C\uDF3E","\uD83C\uDF66","\uD83D\uDCF1","\uD83D\uDCD6","\uD83D\uDCAD","1️⃣","2️⃣","\uD83D\uDFE1","\uD83D\uDFE4"];function u(){let e=(0,o.useRouter)(),{isAuthenticated:t,session:i,signOut:u}=(0,r.a)();null==i||i.sub;let[c,h]=(0,n.useState)(""),[_,m]=(0,n.useState)(l[0]),[f,b]=(0,n.useState)(!1),[p,D]=(0,n.useState)(null),[j,x]=(0,n.useState)(null),[g,v]=(0,n.useState)(!1),[w,E]=(0,n.useState)([]),[N,C]=(0,n.useState)(!0),[S,y]=(0,n.useState)(null),[B,k]=(0,n.useState)(new Set);(0,n.useEffect)(()=>{t?F():e.push("/")},[t,e]);let F=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{C(!0),y(null);let t=await fetch(e?"/api/bluesky/feed?refresh=true":"/api/bluesky/feed",{cache:"no-store",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});if(!t.ok)throw Error("Failed to fetch feed: ".concat(t.status));let a=await t.json();if(w.length>0){let e=new Set(w.map(e=>e.id)),t=a.entries.filter(t=>!e.has(t.id));t.length>0&&(k(new Set(t.map(e=>e.id))),setTimeout(()=>{k(new Set)},2e3))}E(a.entries)}catch(e){console.error("Error fetching feed:",e),y(e.message||"Failed to load feed")}finally{C(!1)}},L=async()=>{await u(),e.push("/")},P=e=>{m(e)},A=async e=>{if(e.preventDefault(),!i||!t){D("Please sign in to post a flush");return}b(!0),D(null),x(null);try{let{createPost:e}=await Promise.all([a.e(684),a.e(985),a.e(473),a.e(856),a.e(227)]).then(a.bind(a,3227)),t="".concat("Someone"," is ").concat(c||"flushing"," ").concat(_),s=await e(i,{text:t,langs:["en"]});console.log("Status update result:",s),h(""),x("Your flushing status has been updated!"),setTimeout(()=>{v(!1)},2e3),setTimeout(()=>{F(!0)},1e3)}catch(e){console.error("Failed to update status:",e),D("Failed to update status: ".concat(e.message||"Unknown error"))}finally{b(!1)}};return t?(0,s.jsxs)("div",{className:d().container,children:[(0,s.jsxs)("header",{className:d().header,children:[(0,s.jsx)("h1",{children:"I'm Flushing"}),(0,s.jsxs)("div",{className:d().userInfo,children:[(0,s.jsxs)("span",{children:["Logged in as: @",null]}),(0,s.jsxs)("div",{className:d().actions,children:[(0,s.jsx)("button",{onClick:()=>F(!0),className:d().feedButton,children:"Refresh Feed"}),(0,s.jsx)("button",{onClick:L,className:d().logoutButton,children:"Logout"})]})]})]}),(0,s.jsxs)("button",{className:"".concat(d().toggleButton," ").concat(g?d().toggleButtonActive:""),onClick:()=>{v(!g),D(null),x(null)},children:[g?"Close":"Update Your Status",(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M19 9L12 16L5 9",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]}),(0,s.jsx)("div",{className:"".concat(d().statusUpdateContainer," ").concat(g?d().statusUpdateOpen:""),children:(0,s.jsxs)("div",{className:d().card,children:[p&&(0,s.jsx)("div",{className:d().error,children:p}),j&&(0,s.jsx)("div",{className:d().success,children:j}),(0,s.jsxs)("form",{onSubmit:A,className:d().form,children:[(0,s.jsxs)("div",{className:d().formGroup,children:[(0,s.jsx)("label",{children:"Select an emoji for your status"}),(0,s.jsx)("div",{className:d().emojiGrid,children:l.map(e=>(0,s.jsx)("button",{type:"button",className:"".concat(d().emojiButton," ").concat(e===_?d().selectedEmoji:""),onClick:()=>P(e),disabled:f,children:e},e))})]}),(0,s.jsxs)("div",{className:d().formGroup,children:[(0,s.jsx)("label",{htmlFor:"status",children:"What's your status? (optional)"}),(0,s.jsx)("input",{type:"text",id:"status",value:c,onChange:e=>h(e.target.value),placeholder:"What's happening in the bathroom... (optional)",maxLength:60,className:d().input,disabled:f}),(0,s.jsxs)("div",{className:d().charCount,children:[c.length,"/60"]})]}),(0,s.jsxs)("div",{className:d().preview,children:[(0,s.jsx)("div",{className:d().previewTitle,children:"Preview:"}),(0,s.jsxs)("div",{className:d().previewContent,children:[(0,s.jsx)("span",{className:d().previewEmoji,children:_}),(0,s.jsx)("span",{children:c||"is flushing"})]})]}),(0,s.jsx)("button",{type:"submit",className:d().submitButton,disabled:f,children:f?"Updating...":"Update Status"})]})]})}),(0,s.jsxs)("div",{className:d().feedSection,children:[(0,s.jsxs)("div",{className:d().feedTitle,children:[(0,s.jsx)("h2",{children:"Recent Bathroom Updates"}),(0,s.jsx)("button",{onClick:()=>F(!0),disabled:N,children:N?"Loading...":"Refresh"})]}),S&&(0,s.jsx)("div",{className:d().error,children:S}),N?(0,s.jsxs)("div",{className:d().loadingContainer,children:[(0,s.jsx)("div",{className:d().loader}),(0,s.jsx)("span",{children:"Loading feed..."})]}):(0,s.jsx)("div",{className:d().feedList,children:w.length>0?w.map(e=>(0,s.jsx)("div",{className:"".concat(d().feedItem," ").concat(B.has(e.id)?d().newFeedItem:""),children:(0,s.jsxs)("div",{className:d().content,children:[(0,s.jsxs)("div",{className:d().contentLeft,children:[(0,s.jsx)("span",{className:d().emoji,children:e.emoji}),(0,s.jsxs)("a",{href:"https://bsky.app/profile/".concat(e.authorHandle),target:"_blank",rel:"noopener noreferrer",className:d().authorLink,children:["@",e.authorHandle]}),(0,s.jsx)("span",{className:d().text,children:e.text?e.text.length>60?"".concat(e.text.substring(0,60),"..."):e.text:"is flushing"})]}),(0,s.jsx)("span",{className:d().timestamp,children:new Date(e.createdAt).toLocaleString()})]})},e.id)):(0,s.jsx)("div",{className:d().emptyState,children:(0,s.jsx)("p",{children:"No entries found. Be the first to share your status!"})})})]})]}):null}},7766:function(e,t,a){"use strict";a.d(t,{AuthProvider:function(){return r},a:function(){return i}});var s=a(57437),n=a(2265);let o=(0,n.createContext)(void 0);function r(e){let{children:t}=e,[r,i]=(0,n.useState)(null),[d,l]=(0,n.useState)(!0),[u,c]=(0,n.useState)(!1);(0,n.useEffect)(()=>{c(!0)},[]),(0,n.useEffect)(()=>{u&&e();async function e(){try{l(!0);let{initializeOAuthClient:e}=await Promise.all([a.e(473),a.e(297),a.e(494)]).then(a.bind(a,62494)),t=await e();t&&(console.log("Initialized with existing session:",t.session.sub),i(t.session))}catch(e){console.error("Failed to initialize OAuth client:",e)}finally{l(!1)}}},[u]),(0,n.useEffect)(()=>{u&&e();async function e(){try{let{onSessionDeleted:e}=await Promise.all([a.e(473),a.e(297),a.e(494)]).then(a.bind(a,62494));e(e=>{let{sub:t,cause:a}=e;console.error("Session for ".concat(t," was invalidated:"),a),i(null)})}catch(e){console.error("Failed to set up session listener:",e)}}},[u]);let h=async e=>{if(!u)throw Error("Sign in can only be called on the client side");try{let{signIn:t}=await Promise.all([a.e(473),a.e(297),a.e(494)]).then(a.bind(a,62494));await t(e)}catch(e){throw console.error("Sign in failed:",e),e}},_=async()=>{if(!u)throw Error("Sign out can only be called on the client side");try{let{signOut:e}=await Promise.all([a.e(473),a.e(297),a.e(494)]).then(a.bind(a,62494));await e(),i(null)}catch(e){throw console.error("Sign out failed:",e),e}},m=async e=>{if(!u)throw Error("Restore session can only be called on the client side");try{let{restoreSession:t}=await Promise.all([a.e(473),a.e(297),a.e(494)]).then(a.bind(a,62494)),s=await t(e);return i(s),s}catch(e){throw console.error("Failed to restore session:",e),e}},f={session:r,isAuthenticated:!!r,isLoading:d||!u,signIn:h,signOut:_,restoreSession:m,accessToken:r?"available":null,refreshToken:r?"available":null,did:(null==r?void 0:r.sub)||null,handle:null,pdsEndpoint:null};return(0,s.jsx)(o.Provider,{value:f,children:t})}function i(){let e=(0,n.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},66321:function(e){e.exports={container:"dashboard_container__Kdrrt",header:"dashboard_header__0IQ3E",userInfo:"dashboard_userInfo__J_gfr",actions:"dashboard_actions__c3bbO",feedButton:"dashboard_feedButton__GHwmr",logoutButton:"dashboard_logoutButton__YBR7L",card:"dashboard_card__uY0FF",description:"dashboard_description__SowcW",code:"dashboard_code__Twdmp",error:"dashboard_error__ih3px",success:"dashboard_success__yQeDz",form:"dashboard_form__2eBG3",formGroup:"dashboard_formGroup__xr6t0",statusUpdateContainer:"dashboard_statusUpdateContainer__8qgXn",statusUpdateOpen:"dashboard_statusUpdateOpen__cjWN2",toggleButton:"dashboard_toggleButton__A8QTo",toggleButtonActive:"dashboard_toggleButtonActive__xa96Q",input:"dashboard_input__5d_PV",charCount:"dashboard_charCount__VcNH8",emojiGrid:"dashboard_emojiGrid__1QgTK",emojiButton:"dashboard_emojiButton__NHK3w",selectedEmoji:"dashboard_selectedEmoji__7uk_7",preview:"dashboard_preview__oDbiu",previewTitle:"dashboard_previewTitle__my2eH",previewContent:"dashboard_previewContent__tEi9N",previewEmoji:"dashboard_previewEmoji__Y7zWA",submitButton:"dashboard_submitButton__SX1H6",feedSection:"dashboard_feedSection__ithG1",feedTitle:"dashboard_feedTitle__mw_DG",backButton:"dashboard_backButton__Fw6c0",feedList:"dashboard_feedList__rOyRk",feedItem:"dashboard_feedItem__vNBE0",feedHeader:"dashboard_feedHeader__OWx0_",authorLink:"dashboard_authorLink__RO_y9",timestamp:"dashboard_timestamp__ZHT5q",content:"dashboard_content__lgdH3",contentLeft:"dashboard_contentLeft__Ppg07",emoji:"dashboard_emoji__grbmJ",newFeedItem:"dashboard_newFeedItem__ffo7b",slideIn:"dashboard_slideIn__K8cik",text:"dashboard_text___6pcW",loadingContainer:"dashboard_loadingContainer__DQmdc",loader:"dashboard_loader__KY9QC",spin:"dashboard_spin__HizU5"}}},function(e){e.O(0,[767,971,117,744],function(){return e(e.s=66872)}),_N_E=e.O()}]);