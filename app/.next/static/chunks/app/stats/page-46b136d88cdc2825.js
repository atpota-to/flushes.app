(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[740],{52750:function(e,t,s){Promise.resolve().then(s.bind(s,7137))},27648:function(e,t,s){"use strict";s.d(t,{default:function(){return n.a}});var a=s(72972),n=s.n(a)},7137:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return c}});var a=s(57437),n=s(2265),r=s(27648),l=s(37653),i=s.n(l),o=s(7766);function c(){let{isAuthenticated:e,session:t,signOut:s}=(0,o.a)(),[l,c]=(0,n.useState)(null),[d,h]=(0,n.useState)(!0),[u,_]=(0,n.useState)(null);(0,n.useEffect)(()=>{m()},[]);let m=async()=>{try{h(!0),_(null);let e=Date.now(),t="/api/bluesky/stats?_t=".concat(e);console.log("Fetching stats from ".concat(t));let s=await fetch(t,{method:"GET",cache:"no-store",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});if(!s.ok)throw Error("Failed to fetch stats: ".concat(s.status));let a=await s.json(),n=await Promise.all(a.leaderboard.map(async e=>{try{let s=await fetch("https://plc.directory/".concat(e.did,"/data"));if(s.ok){var t;let a=await s.json(),n=null===(t=a.alsoKnownAs)||void 0===t?void 0:t[0];if(n&&n.startsWith("at://")){let t=n.substring(5);return{...e,handle:t}}}}catch(t){console.error("Failed to resolve handle for DID ".concat(e.did),t)}return e}));c({...a,leaderboard:n})}catch(e){console.error("Error fetching stats:",e),_(e.message||"Failed to load stats")}finally{h(!1)}};return(0,a.jsxs)("div",{className:i().container,children:[(0,a.jsxs)("div",{className:i().statsHeader,children:[(0,a.jsx)("h2",{children:"Plumbing Stats \uD83E\uDEA0"}),(0,a.jsx)("p",{className:i().statsSubtitle,children:"Global statistics for the Flushes network"})]}),(0,a.jsxs)("div",{className:i().controls,children:[(0,a.jsx)("button",{onClick:()=>m(),className:i().refreshButton,disabled:d,children:d?"Loading...":"Refresh Stats"}),(0,a.jsx)(r.default,{href:"/",className:i().homeLink,children:"Back to Feed"})]}),u&&(0,a.jsxs)("div",{className:i().error,children:["Error: ",u]}),d?(0,a.jsxs)("div",{className:i().loadingContainer,children:[(0,a.jsx)("div",{className:i().loader}),(0,a.jsx)("p",{children:"Loading stats..."})]}):l?(0,a.jsxs)("div",{className:i().statsContent,children:[(0,a.jsxs)("section",{className:i().overallStats,children:[(0,a.jsx)("h2",{children:"Overall Flush Activity"}),(0,a.jsx)("a",{href:"https://bsky.app/profile/plumber.flushes.app",target:"_blank",rel:"noopener noreferrer",className:i().plumberProfileLink,children:"Follow our resident plumber on Bluesky"}),(0,a.jsxs)("div",{className:i().statsGrid,children:[(0,a.jsxs)("div",{className:i().statCard,children:[(0,a.jsx)("div",{className:i().statValue,children:l.totalCount}),(0,a.jsx)("div",{className:i().statLabel,children:"Total flushes"})]}),(0,a.jsxs)("div",{className:i().statCard,children:[(0,a.jsx)("div",{className:i().statValue,children:l.flushesPerDay}),(0,a.jsx)("div",{className:i().statLabel,children:"Flushes per day"})]}),(0,a.jsxs)("div",{className:i().statCard,children:[(0,a.jsx)("div",{className:i().statValue,children:l.plumberFlushCount}),(0,a.jsx)("div",{className:i().statLabel,children:"Plumber test flushes"})]}),(0,a.jsxs)("div",{className:i().statCard,children:[(0,a.jsx)("div",{className:i().statValue,children:l.totalFlushers}),(0,a.jsx)("div",{className:i().statLabel,children:"Total flushers"})]}),(0,a.jsxs)("div",{className:i().statCard,children:[(0,a.jsx)("div",{className:i().statValue,children:l.monthlyActiveFlushers}),(0,a.jsx)("div",{className:i().statLabel,children:"Monthly active flushers"})]}),(0,a.jsxs)("div",{className:i().statCard,children:[(0,a.jsx)("div",{className:i().statValue,children:l.dailyActiveFlushers}),(0,a.jsx)("div",{className:i().statLabel,children:"Daily active flushers (avg)"})]})]})]}),(0,a.jsxs)("section",{className:i().chartSection,children:[(0,a.jsx)("h2",{children:"Daily Activity"}),l.chartData.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:i().chartContainer,children:l.chartData.map((e,t)=>{let s=Math.max(...l.chartData.map(e=>e.count)),n=Math.max(10,Math.min(100,e.count/s*100));return(0,a.jsx)("div",{className:i().chartBar,style:{height:"".concat(n,"%")},title:"".concat(e.date,": ").concat(e.count," flushes")},t)})}),(0,a.jsxs)("div",{className:i().chartLegend,children:[(0,a.jsx)("span",{className:i().chartLegendItem,children:l.chartData.length>0?new Date(l.chartData[0].date).toLocaleDateString(void 0,{month:"short",day:"numeric"}):""}),(0,a.jsx)("span",{className:i().chartLegendItem,children:l.chartData.length>0?new Date(l.chartData[l.chartData.length-1].date).toLocaleDateString(void 0,{month:"short",day:"numeric"}):""})]})]}):(0,a.jsx)("p",{className:i().noDataMessage,children:"Not enough data to display activity chart"})]}),(0,a.jsxs)("section",{className:i().leaderboardSection,children:[(0,a.jsx)("h2",{children:"Top Flushers"}),l.leaderboard.length>0?(0,a.jsxs)("div",{className:i().leaderboard,children:[(0,a.jsxs)("div",{className:i().leaderboardHeader,children:[(0,a.jsx)("span",{className:i().rank,children:"Rank"}),(0,a.jsx)("span",{className:i().user,children:"User"}),(0,a.jsx)("span",{className:i().count,children:"Flushes"})]}),l.leaderboard.map((e,t)=>{let s="";return 0===t?s=i().topRank:1===t?s=i().secondRank:2===t&&(s=i().thirdRank),(0,a.jsxs)("div",{className:"".concat(i().leaderboardItem," ").concat(s),children:[(0,a.jsxs)("span",{className:i().rank,children:["#",t+1]}),(0,a.jsx)("span",{className:i().user,children:e.handle?(0,a.jsxs)(r.default,{href:"/profile/".concat(e.handle),title:"@".concat(e.handle),children:["@",e.handle]}):(0,a.jsxs)("span",{className:i().unknownUser,children:[e.did.substring(0,10),"..."]})}),(0,a.jsx)("span",{className:i().count,children:e.count})]},t)})]}):(0,a.jsx)("p",{className:i().noDataMessage,children:"No leaderboard data available"})]}),(0,a.jsxs)("section",{className:i().emojiSection,children:[(0,a.jsx)("h2",{children:"Emoji Usage"}),l.emojiStats&&l.emojiStats.length>0?(0,a.jsx)("div",{className:i().emojiGrid,children:l.emojiStats.map((e,t)=>(0,a.jsxs)("div",{className:i().emojiCard,children:[(0,a.jsx)("div",{className:i().emoji,children:e.emoji}),(0,a.jsx)("div",{className:i().emojiCount,children:e.count})]},t))}):(0,a.jsx)("p",{className:i().noDataMessage,children:"No emoji data available"})]}),(0,a.jsx)("div",{className:i().shareSection,children:(0,a.jsx)("button",{className:i().shareButton,onClick:()=>{let e="There have been ".concat(l.totalCount," flushes by ").concat(l.totalFlushers," unique users on @flushes.app! We have ").concat(l.monthlyActiveFlushers," monthly active flushers and ").concat(l.dailyActiveFlushers," daily active flushers on average. Check out the stats: https://flushes.app/stats");window.open("https://bsky.app/intent/compose?text=".concat(encodeURIComponent(e)),"_blank")},children:"Share These Stats"})})]}):(0,a.jsx)("div",{className:i().emptyState,children:(0,a.jsx)("p",{children:"No stats data available"})})]})}},7766:function(e,t,s){"use strict";s.d(t,{AuthProvider:function(){return l},a:function(){return i}});var a=s(57437),n=s(2265);let r=(0,n.createContext)(void 0);function l(e){let{children:t}=e,[l,i]=(0,n.useState)(null),[o,c]=(0,n.useState)(!0),[d,h]=(0,n.useState)(!1);(0,n.useEffect)(()=>{h(!0)},[]),(0,n.useEffect)(()=>{d&&e();async function e(){try{c(!0);let{initializeOAuthClient:e}=await Promise.all([s.e(473),s.e(297),s.e(494)]).then(s.bind(s,62494)),t=await e();t&&(console.log("Initialized with existing session:",t.session.sub),i(t.session))}catch(e){console.error("Failed to initialize OAuth client:",e)}finally{c(!1)}}},[d]),(0,n.useEffect)(()=>{d&&e();async function e(){try{let{onSessionDeleted:e}=await Promise.all([s.e(473),s.e(297),s.e(494)]).then(s.bind(s,62494));e(e=>{let{sub:t,cause:s}=e;console.error("Session for ".concat(t," was invalidated:"),s),i(null)})}catch(e){console.error("Failed to set up session listener:",e)}}},[d]);let u=async e=>{if(!d)throw Error("Sign in can only be called on the client side");try{let{signIn:t}=await Promise.all([s.e(473),s.e(297),s.e(494)]).then(s.bind(s,62494));await t(e)}catch(e){throw console.error("Sign in failed:",e),e}},_=async()=>{if(!d)throw Error("Sign out can only be called on the client side");try{let{signOut:e}=await Promise.all([s.e(473),s.e(297),s.e(494)]).then(s.bind(s,62494));await e(),i(null)}catch(e){throw console.error("Sign out failed:",e),e}},m=async e=>{if(!d)throw Error("Restore session can only be called on the client side");try{let{restoreSession:t}=await Promise.all([s.e(473),s.e(297),s.e(494)]).then(s.bind(s,62494)),a=await t(e);return i(a),a}catch(e){throw console.error("Failed to restore session:",e),e}},j={session:l,isAuthenticated:!!l,isLoading:o||!d,signIn:u,signOut:_,restoreSession:m,accessToken:l?"available":null,refreshToken:l?"available":null,did:(null==l?void 0:l.sub)||null,handle:null,pdsEndpoint:null};return(0,a.jsx)(r.Provider,{value:j,children:t})}function i(){let e=(0,n.useContext)(r);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},37653:function(e){e.exports={container:"stats_container__0HsAQ",header:"stats_header__9sD9c",headerContent:"stats_headerContent__M9_Sh",title:"stats_title__g_yzk",subtitle:"stats_subtitle__n40rI",description:"stats_description__HSsSv",creditLine:"stats_creditLine__WpGGS",kofiLink:"stats_kofiLink__jp7YY",headerActions:"stats_headerActions__CWiBy",userInfo:"stats_userInfo__bgXa_",logoutButton:"stats_logoutButton__tseaR",loginButton:"stats_loginButton___mXY5",statsHeader:"stats_statsHeader__BS5J0",statsSubtitle:"stats_statsSubtitle__bqiRY",controls:"stats_controls__Uojja",refreshButton:"stats_refreshButton__Zlv63",homeLink:"stats_homeLink__1iuoe",loadingContainer:"stats_loadingContainer__AzFmD",loader:"stats_loader__52AJY",spin:"stats_spin__rG0vl",error:"stats_error__8vXRU",emptyState:"stats_emptyState__S037y",statsContent:"stats_statsContent__q_dOi",overallStats:"stats_overallStats__cOcCy",chartSection:"stats_chartSection__srieH",leaderboardSection:"stats_leaderboardSection__lveop",emojiSection:"stats_emojiSection__JN76r",plumberProfileLink:"stats_plumberProfileLink__TcMfD",statsGrid:"stats_statsGrid__GCL_G",statCard:"stats_statCard__kfTN5",statValue:"stats_statValue__Os2uC",statLabel:"stats_statLabel___eg66",plumberLink:"stats_plumberLink__rKwK_",chartContainer:"stats_chartContainer__LFQal",chartBar:"stats_chartBar__P3BbP",chartLegend:"stats_chartLegend__VMRCe",noDataMessage:"stats_noDataMessage__EcQsv",leaderboard:"stats_leaderboard__qPOCc",leaderboardHeader:"stats_leaderboardHeader__UGY6K",leaderboardItem:"stats_leaderboardItem__oiP4Z",topRank:"stats_topRank__hdT1W",secondRank:"stats_secondRank__y2__D",thirdRank:"stats_thirdRank__QO5Fz",rank:"stats_rank__dWi9x",user:"stats_user__efntK",unknownUser:"stats_unknownUser__pMz0J",count:"stats_count__1X9Jf",emojiGrid:"stats_emojiGrid__VvPLY",emojiCard:"stats_emojiCard__xNwtu",emoji:"stats_emoji__XgGWx",emojiCount:"stats_emojiCount__ggkr6",shareSection:"stats_shareSection__QxdSk",shareButton:"stats_shareButton__Ms2N_"}}},function(e){e.O(0,[815,972,971,117,744],function(){return e(e.s=52750)}),_N_E=e.O()}]);