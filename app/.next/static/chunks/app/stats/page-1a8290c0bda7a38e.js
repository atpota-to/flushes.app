(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[740],{2750:function(t,e,s){Promise.resolve().then(s.bind(s,7137))},7648:function(t,e,s){"use strict";s.d(e,{default:function(){return n.a}});var a=s(6779),n=s.n(a)},7137:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return c}});var a=s(7437),n=s(2265),r=s(7648),o=s(7653),l=s.n(o),i=s(7758);function c(){let{isAuthenticated:t,session:e,signOut:s}=(0,i.a)(),[o,c]=(0,n.useState)(null),[d,h]=(0,n.useState)(!0),[u,_]=(0,n.useState)(null);(0,n.useEffect)(()=>{m()},[]);let m=async()=>{try{h(!0),_(null);let t=Date.now(),e="/api/bluesky/stats?_t=".concat(t);console.log("Fetching stats from ".concat(e));let s=await fetch(e,{method:"GET",cache:"no-store",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});if(!s.ok)throw Error("Failed to fetch stats: ".concat(s.status));let a=await s.json(),n=await Promise.all(a.leaderboard.map(async t=>{try{let s=await fetch("https://plc.directory/".concat(t.did,"/data"));if(s.ok){var e;let a=await s.json(),n=null===(e=a.alsoKnownAs)||void 0===e?void 0:e[0];if(n&&n.startsWith("at://")){let e=n.substring(5);return{...t,handle:e}}}}catch(e){console.error("Failed to resolve handle for DID ".concat(t.did),e)}return t}));c({...a,leaderboard:n})}catch(t){console.error("Error fetching stats:",t),_(t.message||"Failed to load stats")}finally{h(!1)}};return(0,a.jsxs)("div",{className:l().container,children:[(0,a.jsxs)("div",{className:l().statsHeader,children:[(0,a.jsx)("h2",{children:"Plumbing Stats \uD83E\uDEA0"}),(0,a.jsx)("p",{className:l().statsSubtitle,children:"Global statistics for the Flushes network"})]}),(0,a.jsxs)("div",{className:l().controls,children:[(0,a.jsx)("button",{onClick:()=>m(),className:l().refreshButton,disabled:d,children:d?"Loading...":"Refresh Stats"}),(0,a.jsx)(r.default,{href:"/",className:l().homeLink,children:"Back to Feed"})]}),u&&(0,a.jsxs)("div",{className:l().error,children:["Error: ",u]}),d?(0,a.jsxs)("div",{className:l().loadingContainer,children:[(0,a.jsx)("div",{className:l().loader}),(0,a.jsx)("p",{children:"Loading stats..."})]}):o?(0,a.jsxs)("div",{className:l().statsContent,children:[(0,a.jsxs)("section",{className:l().overallStats,children:[(0,a.jsx)("h2",{children:"Overall Flush Activity"}),(0,a.jsx)("a",{href:"https://bsky.app/profile/plumber.flushes.app",target:"_blank",rel:"noopener noreferrer",className:l().plumberProfileLink,children:"Follow our resident plumber on Bluesky"}),(0,a.jsxs)("div",{className:l().statsGrid,children:[(0,a.jsxs)("div",{className:l().statCard,children:[(0,a.jsx)("div",{className:l().statValue,children:o.totalCount}),(0,a.jsx)("div",{className:l().statLabel,children:"Total flushes"})]}),(0,a.jsxs)("div",{className:l().statCard,children:[(0,a.jsx)("div",{className:l().statValue,children:o.flushesPerDay}),(0,a.jsx)("div",{className:l().statLabel,children:"Flushes per day"})]}),(0,a.jsxs)("div",{className:l().statCard,children:[(0,a.jsx)("div",{className:l().statValue,children:o.plumberFlushCount}),(0,a.jsx)("div",{className:l().statLabel,children:"Plumber test flushes"})]}),(0,a.jsxs)("div",{className:l().statCard,children:[(0,a.jsx)("div",{className:l().statValue,children:o.totalFlushers}),(0,a.jsx)("div",{className:l().statLabel,children:"Total flushers"})]}),(0,a.jsxs)("div",{className:l().statCard,children:[(0,a.jsx)("div",{className:l().statValue,children:o.monthlyActiveFlushers}),(0,a.jsx)("div",{className:l().statLabel,children:"Monthly active flushers"})]}),(0,a.jsxs)("div",{className:l().statCard,children:[(0,a.jsx)("div",{className:l().statValue,children:o.dailyActiveFlushers}),(0,a.jsx)("div",{className:l().statLabel,children:"Daily active flushers (avg)"})]})]})]}),(0,a.jsxs)("section",{className:l().chartSection,children:[(0,a.jsx)("h2",{children:"Daily Activity"}),o.chartData.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:l().chartContainer,children:o.chartData.map((t,e)=>{let s=Math.max(...o.chartData.map(t=>t.count)),n=Math.max(10,Math.min(100,t.count/s*100));return(0,a.jsx)("div",{className:l().chartBar,style:{height:"".concat(n,"%")},title:"".concat(t.date,": ").concat(t.count," flushes")},e)})}),(0,a.jsxs)("div",{className:l().chartLegend,children:[(0,a.jsx)("span",{className:l().chartLegendItem,children:o.chartData.length>0?new Date(o.chartData[0].date).toLocaleDateString(void 0,{month:"short",day:"numeric"}):""}),(0,a.jsx)("span",{className:l().chartLegendItem,children:o.chartData.length>0?new Date(o.chartData[o.chartData.length-1].date).toLocaleDateString(void 0,{month:"short",day:"numeric"}):""})]})]}):(0,a.jsx)("p",{className:l().noDataMessage,children:"Not enough data to display activity chart"})]}),(0,a.jsxs)("section",{className:l().leaderboardSection,children:[(0,a.jsx)("h2",{children:"Top Flushers"}),o.leaderboard.length>0?(0,a.jsxs)("div",{className:l().leaderboard,children:[(0,a.jsxs)("div",{className:l().leaderboardHeader,children:[(0,a.jsx)("span",{className:l().rank,children:"Rank"}),(0,a.jsx)("span",{className:l().user,children:"User"}),(0,a.jsx)("span",{className:l().count,children:"Flushes"})]}),o.leaderboard.map((t,e)=>{let s="";return 0===e?s=l().topRank:1===e?s=l().secondRank:2===e&&(s=l().thirdRank),(0,a.jsxs)("div",{className:"".concat(l().leaderboardItem," ").concat(s),children:[(0,a.jsxs)("span",{className:l().rank,children:["#",e+1]}),(0,a.jsx)("span",{className:l().user,children:t.handle?(0,a.jsxs)(r.default,{href:"/profile/".concat(t.handle),title:"@".concat(t.handle),children:["@",t.handle]}):(0,a.jsxs)("span",{className:l().unknownUser,children:[t.did.substring(0,10),"..."]})}),(0,a.jsx)("span",{className:l().count,children:t.count})]},e)})]}):(0,a.jsx)("p",{className:l().noDataMessage,children:"No leaderboard data available"})]}),(0,a.jsxs)("section",{className:l().emojiSection,children:[(0,a.jsx)("h2",{children:"Emoji Usage"}),o.emojiStats&&o.emojiStats.length>0?(0,a.jsx)("div",{className:l().emojiGrid,children:o.emojiStats.map((t,e)=>(0,a.jsxs)("div",{className:l().emojiCard,children:[(0,a.jsx)("div",{className:l().emoji,children:t.emoji}),(0,a.jsx)("div",{className:l().emojiCount,children:t.count})]},e))}):(0,a.jsx)("p",{className:l().noDataMessage,children:"No emoji data available"})]}),(0,a.jsx)("div",{className:l().shareSection,children:(0,a.jsx)("button",{className:l().shareButton,onClick:()=>{let t="There have been ".concat(o.totalCount," flushes by ").concat(o.totalFlushers," unique users on @flushes.app! We have ").concat(o.monthlyActiveFlushers," monthly active flushers and ").concat(o.dailyActiveFlushers," daily active flushers on average. Check out the stats: https://flushes.app/stats");window.open("https://bsky.app/intent/compose?text=".concat(encodeURIComponent(t)),"_blank")},children:"Share These Stats"})})]}):(0,a.jsx)("div",{className:l().emptyState,children:(0,a.jsx)("p",{children:"No stats data available"})})]})}},7758:function(t,e,s){"use strict";s.d(e,{AuthProvider:function(){return h},a:function(){return u}});var a=s(7437),n=s(2265);let r=new(s(6297)).BrowserOAuthClient({clientMetadata:{client_id:"https://flushes.app/client-metadata.json",application_type:"web",client_name:"Flushes",client_uri:"https://flushes.app",logo_uri:"https://flushes.app/logo.png",tos_uri:"https://flushes.app/terms",policy_uri:"https://flushes.app/privacy",dpop_bound_access_tokens:!0,grant_types:["authorization_code","refresh_token"],redirect_uris:["https://flushes.app/auth/callback"],response_types:["code"],scope:"atproto transition:generic",token_endpoint_auth_method:"none"},handleResolver:"https://bsky.social",responseMode:"fragment"});async function o(){try{let t=await r.init();if(t){let{session:e}=t,s="state"in t?t.state:null;return console.log("OAuth client initialized with session for ".concat(e.sub)),s?console.log("User successfully authenticated with state: ".concat(s)):console.log("Restored previous session"),{session:e,state:s}}return console.log("OAuth client initialized without existing session"),null}catch(t){throw console.error("Failed to initialize OAuth client:",t),t}}async function l(t,e){try{console.log("Initiating OAuth flow for ".concat(t)),await r.signIn(t,{state:(null==e?void 0:e.state)||"signin-".concat(Date.now()),signal:null==e?void 0:e.signal})}catch(t){throw console.error("OAuth sign in failed:",t),t}}async function i(t){try{console.log("Restoring session for ".concat(t));let e=await r.restore(t);return console.log("Successfully restored session for ".concat(e.sub)),e}catch(e){throw console.error("Failed to restore session for ".concat(t,":"),e),e}}async function c(){try{console.log("Signing out user"),"undefined"!=typeof localStorage&&(localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("did"),localStorage.removeItem("handle"),localStorage.removeItem("keyPair"),localStorage.removeItem("dpopNonce"),localStorage.removeItem("pdsEndpoint"),localStorage.removeItem("bsky_auth_pdsEndpoint")),console.log("User signed out")}catch(t){throw console.error("Error during sign out:",t),t}}let d=(0,n.createContext)(void 0);function h(t){let{children:e}=t,[s,h]=(0,n.useState)(null),[u,_]=(0,n.useState)(!0);(0,n.useEffect)(()=>{(async function(){try{_(!0);let t=await o();t&&(console.log("Initialized with existing session:",t.session.sub),h(t.session))}catch(t){console.error("Failed to initialize OAuth client:",t)}finally{_(!1)}})()},[]),(0,n.useEffect)(()=>{var t;t=t=>{let{sub:e,cause:s}=t;console.error("Session for ".concat(e," was invalidated:"),s),h(null)},r.addEventListener("deleted",e=>{let{sub:s,cause:a}=e.detail;console.error("Session for ".concat(s," was invalidated:"),a),t({sub:s,cause:a})})},[]);let m={session:s,isAuthenticated:!!s,isLoading:u,signIn:async t=>{try{await l(t)}catch(t){throw console.error("Sign in failed:",t),t}},signOut:async()=>{try{await c(),h(null)}catch(t){throw console.error("Sign out failed:",t),t}},restoreSession:async t=>{try{let e=await i(t);return h(e),e}catch(t){throw console.error("Failed to restore session:",t),t}},accessToken:s?"available":null,refreshToken:s?"available":null,did:(null==s?void 0:s.sub)||null,handle:null,pdsEndpoint:null};return(0,a.jsx)(d.Provider,{value:m,children:e})}function u(){let t=(0,n.useContext)(d);if(void 0===t)throw Error("useAuth must be used within an AuthProvider");return t}},7653:function(t){t.exports={container:"stats_container__0HsAQ",header:"stats_header__9sD9c",headerContent:"stats_headerContent__M9_Sh",title:"stats_title__g_yzk",subtitle:"stats_subtitle__n40rI",description:"stats_description__HSsSv",creditLine:"stats_creditLine__WpGGS",kofiLink:"stats_kofiLink__jp7YY",headerActions:"stats_headerActions__CWiBy",userInfo:"stats_userInfo__bgXa_",logoutButton:"stats_logoutButton__tseaR",loginButton:"stats_loginButton___mXY5",statsHeader:"stats_statsHeader__BS5J0",statsSubtitle:"stats_statsSubtitle__bqiRY",controls:"stats_controls__Uojja",refreshButton:"stats_refreshButton__Zlv63",homeLink:"stats_homeLink__1iuoe",loadingContainer:"stats_loadingContainer__AzFmD",loader:"stats_loader__52AJY",spin:"stats_spin__rG0vl",error:"stats_error__8vXRU",emptyState:"stats_emptyState__S037y",statsContent:"stats_statsContent__q_dOi",overallStats:"stats_overallStats__cOcCy",chartSection:"stats_chartSection__srieH",leaderboardSection:"stats_leaderboardSection__lveop",emojiSection:"stats_emojiSection__JN76r",plumberProfileLink:"stats_plumberProfileLink__TcMfD",statsGrid:"stats_statsGrid__GCL_G",statCard:"stats_statCard__kfTN5",statValue:"stats_statValue__Os2uC",statLabel:"stats_statLabel___eg66",plumberLink:"stats_plumberLink__rKwK_",chartContainer:"stats_chartContainer__LFQal",chartBar:"stats_chartBar__P3BbP",chartLegend:"stats_chartLegend__VMRCe",noDataMessage:"stats_noDataMessage__EcQsv",leaderboard:"stats_leaderboard__qPOCc",leaderboardHeader:"stats_leaderboardHeader__UGY6K",leaderboardItem:"stats_leaderboardItem__oiP4Z",topRank:"stats_topRank__hdT1W",secondRank:"stats_secondRank__y2__D",thirdRank:"stats_thirdRank__QO5Fz",rank:"stats_rank__dWi9x",user:"stats_user__efntK",unknownUser:"stats_unknownUser__pMz0J",count:"stats_count__1X9Jf",emojiGrid:"stats_emojiGrid__VvPLY",emojiCard:"stats_emojiCard__xNwtu",emoji:"stats_emoji__XgGWx",emojiCount:"stats_emojiCount__ggkr6",shareSection:"stats_shareSection__QxdSk",shareButton:"stats_shareButton__Ms2N_"}}},function(t){t.O(0,[815,297,972,971,117,744],function(){return t(t.s=2750)}),_N_E=t.O()}]);