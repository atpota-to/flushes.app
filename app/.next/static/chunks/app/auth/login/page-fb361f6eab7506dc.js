(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[716],{5405:function(e,t,o){Promise.resolve().then(o.bind(o,1202))},9376:function(e,t,o){"use strict";var n=o(5475);o.o(n,"useParams")&&o.d(t,{useParams:function(){return n.useParams}}),o.o(n,"usePathname")&&o.d(t,{usePathname:function(){return n.usePathname}}),o.o(n,"useRouter")&&o.d(t,{useRouter:function(){return n.useRouter}})},1202:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return c}});var n=o(7437),s=o(2265),i=o(9376),l=o(7758),r=o(9584),a=o.n(r);function c(){let e=(0,i.useRouter)(),{signIn:t}=(0,l.a)(),[o,r]=(0,s.useState)(""),[c,u]=(0,s.useState)(!1),[d,g]=(0,s.useState)(null),h=async e=>{if(e.preventDefault(),!o.trim()){g("Please enter your handle or DID");return}u(!0),g(null);try{console.log("Starting OAuth flow for: ".concat(o)),await t(o.trim()),console.log("This should not be logged - redirect should have occurred")}catch(e){console.error("Login error:",e),g(e.message||"Failed to start login process"),u(!1)}};return(0,n.jsx)("div",{className:a().container,children:(0,n.jsxs)("div",{className:a().loginBox,children:[(0,n.jsx)("h1",{className:a().title,children:"Sign in to Flushes"}),(0,n.jsx)("p",{className:a().subtitle,children:"Connect with your AT Protocol account"}),(0,n.jsxs)("form",{onSubmit:h,className:a().form,children:[(0,n.jsxs)("div",{className:a().inputGroup,children:[(0,n.jsx)("label",{htmlFor:"handle",className:a().label,children:"Handle or DID"}),(0,n.jsx)("input",{id:"handle",type:"text",value:o,onChange:e=>r(e.target.value),placeholder:"e.g., alice.bsky.social or did:plc:...",className:a().input,disabled:c,autoComplete:"username",autoFocus:!0}),(0,n.jsx)("p",{className:a().hint,children:"Enter your Bluesky handle, custom domain, or DID identifier"})]}),d&&(0,n.jsx)("div",{className:a().error,role:"alert",children:d}),(0,n.jsx)("button",{type:"submit",disabled:c||!o.trim(),className:a().submitButton,children:c?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:a().spinner}),"Connecting..."]}):"Sign In"})]}),(0,n.jsxs)("div",{className:a().info,children:[(0,n.jsx)("h3",{children:"Supported Services"}),(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:"Bluesky (bsky.social)"}),(0,n.jsx)("li",{children:"Custom domains (e.g., alice.example.com)"}),(0,n.jsx)("li",{children:"Third-party PDS servers"}),(0,n.jsx)("li",{children:"Self-hosted instances"})]})]}),(0,n.jsx)("div",{className:a().footer,children:(0,n.jsx)("button",{onClick:()=>e.push("/"),className:a().backButton,children:"â† Back to Home"})})]})})}},7758:function(e,t,o){"use strict";o.d(t,{AuthProvider:function(){return d},a:function(){return g}});var n=o(7437),s=o(2265);let i=new(o(6297)).BrowserOAuthClient({clientMetadata:{client_id:"https://flushes.app/client-metadata.json",application_type:"web",client_name:"Flushes",client_uri:"https://flushes.app",logo_uri:"https://flushes.app/logo.png",tos_uri:"https://flushes.app/terms",policy_uri:"https://flushes.app/privacy",dpop_bound_access_tokens:!0,grant_types:["authorization_code","refresh_token"],redirect_uris:["https://flushes.app/auth/callback"],response_types:["code"],scope:"atproto transition:generic",token_endpoint_auth_method:"none"},handleResolver:"https://bsky.social",responseMode:"fragment"});async function l(){try{let e=await i.init();if(e){let{session:t}=e,o="state"in e?e.state:null;return console.log("OAuth client initialized with session for ".concat(t.sub)),o?console.log("User successfully authenticated with state: ".concat(o)):console.log("Restored previous session"),{session:t,state:o}}return console.log("OAuth client initialized without existing session"),null}catch(e){throw console.error("Failed to initialize OAuth client:",e),e}}async function r(e,t){try{console.log("Initiating OAuth flow for ".concat(e)),await i.signIn(e,{state:(null==t?void 0:t.state)||"signin-".concat(Date.now()),signal:null==t?void 0:t.signal})}catch(e){throw console.error("OAuth sign in failed:",e),e}}async function a(e){try{console.log("Restoring session for ".concat(e));let t=await i.restore(e);return console.log("Successfully restored session for ".concat(t.sub)),t}catch(t){throw console.error("Failed to restore session for ".concat(e,":"),t),t}}async function c(){try{console.log("Signing out user"),"undefined"!=typeof localStorage&&(localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("did"),localStorage.removeItem("handle"),localStorage.removeItem("keyPair"),localStorage.removeItem("dpopNonce"),localStorage.removeItem("pdsEndpoint"),localStorage.removeItem("bsky_auth_pdsEndpoint")),console.log("User signed out")}catch(e){throw console.error("Error during sign out:",e),e}}let u=(0,s.createContext)(void 0);function d(e){let{children:t}=e,[o,d]=(0,s.useState)(null),[g,h]=(0,s.useState)(!0);(0,s.useEffect)(()=>{(async function(){try{h(!0);let e=await l();e&&(console.log("Initialized with existing session:",e.session.sub),d(e.session))}catch(e){console.error("Failed to initialize OAuth client:",e)}finally{h(!1)}})()},[]),(0,s.useEffect)(()=>{var e;e=e=>{let{sub:t,cause:o}=e;console.error("Session for ".concat(t," was invalidated:"),o),d(null)},i.addEventListener("deleted",t=>{let{sub:o,cause:n}=t.detail;console.error("Session for ".concat(o," was invalidated:"),n),e({sub:o,cause:n})})},[]);let _={session:o,isAuthenticated:!!o,isLoading:g,signIn:async e=>{try{await r(e)}catch(e){throw console.error("Sign in failed:",e),e}},signOut:async()=>{try{await c(),d(null)}catch(e){throw console.error("Sign out failed:",e),e}},restoreSession:async e=>{try{let t=await a(e);return d(t),t}catch(e){throw console.error("Failed to restore session:",e),e}},accessToken:o?"available":null,refreshToken:o?"available":null,did:(null==o?void 0:o.sub)||null,handle:null,pdsEndpoint:null};return(0,n.jsx)(u.Provider,{value:_,children:t})}function g(){let e=(0,s.useContext)(u);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9584:function(e){e.exports={container:"login_container__5QAMw",loaderContainer:"login_loaderContainer__1CfGr",errorContainer:"login_errorContainer__wDDNb",loader:"login_loader__6SES9",spin:"login_spin__fKFA3",loginForm:"login_loginForm__ymvA1",subtitle:"login_subtitle__R_8JC",description:"login_description__W2Yw5",inputGroup:"login_inputGroup__uKxms",inputWithSuggestions:"login_inputWithSuggestions__88uW6",input:"login_input__OrWbz",suggestionsContainer:"login_suggestionsContainer__jSSVF",suggestionsList:"login_suggestionsList__AqDMZ",suggestionItem:"login_suggestionItem__8gx6R",suggestionButton:"login_suggestionButton__Ojfs3",avatar:"login_avatar__FQvoV",avatarPlaceholder:"login_avatarPlaceholder__15CKa",handle:"login_handle__5SeSW",noResults:"login_noResults__M2oEY",loadingContainer:"login_loadingContainer__O_Gn3",loadingDot:"login_loadingDot__iLTi3",dotPulse:"login_dotPulse__L4qxX",loginButton:"login_loginButton__gObYa",helpText:"login_helpText__NlX75",error:"login_error__fioO8",backButton:"login_backButton__czpHk"}}},function(e){e.O(0,[766,297,971,117,744],function(){return e(e.s=5405)}),_N_E=e.O()}]);