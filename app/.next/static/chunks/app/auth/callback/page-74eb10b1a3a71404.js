(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[453],{5379:function(e,t,n){Promise.resolve().then(n.bind(n,9838))},9376:function(e,t,n){"use strict";var o=n(5475);n.o(o,"useParams")&&n.d(t,{useParams:function(){return o.useParams}}),n.o(o,"usePathname")&&n.d(t,{usePathname:function(){return o.usePathname}}),n.o(o,"useRouter")&&n.d(t,{useRouter:function(){return o.useRouter}})},9838:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var o=n(7437),r=n(2265),s=n(9376),a=n(7758),i=n(6516),c=n.n(i);function l(){return(0,o.jsx)("div",{className:c().container,children:(0,o.jsxs)("div",{className:c().loaderContainer,children:[(0,o.jsx)("div",{className:c().loader}),(0,o.jsx)("p",{children:"Processing login..."})]})})}function u(){let e=(0,s.useRouter)(),{session:t,isLoading:n}=(0,a.a)(),[i,l]=(0,r.useState)(null),[u,d]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{if(u)return;let e=setTimeout(()=>{t||n||(console.error("OAuth callback processing timed out"),l("Login process timed out. Please try again."))},3e4);return()=>{clearTimeout(e),d(!0)}},[t,n,u]),(0,r.useEffect)(()=>{t&&!n&&(console.log("Successfully authenticated user: ".concat(t.sub)),setTimeout(()=>{e.push("/")},1e3))},[t,n,e]),(0,r.useEffect)(()=>{{let e=new URLSearchParams(window.location.search),t=e.get("error"),n=e.get("error_description");if(t){console.error("OAuth error in URL: ".concat(t," - ").concat(n)),l("Authentication error: ".concat(n||t));return}let o=new URLSearchParams(window.location.hash.substring(1)),r=o.get("error"),s=o.get("error_description");if(r){console.error("OAuth error in hash: ".concat(r," - ").concat(s)),l("Authentication error: ".concat(s||r));return}}if(!n&&!t){let e=setTimeout(()=>{t||(console.error("No session available after callback processing"),l("Failed to complete authentication. Please try again."))},5e3);return()=>clearTimeout(e)}},[n,t]),i)?(0,o.jsx)("div",{className:c().container,children:(0,o.jsxs)("div",{className:c().errorContainer,children:[(0,o.jsx)("h1",{children:"Authentication Error"}),(0,o.jsx)("p",{className:c().error,children:i}),(0,o.jsx)("button",{onClick:()=>e.push("/auth/login"),className:c().button,children:"Try Again"}),(0,o.jsx)("button",{onClick:()=>e.push("/"),className:c().button,children:"Back to Home"})]})}):t?(0,o.jsx)("div",{className:c().container,children:(0,o.jsxs)("div",{className:c().successContainer,children:[(0,o.jsx)("div",{className:c().checkmark,children:"âœ“"}),(0,o.jsx)("h1",{children:"Welcome back!"}),(0,o.jsx)("p",{children:"Successfully signed in! Redirecting..."}),(0,o.jsx)("p",{children:"Redirecting to home page..."})]})}):(0,o.jsx)("div",{className:c().container,children:(0,o.jsxs)("div",{className:c().loaderContainer,children:[(0,o.jsx)("div",{className:c().loader}),(0,o.jsx)("p",{children:"Completing authentication..."})]})})}function d(){return(0,o.jsx)(r.Suspense,{fallback:(0,o.jsx)(l,{}),children:(0,o.jsx)(u,{})})}},7758:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return d},a:function(){return h}});var o=n(7437),r=n(2265);let s=new(n(6297)).BrowserOAuthClient({clientMetadata:{client_id:"https://flushes.app/client-metadata.json",application_type:"web",client_name:"Flushes",client_uri:"https://flushes.app",logo_uri:"https://flushes.app/logo.png",tos_uri:"https://flushes.app/terms",policy_uri:"https://flushes.app/privacy",dpop_bound_access_tokens:!0,grant_types:["authorization_code","refresh_token"],redirect_uris:["https://flushes.app/auth/callback"],response_types:["code"],scope:"atproto transition:generic",token_endpoint_auth_method:"none"},handleResolver:"https://bsky.social",responseMode:"fragment"});async function a(){try{let e=await s.init();if(e){let{session:t}=e,n="state"in e?e.state:null;return console.log("OAuth client initialized with session for ".concat(t.sub)),n?console.log("User successfully authenticated with state: ".concat(n)):console.log("Restored previous session"),{session:t,state:n}}return console.log("OAuth client initialized without existing session"),null}catch(e){throw console.error("Failed to initialize OAuth client:",e),e}}async function i(e,t){try{console.log("Initiating OAuth flow for ".concat(e)),await s.signIn(e,{state:(null==t?void 0:t.state)||"signin-".concat(Date.now()),signal:null==t?void 0:t.signal})}catch(e){throw console.error("OAuth sign in failed:",e),e}}async function c(e){try{console.log("Restoring session for ".concat(e));let t=await s.restore(e);return console.log("Successfully restored session for ".concat(t.sub)),t}catch(t){throw console.error("Failed to restore session for ".concat(e,":"),t),t}}async function l(){try{console.log("Signing out user"),"undefined"!=typeof localStorage&&(localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("did"),localStorage.removeItem("handle"),localStorage.removeItem("keyPair"),localStorage.removeItem("dpopNonce"),localStorage.removeItem("pdsEndpoint"),localStorage.removeItem("bsky_auth_pdsEndpoint")),console.log("User signed out")}catch(e){throw console.error("Error during sign out:",e),e}}let u=(0,r.createContext)(void 0);function d(e){let{children:t}=e,[n,d]=(0,r.useState)(null),[h,f]=(0,r.useState)(!0);(0,r.useEffect)(()=>{(async function(){try{f(!0);let e=await a();e&&(console.log("Initialized with existing session:",e.session.sub),d(e.session))}catch(e){console.error("Failed to initialize OAuth client:",e)}finally{f(!1)}})()},[]),(0,r.useEffect)(()=>{var e;e=e=>{let{sub:t,cause:n}=e;console.error("Session for ".concat(t," was invalidated:"),n),d(null)},s.addEventListener("deleted",t=>{let{sub:n,cause:o}=t.detail;console.error("Session for ".concat(n," was invalidated:"),o),e({sub:n,cause:o})})},[]);let p={session:n,isAuthenticated:!!n,isLoading:h,signIn:async e=>{try{await i(e)}catch(e){throw console.error("Sign in failed:",e),e}},signOut:async()=>{try{await l(),d(null)}catch(e){throw console.error("Sign out failed:",e),e}},restoreSession:async e=>{try{let t=await c(e);return d(t),t}catch(e){throw console.error("Failed to restore session:",e),e}},accessToken:n?"available":null,refreshToken:n?"available":null,did:(null==n?void 0:n.sub)||null,handle:null,pdsEndpoint:null};return(0,o.jsx)(u.Provider,{value:p,children:t})}function h(){let e=(0,r.useContext)(u);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6516:function(e){e.exports={container:"callback_container__4mCQY",loaderContainer:"callback_loaderContainer__wEg9L",errorContainer:"callback_errorContainer__bRI_N",loader:"callback_loader__YVzJm",spin:"callback_spin__MJhVO",error:"callback_error__IlMhg",button:"callback_button__0diuj"}}},function(e){e.O(0,[655,297,971,117,744],function(){return e(e.s=5379)}),_N_E=e.O()}]);