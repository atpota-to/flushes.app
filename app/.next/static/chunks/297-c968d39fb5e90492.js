(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[297],{1102:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,a)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.AtUri=t.ATP_URI_REGEX=void 0,a(r(5505),t),t.ATP_URI_REGEX=/^(at:\/\/)?((?:did:[a-z0-9:%-]+)|(?:[a-z0-9][a-z0-9.:-]*))(\/[^?#\s]*)?(\?[^#\s]+)?(#[^\s]+)?$/i;let s=/^(\/[^?#\s]*)?(\?[^#\s]+)?(#[^\s]+)?$/i;class n{constructor(e,t){let r;if(Object.defineProperty(this,"hash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"host",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pathname",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"searchParams",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),t){if(!(r=o(t)))throw Error(`Invalid at uri: ${t}`);let i=function(e){let t=s.exec(e);if(t)return{hash:t[3]||"",pathname:t[1]||"",searchParams:new URLSearchParams(t[2]||"")}}(e);if(!i)throw Error(`Invalid path: ${e}`);Object.assign(r,i)}else if(!(r=o(e)))throw Error(`Invalid at uri: ${e}`);this.hash=r.hash,this.host=r.host,this.pathname=r.pathname,this.searchParams=r.searchParams}static make(e,t,r){let i=e;return t&&(i+="/"+t),r&&(i+="/"+r),new n(i)}get protocol(){return"at:"}get origin(){return`at://${this.host}`}get hostname(){return this.host}set hostname(e){this.host=e}get search(){return this.searchParams.toString()}set search(e){this.searchParams=new URLSearchParams(e)}get collection(){return this.pathname.split("/").filter(Boolean)[0]||""}set collection(e){let t=this.pathname.split("/").filter(Boolean);t[0]=e,this.pathname=t.join("/")}get rkey(){return this.pathname.split("/").filter(Boolean)[1]||""}set rkey(e){let t=this.pathname.split("/").filter(Boolean);t[0]||(t[0]="undefined"),t[1]=e,this.pathname=t.join("/")}get href(){return this.toString()}toString(){let e=this.pathname||"/";e.startsWith("/")||(e=`/${e}`);let t=this.searchParams.toString();t&&!t.startsWith("?")&&(t=`?${t}`);let r=this.hash;return r&&!r.startsWith("#")&&(r=`#${r}`),`at://${this.host}${e}${t}${r}`}}function o(e){let r=t.ATP_URI_REGEX.exec(e);if(r)return{hash:r[5]||"",host:r[2]||"",pathname:r[3]||"",searchParams:new URLSearchParams(r[4]||"")}}t.AtUri=n},5505:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ensureValidAtUriRegex=t.ensureValidAtUri=void 0;let i=r(2542),a=r(8613),s=r(4043);t.ensureValidAtUri=e=>{let t=e.split("#");if(t.length>2)throw Error('ATURI can have at most one "#", separating fragment out');let r=t[1]||null;if(e=t[0],!/^[a-zA-Z0-9._~:@!$&')(*+,;=%/-]*$/.test(e))throw Error("Disallowed characters in ATURI (ASCII)");let n=e.split("/");if(n.length>=3&&("at:"!==n[0]||0!==n[1].length))throw Error('ATURI must start with "at://"');if(n.length<3)throw Error("ATURI requires at least method and authority sections");try{n[2].startsWith("did:")?(0,i.ensureValidDid)(n[2]):(0,a.ensureValidHandle)(n[2])}catch{throw Error("ATURI authority must be a valid handle or DID")}if(n.length>=4){if(0===n[3].length)throw Error("ATURI can not have a slash after authority without a path segment");try{(0,s.ensureValidNsid)(n[3])}catch{throw Error("ATURI requires first path segment (if supplied) to be valid NSID")}}if(n.length>=5&&0===n[4].length)throw Error("ATURI can not have a slash after collection, unless record key is provided");if(n.length>=6)throw Error("ATURI path can have at most two parts, and no trailing slash");if(t.length>=2&&null==r)throw Error("ATURI fragment must be non-empty and start with slash");if(null!=r){if(0===r.length||"/"!==r[0])throw Error("ATURI fragment must be non-empty and start with slash");if(!/^\/[a-zA-Z0-9._~:@!$&')(*+,;=%[\]/-]*$/.test(r))throw Error("Disallowed characters in ATURI fragment (ASCII)")}if(e.length>8192)throw Error("ATURI is far too long")},t.ensureValidAtUriRegex=e=>{let t=e.match(/^at:\/\/(?<authority>[a-zA-Z0-9._:%-]+)(\/(?<collection>[a-zA-Z0-9-.]+)(\/(?<rkey>[a-zA-Z0-9._~:@!$&%')(*+,;=-]+))?)?(#(?<fragment>\/[a-zA-Z0-9._~:@!$&%')(*+,;=\-[\]/\\]*))?$/);if(!t||!t.groups)throw Error("ATURI didn't validate via regex");let r=t.groups;try{(0,a.ensureValidHandleRegex)(r.authority)}catch{try{(0,i.ensureValidDidRegex)(r.authority)}catch{throw Error("ATURI authority must be a valid handle or DID")}}if(r.collection)try{(0,s.ensureValidNsidRegex)(r.collection)}catch{throw Error("ATURI collection path segment must be a valid NSID")}if(e.length>8192)throw Error("ATURI is far too long")}},8485:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidDatetimeError=t.normalizeDatetimeAlways=t.normalizeDatetime=t.isValidDatetime=t.ensureValidDatetime=void 0,t.ensureValidDatetime=e=>{let t=new Date(e);if(isNaN(t.getTime()))throw new r("datetime did not parse as ISO 8601");if(t.toISOString().startsWith("-"))throw new r("datetime normalized to a negative time");if(!/^[0-9]{4}-[01][0-9]-[0-3][0-9]T[0-2][0-9]:[0-6][0-9]:[0-6][0-9](.[0-9]{1,20})?(Z|([+-][0-2][0-9]:[0-5][0-9]))$/.test(e))throw new r("datetime didn't validate via regex");if(e.length>64)throw new r("datetime is too long (64 chars max)");if(e.endsWith("-00:00"))throw new r('datetime can not use "-00:00" for UTC timezone');if(e.startsWith("000"))throw new r("datetime so close to year zero not allowed")},t.isValidDatetime=e=>{try{(0,t.ensureValidDatetime)(e)}catch(e){if(e instanceof r)return!1;throw e}return!0},t.normalizeDatetime=e=>{if((0,t.isValidDatetime)(e)){let r=new Date(e).toISOString();if((0,t.isValidDatetime)(r))return r}if(!/.*(([+-]\d\d:?\d\d)|[a-zA-Z])$/.test(e)){let r=new Date(e+"Z");if(!isNaN(r.getTime())){let e=r.toISOString();if((0,t.isValidDatetime)(e))return e}}let i=new Date(e);if(isNaN(i.getTime()))throw new r("datetime did not parse as any timestamp format");let a=i.toISOString();if((0,t.isValidDatetime)(a))return a;throw new r("datetime normalized to invalid timestamp string")},t.normalizeDatetimeAlways=e=>{try{return(0,t.normalizeDatetime)(e)}catch(e){if(e instanceof r)return new Date(0).toISOString();throw e}};class r extends Error{}t.InvalidDatetimeError=r},2542:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidDidError=t.ensureValidDidRegex=t.ensureValidDid=void 0,t.ensureValidDid=e=>{if(!e.startsWith("did:"))throw new r('DID requires "did:" prefix');if(!/^[a-zA-Z0-9._:%-]*$/.test(e))throw new r("Disallowed characters in DID (ASCII letters, digits, and a couple other characters only)");let{length:t,1:i}=e.split(":");if(t<3)throw new r("DID requires prefix, method, and method-specific content");if(!/^[a-z]+$/.test(i))throw new r("DID method must be lower-case letters");if(e.endsWith(":")||e.endsWith("%"))throw new r('DID can not end with ":" or "%"');if(e.length>2048)throw new r("DID is too long (2048 chars max)")},t.ensureValidDidRegex=e=>{if(!/^did:[a-z]+:[a-zA-Z0-9._:%-]*[a-zA-Z0-9._-]$/.test(e))throw new r("DID didn't validate via regex");if(e.length>2048)throw new r("DID is too long (2048 chars max)")};class r extends Error{}t.InvalidDidError=r},8613:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisallowedDomainError=t.UnsupportedDomainError=t.ReservedHandleError=t.InvalidHandleError=t.isValidTld=t.isValidHandle=t.normalizeAndEnsureValidHandle=t.normalizeHandle=t.ensureValidHandleRegex=t.ensureValidHandle=t.DISALLOWED_TLDS=t.INVALID_HANDLE=void 0,t.INVALID_HANDLE="handle.invalid",t.DISALLOWED_TLDS=[".local",".arpa",".invalid",".localhost",".internal",".example",".alt",".onion"],t.ensureValidHandle=e=>{if(!/^[a-zA-Z0-9.-]*$/.test(e))throw new r("Disallowed characters in handle (ASCII letters, digits, dashes, periods only)");if(e.length>253)throw new r("Handle is too long (253 chars max)");let t=e.split(".");if(t.length<2)throw new r("Handle domain needs at least two parts");for(let e=0;e<t.length;e++){let i=t[e];if(i.length<1)throw new r("Handle parts can not be empty");if(i.length>63)throw new r("Handle part too long (max 63 chars)");if(i.endsWith("-")||i.startsWith("-"))throw new r("Handle parts can not start or end with hyphens");if(e+1===t.length&&!/^[a-zA-Z]/.test(i))throw new r("Handle final component (TLD) must start with ASCII letter")}},t.ensureValidHandleRegex=e=>{if(!/^([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?$/.test(e))throw new r("Handle didn't validate via regex");if(e.length>253)throw new r("Handle is too long (253 chars max)")},t.normalizeHandle=e=>e.toLowerCase(),t.normalizeAndEnsureValidHandle=e=>{let r=(0,t.normalizeHandle)(e);return(0,t.ensureValidHandle)(r),r},t.isValidHandle=e=>{try{(0,t.ensureValidHandle)(e)}catch(e){if(e instanceof r)return!1;throw e}return!0},t.isValidTld=e=>!t.DISALLOWED_TLDS.some(t=>e.endsWith(t));class r extends Error{}t.InvalidHandleError=r;class i extends Error{}t.ReservedHandleError=i;class a extends Error{}t.UnsupportedDomainError=a;class s extends Error{}t.DisallowedDomainError=s},4836:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,a)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(8613),t),a(r(2542),t),a(r(4043),t),a(r(1102),t),a(r(5594),t),a(r(8252),t),a(r(8485),t)},4043:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidNsidError=t.ensureValidNsidRegex=t.ensureValidNsid=t.NSID=void 0;class r{static parse(e){return new r(e)}static create(e,t){return new r([...e.split(".").reverse(),t].join("."))}static isValid(e){try{return r.parse(e),!0}catch(e){return!1}}constructor(e){Object.defineProperty(this,"segments",{enumerable:!0,configurable:!0,writable:!0,value:[]}),(0,t.ensureValidNsid)(e),this.segments=e.split(".")}get authority(){return this.segments.slice(0,this.segments.length-1).reverse().join(".")}get name(){return this.segments.at(this.segments.length-1)}toString(){return this.segments.join(".")}}t.NSID=r,t.ensureValidNsid=e=>{if(!/^[a-zA-Z0-9.-]*$/.test(e))throw new i("Disallowed characters in NSID (ASCII letters, digits, dashes, periods only)");if(e.length>317)throw new i("NSID is too long (317 chars max)");let t=e.split(".");if(t.length<3)throw new i("NSID needs at least three parts");for(let e=0;e<t.length;e++){let r=t[e];if(r.length<1)throw new i("NSID parts can not be empty");if(r.length>63)throw new i("NSID part too long (max 63 chars)");if(r.endsWith("-")||r.startsWith("-"))throw new i("NSID parts can not start or end with hyphen");if(/^[0-9]/.test(r)&&0===e)throw new i("NSID first part may not start with a digit");if(!/^[a-zA-Z][a-zA-Z0-9]*$/.test(r)&&e+1===t.length)throw new i("NSID name part must be only letters and digits (and no leading digit)")}},t.ensureValidNsidRegex=e=>{if(!/^[a-zA-Z]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(\.[a-zA-Z]([a-zA-Z0-9]{0,62})?)$/.test(e))throw new i("NSID didn't validate via regex");if(e.length>317)throw new i("NSID is too long (317 chars max)")};class i extends Error{}t.InvalidNsidError=i},8252:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidRecordKeyError=t.isValidRecordKey=t.ensureValidRecordKey=void 0,t.ensureValidRecordKey=e=>{if(e.length>512||e.length<1)throw new r("record key must be 1 to 512 characters");if(!/^[a-zA-Z0-9_~.:-]{1,512}$/.test(e))throw new r("record key syntax not valid (regex)");if("."===e||".."===e)throw new r('record key can not be "." or ".."')},t.isValidRecordKey=e=>{try{(0,t.ensureValidRecordKey)(e)}catch(e){if(e instanceof r)return!1;throw e}return!0};class r extends Error{}t.InvalidRecordKeyError=r},5594:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidTidError=t.isValidTid=t.ensureValidTid=void 0;let r=/^[234567abcdefghij][234567abcdefghijklmnopqrstuvwxyz]{12}$/;t.ensureValidTid=e=>{if(13!==e.length)throw new i("TID must be 13 characters");if(!r.test(e))throw new i("TID syntax not valid (regex)")},t.isValidTid=e=>13===e.length&&r.test(e);class i extends Error{}t.InvalidTidError=i},257:function(e,t,r){"use strict";var i,a;e.exports=(null==(i=r.g.process)?void 0:i.env)&&"object"==typeof(null==(a=r.g.process)?void 0:a.env)?r.g.process:r(4227)},4227:function(e){!function(){var t={229:function(e){var t,r,i,a=e.exports={};function s(){throw Error("setTimeout has not been defined")}function n(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{r="function"==typeof clearTimeout?clearTimeout:n}catch(e){r=n}}();var d=[],l=!1,c=-1;function u(){l&&i&&(l=!1,i.length?d=i.concat(d):c=-1,d.length&&h())}function h(){if(!l){var e=o(u);l=!0;for(var t=d.length;t;){for(i=d,d=[];++c<t;)i&&i[c].run();c=-1,t=d.length}i=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===n||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function f(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new p(e,t)),1!==d.length||l||o(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=f,a.addListener=f,a.once=f,a.off=f,a.removeListener=f,a.removeAllListeners=f,a.emit=f,a.prependListener=f,a.prependOnceListener=f,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},r={};function i(e){var a=r[e];if(void 0!==a)return a.exports;var s=r[e]={exports:{}},n=!0;try{t[e](s,s.exports,i),n=!1}finally{n&&delete r[e]}return s.exports}i.ab="//";var a=i(229);e.exports=a}()},1438:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZodError=t.quotelessJson=t.ZodIssueCode=void 0;let i=r(9358);t.ZodIssueCode=i.util.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),t.quotelessJson=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class a extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},i=e=>{for(let a of e.issues)if("invalid_union"===a.code)a.unionErrors.map(i);else if("invalid_return_type"===a.code)i(a.returnTypeError);else if("invalid_arguments"===a.code)i(a.argumentsError);else if(0===a.path.length)r._errors.push(t(a));else{let e=r,i=0;for(;i<a.path.length;){let r=a.path[i];i===a.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(a))):e[r]=e[r]||{_errors:[]},e=e[r],i++}}};return i(this),r}static assert(e){if(!(e instanceof a))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,i.util.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let i of this.issues)i.path.length>0?(t[i.path[0]]=t[i.path[0]]||[],t[i.path[0]].push(e(i))):r.push(e(i));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}t.ZodError=a,a.create=e=>new a(e)},9935:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorMap=t.setErrorMap=t.defaultErrorMap=void 0;let a=i(r(9955));t.defaultErrorMap=a.default;let s=a.default;t.setErrorMap=function(e){s=e},t.getErrorMap=function(){return s}},1790:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,a)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(9935),t),a(r(4001),t),a(r(9608),t),a(r(9358),t),a(r(5666),t),a(r(1438),t)},4116:function(e,t){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.errorUtil=void 0,(i=r||(t.errorUtil=r={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},i.toString=e=>"string"==typeof e?e:null==e?void 0:e.message},4001:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isAsync=t.isValid=t.isDirty=t.isAborted=t.OK=t.DIRTY=t.INVALID=t.ParseStatus=t.addIssueToContext=t.EMPTY_PATH=t.makeIssue=void 0;let a=r(9935),s=i(r(9955));t.makeIssue=e=>{let{data:t,path:r,errorMaps:i,issueData:a}=e,s=[...r,...a.path||[]],n={...a,path:s};if(void 0!==a.message)return{...a,path:s,message:a.message};let o="";for(let e of i.filter(e=>!!e).slice().reverse())o=e(n,{data:t,defaultError:o}).message;return{...a,path:s,message:o}},t.EMPTY_PATH=[],t.addIssueToContext=function(e,r){let i=(0,a.getErrorMap)(),n=(0,t.makeIssue)({issueData:r,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,i,i===s.default?void 0:s.default].filter(e=>!!e)});e.common.issues.push(n)};class n{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,r){let i=[];for(let a of r){if("aborted"===a.status)return t.INVALID;"dirty"===a.status&&e.dirty(),i.push(a.value)}return{status:e.value,value:i}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,i=await e.value;r.push({key:t,value:i})}return n.mergeObjectSync(e,r)}static mergeObjectSync(e,r){let i={};for(let a of r){let{key:r,value:s}=a;if("aborted"===r.status||"aborted"===s.status)return t.INVALID;"dirty"===r.status&&e.dirty(),"dirty"===s.status&&e.dirty(),"__proto__"!==r.value&&(void 0!==s.value||a.alwaysSet)&&(i[r.value]=s.value)}return{status:e.value,value:i}}}t.ParseStatus=n,t.INVALID=Object.freeze({status:"aborted"}),t.DIRTY=e=>({status:"dirty",value:e}),t.OK=e=>({status:"valid",value:e}),t.isAborted=e=>"aborted"===e.status,t.isDirty=e=>"dirty"===e.status,t.isValid=e=>"valid"===e.status,t.isAsync=e=>"undefined"!=typeof Promise&&e instanceof Promise},9608:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},9358:function(e,t){"use strict";var r,i,a;Object.defineProperty(t,"__esModule",{value:!0}),t.getParsedType=t.ZodParsedType=t.objectUtil=t.util=void 0,(a=r||(t.util=r={})).assertEqual=e=>e,a.assertIs=function(e){},a.assertNever=function(e){throw Error()},a.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},a.getValidEnumValues=e=>{let t=a.objectKeys(e).filter(t=>"number"!=typeof e[e[t]]),r={};for(let i of t)r[i]=e[i];return a.objectValues(r)},a.objectValues=e=>a.objectKeys(e).map(function(t){return e[t]}),a.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},a.find=(e,t)=>{for(let r of e)if(t(r))return r},a.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,a.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},a.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t,(i||(t.objectUtil=i={})).mergeShapes=(e,t)=>({...e,...t}),t.ZodParsedType=r.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),t.getParsedType=e=>{switch(typeof e){case"undefined":return t.ZodParsedType.undefined;case"string":return t.ZodParsedType.string;case"number":return isNaN(e)?t.ZodParsedType.nan:t.ZodParsedType.number;case"boolean":return t.ZodParsedType.boolean;case"function":return t.ZodParsedType.function;case"bigint":return t.ZodParsedType.bigint;case"symbol":return t.ZodParsedType.symbol;case"object":if(Array.isArray(e))return t.ZodParsedType.array;if(null===e)return t.ZodParsedType.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return t.ZodParsedType.promise;if("undefined"!=typeof Map&&e instanceof Map)return t.ZodParsedType.map;if("undefined"!=typeof Set&&e instanceof Set)return t.ZodParsedType.set;if("undefined"!=typeof Date&&e instanceof Date)return t.ZodParsedType.date;return t.ZodParsedType.object;default:return t.ZodParsedType.unknown}}},4747:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,a)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t},n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.z=void 0;let o=s(r(1790));t.z=o,n(r(1790),t),t.default=o},9955:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let i=r(9358),a=r(1438);t.default=(e,t)=>{let r;switch(e.code){case a.ZodIssueCode.invalid_type:r=e.received===i.ZodParsedType.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case a.ZodIssueCode.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,i.util.jsonStringifyReplacer)}`;break;case a.ZodIssueCode.unrecognized_keys:r=`Unrecognized key(s) in object: ${i.util.joinValues(e.keys,", ")}`;break;case a.ZodIssueCode.invalid_union:r="Invalid input";break;case a.ZodIssueCode.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${i.util.joinValues(e.options)}`;break;case a.ZodIssueCode.invalid_enum_value:r=`Invalid enum value. Expected ${i.util.joinValues(e.options)}, received '${e.received}'`;break;case a.ZodIssueCode.invalid_arguments:r="Invalid function arguments";break;case a.ZodIssueCode.invalid_return_type:r="Invalid function return type";break;case a.ZodIssueCode.invalid_date:r="Invalid date";break;case a.ZodIssueCode.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:i.util.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case a.ZodIssueCode.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case a.ZodIssueCode.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case a.ZodIssueCode.custom:r="Invalid input";break;case a.ZodIssueCode.invalid_intersection_types:r="Intersection results could not be merged";break;case a.ZodIssueCode.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case a.ZodIssueCode.not_finite:r="Number must be finite";break;default:r=t.defaultError,i.util.assertNever(e)}return{message:r}}},5666:function(e,t,r){"use strict";let i;var a,s,n,o,d=this&&this.__classPrivateFieldGet||function(e,t,r,i){if("a"===r&&!i)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?i:"a"===r?i.call(e):i?i.value:t.get(e)},l=this&&this.__classPrivateFieldSet||function(e,t,r,i,a){if("m"===i)throw TypeError("Private method is not writable");if("a"===i&&!a)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?a.call(e,r):a?a.value=r:t.set(e,r),r};Object.defineProperty(t,"__esModule",{value:!0}),t.boolean=t.bigint=t.array=t.any=t.coerce=t.ZodFirstPartyTypeKind=t.late=t.ZodSchema=t.Schema=t.custom=t.ZodReadonly=t.ZodPipeline=t.ZodBranded=t.BRAND=t.ZodNaN=t.ZodCatch=t.ZodDefault=t.ZodNullable=t.ZodOptional=t.ZodTransformer=t.ZodEffects=t.ZodPromise=t.ZodNativeEnum=t.ZodEnum=t.ZodLiteral=t.ZodLazy=t.ZodFunction=t.ZodSet=t.ZodMap=t.ZodRecord=t.ZodTuple=t.ZodIntersection=t.ZodDiscriminatedUnion=t.ZodUnion=t.ZodObject=t.ZodArray=t.ZodVoid=t.ZodNever=t.ZodUnknown=t.ZodAny=t.ZodNull=t.ZodUndefined=t.ZodSymbol=t.ZodDate=t.ZodBoolean=t.ZodBigInt=t.ZodNumber=t.ZodString=t.datetimeRegex=t.ZodType=void 0,t.NEVER=t.void=t.unknown=t.union=t.undefined=t.tuple=t.transformer=t.symbol=t.string=t.strictObject=t.set=t.record=t.promise=t.preprocess=t.pipeline=t.ostring=t.optional=t.onumber=t.oboolean=t.object=t.number=t.nullable=t.null=t.never=t.nativeEnum=t.nan=t.map=t.literal=t.lazy=t.intersection=t.instanceof=t.function=t.enum=t.effect=t.discriminatedUnion=t.date=void 0;let c=r(9935),u=r(4116),h=r(4001),p=r(9358),f=r(1438);class y{constructor(e,t,r,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let m=(e,t)=>{if((0,h.isValid)(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new f.ZodError(e.common.issues);return this._error=t,this._error}}};function g(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:i,description:a}=e;if(t&&(r||i))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:a}:{errorMap:(t,a)=>{var s,n;let{message:o}=e;return"invalid_enum_value"===t.code?{message:null!=o?o:a.defaultError}:void 0===a.data?{message:null!==(s=null!=o?o:i)&&void 0!==s?s:a.defaultError}:"invalid_type"!==t.code?{message:a.defaultError}:{message:null!==(n=null!=o?o:r)&&void 0!==n?n:a.defaultError}},description:a}}class w{get description(){return this._def.description}_getType(e){return(0,p.getParsedType)(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:(0,p.getParsedType)(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new h.ParseStatus,ctx:{common:e.parent.common,data:e.data,parsedType:(0,p.getParsedType)(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if((0,h.isAsync)(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;let i={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,p.getParsedType)(e)},a=this._parseSync({data:e,path:i.path,parent:i});return m(i,a)}"~validate"(e){var t,r;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,p.getParsedType)(e)};if(!this["~standard"].async)try{let t=this._parseSync({data:e,path:[],parent:i});return(0,h.isValid)(t)?{value:t.value}:{issues:i.common.issues}}catch(e){(null===(r=null===(t=null==e?void 0:e.message)||void 0===t?void 0:t.toLowerCase())||void 0===r?void 0:r.includes("encountered"))&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(e=>(0,h.isValid)(e)?{value:e.value}:{issues:i.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,p.getParsedType)(e)},i=this._parse({data:e,path:r.path,parent:r});return m(r,await ((0,h.isAsync)(i)?i:Promise.resolve(i)))}refine(e,t){let r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,i)=>{let a=e(t),s=()=>i.addIssue({code:f.ZodIssueCode.custom,...r(t)});return"undefined"!=typeof Promise&&a instanceof Promise?a.then(e=>!!e||(s(),!1)):!!a||(s(),!1)})}refinement(e,t){return this._refinement((r,i)=>!!e(r)||(i.addIssue("function"==typeof t?t(r,i):t),!1))}_refinement(e){return new eh({schema:this,typeName:o.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return ep.create(this,this._def)}nullable(){return ef.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return q.create(this)}promise(){return eu.create(this,this._def)}or(e){return X.create([this,e],this._def)}and(e){return ee.create(this,e,this._def)}transform(e){return new eh({...g(this._def),schema:this,typeName:o.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new ey({...g(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:o.ZodDefault})}brand(){return new ew({typeName:o.ZodBranded,type:this,...g(this._def)})}catch(e){return new em({...g(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:o.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return ev.create(this,e)}readonly(){return eb.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}t.ZodType=w,t.Schema=w,t.ZodSchema=w;let v=/^c[^\s-]{8,}$/i,b=/^[0-9a-z]+$/,_=/^[0-9A-HJKMNP-TV-Z]{26}$/i,S=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,E=/^[a-z0-9_-]{21}$/i,k=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,A=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,P=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,I=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,T=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,C=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,O=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,x=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,R=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,j="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",D=RegExp(`^${j}$`);function z(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}function M(e){let t=`${j}T${z(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)}t.datetimeRegex=M;class U extends w{_parse(e){var t,r,a,s;let n;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==p.ZodParsedType.string){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.string,received:t.parsedType}),h.INVALID}let o=new h.ParseStatus;for(let d of this._def.checks)if("min"===d.kind)e.data.length<d.value&&(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{code:f.ZodIssueCode.too_small,minimum:d.value,type:"string",inclusive:!0,exact:!1,message:d.message}),o.dirty());else if("max"===d.kind)e.data.length>d.value&&(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{code:f.ZodIssueCode.too_big,maximum:d.value,type:"string",inclusive:!0,exact:!1,message:d.message}),o.dirty());else if("length"===d.kind){let t=e.data.length>d.value,r=e.data.length<d.value;(t||r)&&(n=this._getOrReturnCtx(e,n),t?(0,h.addIssueToContext)(n,{code:f.ZodIssueCode.too_big,maximum:d.value,type:"string",inclusive:!0,exact:!0,message:d.message}):r&&(0,h.addIssueToContext)(n,{code:f.ZodIssueCode.too_small,minimum:d.value,type:"string",inclusive:!0,exact:!0,message:d.message}),o.dirty())}else if("email"===d.kind)P.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"email",code:f.ZodIssueCode.invalid_string,message:d.message}),o.dirty());else if("emoji"===d.kind)i||(i=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),i.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"emoji",code:f.ZodIssueCode.invalid_string,message:d.message}),o.dirty());else if("uuid"===d.kind)S.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"uuid",code:f.ZodIssueCode.invalid_string,message:d.message}),o.dirty());else if("nanoid"===d.kind)E.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"nanoid",code:f.ZodIssueCode.invalid_string,message:d.message}),o.dirty());else if("cuid"===d.kind)v.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"cuid",code:f.ZodIssueCode.invalid_string,message:d.message}),o.dirty());else if("cuid2"===d.kind)b.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"cuid2",code:f.ZodIssueCode.invalid_string,message:d.message}),o.dirty());else if("ulid"===d.kind)_.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"ulid",code:f.ZodIssueCode.invalid_string,message:d.message}),o.dirty());else if("url"===d.kind)try{new URL(e.data)}catch(t){n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"url",code:f.ZodIssueCode.invalid_string,message:d.message}),o.dirty()}else"regex"===d.kind?(d.regex.lastIndex=0,d.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"regex",code:f.ZodIssueCode.invalid_string,message:d.message}),o.dirty())):"trim"===d.kind?e.data=e.data.trim():"includes"===d.kind?e.data.includes(d.value,d.position)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{code:f.ZodIssueCode.invalid_string,validation:{includes:d.value,position:d.position},message:d.message}),o.dirty()):"toLowerCase"===d.kind?e.data=e.data.toLowerCase():"toUpperCase"===d.kind?e.data=e.data.toUpperCase():"startsWith"===d.kind?e.data.startsWith(d.value)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{code:f.ZodIssueCode.invalid_string,validation:{startsWith:d.value},message:d.message}),o.dirty()):"endsWith"===d.kind?e.data.endsWith(d.value)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{code:f.ZodIssueCode.invalid_string,validation:{endsWith:d.value},message:d.message}),o.dirty()):"datetime"===d.kind?M(d).test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{code:f.ZodIssueCode.invalid_string,validation:"datetime",message:d.message}),o.dirty()):"date"===d.kind?D.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{code:f.ZodIssueCode.invalid_string,validation:"date",message:d.message}),o.dirty()):"time"===d.kind?RegExp(`^${z(d)}$`).test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{code:f.ZodIssueCode.invalid_string,validation:"time",message:d.message}),o.dirty()):"duration"===d.kind?A.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"duration",code:f.ZodIssueCode.invalid_string,message:d.message}),o.dirty()):"ip"===d.kind?(t=e.data,("v4"===(r=d.version)||!r)&&I.test(t)||("v6"===r||!r)&&C.test(t)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"ip",code:f.ZodIssueCode.invalid_string,message:d.message}),o.dirty())):"jwt"===d.kind?!function(e,t){if(!k.test(e))return!1;try{let[r]=e.split("."),i=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),a=JSON.parse(atob(i));if("object"!=typeof a||null===a||!a.typ||!a.alg||t&&a.alg!==t)return!1;return!0}catch(e){return!1}}(e.data,d.alg)&&(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"jwt",code:f.ZodIssueCode.invalid_string,message:d.message}),o.dirty()):"cidr"===d.kind?(a=e.data,("v4"===(s=d.version)||!s)&&T.test(a)||("v6"===s||!s)&&O.test(a)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"cidr",code:f.ZodIssueCode.invalid_string,message:d.message}),o.dirty())):"base64"===d.kind?x.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"base64",code:f.ZodIssueCode.invalid_string,message:d.message}),o.dirty()):"base64url"===d.kind?R.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"base64url",code:f.ZodIssueCode.invalid_string,message:d.message}),o.dirty()):p.util.assertNever(d);return{status:o.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:f.ZodIssueCode.invalid_string,...u.errorUtil.errToObj(r)})}_addCheck(e){return new U({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...u.errorUtil.errToObj(e)})}url(e){return this._addCheck({kind:"url",...u.errorUtil.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...u.errorUtil.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...u.errorUtil.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...u.errorUtil.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...u.errorUtil.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...u.errorUtil.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...u.errorUtil.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...u.errorUtil.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...u.errorUtil.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...u.errorUtil.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...u.errorUtil.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...u.errorUtil.errToObj(e)})}datetime(e){var t,r;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(r=null==e?void 0:e.local)&&void 0!==r&&r,...u.errorUtil.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...u.errorUtil.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...u.errorUtil.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...u.errorUtil.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...u.errorUtil.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...u.errorUtil.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...u.errorUtil.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...u.errorUtil.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...u.errorUtil.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...u.errorUtil.errToObj(t)})}nonempty(e){return this.min(1,u.errorUtil.errToObj(e))}trim(){return new U({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new U({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new U({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}t.ZodString=U,U.create=e=>{var t;return new U({checks:[],typeName:o.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...g(e)})};class W extends w{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==p.ZodParsedType.number){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.number,received:t.parsedType}),h.INVALID}let r=new h.ParseStatus;for(let i of this._def.checks)"int"===i.kind?p.util.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:"integer",received:"float",message:i.message}),r.dirty()):"min"===i.kind?(i.inclusive?e.data<i.value:e.data<=i.value)&&(t=this._getOrReturnCtx(e,t),(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):"max"===i.kind?(i.inclusive?e.data>i.value:e.data>=i.value)&&(t=this._getOrReturnCtx(e,t),(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):"multipleOf"===i.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,i=(t.toString().split(".")[1]||"").length,a=r>i?r:i;return parseInt(e.toFixed(a).replace(".",""))%parseInt(t.toFixed(a).replace(".",""))/Math.pow(10,a)}(e.data,i.value)&&(t=this._getOrReturnCtx(e,t),(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):"finite"===i.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.not_finite,message:i.message}),r.dirty()):p.util.assertNever(i);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,u.errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,u.errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,u.errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,u.errorUtil.toString(t))}setLimit(e,t,r,i){return new W({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:u.errorUtil.toString(i)}]})}_addCheck(e){return new W({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:u.errorUtil.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:u.errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:u.errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:u.errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:u.errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:u.errorUtil.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:u.errorUtil.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:u.errorUtil.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:u.errorUtil.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&p.util.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}t.ZodNumber=W,W.create=e=>new W({checks:[],typeName:o.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...g(e)});class K extends w{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch(t){return this._getInvalidInput(e)}if(this._getType(e)!==p.ZodParsedType.bigint)return this._getInvalidInput(e);let r=new h.ParseStatus;for(let i of this._def.checks)"min"===i.kind?(i.inclusive?e.data<i.value:e.data<=i.value)&&(t=this._getOrReturnCtx(e,t),(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):"max"===i.kind?(i.inclusive?e.data>i.value:e.data>=i.value)&&(t=this._getOrReturnCtx(e,t),(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):"multipleOf"===i.kind?e.data%i.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):p.util.assertNever(i);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.bigint,received:t.parsedType}),h.INVALID}gte(e,t){return this.setLimit("min",e,!0,u.errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,u.errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,u.errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,u.errorUtil.toString(t))}setLimit(e,t,r,i){return new K({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:u.errorUtil.toString(i)}]})}_addCheck(e){return new K({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:u.errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:u.errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:u.errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:u.errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:u.errorUtil.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}t.ZodBigInt=K,K.create=e=>{var t;return new K({checks:[],typeName:o.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...g(e)})};class Z extends w{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==p.ZodParsedType.boolean){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.boolean,received:t.parsedType}),h.INVALID}return(0,h.OK)(e.data)}}t.ZodBoolean=Z,Z.create=e=>new Z({typeName:o.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...g(e)});class L extends w{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==p.ZodParsedType.date){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.date,received:t.parsedType}),h.INVALID}if(isNaN(e.data.getTime())){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_date}),h.INVALID}let r=new h.ParseStatus;for(let i of this._def.checks)"min"===i.kind?e.data.getTime()<i.value&&(t=this._getOrReturnCtx(e,t),(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):"max"===i.kind?e.data.getTime()>i.value&&(t=this._getOrReturnCtx(e,t),(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):p.util.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new L({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:u.errorUtil.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:u.errorUtil.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}t.ZodDate=L,L.create=e=>new L({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:o.ZodDate,...g(e)});class H extends w{_parse(e){if(this._getType(e)!==p.ZodParsedType.symbol){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.symbol,received:t.parsedType}),h.INVALID}return(0,h.OK)(e.data)}}t.ZodSymbol=H,H.create=e=>new H({typeName:o.ZodSymbol,...g(e)});class N extends w{_parse(e){if(this._getType(e)!==p.ZodParsedType.undefined){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.undefined,received:t.parsedType}),h.INVALID}return(0,h.OK)(e.data)}}t.ZodUndefined=N,N.create=e=>new N({typeName:o.ZodUndefined,...g(e)});class J extends w{_parse(e){if(this._getType(e)!==p.ZodParsedType.null){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.null,received:t.parsedType}),h.INVALID}return(0,h.OK)(e.data)}}t.ZodNull=J,J.create=e=>new J({typeName:o.ZodNull,...g(e)});class $ extends w{constructor(){super(...arguments),this._any=!0}_parse(e){return(0,h.OK)(e.data)}}t.ZodAny=$,$.create=e=>new $({typeName:o.ZodAny,...g(e)});class F extends w{constructor(){super(...arguments),this._unknown=!0}_parse(e){return(0,h.OK)(e.data)}}t.ZodUnknown=F,F.create=e=>new F({typeName:o.ZodUnknown,...g(e)});class V extends w{_parse(e){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.never,received:t.parsedType}),h.INVALID}}t.ZodNever=V,V.create=e=>new V({typeName:o.ZodNever,...g(e)});class B extends w{_parse(e){if(this._getType(e)!==p.ZodParsedType.undefined){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.void,received:t.parsedType}),h.INVALID}return(0,h.OK)(e.data)}}t.ZodVoid=B,B.create=e=>new B({typeName:o.ZodVoid,...g(e)});class q extends w{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),i=this._def;if(t.parsedType!==p.ZodParsedType.array)return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.array,received:t.parsedType}),h.INVALID;if(null!==i.exactLength){let e=t.data.length>i.exactLength.value,a=t.data.length<i.exactLength.value;(e||a)&&((0,h.addIssueToContext)(t,{code:e?f.ZodIssueCode.too_big:f.ZodIssueCode.too_small,minimum:a?i.exactLength.value:void 0,maximum:e?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),r.dirty())}if(null!==i.minLength&&t.data.length<i.minLength.value&&((0,h.addIssueToContext)(t,{code:f.ZodIssueCode.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),r.dirty()),null!==i.maxLength&&t.data.length>i.maxLength.value&&((0,h.addIssueToContext)(t,{code:f.ZodIssueCode.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>i.type._parseAsync(new y(t,e,t.path,r)))).then(e=>h.ParseStatus.mergeArray(r,e));let a=[...t.data].map((e,r)=>i.type._parseSync(new y(t,e,t.path,r)));return h.ParseStatus.mergeArray(r,a)}get element(){return this._def.type}min(e,t){return new q({...this._def,minLength:{value:e,message:u.errorUtil.toString(t)}})}max(e,t){return new q({...this._def,maxLength:{value:e,message:u.errorUtil.toString(t)}})}length(e,t){return new q({...this._def,exactLength:{value:e,message:u.errorUtil.toString(t)}})}nonempty(e){return this.min(1,e)}}t.ZodArray=q,q.create=(e,t)=>new q({type:e,minLength:null,maxLength:null,exactLength:null,typeName:o.ZodArray,...g(t)});class G extends w{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=p.util.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==p.ZodParsedType.object){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.object,received:t.parsedType}),h.INVALID}let{status:t,ctx:r}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),s=[];if(!(this._def.catchall instanceof V&&"strip"===this._def.unknownKeys))for(let e in r.data)a.includes(e)||s.push(e);let n=[];for(let e of a){let t=i[e],a=r.data[e];n.push({key:{status:"valid",value:e},value:t._parse(new y(r,a,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof V){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of s)n.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)s.length>0&&((0,h.addIssueToContext)(r,{code:f.ZodIssueCode.unrecognized_keys,keys:s}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of s){let i=r.data[t];n.push({key:{status:"valid",value:t},value:e._parse(new y(r,i,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of n){let r=await t.key,i=await t.value;e.push({key:r,value:i,alwaysSet:t.alwaysSet})}return e}).then(e=>h.ParseStatus.mergeObjectSync(t,e)):h.ParseStatus.mergeObjectSync(t,n)}get shape(){return this._def.shape()}strict(e){return u.errorUtil.errToObj,new G({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var i,a,s,n;let o=null!==(s=null===(a=(i=this._def).errorMap)||void 0===a?void 0:a.call(i,t,r).message)&&void 0!==s?s:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(n=u.errorUtil.errToObj(e).message)&&void 0!==n?n:o}:{message:o}}}:{}})}strip(){return new G({...this._def,unknownKeys:"strip"})}passthrough(){return new G({...this._def,unknownKeys:"passthrough"})}extend(e){return new G({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new G({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:o.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new G({...this._def,catchall:e})}pick(e){let t={};return p.util.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new G({...this._def,shape:()=>t})}omit(e){let t={};return p.util.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new G({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof G){let r={};for(let i in t.shape){let a=t.shape[i];r[i]=ep.create(e(a))}return new G({...t._def,shape:()=>r})}return t instanceof q?new q({...t._def,type:e(t.element)}):t instanceof ep?ep.create(e(t.unwrap())):t instanceof ef?ef.create(e(t.unwrap())):t instanceof et?et.create(t.items.map(t=>e(t))):t}(this)}partial(e){let t={};return p.util.objectKeys(this.shape).forEach(r=>{let i=this.shape[r];e&&!e[r]?t[r]=i:t[r]=i.optional()}),new G({...this._def,shape:()=>t})}required(e){let t={};return p.util.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof ep;)e=e._def.innerType;t[r]=e}}),new G({...this._def,shape:()=>t})}keyof(){return ed(p.util.objectKeys(this.shape))}}t.ZodObject=G,G.create=(e,t)=>new G({shape:()=>e,unknownKeys:"strip",catchall:V.create(),typeName:o.ZodObject,...g(t)}),G.strictCreate=(e,t)=>new G({shape:()=>e,unknownKeys:"strict",catchall:V.create(),typeName:o.ZodObject,...g(t)}),G.lazycreate=(e,t)=>new G({shape:e,unknownKeys:"strip",catchall:V.create(),typeName:o.ZodObject,...g(t)});class X extends w{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new f.ZodError(e.ctx.common.issues));return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_union,unionErrors:r}),h.INVALID});{let e;let i=[];for(let a of r){let r={...t,common:{...t.common,issues:[]},parent:null},s=a._parseSync({data:t.data,path:t.path,parent:r});if("valid"===s.status)return s;"dirty"!==s.status||e||(e={result:s,ctx:r}),r.common.issues.length&&i.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let a=i.map(e=>new f.ZodError(e));return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_union,unionErrors:a}),h.INVALID}}get options(){return this._def.options}}t.ZodUnion=X,X.create=(e,t)=>new X({options:e,typeName:o.ZodUnion,...g(t)});let Y=e=>{if(e instanceof en)return Y(e.schema);if(e instanceof eh)return Y(e.innerType());if(e instanceof eo)return[e.value];if(e instanceof el)return e.options;if(e instanceof ec)return p.util.objectValues(e.enum);if(e instanceof ey)return Y(e._def.innerType);if(e instanceof N)return[void 0];else if(e instanceof J)return[null];else if(e instanceof ep)return[void 0,...Y(e.unwrap())];else if(e instanceof ef)return[null,...Y(e.unwrap())];else if(e instanceof ew)return Y(e.unwrap());else if(e instanceof eb)return Y(e.unwrap());else if(e instanceof em)return Y(e._def.innerType);else return[]};class Q extends w{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==p.ZodParsedType.object)return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.object,received:t.parsedType}),h.INVALID;let r=this.discriminator,i=t.data[r],a=this.optionsMap.get(i);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):((0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),h.INVALID)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let i=new Map;for(let r of t){let t=Y(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of t){if(i.has(a))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);i.set(a,r)}}return new Q({typeName:o.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:i,...g(r)})}}t.ZodDiscriminatedUnion=Q;class ee extends w{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),i=(e,i)=>{if((0,h.isAborted)(e)||(0,h.isAborted)(i))return h.INVALID;let a=function e(t,r){let i=(0,p.getParsedType)(t),a=(0,p.getParsedType)(r);if(t===r)return{valid:!0,data:t};if(i===p.ZodParsedType.object&&a===p.ZodParsedType.object){let i=p.util.objectKeys(r),a=p.util.objectKeys(t).filter(e=>-1!==i.indexOf(e)),s={...t,...r};for(let i of a){let a=e(t[i],r[i]);if(!a.valid)return{valid:!1};s[i]=a.data}return{valid:!0,data:s}}if(i===p.ZodParsedType.array&&a===p.ZodParsedType.array){if(t.length!==r.length)return{valid:!1};let i=[];for(let a=0;a<t.length;a++){let s=e(t[a],r[a]);if(!s.valid)return{valid:!1};i.push(s.data)}return{valid:!0,data:i}}return i===p.ZodParsedType.date&&a===p.ZodParsedType.date&&+t==+r?{valid:!0,data:t}:{valid:!1}}(e.value,i.value);return a.valid?(((0,h.isDirty)(e)||(0,h.isDirty)(i))&&t.dirty(),{status:t.value,value:a.data}):((0,h.addIssueToContext)(r,{code:f.ZodIssueCode.invalid_intersection_types}),h.INVALID)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>i(e,t)):i(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}t.ZodIntersection=ee,ee.create=(e,t,r)=>new ee({left:e,right:t,typeName:o.ZodIntersection,...g(r)});class et extends w{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==p.ZodParsedType.array)return(0,h.addIssueToContext)(r,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.array,received:r.parsedType}),h.INVALID;if(r.data.length<this._def.items.length)return(0,h.addIssueToContext)(r,{code:f.ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),h.INVALID;!this._def.rest&&r.data.length>this._def.items.length&&((0,h.addIssueToContext)(r,{code:f.ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...r.data].map((e,t)=>{let i=this._def.items[t]||this._def.rest;return i?i._parse(new y(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(i).then(e=>h.ParseStatus.mergeArray(t,e)):h.ParseStatus.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new et({...this._def,rest:e})}}t.ZodTuple=et,et.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new et({items:e,typeName:o.ZodTuple,rest:null,...g(t)})};class er extends w{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==p.ZodParsedType.object)return(0,h.addIssueToContext)(r,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.object,received:r.parsedType}),h.INVALID;let i=[],a=this._def.keyType,s=this._def.valueType;for(let e in r.data)i.push({key:a._parse(new y(r,e,r.path,e)),value:s._parse(new y(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?h.ParseStatus.mergeObjectAsync(t,i):h.ParseStatus.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,r){return new er(t instanceof w?{keyType:e,valueType:t,typeName:o.ZodRecord,...g(r)}:{keyType:U.create(),valueType:e,typeName:o.ZodRecord,...g(t)})}}t.ZodRecord=er;class ei extends w{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==p.ZodParsedType.map)return(0,h.addIssueToContext)(r,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.map,received:r.parsedType}),h.INVALID;let i=this._def.keyType,a=this._def.valueType,s=[...r.data.entries()].map(([e,t],s)=>({key:i._parse(new y(r,e,r.path,[s,"key"])),value:a._parse(new y(r,t,r.path,[s,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of s){let i=await r.key,a=await r.value;if("aborted"===i.status||"aborted"===a.status)return h.INVALID;("dirty"===i.status||"dirty"===a.status)&&t.dirty(),e.set(i.value,a.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of s){let i=r.key,a=r.value;if("aborted"===i.status||"aborted"===a.status)return h.INVALID;("dirty"===i.status||"dirty"===a.status)&&t.dirty(),e.set(i.value,a.value)}return{status:t.value,value:e}}}}t.ZodMap=ei,ei.create=(e,t,r)=>new ei({valueType:t,keyType:e,typeName:o.ZodMap,...g(r)});class ea extends w{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==p.ZodParsedType.set)return(0,h.addIssueToContext)(r,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.set,received:r.parsedType}),h.INVALID;let i=this._def;null!==i.minSize&&r.data.size<i.minSize.value&&((0,h.addIssueToContext)(r,{code:f.ZodIssueCode.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),t.dirty()),null!==i.maxSize&&r.data.size>i.maxSize.value&&((0,h.addIssueToContext)(r,{code:f.ZodIssueCode.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),t.dirty());let a=this._def.valueType;function s(e){let r=new Set;for(let i of e){if("aborted"===i.status)return h.INVALID;"dirty"===i.status&&t.dirty(),r.add(i.value)}return{status:t.value,value:r}}let n=[...r.data.values()].map((e,t)=>a._parse(new y(r,e,r.path,t)));return r.common.async?Promise.all(n).then(e=>s(e)):s(n)}min(e,t){return new ea({...this._def,minSize:{value:e,message:u.errorUtil.toString(t)}})}max(e,t){return new ea({...this._def,maxSize:{value:e,message:u.errorUtil.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}t.ZodSet=ea,ea.create=(e,t)=>new ea({valueType:e,minSize:null,maxSize:null,typeName:o.ZodSet,...g(t)});class es extends w{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==p.ZodParsedType.function)return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.function,received:t.parsedType}),h.INVALID;function r(e,r){return(0,h.makeIssue)({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,(0,c.getErrorMap)(),c.defaultErrorMap].filter(e=>!!e),issueData:{code:f.ZodIssueCode.invalid_arguments,argumentsError:r}})}function i(e,r){return(0,h.makeIssue)({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,(0,c.getErrorMap)(),c.defaultErrorMap].filter(e=>!!e),issueData:{code:f.ZodIssueCode.invalid_return_type,returnTypeError:r}})}let a={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof eu){let e=this;return(0,h.OK)(async function(...t){let n=new f.ZodError([]),o=await e._def.args.parseAsync(t,a).catch(e=>{throw n.addIssue(r(t,e)),n}),d=await Reflect.apply(s,this,o);return await e._def.returns._def.type.parseAsync(d,a).catch(e=>{throw n.addIssue(i(d,e)),n})})}{let e=this;return(0,h.OK)(function(...t){let n=e._def.args.safeParse(t,a);if(!n.success)throw new f.ZodError([r(t,n.error)]);let o=Reflect.apply(s,this,n.data),d=e._def.returns.safeParse(o,a);if(!d.success)throw new f.ZodError([i(o,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new es({...this._def,args:et.create(e).rest(F.create())})}returns(e){return new es({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new es({args:e||et.create([]).rest(F.create()),returns:t||F.create(),typeName:o.ZodFunction,...g(r)})}}t.ZodFunction=es;class en extends w{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}t.ZodLazy=en,en.create=(e,t)=>new en({getter:e,typeName:o.ZodLazy,...g(t)});class eo extends w{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{received:t.data,code:f.ZodIssueCode.invalid_literal,expected:this._def.value}),h.INVALID}return{status:"valid",value:e.data}}get value(){return this._def.value}}function ed(e,t){return new el({values:e,typeName:o.ZodEnum,...g(t)})}t.ZodLiteral=eo,eo.create=(e,t)=>new eo({value:e,typeName:o.ZodLiteral,...g(t)});class el extends w{constructor(){super(...arguments),s.set(this,void 0)}_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return(0,h.addIssueToContext)(t,{expected:p.util.joinValues(r),received:t.parsedType,code:f.ZodIssueCode.invalid_type}),h.INVALID}if(d(this,s,"f")||l(this,s,new Set(this._def.values),"f"),!d(this,s,"f").has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return(0,h.addIssueToContext)(t,{received:t.data,code:f.ZodIssueCode.invalid_enum_value,options:r}),h.INVALID}return(0,h.OK)(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return el.create(e,{...this._def,...t})}exclude(e,t=this._def){return el.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}t.ZodEnum=el,s=new WeakMap,el.create=ed;class ec extends w{constructor(){super(...arguments),n.set(this,void 0)}_parse(e){let t=p.util.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==p.ZodParsedType.string&&r.parsedType!==p.ZodParsedType.number){let e=p.util.objectValues(t);return(0,h.addIssueToContext)(r,{expected:p.util.joinValues(e),received:r.parsedType,code:f.ZodIssueCode.invalid_type}),h.INVALID}if(d(this,n,"f")||l(this,n,new Set(p.util.getValidEnumValues(this._def.values)),"f"),!d(this,n,"f").has(e.data)){let e=p.util.objectValues(t);return(0,h.addIssueToContext)(r,{received:r.data,code:f.ZodIssueCode.invalid_enum_value,options:e}),h.INVALID}return(0,h.OK)(e.data)}get enum(){return this._def.values}}t.ZodNativeEnum=ec,n=new WeakMap,ec.create=(e,t)=>new ec({values:e,typeName:o.ZodNativeEnum,...g(t)});class eu extends w{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==p.ZodParsedType.promise&&!1===t.common.async)return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.promise,received:t.parsedType}),h.INVALID;let r=t.parsedType===p.ZodParsedType.promise?t.data:Promise.resolve(t.data);return(0,h.OK)(r.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}t.ZodPromise=eu,eu.create=(e,t)=>new eu({type:e,typeName:o.ZodPromise,...g(t)});class eh extends w{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===o.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),i=this._def.effect||null,a={addIssue:e=>{(0,h.addIssueToContext)(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(a.addIssue=a.addIssue.bind(a),"preprocess"===i.type){let e=i.transform(r.data,a);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return h.INVALID;let i=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===i.status?h.INVALID:"dirty"===i.status||"dirty"===t.value?(0,h.DIRTY)(i.value):i});{if("aborted"===t.value)return h.INVALID;let i=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===i.status?h.INVALID:"dirty"===i.status||"dirty"===t.value?(0,h.DIRTY)(i.value):i}}if("refinement"===i.type){let e=e=>{let t=i.refinement(e,a);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?h.INVALID:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===i.status?h.INVALID:("dirty"===i.status&&t.dirty(),e(i.value),{status:t.value,value:i.value})}}if("transform"===i.type){if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>(0,h.isValid)(e)?Promise.resolve(i.transform(e.value,a)).then(e=>({status:t.value,value:e})):e);{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!(0,h.isValid)(e))return e;let s=i.transform(e.value,a);if(s instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}}p.util.assertNever(i)}}t.ZodEffects=eh,t.ZodTransformer=eh,eh.create=(e,t,r)=>new eh({schema:e,typeName:o.ZodEffects,effect:t,...g(r)}),eh.createWithPreprocess=(e,t,r)=>new eh({schema:t,effect:{type:"preprocess",transform:e},typeName:o.ZodEffects,...g(r)});class ep extends w{_parse(e){return this._getType(e)===p.ZodParsedType.undefined?(0,h.OK)(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}t.ZodOptional=ep,ep.create=(e,t)=>new ep({innerType:e,typeName:o.ZodOptional,...g(t)});class ef extends w{_parse(e){return this._getType(e)===p.ZodParsedType.null?(0,h.OK)(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}t.ZodNullable=ef,ef.create=(e,t)=>new ef({innerType:e,typeName:o.ZodNullable,...g(t)});class ey extends w{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===p.ZodParsedType.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}t.ZodDefault=ey,ey.create=(e,t)=>new ey({innerType:e,typeName:o.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...g(t)});class em extends w{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},i=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return(0,h.isAsync)(i)?i.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new f.ZodError(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===i.status?i.value:this._def.catchValue({get error(){return new f.ZodError(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}t.ZodCatch=em,em.create=(e,t)=>new em({innerType:e,typeName:o.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...g(t)});class eg extends w{_parse(e){if(this._getType(e)!==p.ZodParsedType.nan){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.nan,received:t.parsedType}),h.INVALID}return{status:"valid",value:e.data}}}t.ZodNaN=eg,eg.create=e=>new eg({typeName:o.ZodNaN,...g(e)}),t.BRAND=Symbol("zod_brand");class ew extends w{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}t.ZodBranded=ew;class ev extends w{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?h.INVALID:"dirty"===e.status?(t.dirty(),(0,h.DIRTY)(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?h.INVALID:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new ev({in:e,out:t,typeName:o.ZodPipeline})}}t.ZodPipeline=ev;class eb extends w{_parse(e){let t=this._def.innerType._parse(e),r=e=>((0,h.isValid)(e)&&(e.value=Object.freeze(e.value)),e);return(0,h.isAsync)(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}function e_(e,t){let r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function eS(e,t={},r){return e?$.create().superRefine((i,a)=>{var s,n;let o=e(i);if(o instanceof Promise)return o.then(e=>{var s,n;if(!e){let e=e_(t,i),o=null===(n=null!==(s=e.fatal)&&void 0!==s?s:r)||void 0===n||n;a.addIssue({code:"custom",...e,fatal:o})}});if(!o){let e=e_(t,i),o=null===(n=null!==(s=e.fatal)&&void 0!==s?s:r)||void 0===n||n;a.addIssue({code:"custom",...e,fatal:o})}}):$.create()}t.ZodReadonly=eb,eb.create=(e,t)=>new eb({innerType:e,typeName:o.ZodReadonly,...g(t)}),t.custom=eS,t.late={object:G.lazycreate},(a=o||(t.ZodFirstPartyTypeKind=o={})).ZodString="ZodString",a.ZodNumber="ZodNumber",a.ZodNaN="ZodNaN",a.ZodBigInt="ZodBigInt",a.ZodBoolean="ZodBoolean",a.ZodDate="ZodDate",a.ZodSymbol="ZodSymbol",a.ZodUndefined="ZodUndefined",a.ZodNull="ZodNull",a.ZodAny="ZodAny",a.ZodUnknown="ZodUnknown",a.ZodNever="ZodNever",a.ZodVoid="ZodVoid",a.ZodArray="ZodArray",a.ZodObject="ZodObject",a.ZodUnion="ZodUnion",a.ZodDiscriminatedUnion="ZodDiscriminatedUnion",a.ZodIntersection="ZodIntersection",a.ZodTuple="ZodTuple",a.ZodRecord="ZodRecord",a.ZodMap="ZodMap",a.ZodSet="ZodSet",a.ZodFunction="ZodFunction",a.ZodLazy="ZodLazy",a.ZodLiteral="ZodLiteral",a.ZodEnum="ZodEnum",a.ZodEffects="ZodEffects",a.ZodNativeEnum="ZodNativeEnum",a.ZodOptional="ZodOptional",a.ZodNullable="ZodNullable",a.ZodDefault="ZodDefault",a.ZodCatch="ZodCatch",a.ZodPromise="ZodPromise",a.ZodBranded="ZodBranded",a.ZodPipeline="ZodPipeline",a.ZodReadonly="ZodReadonly",t.instanceof=(e,t={message:`Input not instance of ${e.name}`})=>eS(t=>t instanceof e,t);let eE=U.create;t.string=eE;let ek=W.create;t.number=ek;let eA=eg.create;t.nan=eA;let eP=K.create;t.bigint=eP;let eI=Z.create;t.boolean=eI;let eT=L.create;t.date=eT;let eC=H.create;t.symbol=eC;let eO=N.create;t.undefined=eO;let ex=J.create;t.null=ex;let eR=$.create;t.any=eR;let ej=F.create;t.unknown=ej;let eD=V.create;t.never=eD;let ez=B.create;t.void=ez;let eM=q.create;t.array=eM;let eU=G.create;t.object=eU;let eW=G.strictCreate;t.strictObject=eW;let eK=X.create;t.union=eK;let eZ=Q.create;t.discriminatedUnion=eZ;let eL=ee.create;t.intersection=eL;let eH=et.create;t.tuple=eH;let eN=er.create;t.record=eN;let eJ=ei.create;t.map=eJ;let e$=ea.create;t.set=e$;let eF=es.create;t.function=eF;let eV=en.create;t.lazy=eV;let eB=eo.create;t.literal=eB;let eq=el.create;t.enum=eq;let eG=ec.create;t.nativeEnum=eG;let eX=eu.create;t.promise=eX;let eY=eh.create;t.effect=eY,t.transformer=eY;let eQ=ep.create;t.optional=eQ;let e0=ef.create;t.nullable=e0;let e1=eh.createWithPreprocess;t.preprocess=e1;let e2=ev.create;t.pipeline=e2,t.ostring=()=>eE().optional(),t.onumber=()=>ek().optional(),t.oboolean=()=>eI().optional(),t.coerce={string:e=>U.create({...e,coerce:!0}),number:e=>W.create({...e,coerce:!0}),boolean:e=>Z.create({...e,coerce:!0}),bigint:e=>K.create({...e,coerce:!0}),date:e=>L.create({...e,coerce:!0})},t.NEVER=h.INVALID},3901:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DidCacheMemory=void 0;let i=r(9489);class a extends i.SimpleStoreMemory{constructor(e){super(e?.max==null?{ttl:36e5,maxSize:52428800,...e}:{ttl:36e5,...e})}}t.DidCacheMemory=a},2728:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DidResolverCached=void 0;let i=r(6228),a=r(3901);class s{constructor(e,t=new a.DidCacheMemory){Object.defineProperty(this,"getter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.getter=new i.CachedGetter((t,r)=>e.resolve(t,r),t)}async resolve(e,t){return this.getter.get(e,t)}}t.DidResolverCached=s},802:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},2167:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DidResolverBase=void 0;let i=r(4747),a=r(4146),s=r(162);class n{constructor(e){Object.defineProperty(this,"methods",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.methods=new Map(Object.entries(e))}async resolve(e,t){t?.signal?.throwIfAborted();let r=(0,a.extractDidMethod)(e),n=this.methods.get(r);if(!n)throw new a.DidError(e,"Unsupported DID method","did-method-invalid",400);try{let r=await n.resolve(e,t);if(r.id!==e)throw new a.DidError(e,`DID document id (${r.id}) does not match DID`,"did-document-id-mismatch",400);return r}catch(t){if(t instanceof s.FetchResponseError){let r=t.response.status>=500?502:t.response.status;throw new a.DidError(e,t.message,"did-fetch-error",r,t)}if(t instanceof s.FetchError)throw new a.DidError(e,t.message,"did-fetch-error",400,t);if(t instanceof i.ZodError)throw new a.DidError(e,t.message,"did-document-format-error",503,t);throw a.DidError.from(t,e)}}}t.DidResolverBase=n},3107:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DidResolverCommon=void 0;let i=r(2167),a=r(900),s=r(6037);class n extends i.DidResolverBase{constructor(e){super({plc:new a.DidPlcMethod(e),web:new s.DidWebMethod(e)})}}t.DidResolverCommon=n},3925:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},5561:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,a)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(4146),t),a(r(3901),t),a(r(2728),t),a(r(802),t),a(r(3107),t),a(r(3925),t),a(r(2280),t),a(r(790),t)},2280:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,a)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(900),t),a(r(6037),t)},900:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DidPlcMethod=void 0;let i=r(4146),a=r(162),s=(0,r(7319).pipe)((0,a.fetchOkProcessor)(),(0,a.fetchJsonProcessor)(/^application\/(did\+ld\+)?json$/),(0,a.fetchJsonZodProcessor)(i.didDocumentValidator));class n{constructor(e){Object.defineProperty(this,"fetch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"plcDirectoryUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.plcDirectoryUrl=new URL(e?.plcDirectoryUrl||"https://plc.directory/"),this.fetch=(0,a.bindFetch)(e?.fetch)}async resolve(e,t){(0,i.assertDidPlc)(e);let r=new URL(`/${encodeURIComponent(e)}`,this.plcDirectoryUrl);return this.fetch(r,{redirect:"error",headers:{accept:"application/did+ld+json,application/json"},signal:t?.signal}).then(s)}}t.DidPlcMethod=n},6037:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DidWebMethod=void 0,t.buildDidWebDocumentUrl=o;let i=r(4146),a=r(162),s=(0,r(7319).pipe)((0,a.fetchOkProcessor)(),(0,a.fetchJsonProcessor)(/^application\/(did\+ld\+)?json$/),(0,a.fetchJsonZodProcessor)(i.didDocumentValidator));class n{constructor({fetch:e=globalThis.fetch,allowHttp:t=!0}={}){Object.defineProperty(this,"fetch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"allowHttp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.fetch=(0,a.bindFetch)(e),this.allowHttp=t}async resolve(e,t){let r=o(e);if(!this.allowHttp&&"http:"===r.protocol)throw new i.DidError(e,'Resolution of "http" did:web is not allowed',"did-web-http-not-allowed");return this.fetch(r,{redirect:"error",headers:{accept:"application/did+ld+json,application/json"},signal:t?.signal}).then(s)}}function o(e){let t=(0,i.didWebToUrl)(e);return"/"===t.pathname?new URL("/.well-known/did.json",t):new URL(`${t.pathname}/did.json`,t)}t.DidWebMethod=n},790:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},2794:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FetchError=void 0;class r extends Error{constructor(e,t,r){super(t,r),Object.defineProperty(this,"statusCode",{enumerable:!0,configurable:!0,writable:!0,value:e})}get expose(){return!0}}t.FetchError=r},3867:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_FORBIDDEN_DOMAIN_NAMES=t.FetchRequestError=void 0,t.protocolCheckRequestTransform=function(e){return(t,r)=>{let{protocol:i,port:o}=(0,s.extractUrl)(t),d=(0,a.asRequest)(t,r),l=Object.hasOwn(e,i)?e[i]:void 0;if(l){if(!0===l);else if(!l.allowCustomPort&&""!==o)throw new n(d,400,`Custom ${i} ports not allowed`)}else throw new n(d,400,`Forbidden protocol "${i}"`);return d}},t.explicitRedirectCheckRequestTransform=function(){return(e,t)=>{let r=(0,a.asRequest)(e,t);if(t?.redirect!=null)return r;if("follow"===r.redirect)throw new n(r,500,'Request redirect must be "error" or "manual"');return r}},t.requireHostHeaderTransform=function(){return(e,t)=>{let{protocol:r,hostname:i}=(0,s.extractUrl)(e),o=(0,a.asRequest)(e,t);if("http:"!==r&&"https:"!==r)throw new n(o,400,`"${r}" requests are not allowed`);if(!i||(0,s.isIp)(i))throw new n(o,400,"Invalid hostname");return o}},t.forbiddenDomainNameRequestTransform=function(e=t.DEFAULT_FORBIDDEN_DOMAIN_NAMES){let r=new Set(e);return 0===r.size?a.asRequest:async(e,t)=>{let{hostname:i}=(0,s.extractUrl)(e),o=(0,a.asRequest)(e,t);if(r.has(i))throw new n(o,403,"Forbidden hostname");let d=i.indexOf(".");for(;-1!==d;){let e=i.slice(d+1);if(r.has(`*.${e}`))throw new n(o,403,"Forbidden hostname");d=i.indexOf(".",d+1)}return o}};let i=r(2794),a=r(7904),s=r(7008);class n extends i.FetchError{constructor(e,t,r,i){if(null==t||!r){var a;let e=function(e){if("string"==typeof e&&e.length>0)return[500,e];if(!(e instanceof Error))return[500,"Failed to fetch"];switch(e.message){case"failed to fetch the data URL":return[400,e.message];case"unexpected redirect":case"cors failure":case"blocked":case"proxy authentication required":return[502,e.message]}let t=e.code;if("string"==typeof t)switch(!0){case"ENOTFOUND"===t:return[400,"Invalid hostname"];case"ECONNREFUSED"===t:return[502,"Connection refused"];case"DEPTH_ZERO_SELF_SIGNED_CERT"===t:return[502,"Self-signed certificate"];case t.startsWith("ERR_TLS"):return[502,"TLS error"];case t.startsWith("ECONN"):return[502,"Connection error"];default:return[500,`${t} error`]}return[500,e.message]}((a=i?.cause)instanceof TypeError&&"fetch failed"===a.message&&void 0!==a.cause?a.cause:a);t??(t=e[0]),r||(r=e[1])}super(t,r,i),Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:e})}get expose(){return 500!==this.statusCode}static from(e,t){return t instanceof n?t:new n(e,void 0,void 0,{cause:t})}}t.FetchRequestError=n,t.DEFAULT_FORBIDDEN_DOMAIN_NAMES=["example.com","*.example.com","example.org","*.example.org","example.net","*.example.net","googleusercontent.com","*.googleusercontent.com"]},2383:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchJsonZodProcessor=t.FetchResponseError=void 0,t.peekJson=c,t.checkLength=u,t.extractLength=h,t.extractMime=p,t.cancelBodyOnError=f,t.fetchOkProcessor=function(e){return f(t=>y(t,e))},t.fetchOkTransformer=y,t.fetchMaxSizeProcessor=function(e){if(e===1/0)return e=>e;if(!Number.isFinite(e)||e<0)throw TypeError("maxBytes must be a 0, Infinity or a positive number");return f(t=>m(t,e))},t.fetchResponseMaxSizeChecker=m,t.fetchTypeProcessor=g,t.fetchResponseTypeChecker=w,t.fetchResponseJsonTransformer=v,t.fetchJsonProcessor=function(e=o,t=!0){return(0,i.pipe)(g(e,t),f(v))},t.fetchJsonValidatorProcessor=b;let i=r(7319),a=r(2794),s=r(9959),n=r(7008),o=/^application\/(?:[^()<>@,;:/[\]\\?={} \t]+\+)?json$/i;class d extends a.FetchError{constructor(e,t=e.status,r=e.statusText,i){super(t,r,i),Object.defineProperty(this,"response",{enumerable:!0,configurable:!0,writable:!0,value:e})}static async from(e,t=l,r=e.status,i){let a="string"==typeof t?t:"function"==typeof t?await t(e):void 0;return new d(e,r,a,i)}}t.FetchResponseError=d;let l=async e=>{let t=p(e);if(t)try{if("text/plain"===t)return await e.text();if(o.test(t)){let t=await e.json();if("string"==typeof t)return t;if("object"==typeof t&&null!=t){let e=(0,n.ifString)(t.error_description);if(e)return e;let r=(0,n.ifString)(t.error);if(r)return r;let i=(0,n.ifString)(t.message);if(i)return i}}}catch{}};async function c(e,t=1/0){if("application/json"!==p(e))return;u(e,t);let r=e.clone();return(e.body&&t<1/0?new s.TransformedResponse(r,new n.MaxBytesTransformStream(t)):r).json()}function u(e,t){if(!(t>=0))throw TypeError("maxBytes must be a non-negative number");let r=h(e);if(null!=r&&r>t)throw new d(e,502,"Response too large");return r}function h(e){let t=e.headers.get("Content-Length");if(null==t)return;if(!/^\d+$/.test(t))throw new d(e,502,"Invalid Content-Length");let r=Number(t);if(!Number.isSafeInteger(r))throw new d(e,502,"Content-Length too large");return r}function p(e){let t=e.headers.get("Content-Type");if(null!=t)return t.split(";",1)[0].trim()}function f(e,t=n.logCancellationError){return async r=>{try{return await e(r)}catch(e){throw await (0,n.cancelBody)(r,t??void 0),e}}}async function y(e,t){if(e.ok)return e;throw await d.from(e,t)}function m(e,t){if(t===1/0||(u(e,t),!e.body))return e;let r=new n.MaxBytesTransformStream(t);return new s.TransformedResponse(e,r)}function g(e,t=!0){let r="string"==typeof e?t=>t===e:e instanceof RegExp?t=>e.test(t):e;return f(e=>w(e,r,t))}async function w(e,t,r=!0){let i=p(e);if(i){if(!t(i.toLowerCase()))throw await d.from(e,`Unexpected response Content-Type (${i})`,502)}else if(r)throw await d.from(e,"Missing response Content-Type header",502);return e}async function v(e){try{let t=await e.json();return{response:e,json:t}}catch(t){throw new d(e,502,"Unable to parse response as JSON",{cause:t})}}function b(e,t){if("parseAsync"in e&&"function"==typeof e.parseAsync)return async r=>e.parseAsync(r.json,t);if("parse"in e&&"function"==typeof e.parse)return async r=>e.parse(r.json,t);throw TypeError("Invalid schema")}t.fetchJsonZodProcessor=b},9315:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.timedFetch=void 0,t.loggedFetch=function({fetch:e=globalThis.fetch,logRequest:t=!0,logResponse:r=!0,logError:i=!0}){let s=!0===t?async e=>{let t=await (0,n.stringifyMessage)(e);console.info(`> ${e.method} ${e.url}
${(0,n.padLines)(t,"  ")}`)}:t||void 0,o=!0===r?async e=>{let t=await (0,n.stringifyMessage)(e.clone());console.info(`< HTTP/1.1 ${e.status} ${e.statusText}
${(0,n.padLines)(t,"  ")}`)}:r||void 0,d=!0===i?async e=>{console.error("< Error:",e)}:i||void 0;return s||o||d?(0,a.toRequestTransformer)(async function(t){s&&await s(t);try{let r=await e.call(this,t);return o&&await o(r,t),r}catch(e){throw d&&await d(e,t),e}}):e},t.bindFetch=function(e=globalThis.fetch,t=globalThis){return(0,a.toRequestTransformer)(async r=>{try{return await e.call(t,r)}catch(e){throw i.FetchRequestError.from(r,e)}})};let i=r(3867),a=r(7904),s=r(9959),n=r(7008);t.timedFetch=(e=6e4,t=globalThis.fetch)=>{if(e===1/0)return t;if(!Number.isFinite(e)||e<=0)throw TypeError("Timeout must be positive");return(0,a.toRequestTransformer)(async function(r){let i=new AbortController,a=i.signal,n=()=>{i.abort()},o=()=>{clearTimeout(d),r.signal?.removeEventListener("abort",n)},d=setTimeout(n,e);"object"==typeof d&&d.unref?.(),r.signal?.addEventListener("abort",n),a.addEventListener("abort",o);let l=await t.call(this,r,{signal:a});if(!l.body)return o(),l;{let e=new TransformStream({flush:o});return new s.TransformedResponse(l,e)}})}},7904:function(e,t){"use strict";function r(e,t){return!t&&e instanceof Request?e:new Request(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.toRequestTransformer=function(e){return function(t,i){return e.call(this,r(t,i))}},t.asRequest=r},162:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,a)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(2794),t),a(r(3867),t),a(r(2383),t),a(r(9315),t),a(r(7904),t),a(r(7008),t)},9959:function(e,t){"use strict";var r,i=this&&this.__classPrivateFieldSet||function(e,t,r,i,a){if("m"===i)throw TypeError("Private method is not writable");if("a"===i&&!a)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?a.call(e,r):a?a.value=r:t.set(e,r),r},a=this&&this.__classPrivateFieldGet||function(e,t,r,i){if("a"===r&&!i)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?i:"a"===r?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.TransformedResponse=void 0;class s extends Response{constructor(e,t){if(!e.body)throw TypeError("Response body is not available");if(e.bodyUsed)throw TypeError("Response body is already used");super(e.body.pipeThrough(t),{status:e.status,statusText:e.statusText,headers:e.headers}),r.set(this,void 0),i(this,r,e,"f")}get url(){return a(this,r,"f").url}get redirected(){return a(this,r,"f").redirected}get type(){return a(this,r,"f").type}get statusText(){return a(this,r,"f").statusText}}t.TransformedResponse=s,r=new WeakMap},7008:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractUrl=t.MaxBytesTransformStream=t.ifString=void 0,t.isIp=function(e){return!!(e.match(/^\d+\.\d+\.\d+\.\d+$/)||e.startsWith("[")&&e.endsWith("]"))},t.padLines=function(e,t){return e?t+e.replace(i,`$&${t}`):e},t.cancelBody=a,t.logCancellationError=s,t.stringifyMessage=n,t.ifString=e=>"string"==typeof e?e:void 0;class r extends TransformStream{constructor(e){if(!(e>=0))throw TypeError("maxBytes must be a non-negative number");let t=0;super({transform:(r,i)=>{(t+=r.length)<=e?i.enqueue(r):i.error(Error("Response too large"))}})}}t.MaxBytesTransformStream=r;let i=/\r?\n/g;async function a(e,t){!e.body||e.bodyUsed||e.body.locked||"function"!=typeof e.body.cancel||("function"==typeof t?e.body.cancel().catch(t):"log"===t?e.body.cancel().catch(s):await e.body.cancel())}function s(e){console.warn("Failed to cancel response body",e)}async function n(e){try{var t;let r=(t=e.headers,Array.from(t).map(([e,t])=>`${e}: ${t}`).join("\n")),i=await o(e);return r&&i?`${r}
${i}`:r||i}finally{a(e,"log")}}async function o(e){try{let t=await e.blob();if(t.type?.startsWith("text/")){let e=await t.text();return JSON.stringify(e)}if(/application\/(?:\w+\+)?json/.test(t.type)){let e=await t.text();return e.includes("\n")?JSON.stringify(JSON.parse(e)):e}return`[Body size: ${t.size}, type: ${JSON.stringify(t.type)} ]`}catch{return"[Body could not be read]"}}t.extractUrl=e=>"string"==typeof e?new URL(e):e instanceof URL?e:new URL(e.url)},6878:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AppViewHandleResolver=t.xrpcErrorSchema=void 0;let i=r(4747),a=r(5139);t.xrpcErrorSchema=i.z.object({error:i.z.string(),message:i.z.string().optional()});class s{static from(e,t){return"string"==typeof e||e instanceof URL?new s(e,t):e}constructor(e,t){Object.defineProperty(this,"serviceUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.serviceUrl=new URL(e),this.fetch=t?.fetch??globalThis.fetch}async resolve(e,r){let i=new URL("/xrpc/com.atproto.identity.resolveHandle",this.serviceUrl);i.searchParams.set("handle",e);let s=await this.fetch.call(null,i,{cache:r?.noCache?"no-cache":void 0,signal:r?.signal,redirect:"error"}),n=await s.json();if(400===s.status){let e=t.xrpcErrorSchema.parse(n);if("InvalidRequest"===e.error&&"Unable to resolve handle"===e.message)return null}if(!s.ok)throw TypeError("Invalid response from resolveHandle method");let o=n?.did;if(!(0,a.isResolvedHandle)(o))throw TypeError("Invalid DID returned from resolveHandle method");return o}}t.AppViewHandleResolver=s},8391:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AtprotoDohHandleResolver=void 0;let i=r(7412);class a extends i.AtprotoHandleResolver{constructor(e){super({...e,resolveTxt:function({dohEndpoint:e,fetch:t=globalThis.fetch}){return async r=>{let i=new URL(e);i.searchParams.set("type","TXT"),i.searchParams.set("name",r);let a=await t(i,{method:"GET",headers:{accept:"application/dns-json"},redirect:"follow"});try{let e=a.headers.get("content-type")?.trim();if(a.ok){if(e?.match(/application\/(dns-)?json/i)==null)throw TypeError("Unexpected response from DoH server")}else{let t=e?.startsWith("text/plain")?await a.text():`Failed to resolve ${r}`;throw TypeError(t)}let t=function(e){var t;if("object"==typeof e&&null!==e&&"Status"in e&&"number"==typeof e.Status&&(!("Answer"in e)||(t=e.Answer,Array.isArray(t)&&t.every(n))))return e;throw TypeError("Invalid DoH response")}(await a.json());return t.Answer?.filter(o).map(d)??null}finally{!1===a.bodyUsed&&a.body?.cancel().catch(s)}}}(e),resolveTxtFallback:void 0})}}function s(e){e instanceof DOMException&&"AbortError"===e.name||console.error("An error occurred while cancelling the response body:",e)}function n(e){return"object"==typeof e&&null!==e&&"name"in e&&"string"==typeof e.name&&"type"in e&&"number"==typeof e.type&&"data"in e&&"string"==typeof e.data&&"TTL"in e&&"number"==typeof e.TTL}function o(e){return 16===e.type}function d(e){return e.data.replace(/^"|"$/g,"").replace(/\\"/g,'"')}t.AtprotoDohHandleResolver=a},7412:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AtprotoHandleResolver=void 0;let i=r(9483),a=r(1006),s=()=>{};class n{constructor(e){Object.defineProperty(this,"httpResolver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dnsResolver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dnsResolverFallback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.httpResolver=new a.WellKnownHandleResolver(e),this.dnsResolver=new i.DnsHandleResolver(e.resolveTxt),this.dnsResolverFallback=e.resolveTxtFallback?new i.DnsHandleResolver(e.resolveTxtFallback):void 0}async resolve(e,t){t?.signal?.throwIfAborted();let r=new AbortController,{signal:i}=r;t?.signal?.addEventListener("abort",()=>r.abort(),{signal:i});let a={...t,signal:i};try{let t=this.dnsResolver.resolve(e,a),r=this.httpResolver.resolve(e,a);r.catch(s);let n=await t;if(n)return n;i.throwIfAborted();let o=await r;if(o)return o;return i.throwIfAborted(),this.dnsResolverFallback?.resolve(e,a)??null}finally{r.abort()}}}t.AtprotoHandleResolver=n},3069:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CachedHandleResolver=void 0;let i=r(6228),a=r(9489);class s{constructor(e,t=new a.SimpleStoreMemory({max:1e3,ttl:6e5})){Object.defineProperty(this,"getter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.getter=new i.CachedGetter((t,r)=>e.resolve(t,r),t)}async resolve(e,t){return this.getter.get(e,t)}}t.CachedHandleResolver=s},7015:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,a)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(5139),t),a(r(6878),t),a(r(8391),t),a(r(7412),t),a(r(3069),t)},9483:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DnsHandleResolver=void 0;let i=r(5139),a="did=";class s{constructor(e){Object.defineProperty(this,"resolveTxt",{enumerable:!0,configurable:!0,writable:!0,value:e})}async resolve(e){let t=await this.resolveTxt.call(null,`_atproto.${e}`);if(!t)return null;for(let e=0;e<t.length;e++){if(!t[e].startsWith(a))continue;for(let r=e+1;r<t.length;r++)if(t[r].startsWith(a))return null;let r=t[e].slice(a.length);return(0,i.isResolvedHandle)(r)?r:null}return null}}t.DnsHandleResolver=s},1006:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WellKnownHandleResolver=void 0;let i=r(5139);class a{constructor(e){Object.defineProperty(this,"fetch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.fetch=e?.fetch??globalThis.fetch}async resolve(e,t){let r=new URL("/.well-known/atproto-did",`https://${e}`);try{let e=await this.fetch.call(null,r,{cache:t?.noCache?"no-cache":void 0,signal:t?.signal,redirect:"error"}),a=(await e.text()).split("\n")[0].trim();if((0,i.isResolvedHandle)(a))return a;return null}catch(e){return t?.signal?.throwIfAborted(),null}}}t.WellKnownHandleResolver=a},5139:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isResolvedHandle=function(e){return null===e||(0,i.isAtprotoDid)(e)};let i=r(4146)},212:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdentityResolver=void 0;let i=r(4836),a=r(7015);class s{constructor(e,t){Object.defineProperty(this,"didResolver",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handleResolver",{enumerable:!0,configurable:!0,writable:!0,value:t})}async resolve(e,t){let r=(0,a.isResolvedHandle)(e)?await this.getDocumentFromDid(e,t):await this.getDocumentFromHandle(e,t),i=r.service?.find(n,r);if(!i)throw TypeError(`No valid "AtprotoPersonalDataServer" service found in "${r.id}" DID document`);return{did:r.id,pds:new URL(i.serviceEndpoint)}}async getDocumentFromDid(e,t){return this.didResolver.resolve(e,t)}async getDocumentFromHandle(e,t){let r=(0,i.normalizeAndEnsureValidHandle)(e),a=await this.handleResolver.resolve(r,t);if(!a)throw TypeError(`Handle "${r}" does not resolve to a DID`);t?.signal?.throwIfAborted();let s=await this.didResolver.resolve(a,t);if(!s.alsoKnownAs?.includes(`at://${r}`))throw TypeError(`Did document for "${a}" does not include the handle "${r}"`);return s}}function n(e){return"string"==typeof e.serviceEndpoint&&"AtprotoPersonalDataServer"===e.type&&(e.id.startsWith("#")?"#atproto_pds"===e.id:e.id===`${this.id}#atproto_pds`)}t.IdentityResolver=s},7196:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,a)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(212),t)},7319:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pipeTwo=t.pipe=void 0;var i=r(3364);Object.defineProperty(t,"pipe",{enumerable:!0,get:function(){return i.pipe}}),Object.defineProperty(t,"pipeTwo",{enumerable:!0,get:function(){return i.pipeTwo}})},3364:function(e,t){"use strict";function r(e,t){return async(...r)=>t(await e(...r))}Object.defineProperty(t,"__esModule",{value:!0}),t.pipe=function(...e){return e.reduce(r)},t.pipeTwo=r},9489:function(e,t,r){"use strict";var i,a=this&&this.__classPrivateFieldSet||function(e,t,r,i,a){if("m"===i)throw TypeError("Private method is not writable");if("a"===i&&!a)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?a.call(e,r):a?a.value=r:t.set(e,r),r},s=this&&this.__classPrivateFieldGet||function(e,t,r,i){if("a"===r&&!i)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?i:"a"===r?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleStoreMemory=void 0;let n=r(329),o=r(1112),d=Symbol("nullItem"),l=e=>null===e?d:e,c=e=>e===d?null:e;class u{constructor({sizeCalculation:e,...t}){i.set(this,void 0),a(this,i,new n.LRUCache({...t,allowStale:!1,updateAgeOnGet:!1,updateAgeOnHas:!1,sizeCalculation:e?(t,r)=>e(c(t),r):null!=t.maxEntrySize||null!=t.maxSize?o.roughSizeOfObject:void 0}),"f")}get(e){let t=s(this,i,"f").get(e);if(void 0!==t)return c(t)}set(e,t){s(this,i,"f").set(e,l(t))}del(e){s(this,i,"f").delete(e)}clear(){s(this,i,"f").clear()}}t.SimpleStoreMemory=u,i=new WeakMap},1112:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.roughSizeOfObject=function(e){let t=new Set,i=[e],a=0;for(;i.length;){let e=i.pop();switch(typeof e){case"string":a+=12+4*Math.ceil(e.length/4);break;case"number":a+=12;break;case"boolean":a+=4;break;case"object":if(a+=4,null===e)break;if(r.has(e)){a+=r.get(e);break}if(t.has(e))continue;if(t.add(e),Array.isArray(e))a+=4,i.push(...e);else{a+=8;let t=Object.getOwnPropertyNames(e);for(let r=0;r<t.length;r++){a+=4;let s=t[r],n=e[s];void 0!==n&&i.push(n),i.push(s)}}break;case"function":case"symbol":a+=8;break;case"bigint":a+=16}}return"object"==typeof e&&null!==e&&r.set(e,a),a};let r=new WeakMap},3446:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CachedGetter=void 0;let r=()=>!0,i=()=>!1;class a{constructor(e,t,r){Object.defineProperty(this,"getter",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"store",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"pending",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}async get(e,t={}){let a;t.signal?.throwIfAborted();let s=this.options?.isStale,n=t.noCache?i:t.allowStale||null==s?r:async t=>!await s(e,t);for(;a=this.pending.get(e);){try{let{isFresh:e,value:t}=await a;if(e||await n(t))return t}catch{}t.signal?.throwIfAborted()}let o=Promise.resolve().then(async()=>{let r=await this.getStored(e,t);return void 0!==r&&await n(r)?{isFresh:!1,value:r}:Promise.resolve().then(async()=>(0,this.getter)(e,t,r)).catch(async t=>{if(void 0!==r)try{let i=this.options?.deleteOnError;await i?.(t,e,r)&&await this.delStored(e,t)}catch(e){throw AggregateError([t,e],"Error while deleting stored value")}throw t}).then(async t=>(await this.setStored(e,t),{isFresh:!0,value:t}))}).finally(()=>{this.pending.delete(e)});if(this.pending.has(e))throw Error("Concurrent request for the same key");this.pending.set(e,o);let{value:d}=await o;return d}async getStored(e,t){try{return await this.store.get(e,t)}catch(e){return}}async setStored(e,t){try{await this.store.set(e,t)}catch(i){let r=this.options?.onStoreError;await r?.(i,e,t)}}async delStored(e,t){await this.store.del(e)}}t.CachedGetter=a},6228:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,a)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(3446),t),a(r(4513),t)},4513:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},98:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.atprotoDidSchema=void 0,t.isAtprotoDid=n,t.asAtprotoDid=function(e){return o(e),e},t.assertAtprotoDid=o,t.assertAtprotoDidWeb=d,t.isAtprotoDidWeb=l;let i=r(4747),a=r(5008),s=r(7485);function n(e){return"string"==typeof e&&(e.startsWith(s.DID_PLC_PREFIX)?(0,s.isDidPlc)(e):!!e.startsWith(s.DID_WEB_PREFIX)&&l(e))}function o(e){if("string"!=typeof e)throw new a.InvalidDidError(typeof e,"DID must be a string");if(e.startsWith(s.DID_PLC_PREFIX))(0,s.assertDidPlc)(e);else if(e.startsWith(s.DID_WEB_PREFIX))d(e);else throw new a.InvalidDidError(e,'Atproto only allows "plc" and "web" DID methods')}function d(e){if((0,s.assertDidWeb)(e),e.includes(":",s.DID_WEB_PREFIX.length))throw new a.InvalidDidError(e,"Atproto does not allow path components in Web DIDs");if(e.includes("%3A",s.DID_WEB_PREFIX.length)&&!e.startsWith("did:web:localhost%3A"))throw new a.InvalidDidError(e,"Atproto does not allow port numbers in Web DIDs, except for localhost")}function l(e){try{return d(e),!0}catch{return!1}}t.atprotoDidSchema=i.z.string().refine(n,'Atproto only allows "plc" and "web" DID methods')},8595:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.didDocumentValidator=t.didDocumentSchema=void 0;let i=r(4747),a=r(7391),s=i.z.string().refine(e=>{try{return new URL(e),!0}catch{return!1}},"RFC3968 compliant URI"),n=i.z.union([a.didSchema,i.z.array(a.didSchema)]),o=i.z.union([s,i.z.string().regex(/^#[^#]+$/)]),d=i.z.object({id:o,type:i.z.string().min(1),controller:n,publicKeyJwk:i.z.record(i.z.string(),i.z.unknown()).optional(),publicKeyMultibase:i.z.string().optional()}),l=i.z.union([i.z.string(),i.z.array(i.z.string())]),c=i.z.union([s,i.z.record(i.z.string(),s),i.z.array(i.z.union([s,i.z.record(i.z.string(),s)])).nonempty()]),u=i.z.object({id:o,type:l,serviceEndpoint:c}),h=i.z.union([o,d]);t.didDocumentSchema=i.z.object({"@context":i.z.union([i.z.literal("https://www.w3.org/ns/did/v1"),i.z.array(i.z.string().url()).nonempty().refine(e=>"https://www.w3.org/ns/did/v1"===e[0],{message:"First @context must be https://www.w3.org/ns/did/v1"})]),id:a.didSchema,controller:n.optional(),alsoKnownAs:i.z.array(s).optional(),service:i.z.array(u).optional(),authentication:i.z.array(h).optional(),verificationMethod:i.z.array(i.z.union([d,o])).optional()}),t.didDocumentValidator=t.didDocumentSchema.superRefine(({id:e,service:t},r)=>{if(t){let a=new Set;for(let s=0;s<t.length;s++){let n=t[s],o=n.id.startsWith("#")?`${e}${n.id}`:n.id;a.has(o)?r.addIssue({code:i.z.ZodIssueCode.custom,message:`Duplicate service id (${n.id}) found in the document`,path:["service",s,"id"]}):a.add(o)}}})},5008:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidDidError=t.DidError=void 0;class r extends Error{constructor(e,t,r,i=400,a){super(t,{cause:a}),Object.defineProperty(this,"did",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:i})}get statusCode(){return this.status}toString(){return`${this.constructor.name} ${this.code} (${this.did}): ${this.message}`}static from(e,t){return e instanceof r?e:new r(t,e instanceof Error?e.message:"string"==typeof e?e:"An unknown error occurred","did-unknown-error",("number"==typeof e?.statusCode?e.statusCode:void 0)??("number"==typeof e?.status?e.status:void 0),e)}}t.DidError=r;class i extends r{constructor(e,t,r){super(e,t,"did-invalid",400,r)}}t.InvalidDidError=i},7391:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.didSchema=t.DID_PREFIX=void 0,t.assertDidMethod=o,t.extractDidMethod=function(e){let t=e.indexOf(":",n);return e.slice(n,t)},t.assertDidMsid=d,t.assertDid=l,t.isDid=function(e){try{return l(e),!0}catch(e){if(e instanceof a.DidError)return!1;throw e}},t.asDid=function(e){return l(e),e};let i=r(4747),a=r(5008),s="did:";t.DID_PREFIX=s;let n=s.length;function o(e,t=0,r=e.length){let i;if(!Number.isFinite(r)||!Number.isFinite(t)||r<t||r>e.length)throw TypeError("Invalid start or end position");if(r===t)throw new a.InvalidDidError(e,"Empty method name");for(let s=t;s<r;s++)if(((i=e.charCodeAt(s))<97||i>122)&&(i<48||i>57))throw new a.InvalidDidError(e,`Invalid character at position ${s} in DID method name`)}function d(e,t=0,r=e.length){let i;if(!Number.isFinite(r)||!Number.isFinite(t)||r<t||r>e.length)throw TypeError("Invalid start or end position");if(r===t)throw new a.InvalidDidError(e,"DID method-specific id must not be empty");for(let s=t;s<r;s++)if(((i=e.charCodeAt(s))<97||i>122)&&(i<65||i>90)&&(i<48||i>57)&&46!==i&&45!==i&&95!==i){if(58===i){if(s===r-1)throw new a.InvalidDidError(e,'DID cannot end with ":"');continue}if(37===i){if(((i=e.charCodeAt(++s))<48||i>57)&&(i<65||i>70)||((i=e.charCodeAt(++s))<48||i>57)&&(i<65||i>70))throw new a.InvalidDidError(e,`Invalid pct-encoded character at position ${s}`);if(s>=r)throw new a.InvalidDidError(e,`Incomplete pct-encoded character at position ${s-2}`);continue}throw new a.InvalidDidError(e,`Disallowed character in DID at position ${s}`)}}function l(e){if("string"!=typeof e)throw new a.InvalidDidError(typeof e,"DID must be a string");let{length:t}=e;if(t>2048)throw new a.InvalidDidError(e,"DID is too long (2048 chars max)");if(!e.startsWith(s))throw new a.InvalidDidError(e,`DID requires "${s}" prefix`);let r=e.indexOf(":",n);if(-1===r)throw new a.InvalidDidError(e,"Missing colon after method name");o(e,n,r),d(e,r+1,t)}t.didSchema=i.z.string().superRefine((e,t)=>{try{return l(e),!0}catch(e){return t.addIssue({code:i.z.ZodIssueCode.custom,message:e instanceof Error?e.message:"Unexpected error"}),!1}})},4146:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,a)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(98),t),a(r(8595),t),a(r(5008),t),a(r(7391),t),a(r(7485),t)},7485:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,a)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(5616),t),a(r(8718),t)},5616:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DID_PLC_PREFIX=void 0,t.isDidPlc=function(e){if("string"!=typeof e||32!==e.length||!e.startsWith(a))return!1;for(let t=s;t<32;t++)if(!o(e.charCodeAt(t)))return!1;return!0},t.asDidPlc=function(e){return n(e),e},t.assertDidPlc=n;let i=r(5008),a="did:plc:";t.DID_PLC_PREFIX=a;let s=a.length;function n(e){if("string"!=typeof e)throw new i.InvalidDidError(typeof e,"DID must be a string");if(!e.startsWith(a))throw new i.InvalidDidError(e,"Invalid did:plc prefix");if(32!==e.length)throw new i.InvalidDidError(e,"did:plc must be 32 characters long");for(let t=s;t<32;t++)if(!o(e.charCodeAt(t)))throw new i.InvalidDidError(e,`Invalid character at position ${t}`)}let o=e=>e>=97&&e<=122||e>=50&&e<=55},8718:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DID_WEB_PREFIX=void 0,t.isDidWeb=function(e){if("string"!=typeof e||!e.startsWith(t.DID_WEB_PREFIX)||":"===e.charAt(t.DID_WEB_PREFIX.length))return!1;try{return n(e),!0}catch{return!1}},t.asDidWeb=function(e){return s(e),e},t.assertDidWeb=s,t.didWebToUrl=n,t.urlToDidWeb=function(e){let t=e.port?`%3A${e.port}`:"",r="/"===e.pathname?"":e.pathname.replaceAll("/",":");return`did:web:${e.hostname}${t}${r}`};let i=r(5008),a=r(7391);function s(e){if("string"!=typeof e)throw new i.InvalidDidError(typeof e,"DID must be a string");if(!e.startsWith(t.DID_WEB_PREFIX))throw new i.InvalidDidError(e,"Invalid did:web prefix");if(":"===e.charAt(t.DID_WEB_PREFIX.length))throw new i.InvalidDidError(e,"did:web MSID must not start with a colon");n(e)}function n(e){(0,a.assertDidMsid)(e,t.DID_WEB_PREFIX.length);let r=t.DID_WEB_PREFIX.length,s=e.indexOf(":",r),n=-1===s?e.slice(r):e.slice(r,s),o=-1===s?"":e.slice(s);try{let e=new URL(`https://${n.replaceAll("%3A",":")}${o.replaceAll(":","/")}`);return"localhost"===e.hostname&&(e.protocol="http:"),e}catch(t){throw new i.InvalidDidError(e,"Invalid Web DID",t)}}t.DID_WEB_PREFIX="did:web:"},4022:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,a)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(3201),t)},3201:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JoseKey=void 0;let i=r(6924),a=r(9538),s=r(8091),{JOSEError:n}=i.errors;class o extends a.Key{async getKeyObj(e){if(!this.algorithms.includes(e))throw new a.JwkError(`Key cannot be used with algorithm "${e}"`);try{return await (0,i.importJWK)(this.jwk,e)}catch(e){throw new a.JwkError("Failed to import JWK",void 0,{cause:e})}}async createJwt(e,t){try{let{kid:r}=e;if(r&&r!==this.kid)throw new a.JwtCreateError(`Invalid "kid" (${r}) used to sign with key "${this.kid}"`);let{alg:s}=e;if(!s)throw new a.JwtCreateError('Missing "alg" in JWT header');let n=await this.getKeyObj(s),o=new i.SignJWT(t).setProtectedHeader({...e,alg:s,kid:this.kid});return await o.sign(n)}catch(e){if(e instanceof n)throw new a.JwtCreateError(e.message,e.code,{cause:e});throw a.JwtCreateError.from(e)}}async verifyJwt(e,t){try{let r=await (0,i.jwtVerify)(e,async({alg:e})=>this.getKeyObj(e),{...t,algorithms:this.algorithms}),s=a.jwtHeaderSchema.safeParse(r.protectedHeader);if(!s.success)throw new a.JwtVerifyError("Invalid JWT header",void 0,{cause:s.error});let n=a.jwtPayloadSchema.safeParse(r.payload);if(!n.success)throw new a.JwtVerifyError("Invalid JWT payload",void 0,{cause:n.error});return{protectedHeader:s.data,payload:n.data}}catch(e){if(e instanceof n)throw new a.JwtVerifyError(e.message,e.code,{cause:e});throw a.JwtVerifyError.from(e)}}static async generateKeyPair(e=["ES256"],t){if(!e.length)throw new a.JwkError("No algorithms provided for key generation");let r=[];for(let a of e)try{return await (0,i.generateKeyPair)(a,t)}catch(e){r.push(e)}throw new a.JwkError("Failed to generate key pair",void 0,{cause:AggregateError(r,"None of the algorithms worked")})}static async generate(e=["ES256"],t,r){let i=await this.generateKeyPair(e,{...r,extractable:!0});return this.fromImportable(i.privateKey,t)}static async fromImportable(e,t){if("string"==typeof e){if(e.startsWith("-----"))return this.fromPKCS8(e,"",t);if(e.startsWith("{"))return this.fromJWK(e,t);throw new a.JwkError("Invalid input")}if("object"==typeof e)return"kty"in e||"alg"in e?this.fromJWK(e,t):this.fromKeyLike(e,t);throw new a.JwkError("Invalid input")}static async fromKeyLike(e,t,r){let s=await (0,i.exportJWK)(e);if(r){if(s.alg){if(s.alg!==r)throw new a.JwkError('Invalid "alg" in JWK')}else s.alg=r}return this.fromJWK(s,t)}static async fromPKCS8(e,t,r){let a=await (0,i.importPKCS8)(e,t,{extractable:!0});return this.fromKeyLike(a,r)}static async fromJWK(e,t){let r="string"==typeof e?JSON.parse(e):e;if(!r||"object"!=typeof r)throw new a.JwkError("Invalid JWK");let i=(0,s.either)(r.kid,t),n=r.use||"sig";return new o(a.jwkValidator.parse({...r,kid:i,use:n}))}}t.JoseKey=o},8091:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.either=function(e,t){if(null!=e&&null!=t&&e!==t)throw TypeError(`Expected "${t}", got "${e}"`);return e??t??void 0}},6784:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,a)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(5643),t)},2556:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toSubtleAlgorithm=function(e,t,r){switch(e){case"PS256":case"PS384":case"PS512":return{name:"RSA-PSS",hash:`SHA-${e.slice(-3)}`,modulusLength:r?.modulusLength??2048,publicExponent:new Uint8Array([1,0,1])};case"RS256":case"RS384":case"RS512":return{name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.slice(-3)}`,modulusLength:r?.modulusLength??2048,publicExponent:new Uint8Array([1,0,1])};case"ES256":case"ES384":return{name:"ECDSA",namedCurve:`P-${e.slice(-3)}`};case"ES512":return{name:"ECDSA",namedCurve:"P-521"};default:throw TypeError(`Unsupported alg "${e}"`)}},t.fromSubtleAlgorithm=function(e){switch(e.name){case"RSA-PSS":case"RSASSA-PKCS1-v1_5":{let t=e.hash.name;switch(t){case"SHA-256":case"SHA-384":case"SHA-512":{let r="RSA-PSS"===e.name?"PS":"RS";return`${r}${t.slice(-3)}`}default:throw TypeError("unsupported RsaHashedKeyAlgorithm hash")}}case"ECDSA":{let t=e.namedCurve;switch(t){case"P-256":case"P-384":case"P-512":return`ES${t.slice(-3)}`;case"P-521":return"ES512";default:throw TypeError("unsupported EcKeyAlgorithm namedCurve")}}case"Ed448":case"Ed25519":return"EdDSA";default:throw TypeError(`Unexpected algorithm "${e.name}"`)}},t.isCryptoKeyPair=function(e,t){return"object"==typeof e&&null!==e&&"privateKey"in e&&e.privateKey instanceof CryptoKey&&"private"===e.privateKey.type&&(null==t||e.privateKey.extractable===t)&&e.privateKey.usages.includes("sign")&&"publicKey"in e&&e.publicKey instanceof CryptoKey&&"public"===e.publicKey.type&&!0===e.publicKey.extractable&&e.publicKey.usages.includes("verify")}},5643:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebcryptoKey=t.jwkWithAlgSchema=void 0;let i=r(4747),a=r(9538),s=r(4022),n=r(2556);t.jwkWithAlgSchema=i.z.intersection(a.jwkSchema,i.z.object({alg:i.z.string()}));class o extends s.JoseKey{static async generate(e=["ES256"],t=crypto.randomUUID(),r){let i=await this.generateKeyPair(e,r);if(!(0,n.isCryptoKeyPair)(i))throw TypeError("Invalid CryptoKeyPair");return this.fromKeypair(i,t)}static async fromKeypair(e,r){let{key_ops:i,use:a,alg:s=(0,n.fromSubtleAlgorithm)(e.privateKey.algorithm),...d}=await crypto.subtle.exportKey("jwk",e.privateKey.extractable?e.privateKey:e.publicKey);if(a&&"sig"!==a)throw TypeError(`Unsupported JWK use "${a}"`);if(i&&!i.some(e=>"sign"===e||"verify"===e))throw TypeError(`Invalid key_ops "${i}" for "sig" use`);return new o(t.jwkWithAlgSchema.parse({...d,kid:r,alg:s,use:"sig"}),e)}constructor(e,t){super(e),Object.defineProperty(this,"cryptoKeyPair",{enumerable:!0,configurable:!0,writable:!0,value:t})}get isPrivate(){return!0}get privateJwk(){if(super.isPrivate)return this.jwk;throw Error("Private Webcrypto Key not exportable")}async getKeyObj(e){if(this.jwk.alg!==e)throw new a.JwkError(`Key cannot be used with algorithm "${e}"`);return this.cryptoKeyPair.privateKey}}t.WebcryptoKey=o},2040:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jwkAlgorithms=function*(e){if(e.alg){yield e.alg;return}switch(e.kty){case"EC":if(("enc"===e.use||void 0===e.use)&&(yield"ECDH-ES",yield"ECDH-ES+A128KW",yield"ECDH-ES+A192KW",yield"ECDH-ES+A256KW"),"sig"===e.use||void 0===e.use){let t="crv"in e?e.crv:void 0;switch(t){case"P-256":case"P-384":yield`ES${t.slice(-3)}`;break;case"P-521":yield"ES512";break;case"secp256k1":s&&(yield"ES256K");break;default:throw new i.JwkError(`Unsupported crv "${t}"`)}}return;case"OKP":if(!e.use)throw new i.JwkError('Missing "use" Parameter value');yield"ECDH-ES",yield"ECDH-ES+A128KW",yield"ECDH-ES+A192KW",yield"ECDH-ES+A256KW";return;case"RSA":("enc"===e.use||void 0===e.use)&&(yield"RSA-OAEP",yield"RSA-OAEP-256",yield"RSA-OAEP-384",yield"RSA-OAEP-512",s&&(yield"RSA1_5")),("sig"===e.use||void 0===e.use)&&(yield"PS256",yield"PS384",yield"PS512",yield"RS256",yield"RS384",yield"RS512");return;case"oct":("enc"===e.use||void 0===e.use)&&(yield"A128GCMKW",yield"A192GCMKW",yield"A256GCMKW",yield"A128KW",yield"A192KW",yield"A256KW"),("sig"===e.use||void 0===e.use)&&(yield"HS256",yield"HS384",yield"HS512");return;default:throw new i.JwkError(`Unsupported kty "${e.kty}"`)}};let i=r(6456),{process:a}=globalThis,s=void 0!==a&&"string"==typeof a?.versions?.node},6456:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JwtVerifyError=t.JwtCreateError=t.JwkError=t.ERR_JWT_VERIFY=t.ERR_JWT_CREATE=t.ERR_JWT_INVALID=t.ERR_JWK_NOT_FOUND=t.ERR_JWK_INVALID=t.ERR_JWKS_NO_MATCHING_KEY=void 0,t.ERR_JWKS_NO_MATCHING_KEY="ERR_JWKS_NO_MATCHING_KEY",t.ERR_JWK_INVALID="ERR_JWK_INVALID",t.ERR_JWK_NOT_FOUND="ERR_JWK_NOT_FOUND",t.ERR_JWT_INVALID="ERR_JWT_INVALID",t.ERR_JWT_CREATE="ERR_JWT_CREATE",t.ERR_JWT_VERIFY="ERR_JWT_VERIFY";class r extends TypeError{constructor(e="JWK error",r=t.ERR_JWK_INVALID,i){super(e,i),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:r})}}t.JwkError=r;class i extends Error{constructor(e="Unable to create JWT",r=t.ERR_JWT_CREATE,i){super(e,i),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:r})}static from(e,t,a){return e instanceof i?e:e instanceof r?new i(a,e.code,{cause:e}):new i(a,t,{cause:e})}}t.JwtCreateError=i;class a extends Error{constructor(e="Invalid JWT",r=t.ERR_JWT_VERIFY,i){super(e,i),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:r})}static from(e,t,i){return e instanceof a?e:e instanceof r?new a(i,e.code,{cause:e}):new a(i,t,{cause:e})}}t.JwtVerifyError=a},9538:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,a)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.ValidationError=void 0;var s=r(4747);Object.defineProperty(t,"ValidationError",{enumerable:!0,get:function(){return s.ZodError}}),a(r(2040),t),a(r(6456),t),a(r(8068),t),a(r(503),t),a(r(7612),t),a(r(7454),t),a(r(145),t),a(r(7046),t),a(r(372),t),a(r(6735),t)},8068:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jwkPubSchema=t.jwkValidator=t.jwkSchema=t.jwkUnknownKeySchema=t.jwkSymKeySchema=t.jwkOkpKeySchema=t.jwkEcSecp256k1KeySchema=t.jwkEcKeySchema=t.jwkRsaKeySchema=t.jwkBaseSchema=t.keyUsageSchema=void 0;let i=r(4747);t.keyUsageSchema=i.z.enum(["sign","verify","encrypt","decrypt","wrapKey","unwrapKey","deriveKey","deriveBits"]),t.jwkBaseSchema=i.z.object({kty:i.z.string().min(1),alg:i.z.string().min(1).optional(),kid:i.z.string().min(1).optional(),ext:i.z.boolean().optional(),use:i.z.enum(["sig","enc"]).optional(),key_ops:i.z.array(t.keyUsageSchema).optional(),x5c:i.z.array(i.z.string()).optional(),x5t:i.z.string().min(1).optional(),"x5t#S256":i.z.string().min(1).optional(),x5u:i.z.string().url().optional()}),t.jwkRsaKeySchema=t.jwkBaseSchema.extend({kty:i.z.literal("RSA"),alg:i.z.enum(["RS256","RS384","RS512","PS256","PS384","PS512"]).optional(),n:i.z.string().min(1),e:i.z.string().min(1),d:i.z.string().min(1).optional(),p:i.z.string().min(1).optional(),q:i.z.string().min(1).optional(),dp:i.z.string().min(1).optional(),dq:i.z.string().min(1).optional(),qi:i.z.string().min(1).optional(),oth:i.z.array(i.z.object({r:i.z.string().optional(),d:i.z.string().optional(),t:i.z.string().optional()})).nonempty().optional()}),t.jwkEcKeySchema=t.jwkBaseSchema.extend({kty:i.z.literal("EC"),alg:i.z.enum(["ES256","ES384","ES512"]).optional(),crv:i.z.enum(["P-256","P-384","P-521"]),x:i.z.string().min(1),y:i.z.string().min(1),d:i.z.string().min(1).optional()}),t.jwkEcSecp256k1KeySchema=t.jwkBaseSchema.extend({kty:i.z.literal("EC"),alg:i.z.enum(["ES256K"]).optional(),crv:i.z.enum(["secp256k1"]),x:i.z.string().min(1),y:i.z.string().min(1),d:i.z.string().min(1).optional()}),t.jwkOkpKeySchema=t.jwkBaseSchema.extend({kty:i.z.literal("OKP"),alg:i.z.enum(["EdDSA"]).optional(),crv:i.z.enum(["Ed25519","Ed448"]),x:i.z.string().min(1),d:i.z.string().min(1).optional()}),t.jwkSymKeySchema=t.jwkBaseSchema.extend({kty:i.z.literal("oct"),alg:i.z.enum(["HS256","HS384","HS512"]).optional(),k:i.z.string()}),t.jwkUnknownKeySchema=t.jwkBaseSchema.extend({kty:i.z.string().refine(e=>"RSA"!==e&&"EC"!==e&&"OKP"!==e&&"oct"!==e)}),t.jwkSchema=i.z.union([t.jwkUnknownKeySchema,t.jwkRsaKeySchema,t.jwkEcKeySchema,t.jwkEcSecp256k1KeySchema,t.jwkOkpKeySchema,t.jwkSymKeySchema]),t.jwkValidator=t.jwkSchema.refine(e=>null!=e.use||null!=e.key_ops,"use or key_ops required").refine(e=>!e.use||!e.key_ops||e.key_ops.every(t=>"sig"===e.use?"sign"===t||"verify"===t:"encrypt"===t||"decrypt"===t),"use and key_ops must be consistent"),t.jwkPubSchema=t.jwkValidator.refine(e=>null!=e.kid,"kid is required").refine(e=>!("k"in e)&&!("d"in e),"private key not allowed")},503:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jwksPubSchema=t.jwksSchema=void 0;let i=r(4747),a=r(8068);t.jwksSchema=i.z.object({keys:i.z.array(a.jwkSchema)}),t.jwksPubSchema=i.z.object({keys:i.z.array(a.jwkPubSchema)})},7612:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unsafeDecodeJwt=function(e){let{0:t,1:r,length:n}=e.split(".");if(n>3||n<2)throw new i.JwtVerifyError(void 0,i.ERR_JWT_INVALID);let o=a.jwtHeaderSchema.parse((0,s.parseB64uJson)(t));if(2===n&&o?.alg!=="none")throw new i.JwtVerifyError(void 0,i.ERR_JWT_INVALID);return{header:o,payload:a.jwtPayloadSchema.parse((0,s.parseB64uJson)(r))}};let i=r(6456),a=r(145),s=r(6735)},7454:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},145:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jwtPayloadSchema=t.jwtHeaderSchema=t.isUnsignedJwt=t.unsignedJwtSchema=t.isSignedJwt=t.signedJwtSchema=void 0;let i=r(4747),a=r(8068),s=r(6735);t.signedJwtSchema=i.z.string().superRefine(s.jwtCharsRefinement).superRefine((0,s.segmentedStringRefinementFactory)(3)),t.isSignedJwt=e=>t.signedJwtSchema.safeParse(e).success,t.unsignedJwtSchema=i.z.string().superRefine(s.jwtCharsRefinement).superRefine((0,s.segmentedStringRefinementFactory)(2)),t.isUnsignedJwt=e=>t.unsignedJwtSchema.safeParse(e).success,t.jwtHeaderSchema=i.z.object({alg:i.z.string(),jku:i.z.string().url().optional(),jwk:i.z.object({kty:i.z.string(),crv:i.z.string().optional(),x:i.z.string().optional(),y:i.z.string().optional(),e:i.z.string().optional(),n:i.z.string().optional()}).optional(),kid:i.z.string().optional(),x5u:i.z.string().optional(),x5c:i.z.array(i.z.string()).optional(),x5t:i.z.string().optional(),"x5t#S256":i.z.string().optional(),typ:i.z.string().optional(),cty:i.z.string().optional(),crit:i.z.array(i.z.string()).optional()}).passthrough(),t.jwtPayloadSchema=i.z.object({iss:i.z.string().optional(),aud:i.z.union([i.z.string(),i.z.array(i.z.string()).nonempty()]).optional(),sub:i.z.string().optional(),exp:i.z.number().int().optional(),nbf:i.z.number().int().optional(),iat:i.z.number().int().optional(),jti:i.z.string().optional(),htm:i.z.string().optional(),htu:i.z.string().optional(),ath:i.z.string().optional(),acr:i.z.string().optional(),azp:i.z.string().optional(),amr:i.z.array(i.z.string()).optional(),cnf:i.z.object({kid:i.z.string().optional(),jwk:a.jwkPubSchema.optional(),jwe:i.z.string().optional(),jku:i.z.string().url().optional(),jkt:i.z.string().optional(),"x5t#S256":i.z.string().optional(),osc:i.z.string().optional()}).optional(),client_id:i.z.string().optional(),scope:i.z.string().optional(),nonce:i.z.string().optional(),at_hash:i.z.string().optional(),c_hash:i.z.string().optional(),s_hash:i.z.string().optional(),auth_time:i.z.number().int().optional(),name:i.z.string().optional(),family_name:i.z.string().optional(),given_name:i.z.string().optional(),middle_name:i.z.string().optional(),nickname:i.z.string().optional(),preferred_username:i.z.string().optional(),gender:i.z.string().optional(),picture:i.z.string().url().optional(),profile:i.z.string().url().optional(),website:i.z.string().url().optional(),birthdate:i.z.string().regex(/\d{4}-\d{2}-\d{2}/).optional(),zoneinfo:i.z.string().regex(/^[A-Za-z0-9_/]+$/).optional(),locale:i.z.string().regex(/^[a-z]{2,3}(-[A-Z]{2})?$/).optional(),updated_at:i.z.number().int().optional(),email:i.z.string().optional(),email_verified:i.z.boolean().optional(),phone_number:i.z.string().optional(),phone_number_verified:i.z.boolean().optional(),address:i.z.object({formatted:i.z.string().optional(),street_address:i.z.string().optional(),locality:i.z.string().optional(),region:i.z.string().optional(),postal_code:i.z.string().optional(),country:i.z.string().optional()}).optional(),authorization_details:i.z.array(i.z.object({type:i.z.string(),locations:i.z.array(i.z.string()).optional(),actions:i.z.array(i.z.string()).optional(),datatypes:i.z.array(i.z.string()).optional(),identifier:i.z.string().optional(),privileges:i.z.array(i.z.string()).optional()}).passthrough()).optional()}).passthrough()},7046:function(e,t,r){"use strict";let i,a,s,n;var o,d=this&&this.__runInitializers||function(e,t,r){for(var i=arguments.length>2,a=0;a<t.length;a++)r=i?t[a].call(e,r):t[a].call(e);return i?r:void 0},l=this&&this.__esDecorate||function(e,t,r,i,a,s){function n(e){if(void 0!==e&&"function"!=typeof e)throw TypeError("Function expected");return e}for(var o,d=i.kind,l="getter"===d?"get":"setter"===d?"set":"value",c=!t&&e?i.static?e:e.prototype:null,u=t||(c?Object.getOwnPropertyDescriptor(c,i.name):{}),h=!1,p=r.length-1;p>=0;p--){var f={};for(var y in i)f[y]="access"===y?{}:i[y];for(var y in i.access)f.access[y]=i.access[y];f.addInitializer=function(e){if(h)throw TypeError("Cannot add initializers after decoration has completed");s.push(n(e||null))};var m=(0,r[p])("accessor"===d?{get:u.get,set:u.set}:u[l],f);if("accessor"===d){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw TypeError("Object expected");(o=n(m.get))&&(u.get=o),(o=n(m.set))&&(u.set=o),(o=n(m.init))&&a.unshift(o)}else(o=n(m))&&("field"===d?a.unshift(o):u[l]=o)}c&&Object.defineProperty(c,i.name,u),h=!0};Object.defineProperty(t,"__esModule",{value:!0}),t.Key=void 0;let c=r(2040),u=r(6456),h=r(8068),p=r(6735),f=h.jwkSchema.readonly(),y=(n=[],o=class{constructor(e){if(Object.defineProperty(this,"jwk",{enumerable:!0,configurable:!0,writable:!0,value:(d(this,n),e)}),!e.use)throw new u.JwkError('Missing "use" Parameter value')}get isPrivate(){let{jwk:e}=this;return"d"in e&&void 0!==e.d||"k"in e&&void 0!==e.k}get isSymetric(){let{jwk:e}=this;return"k"in e&&void 0!==e.k}get privateJwk(){return this.isPrivate?this.jwk:void 0}get publicJwk(){if(!this.isSymetric)return f.parse({...this.jwk,d:void 0,k:void 0})}get bareJwk(){if(this.isSymetric)return;let{kty:e,crv:t,e:r,n:i,x:a,y:s}=this.jwk;return f.parse({crv:t,e:r,kty:e,n:i,x:a,y:s})}get use(){return this.jwk.use}get alg(){return this.jwk.alg}get kid(){return this.jwk.kid}get crv(){return this.jwk.crv}get algorithms(){return Object.freeze(Array.from((0,c.jwkAlgorithms)(this.jwk)))}},(()=>{let e="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[p.cachedGetter],a=[p.cachedGetter],s=[p.cachedGetter],l(o,null,i,{kind:"getter",name:"publicJwk",static:!1,private:!1,access:{has:e=>"publicJwk"in e,get:e=>e.publicJwk},metadata:e},null,n),l(o,null,a,{kind:"getter",name:"bareJwk",static:!1,private:!1,access:{has:e=>"bareJwk"in e,get:e=>e.bareJwk},metadata:e},null,n),l(o,null,s,{kind:"getter",name:"algorithms",static:!1,private:!1,access:{has:e=>"algorithms"in e,get:e=>e.algorithms},metadata:e},null,n),e&&Object.defineProperty(o,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:e})})(),o);t.Key=y},372:function(e,t,r){"use strict";let i,a,s,n;var o,d=this&&this.__runInitializers||function(e,t,r){for(var i=arguments.length>2,a=0;a<t.length;a++)r=i?t[a].call(e,r):t[a].call(e);return i?r:void 0},l=this&&this.__esDecorate||function(e,t,r,i,a,s){function n(e){if(void 0!==e&&"function"!=typeof e)throw TypeError("Function expected");return e}for(var o,d=i.kind,l="getter"===d?"get":"setter"===d?"set":"value",c=!t&&e?i.static?e:e.prototype:null,u=t||(c?Object.getOwnPropertyDescriptor(c,i.name):{}),h=!1,p=r.length-1;p>=0;p--){var f={};for(var y in i)f[y]="access"===y?{}:i[y];for(var y in i.access)f.access[y]=i.access[y];f.addInitializer=function(e){if(h)throw TypeError("Cannot add initializers after decoration has completed");s.push(n(e||null))};var m=(0,r[p])("accessor"===d?{get:u.get,set:u.set}:u[l],f);if("accessor"===d){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw TypeError("Object expected");(o=n(m.get))&&(u.get=o),(o=n(m.set))&&(u.set=o),(o=n(m.init))&&a.unshift(o)}else(o=n(m))&&("field"===d?a.unshift(o):u[l]=o)}c&&Object.defineProperty(c,i.name,u),h=!0};Object.defineProperty(t,"__esModule",{value:!0}),t.Keyset=void 0;let c=r(6456),u=r(7612),h=r(6735),p=e=>e.privateJwk,f=e=>e.publicJwk,y=(n=[],o=class{constructor(e,t=e instanceof o?[...e.preferredSigningAlgorithms]:["EdDSA","ES256K","ES256","PS256","PS384","PS512","HS256","HS384","HS512"]){Object.defineProperty(this,"preferredSigningAlgorithms",{enumerable:!0,configurable:!0,writable:!0,value:(d(this,n),t)}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let r=[],i=new Set;for(let t of e)if(t&&(r.push(t),t.kid)){if(i.has(t.kid))throw new c.JwkError(`Duplicate key: ${t.kid}`);i.add(t.kid)}this.keys=Object.freeze(r)}get size(){return this.keys.length}get signAlgorithms(){let e=new Set;for(let t of this)if("sig"===t.use)for(let r of t.algorithms)e.add(r);return Object.freeze([...e].sort((0,h.preferredOrderCmp)(this.preferredSigningAlgorithms)))}get publicJwks(){return{keys:Array.from(this,f).filter(h.isDefined)}}get privateJwks(){return{keys:Array.from(this,p).filter(h.isDefined)}}has(e){return this.keys.some(t=>t.kid===e)}get(e){for(let t of this.list(e))return t;throw new c.JwkError(`Key not found ${e.kid||e.alg||"<unknown>"}`,c.ERR_JWK_NOT_FOUND)}*list(e){if(e.kid?.length!==0&&e.alg?.length!==0){for(let t of this)if(!e.use||t.use===e.use){if(Array.isArray(e.kid)){if(!t.kid||!e.kid.includes(t.kid))continue}else if(e.kid&&t.kid!==e.kid)continue;if(Array.isArray(e.alg)){if(!e.alg.some(e=>t.algorithms.includes(e)))continue}else if("string"==typeof e.alg&&!t.algorithms.includes(e.alg))continue;yield t}}}findKey({kid:e,alg:t,use:r}){let i=[];for(let a of this.list({kid:e,alg:t,use:r}))if(a.isPrivate){if("string"==typeof t)return[a,t];i.push(a)}let a=(0,h.matchesAny)(t),s=i.map(e=>[e,e.algorithms.filter(a)]);for(let e of this.preferredSigningAlgorithms)for(let[t,r]of s)if(r.includes(e))return[t,e];for(let[e,t]of s)for(let r of t)return[e,r];throw new c.JwkError(`No signing key found for ${e||t||r||"<unknown>"}`,c.ERR_JWK_NOT_FOUND)}[(i=[h.cachedGetter],a=[h.cachedGetter],s=[h.cachedGetter],Symbol.iterator)](){return this.keys.values()}async createJwt({alg:e,kid:t,...r},i){try{let[a,s]=this.findKey({alg:e,kid:t,use:"sig"}),n={...r,alg:s,kid:a.kid};return"function"==typeof i&&(i=await i(n,a)),await a.createJwt(n,i)}catch(e){throw c.JwtCreateError.from(e)}}async verifyJwt(e,t){let{header:r}=(0,u.unsafeDecodeJwt)(e),{kid:i,alg:a}=r,s=[];for(let r of this.list({kid:i,alg:a}))try{return{...await r.verifyJwt(e,t),key:r}}catch(e){s.push(e)}switch(s.length){case 0:throw new c.JwtVerifyError("No key matched",c.ERR_JWKS_NO_MATCHING_KEY);case 1:throw c.JwtVerifyError.from(s[0],c.ERR_JWT_INVALID);default:throw c.JwtVerifyError.from(s,c.ERR_JWT_INVALID)}}toJSON(){return structuredClone(this.publicJwks)}},(()=>{let e="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;l(o,null,i,{kind:"getter",name:"signAlgorithms",static:!1,private:!1,access:{has:e=>"signAlgorithms"in e,get:e=>e.signAlgorithms},metadata:e},null,n),l(o,null,a,{kind:"getter",name:"publicJwks",static:!1,private:!1,access:{has:e=>"publicJwks"in e,get:e=>e.publicJwks},metadata:e},null,n),l(o,null,s,{kind:"getter",name:"privateJwks",static:!1,private:!1,access:{has:e=>"privateJwks"in e,get:e=>e.privateJwks},metadata:e},null,n),e&&Object.defineProperty(o,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:e})})(),o);t.Keyset=y},6735:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.segmentedStringRefinementFactory=t.jwtCharsRefinement=t.cachedGetter=t.preferredOrderCmp=t.isDefined=void 0,t.matchesAny=function(e){return null==e?e=>!0:Array.isArray(e)?t=>e.includes(t):t=>t===e},t.parseB64uJson=function(e){let t=i.base64url.baseDecode(e);return JSON.parse(s.decode(t))};let i=r(4825),a=r(4747);t.isDefined=e=>void 0!==e,t.preferredOrderCmp=e=>(t,r)=>{let i=e.indexOf(t),a=e.indexOf(r);return i===a?0:-1===i?1:-1===a?-1:i-a},t.cachedGetter=(e,t)=>function(){let t=e.call(this);return Object.defineProperty(this,e.name,{get:()=>t,enumerable:!0,configurable:!0}),t};let s=new TextDecoder;t.jwtCharsRefinement=(e,t)=>{let r;for(let i=0;i<e.length;i++)if(65<=(r=e.charCodeAt(i))&&r<=90||97<=r&&r<=122||48<=r&&r<=57||45===r||95===r||46===r);else{let r=String.fromCodePoint(e.codePointAt(i));return t.addIssue({code:a.ZodIssueCode.custom,message:`Invalid character "${r}" in JWT at position ${i}`})}},t.segmentedStringRefinementFactory=(e,t=2)=>{if(!Number.isFinite(e)||e<1||(0|e)!==e)throw TypeError(`Count must be a natural number (got ${e})`);let r=e*t+(e-1),i="Invalid JWT format";return(s,n)=>{if(s.length<r)return n.addIssue({code:a.ZodIssueCode.custom,message:`${i}: too short`}),!1;let o=0;for(let r=0;r<e-1;r++){let d=s.indexOf(".",o);if(-1===d)return n.addIssue({code:a.ZodIssueCode.custom,message:`${i}: expected ${e} segments, got ${r+1}`}),!1;if(d-o<t)return n.addIssue({code:a.ZodIssueCode.custom,message:`${i}: segment ${r+1} is too short`}),!1;o=d+1}return -1!==s.indexOf(".",o)?(n.addIssue({code:a.ZodIssueCode.custom,message:`${i}: too many segments`}),!1):!(s.length-o<t)||(n.addIssue({code:a.ZodIssueCode.custom,message:`${i}: last segment is too short`}),!1)}}},6948:function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserOAuthClient=void 0;let a=r(2495),s=r(3377),n=r(605),o=r(3681),d=r(4062),l=r(5766),c="@@atproto/oauth-client-browser",u=`${c}(popup-channel)`,h=`${c}(popup-state):`,p=new BroadcastChannel(`${c}(synchronization-channel)`);class f extends a.OAuthClient{static async load({clientId:e,...t}){if(e.startsWith("http:"))return new f({clientMetadata:(0,s.atprotoLoopbackClientMetadata)(e),...t});if(e.startsWith("https:"))return(0,s.assertOAuthDiscoverableClientId)(e),new f({clientMetadata:await a.OAuthClient.fetchMetadata({clientId:e,...t}),...t});throw TypeError(`Invalid client id: ${e}`)}constructor({clientMetadata:e=(0,s.atprotoLoopbackClientMetadata)((0,l.buildLoopbackClientId)(window.location)),responseMode:t="fragment",...r}){if(!globalThis.crypto?.subtle)throw Error("WebCrypto API is required");if(!["query","fragment"].includes(t))throw TypeError(`Invalid response mode: ${t}`);let a=new n.BrowserOAuthDatabase;super({...r,clientMetadata:e,responseMode:t,keyset:void 0,runtimeImplementation:new o.BrowserRuntimeImplementation,sessionStore:a.getSessionStore(),stateStore:a.getStateStore(),didCache:a.getDidCache(),handleCache:a.getHandleCache(),dpopNonceCache:a.getDpopNonceCache(),authorizationServerMetadataCache:a.getAuthorizationServerMetadataCache(),protectedResourceMetadataCache:a.getProtectedResourceMetadataCache()}),Object.defineProperty(this,i,{enumerable:!0,configurable:!0,writable:!0,value:void 0});let d=new AbortController,{signal:u}=d;for(let e of(this[Symbol.dispose]=()=>d.abort(),u.addEventListener("abort",()=>a[Symbol.asyncDispose](),{once:!0}),this.addEventListener("deleted",({detail:{sub:e}})=>{localStorage.getItem(`${c}(sub)`)===e&&localStorage.removeItem(`${c}(sub)`)}),["deleted","updated"]))this.sessionGetter.addEventListener(e,({detail:t})=>{p.postMessage([e,t])});p.addEventListener("message",e=>{if(e.source!==window){let[t,r]=e.data;this.dispatchCustomEvent(t,r)}},{signal:u})}async init(e){await function(e){if(!(0,s.isOAuthClientIdLoopback)(e.client_id)||"localhost"!==window.location.hostname)return;let t=new URL(window.location.href);for(let r of e.redirect_uris){let e=new URL(r);if(("127.0.0.1"===e.hostname||"[::1]"===e.hostname)&&(!e.port||e.port===t.port)&&e.protocol===t.protocol&&e.pathname===t.pathname)throw e.port=t.port,window.location.href=e.href,Error("Redirecting to loopback IP...")}throw Error(`Please use the loopback IP address instead of ${t}`)}(this.clientMetadata);let t=await this.signInCallback();if(t)return localStorage.setItem(`${c}(sub)`,t.session.sub),t;let r=localStorage.getItem(`${c}(sub)`);if(r)try{return{session:await this.restore(r,e)}}catch(e){throw localStorage.removeItem(`${c}(sub)`),e}}async restore(e,t){let r=await super.restore(e,t);return localStorage.setItem(`${c}(sub)`,r.sub),r}async revoke(e){return localStorage.removeItem(`${c}(sub)`),super.revoke(e)}async signIn(e,t){return t?.display==="popup"?this.signInPopup(e,t):this.signInRedirect(e,t)}async signInRedirect(e,t){let r=await this.authorize(e,t);return window.location.href=r.href,new Promise((e,t)=>{setTimeout(e=>{this.abortRequest(r).then(()=>t(e),r=>t(AggregateError([e,r])))},5e3,Error("User navigated back"))})}async signInPopup(e,t){let r="width=600,height=600,menubar=no,toolbar=no",i=window.open("about:blank","_blank",r),s=`${Math.random().toString(36).slice(2)}`,n=await this.authorize(e,{...t,state:`${h}${s}`,display:t?.display??"popup"});return t?.signal?.throwIfAborted(),i?i.window.location.href=n.href:i=window.open(n.href,"_blank",r),i?.focus(),new Promise((e,r)=>{let n=new BroadcastChannel(u),o=()=>{clearTimeout(l),n.removeEventListener("message",c),n.close(),t?.signal?.removeEventListener("abort",d),i?.close()},d=()=>{r(Error(t?.signal?.aborted?"Aborted":"Timeout")),o()};t?.signal?.addEventListener("abort",d);let l=setTimeout(d,3e5),c=async({data:i})=>{if(i.key!==s||!("result"in i))return;n.postMessage({key:s,ack:!0}),o();let{result:d}=i;if("fulfilled"===d.status){let i=d.value;try{t?.signal?.throwIfAborted(),e(await this.restore(i,!1))}catch(e){r(e),this.revoke(i)}}else{let{message:e,params:t}=d.reason;r(new a.OAuthCallbackError(new URLSearchParams(t),e))}};n.addEventListener("message",c)})}readCallbackParams(){let e=new URLSearchParams("fragment"===this.responseMode?location.hash.slice(1):location.search);return e.has("state")&&(e.has("code")||e.has("error"))&&this.clientMetadata.redirect_uris.map(e=>new URL(e)).some(e=>location.origin===e.origin&&location.pathname===e.pathname)?e:null}async signInCallback(){let e=this.readCallbackParams();if(!e)return null;"fragment"===this.responseMode?history.replaceState(null,"",location.pathname+location.search):"query"===this.responseMode&&history.replaceState(null,"",location.pathname);let t=e=>{let t=new BroadcastChannel(u);return new Promise(r=>{let i=e=>{clearTimeout(s),t.removeEventListener("message",a),t.close(),r(e)},a=({data:t})=>{"ack"in t&&e.key===t.key&&i(!0)};t.addEventListener("message",a),t.postMessage(e);let s=setTimeout(i,500,!1)})};return this.callback(e).then(async e=>{if(e.state?.startsWith(h))throw await t({key:e.state.slice(h.length),result:{status:"fulfilled",value:e.session.sub}})||await e.session.signOut(),new d.LoginContinuedInParentWindowError;return e}).catch(async e=>{if(e instanceof a.OAuthCallbackError&&e.state?.startsWith(h))throw await t({key:e.state.slice(h.length),result:{status:"rejected",reason:{message:e.message,params:Array.from(e.params.entries())}}}),new d.LoginContinuedInParentWindowError;throw e}).catch(e=>{throw e instanceof d.LoginContinuedInParentWindowError&&window.close(),e})}dispose(){this[Symbol.dispose]()}}t.BrowserOAuthClient=f,i=Symbol.dispose},605:function(e,t,r){"use strict";var i,a,s=this&&this.__classPrivateFieldSet||function(e,t,r,i,a){if("m"===i)throw TypeError("Private method is not writable");if("a"===i&&!a)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?a.call(e,r):a?a.value=r:t.set(e,r),r},n=this&&this.__classPrivateFieldGet||function(e,t,r,i){if("a"===r&&!i)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?i:"a"===r?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserOAuthDatabase=void 0;let o=r(6784),d=r(259);function l(e){if(!(e instanceof o.WebcryptoKey)||!e.kid)throw Error("Invalid key object");return{keyId:e.kid,keyPair:e.cryptoKeyPair}}async function c(e){return o.WebcryptoKey.fromKeypair(e.keyPair,e.keyId)}let u=["state","session","didCache","dpopNonceCache","handleCache","authorizationServerMetadataCache","protectedResourceMetadataCache"];class h{constructor(e){i.set(this,void 0),a.set(this,void 0),s(this,i,d.DB.open(e?.name??"@atproto-oauth-client",[e=>{for(let t of u)e.createObjectStore(t,{autoIncrement:!0}).createIndex("expiresAt","expiresAt",{unique:!1})}],{durability:e?.durability??"strict"}),"f"),s(this,a,setInterval(()=>{this.cleanup()},e?.cleanupInterval??3e4),"f")}async run(e,t,r){let a=await n(this,i,"f");return await a.transaction([e],t,t=>r(t.objectStore(e)))}createStore(e,{encode:t,decode:r,expiresAt:i}){return{get:async t=>{let i=await this.run(e,"readonly",e=>e.get(t));if(void 0!==i){if(null!=i.expiresAt&&new Date(i.expiresAt)<new Date){await this.run(e,"readwrite",e=>e.delete(t));return}return r(i.value)}},set:async(r,a)=>{let s={value:await t(a),expiresAt:i(a)?.toISOString()};await this.run(e,"readwrite",e=>e.put(s,r))},del:async t=>{await this.run(e,"readwrite",e=>e.delete(t))}}}getSessionStore(){return this.createStore("session",{expiresAt:({tokenSet:e})=>e.refresh_token||null==e.expires_at?null:new Date(e.expires_at),encode:({dpopKey:e,...t})=>({...t,dpopKey:l(e)}),decode:async({dpopKey:e,...t})=>({...t,dpopKey:await c(e)})})}getStateStore(){return this.createStore("state",{expiresAt:e=>new Date(Date.now()+6e5),encode:({dpopKey:e,...t})=>({...t,dpopKey:l(e)}),decode:async({dpopKey:e,...t})=>({...t,dpopKey:await c(e)})})}getDpopNonceCache(){return this.createStore("dpopNonceCache",{expiresAt:e=>new Date(Date.now()+6e5),encode:e=>e,decode:e=>e})}getDidCache(){return this.createStore("didCache",{expiresAt:e=>new Date(Date.now()+6e4),encode:e=>e,decode:e=>e})}getHandleCache(){return this.createStore("handleCache",{expiresAt:e=>new Date(Date.now()+6e4),encode:e=>e,decode:e=>e})}getAuthorizationServerMetadataCache(){return this.createStore("authorizationServerMetadataCache",{expiresAt:e=>new Date(Date.now()+6e4),encode:e=>e,decode:e=>e})}getProtectedResourceMetadataCache(){return this.createStore("protectedResourceMetadataCache",{expiresAt:e=>new Date(Date.now()+6e4),encode:e=>e,decode:e=>e})}async cleanup(){let e=await n(this,i,"f");for(let t of u)await e.transaction([t],"readwrite",e=>e.objectStore(t).index("expiresAt").deleteAll(IDBKeyRange.upperBound(Date.now())))}async [(i=new WeakMap,a=new WeakMap,Symbol.asyncDispose)](){clearInterval(n(this,a,"f")),s(this,a,void 0,"f");let e=n(this,i,"f");s(this,i,Promise.reject(Error("Database has been disposed")),"f"),n(this,i,"f").catch(()=>null);let t=await e.catch(()=>null);t&&await (t[Symbol.asyncDispose]||t[Symbol.dispose]).call(t)}}t.BrowserOAuthDatabase=h},3681:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserRuntimeImplementation=void 0;let i=r(6784),a=navigator.locks?.request?(e,t)=>navigator.locks.request(e,{mode:"exclusive"},async()=>t()):void 0;class s{constructor(){if(Object.defineProperty(this,"requestLock",{enumerable:!0,configurable:!0,writable:!0,value:a}),"object"!=typeof crypto||!crypto?.subtle)throw Error("Crypto with CryptoSubtle is required. If running in a browser, make sure the current page is loaded over HTTPS.");this.requestLock||console.warn("Locks API not available. You should consider using a more recent browser.")}async createKey(e){return i.WebcryptoKey.generate(e)}getRandomValues(e){return crypto.getRandomValues(new Uint8Array(e))}async digest(e,{name:t}){switch(t){case"sha256":case"sha384":case"sha512":return new Uint8Array(await crypto.subtle.digest(`SHA-${t.slice(3)}`,e));default:throw Error(`Unsupported digest algorithm: ${t}`)}}}t.BrowserRuntimeImplementation=s},9416:function(){"use strict";Symbol.dispose??(Symbol.dispose=Symbol("@@dispose")),Symbol.asyncDispose??(Symbol.asyncDispose=Symbol("@@asyncDispose"))},4062:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoginContinuedInParentWindowError=void 0;class r extends Error{constructor(){super("Login complete, please close the popup window."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:"LOGIN_CONTINUED_IN_PARENT_WINDOW"})}}t.LoginContinuedInParentWindowError=r},6297:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,a)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.buildLoopbackClientId=void 0,r(9416),a(r(6784),t),a(r(2495),t),a(r(6948),t),a(r(4062),t);var s=r(5766);Object.defineProperty(t,"buildLoopbackClientId",{enumerable:!0,get:function(){return s.buildLoopbackClientId}})},2414:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DBIndex=void 0;let i=r(9761);class a{constructor(e){Object.defineProperty(this,"idbIndex",{enumerable:!0,configurable:!0,writable:!0,value:e})}count(e){return(0,i.promisify)(this.idbIndex.count(e))}get(e){return(0,i.promisify)(this.idbIndex.get(e))}getKey(e){return(0,i.promisify)(this.idbIndex.getKey(e))}getAll(e,t){return(0,i.promisify)(this.idbIndex.getAll(e,t))}getAllKeys(e,t){return(0,i.promisify)(this.idbIndex.getAllKeys(e,t))}deleteAll(e){return new Promise((t,r)=>{let i=this.idbIndex.openCursor(e);i.onsuccess=function(e){let r=e.target.result;r?(r.delete(),r.continue()):t()},i.onerror=function(e){r(e.target?.error||Error("Unexpected error"))}})}}t.DBIndex=a},1292:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DBObjectStore=void 0;let i=r(2414),a=r(9761);class s{constructor(e){Object.defineProperty(this,"idbObjStore",{enumerable:!0,configurable:!0,writable:!0,value:e})}get name(){return this.idbObjStore.name}index(e){return new i.DBIndex(this.idbObjStore.index(e))}get(e){return(0,a.promisify)(this.idbObjStore.get(e))}getKey(e){return(0,a.promisify)(this.idbObjStore.getKey(e))}getAll(e,t){return(0,a.promisify)(this.idbObjStore.getAll(e,t))}getAllKeys(e,t){return(0,a.promisify)(this.idbObjStore.getAllKeys(e,t))}add(e,t){return(0,a.promisify)(this.idbObjStore.add(e,t))}put(e,t){return(0,a.promisify)(this.idbObjStore.put(e,t))}delete(e){return(0,a.promisify)(this.idbObjStore.delete(e))}clear(){return(0,a.promisify)(this.idbObjStore.clear())}}t.DBObjectStore=s},2703:function(e,t,r){"use strict";var i,a=this&&this.__classPrivateFieldSet||function(e,t,r,i,a){if("m"===i)throw TypeError("Private method is not writable");if("a"===i&&!a)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?a.call(e,r):a?a.value=r:t.set(e,r),r},s=this&&this.__classPrivateFieldGet||function(e,t,r,i){if("a"===r&&!i)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?i:"a"===r?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.DBTransaction=void 0;let n=r(1292);class o{constructor(e){i.set(this,void 0),a(this,i,e,"f");let t=()=>{s()},r=()=>{s()},s=()=>{a(this,i,null,"f"),e.removeEventListener("abort",t),e.removeEventListener("complete",r)};e.addEventListener("abort",t),e.addEventListener("complete",r)}get tx(){if(!s(this,i,"f"))throw Error("Transaction already ended");return s(this,i,"f")}async abort(){let{tx:e}=this;a(this,i,null,"f"),e.abort()}async commit(){let{tx:e}=this;a(this,i,null,"f"),e.commit?.()}objectStore(e){let t=this.tx.objectStore(e);return new n.DBObjectStore(t)}[(i=new WeakMap,Symbol.dispose)](){s(this,i,"f")&&this.commit()}}t.DBTransaction=o},8810:function(e,t,r){"use strict";var i,a=this&&this.__classPrivateFieldSet||function(e,t,r,i,a){if("m"===i)throw TypeError("Private method is not writable");if("a"===i&&!a)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?a.call(e,r):a?a.value=r:t.set(e,r),r},s=this&&this.__classPrivateFieldGet||function(e,t,r,i){if("a"===r&&!i)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?i:"a"===r?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.DB=void 0;let n=r(2703);class o{static async open(e,t,r){return new o(await new Promise((r,i)=>{let a=indexedDB.open(e,t.length);a.onerror=()=>i(a.error),a.onsuccess=()=>r(a.result),a.onupgradeneeded=({oldVersion:e,newVersion:r})=>{let s=a.result;try{for(let i=e;i<(r??t.length);++i){let e=t[i];if(e)e(s);else throw Error(`Missing migration for version ${i}`)}}catch(e){s.close(),i(e)}}}),r)}constructor(e,t){Object.defineProperty(this,"txOptions",{enumerable:!0,configurable:!0,writable:!0,value:t}),i.set(this,void 0),a(this,i,e,"f");let r=()=>{a(this,i,null,"f"),e.removeEventListener("versionchange",r),e.removeEventListener("close",r),e.close()};e.addEventListener("versionchange",r),e.addEventListener("close",r)}get db(){if(!s(this,i,"f"))throw Error("Database closed");return s(this,i,"f")}get name(){return this.db.name}get objectStoreNames(){return this.db.objectStoreNames}get version(){return this.db.version}async transaction(e,t,r){return new Promise(async(i,a)=>{try{let s=this.db.transaction(e,t,this.txOptions),o={done:!1};s.oncomplete=()=>{o.done?i(o.value):a(Error("Transaction completed without result"))},s.onerror=()=>a(s.error),s.onabort=()=>a(s.error||Error("Transaction aborted"));try{let e=await r(new n.DBTransaction(s));o={done:!0,value:e},s.commit()}catch(e){throw s.abort(),e}}catch(e){a(e)}})}close(){let{db:e}=this;a(this,i,null,"f"),e.close()}[(i=new WeakMap,Symbol.dispose)](){if(s(this,i,"f"))return this.close()}}t.DB=o},259:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,a)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),r(9416),a(r(8810),t),a(r(2414),t),a(r(1292),t),a(r(2703),t)},9761:function(e,t){"use strict";function r(e,t,r){let i=()=>{e.removeEventListener("success",a),e.removeEventListener("error",s)},a=()=>{t(e.result),i()},s=()=>{r(e.error||Error("Unknown error")),i()};e.addEventListener("success",a),e.addEventListener("error",s)}Object.defineProperty(t,"__esModule",{value:!0}),t.handleRequest=r,t.promisify=function(e){return new Promise((t,i)=>{r(e,t,i)})}},5766:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildLoopbackClientId=function(e,t="127.0.0.1"){if(!(0,i.isLoopbackHost)(e.hostname))throw TypeError(`Expected a loopback host, got ${e.hostname}`);let r=`http://${"localhost"===e.hostname?t:e.hostname}${e.port&&!e.port.startsWith(":")?`:${e.port}`:e.port}${e.pathname}`;return`http://localhost${"/"===e.pathname?"":e.pathname}?redirect_uri=${encodeURIComponent(r)}`};let i=r(3377)},6238:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.atprotoTokenResponseSchema=t.atprotoScopeSchema=t.isAtprotoScope=void 0;let i=r(4747),a=r(4146),s=r(3377),n=r(6815);t.isAtprotoScope=e=>(0,n.includesSpaceSeparatedValue)(e,"atproto"),t.atprotoScopeSchema=i.z.string().refine(t.isAtprotoScope,'The "atproto" scope is required'),t.atprotoTokenResponseSchema=s.oauthTokenResponseSchema.extend({token_type:i.z.literal("DPoP"),sub:a.atprotoDidSchema,scope:t.atprotoScopeSchema,id_token:i.z.never().optional()})},2091:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FALLBACK_ALG=void 0,t.FALLBACK_ALG="ES256"},3871:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenInvalidError=void 0;class r extends Error{constructor(e,t=`The session for "${e}" is invalid`,r){super(t,r),Object.defineProperty(this,"sub",{enumerable:!0,configurable:!0,writable:!0,value:e})}}t.TokenInvalidError=r},5054:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenRefreshError=void 0;class r extends Error{constructor(e,t,r){super(t,r),Object.defineProperty(this,"sub",{enumerable:!0,configurable:!0,writable:!0,value:e})}}t.TokenRefreshError=r},6861:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenRevokedError=void 0;class r extends Error{constructor(e,t=`The session for "${e}" was successfully revoked`,r){super(t,r),Object.defineProperty(this,"sub",{enumerable:!0,configurable:!0,writable:!0,value:e})}}t.TokenRevokedError=r},5121:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dpopFetchWrapper=function({key:e,iss:t,supportedAlgs:r,nonces:i,sha256:c=void 0!==s?l:void 0,isAuthServer:u,fetch:h=globalThis.fetch}){if(!c)throw TypeError("crypto.subtle is not available in this environment. Please provide a sha256 function.");let p=function(e,t){if(t){let r=t.find(t=>e.algorithms.includes(t));if(r)return r}else{let[t]=e.algorithms;if(t)return t}throw Error("Key does not match any alg supported by the server")}(e,r);return async function(r,s){let l;if(!e.algorithms.includes(p))throw TypeError(`Key does not support the algorithm ${p}`);let f=null==s&&r instanceof Request?r:new Request(r,s),y=f.headers.get("Authorization"),m=y?.startsWith("DPoP ")?await c(y.slice(5)):void 0,{method:g,url:w}=f,{origin:v}=new URL(w);try{l=await i.get(v)}catch{}let b=await o(e,p,t,g,w,l,m);f.headers.set("DPoP",b);let _=await h.call(this,f),S=_.headers.get("DPoP-Nonce");if(!S||S===l)return _;try{await i.set(v,S)}catch{}if(!await d(_,u)||r===f||n&&s?.body instanceof n)return _;await (0,a.cancelBody)(_,"log");let E=await o(e,p,t,g,w,S,m),k=new Request(r,s);return k.headers.set("DPoP",E),h.call(this,k)}};let i=r(4825),a=r(162),s=globalThis.crypto?.subtle,n=globalThis.ReadableStream;async function o(e,t,r,i,a,s,n){if(!e.bareJwk)throw Error("Only asymmetric keys can be used as DPoP proofs");let o=Math.floor(Date.now()/1e3);return e.createJwt({alg:t,typ:"dpop+jwt",jwk:e.bareJwk},{iss:r,iat:o,jti:Math.random().toString(36).slice(2),htm:i,htu:a,nonce:s,ath:n})}async function d(e,t){if((void 0===t||!1===t)&&401===e.status){let t=e.headers.get("WWW-Authenticate");if(t?.startsWith("DPoP"))return t.includes('error="use_dpop_nonce"')}if((void 0===t||!0===t)&&400===e.status)try{let t=await (0,a.peekJson)(e,10240);return"object"==typeof t&&t?.error==="use_dpop_nonce"}catch{}return!1}async function l(e){if(null==s)throw Error("crypto.subtle is not available in this environment. Please provide a sha256 function.");let t=new TextEncoder().encode(e),r=new Uint8Array(await s.digest("SHA-256",t));return i.base64url.baseEncode(r)}},2495:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,a)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.FetchResponseError=t.FetchRequestError=t.FetchError=void 0,a(r(5561),t);var s=r(162);Object.defineProperty(t,"FetchError",{enumerable:!0,get:function(){return s.FetchError}}),Object.defineProperty(t,"FetchRequestError",{enumerable:!0,get:function(){return s.FetchRequestError}}),Object.defineProperty(t,"FetchResponseError",{enumerable:!0,get:function(){return s.FetchResponseError}}),a(r(7015),t),a(r(4146),t),a(r(3377),t),a(r(6797),t),a(r(6185),t),a(r(3903),t),a(r(2744),t),a(r(966),t),a(r(6189),t),a(r(7751),t),a(r(4605),t),a(r(4222),t),a(r(8576),t),a(r(6336),t),a(r(5485),t),a(r(2972),t),a(r(3871),t),a(r(5054),t),a(r(6861),t)},4129:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.requestLocalLock=void 0;let r=new Map;t.requestLocalLock=(e,t)=>new Promise(t=>{let i=(r.get(e)??Promise.resolve()).then(()=>new Promise(a=>{t(()=>{r.get(e)===i&&r.delete(e),a()})}));r.set(e,i)}).then(async e=>{try{return await t()}finally{e()}})},6797:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthAuthorizationServerMetadataResolver=void 0;let i=r(3377),a=r(162),s=r(6228),n=r(6815);class o extends s.CachedGetter{constructor(e,t,r){super(async(e,t)=>this.fetchMetadata(e,t),e),Object.defineProperty(this,"fetch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"allowHttpIssuer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.fetch=(0,a.bindFetch)(t),this.allowHttpIssuer=r?.allowHttpIssuer===!0}async get(e,t){let r=i.oauthIssuerIdentifierSchema.parse(e);if(!this.allowHttpIssuer&&r.startsWith("http:"))throw TypeError("Unsecure issuer URL protocol only allowed in development and test environments");return super.get(r,t)}async fetchMetadata(e,t){let r=new URL("/.well-known/oauth-authorization-server",e),s=new Request(r,{headers:{accept:"application/json"},cache:t?.noCache?"no-cache":void 0,signal:t?.signal,redirect:"manual"}),o=await this.fetch(s);if(200!==o.status)throw await (0,a.cancelBody)(o,"log"),await a.FetchResponseError.from(o,`Unexpected status code ${o.status} for "${r}"`,void 0,{cause:s});if("application/json"!==(0,n.contentMime)(o.headers))throw await (0,a.cancelBody)(o,"log"),await a.FetchResponseError.from(o,`Unexpected content type for "${r}"`,void 0,{cause:s});let d=i.oauthAuthorizationServerMetadataValidator.parse(await o.json());if(d.issuer!==e)throw TypeError(`Invalid issuer ${d.issuer}`);if(!0!==d.client_id_metadata_document_supported)throw TypeError(`Authorization server "${e}" does not support client_id_metadata_document`);return d}}t.OAuthAuthorizationServerMetadataResolver=o},6185:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthCallbackError=void 0;class r extends Error{static from(e,t,i){return e instanceof r?e:new r(t,e instanceof Error?e.message:void 0,i,e)}constructor(e,t=e.get("error_description")||"OAuth callback error",r,i){super(t,{cause:i}),Object.defineProperty(this,"params",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:r})}}t.OAuthCallbackError=r},3903:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthClient=void 0;let i=r(9538),a=r(3377),s=r(5561),n=r(7015),o=r(7196),d=r(9489),l=r(2091),c=r(6861),u=r(6797),h=r(6185),p=r(2744),f=r(1181),y=r(4605),m=r(4222),g=r(4546),w=r(6336),v=r(6815),b=r(7567);class _ extends v.CustomEventTarget{static async fetchMetadata({clientId:e,fetch:t=globalThis.fetch,signal:r}){r?.throwIfAborted();let i=new Request(e,{redirect:"error",signal:r}),s=await t(i);if(200!==s.status)throw s.body?.cancel?.(),TypeError(`Failed to fetch client metadata: ${s.status}`);let n=s.headers.get("content-type")?.split(";")[0].trim();if("application/json"!==n)throw s.body?.cancel?.(),TypeError(`Invalid client metadata content type: ${n}`);let o=await s.json();return r?.throwIfAborted(),a.oauthClientMetadataSchema.parse(o)}constructor({fetch:e=globalThis.fetch,allowHttp:t=!1,stateStore:r,sessionStore:a,didCache:l,dpopNonceCache:c=new d.SimpleStoreMemory({ttl:6e4,max:100}),handleCache:h,authorizationServerMetadataCache:m=new d.SimpleStoreMemory({ttl:6e4,max:100}),protectedResourceMetadataCache:v=new d.SimpleStoreMemory({ttl:6e4,max:100}),responseMode:_,clientMetadata:S,handleResolver:E,plcDirectoryUrl:k,runtimeImplementation:A,keyset:P}){for(let d of(super(),Object.defineProperty(this,"clientMetadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"responseMode",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyset",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runtime",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"oauthResolver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serverFactory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sessionGetter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stateStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyset=P?P instanceof i.Keyset?P:new i.Keyset(P):void 0,this.clientMetadata=(0,b.validateClientMetadata)(S,this.keyset),this.responseMode=_,this.runtime=new g.Runtime(A),this.fetch=e,this.oauthResolver=new f.OAuthResolver(new o.IdentityResolver(new s.DidResolverCached(new s.DidResolverCommon({fetch:e,plcDirectoryUrl:k,allowHttp:t}),l),new n.CachedHandleResolver(n.AppViewHandleResolver.from(E,{fetch:e}),h)),new p.OAuthProtectedResourceMetadataResolver(v,e,{allowHttpResource:t}),new u.OAuthAuthorizationServerMetadataResolver(m,e,{allowHttpIssuer:t})),this.serverFactory=new y.OAuthServerFactory(this.clientMetadata,this.runtime,this.oauthResolver,this.fetch,this.keyset,c),this.sessionGetter=new w.SessionGetter(a,this.serverFactory,this.runtime),this.stateStore=r,["deleted","updated"]))this.sessionGetter.addEventListener(d,e=>{this.dispatchCustomEvent(d,e.detail)||e.preventDefault()})}get identityResolver(){return this.oauthResolver.identityResolver}get didResolver(){return this.identityResolver.didResolver}get handleResolver(){return this.identityResolver.handleResolver}get jwks(){return this.keyset?.publicJwks??{keys:[]}}async authorize(e,{signal:t,...r}={}){let i=r?.redirect_uri??this.clientMetadata.redirect_uris[0];if(!this.clientMetadata.redirect_uris.includes(i))throw TypeError("Invalid redirect_uri");let{identity:a,metadata:s}=await this.oauthResolver.resolve(e,{signal:t}),n=await this.runtime.generatePKCE(),o=await this.runtime.generateKey(s.dpop_signing_alg_values_supported||[l.FALLBACK_ALG]),d=await this.runtime.generateNonce();await this.stateStore.set(d,{iss:s.issuer,dpopKey:o,verifier:n.verifier,appState:r?.state});let c={...r,client_id:this.clientMetadata.client_id,redirect_uri:i,code_challenge:n.challenge,code_challenge_method:n.method,state:d,login_hint:a?e:void 0,response_mode:this.responseMode,response_type:"code",scope:r?.scope??this.clientMetadata.scope},u=new URL(s.authorization_endpoint);if("https:"!==u.protocol&&"http:"!==u.protocol)throw TypeError(`Invalid authorization endpoint protocol: ${u.protocol}`);if(s.pushed_authorization_request_endpoint){let e=await this.serverFactory.fromMetadata(s,o),t=await e.request("pushed_authorization_request",c);return u.searchParams.set("client_id",this.clientMetadata.client_id),u.searchParams.set("request_uri",t.request_uri),u}if(s.require_pushed_authorization_requests)throw Error("Server requires pushed authorization requests (PAR) but no PAR endpoint is available");for(let[e,t]of Object.entries(c))t&&u.searchParams.set(e,String(t));if(u.pathname.length+u.search.length<2048)return u;if(!s.pushed_authorization_request_endpoint)throw Error("Login URL too long");throw Error("Server does not support pushed authorization requests (PAR)")}async abortRequest(e){if(!e.searchParams.get("request_uri"))return}async callback(e){if(null!=e.get("response"))throw new h.OAuthCallbackError(e,"JARM not supported");let t=e.get("iss"),r=e.get("state"),i=e.get("error"),a=e.get("code");if(!r)throw new h.OAuthCallbackError(e,'Missing "state" parameter');let s=await this.stateStore.get(r);if(s)await this.stateStore.del(r);else throw new h.OAuthCallbackError(e,`Unknown authorization session "${r}"`);try{if(null!=i)throw new h.OAuthCallbackError(e,void 0,s.appState);if(!a)throw new h.OAuthCallbackError(e,'Missing "code" query param',s.appState);let r=await this.serverFactory.fromIssuer(s.iss,s.dpopKey);if(null!=t){if(!r.issuer)throw new h.OAuthCallbackError(e,"Issuer not found in metadata",s.appState);if(r.issuer!==t)throw new h.OAuthCallbackError(e,"Issuer mismatch",s.appState)}else if(r.serverMetadata.authorization_response_iss_parameter_supported)throw new h.OAuthCallbackError(e,"iss missing from the response",s.appState);let n=await r.exchangeCode(a,s.verifier);try{return await this.sessionGetter.setStored(n.sub,{dpopKey:s.dpopKey,tokenSet:n}),{session:this.createSession(r,n.sub),state:s.appState??null}}catch(e){throw await r.revoke(n.refresh_token||n.access_token),e}}catch(t){throw h.OAuthCallbackError.from(t,e,s.appState)}}async restore(e,t="auto"){(0,s.assertAtprotoDid)(e);let{dpopKey:r,tokenSet:i}=await this.sessionGetter.get(e,{noCache:!0===t,allowStale:!1===t}),a=await this.serverFactory.fromIssuer(i.iss,r,{noCache:!0===t,allowStale:!1===t});return this.createSession(a,e)}async revoke(e){(0,s.assertAtprotoDid)(e);let{dpopKey:t,tokenSet:r}=await this.sessionGetter.get(e,{allowStale:!0});try{let e=await this.serverFactory.fromIssuer(r.iss,t);await e.revoke(r.access_token)}finally{await this.sessionGetter.delStored(e,new c.TokenRevokedError(e))}}createSession(e,t){return new m.OAuthSession(e,t,this.sessionGetter,this.fetch)}}t.OAuthClient=_},2744:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthProtectedResourceMetadataResolver=void 0;let i=r(3377),a=r(162),s=r(6228),n=r(6815);class o extends s.CachedGetter{constructor(e,t=globalThis.fetch,r){super(async(e,t)=>this.fetchMetadata(e,t),e),Object.defineProperty(this,"fetch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"allowHttpResource",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.fetch=(0,a.bindFetch)(t),this.allowHttpResource=r?.allowHttpResource===!0}async get(e,t){let{protocol:r,origin:i}=new URL(e);if("https:"!==r&&"http:"!==r)throw TypeError(`Invalid protected resource metadata URL protocol: ${r}`);if("http:"===r&&!this.allowHttpResource)throw TypeError(`Unsecure resource metadata URL (${r}) only allowed in development and test environments`);return super.get(i,t)}async fetchMetadata(e,t){let r=new URL("/.well-known/oauth-protected-resource",e),s=new Request(r,{signal:t?.signal,headers:{accept:"application/json"},cache:t?.noCache?"no-cache":void 0,redirect:"manual"}),o=await this.fetch(s);if(200!==o.status)throw await (0,a.cancelBody)(o,"log"),await a.FetchResponseError.from(o,`Unexpected status code ${o.status} for "${r}"`,void 0,{cause:s});if("application/json"!==(0,n.contentMime)(o.headers))throw await (0,a.cancelBody)(o,"log"),await a.FetchResponseError.from(o,`Unexpected content type for "${r}"`,void 0,{cause:s});let d=i.oauthProtectedResourceMetadataSchema.parse(await o.json());if(d.resource!==e)throw TypeError(`Invalid issuer ${d.resource}`);return d}}t.OAuthProtectedResourceMetadataResolver=o},966:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthResolverError=void 0;let i=r(4747);class a extends Error{constructor(e,t){super(e,t)}static from(e,t){if(e instanceof a)return e;let r=e instanceof i.ZodError?`${e.errors[0].path} ${e.errors[0].message}`:null;return new a((t??"Unable to resolve identity")+(r?` (${r})`:""),{cause:e})}}t.OAuthResolverError=a},1181:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthResolver=void 0;let i=r(3377),a=r(966);class s{constructor(e,t,r){Object.defineProperty(this,"identityResolver",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"protectedResourceMetadataResolver",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"authorizationServerMetadataResolver",{enumerable:!0,configurable:!0,writable:!0,value:r})}async resolve(e,t){return/^https?:\/\//.test(e)?this.resolveFromService(e,t):this.resolveFromIdentity(e,t)}async resolveFromService(e,t){try{return{metadata:await this.getResourceServerMetadata(e,t)}}catch(r){if(!t?.signal?.aborted&&r instanceof a.OAuthResolverError)try{let r=i.oauthIssuerIdentifierSchema.safeParse(e);if(r.success)return{metadata:await this.getAuthorizationServerMetadata(r.data,t)}}catch{}throw r}}async resolveFromIdentity(e,t){let r=await this.resolveIdentity(e,t);t?.signal?.throwIfAborted();let i=await this.getResourceServerMetadata(r.pds,t);return{identity:r,metadata:i}}async resolveIdentity(e,t){try{return await this.identityResolver.resolve(e,t)}catch(t){throw a.OAuthResolverError.from(t,`Failed to resolve identity: ${e}`)}}async getAuthorizationServerMetadata(e,t){try{return await this.authorizationServerMetadataResolver.get(e,t)}catch(t){throw a.OAuthResolverError.from(t,`Failed to resolve OAuth server metadata for issuer: ${e}`)}}async getResourceServerMetadata(e,t){try{let r=await this.protectedResourceMetadataResolver.get(e,t);if(r.authorization_servers?.length!==1)throw new a.OAuthResolverError(r.authorization_servers?.length?`Unable to determine authorization server for PDS: ${e}`:`No authorization servers found for PDS: ${e}`);let i=r.authorization_servers[0];t?.signal?.throwIfAborted();let s=await this.getAuthorizationServerMetadata(i,t);if(s.protected_resources&&!s.protected_resources.includes(r.resource))throw new a.OAuthResolverError(`PDS "${e}" not protected by issuer "${i}"`);return s}catch(t){throw a.OAuthResolverError.from(t,`Failed to resolve OAuth server metadata for resource: ${e}`)}}}t.OAuthResolver=s},6189:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthResponseError=void 0;let i=r(6815);class a extends Error{constructor(e,t){let r="object"==typeof t?t:void 0,a=(0,i.ifString)(r?.error),s=(0,i.ifString)(r?.error_description);super(`OAuth ${a?`"${a}"`:"unknown"} error${s?`: ${s}`:""}`),Object.defineProperty(this,"response",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"payload",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"errorDescription",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.error=a,this.errorDescription=s}get status(){return this.response.status}get headers(){return this.response.headers}}t.OAuthResponseError=a},7751:function(e,t,r){"use strict";var i,a=this&&this.__addDisposableResource||function(e,t,r){if(null!=t){var i,a;if("object"!=typeof t&&"function"!=typeof t)throw TypeError("Object expected.");if(r){if(!Symbol.asyncDispose)throw TypeError("Symbol.asyncDispose is not defined.");i=t[Symbol.asyncDispose]}if(void 0===i){if(!Symbol.dispose)throw TypeError("Symbol.dispose is not defined.");i=t[Symbol.dispose],r&&(a=i)}if("function"!=typeof i)throw TypeError("Object not disposable.");a&&(i=function(){try{a.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:i,async:r})}else r&&e.stack.push({async:!0});return t},s=this&&this.__disposeResources||(i="function"==typeof SuppressedError?SuppressedError:function(e,t,r){var i=Error(r);return i.name="SuppressedError",i.error=e,i.suppressed=t,i},function(e){function t(t){e.error=e.hasError?new i(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}var r,a=0;return function i(){for(;r=e.stack.pop();)try{if(!r.async&&1===a)return a=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var s=r.dispose.call(r.value);if(r.async)return a|=2,Promise.resolve(s).then(i,function(e){return t(e),i()})}else a|=1}catch(e){t(e)}if(1===a)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}()});Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthServerAgent=void 0;let n=r(3377),o=r(162),d=r(6238),l=r(2091),c=r(5054),u=r(5121),h=r(6189),p=r(6815);class f{constructor(e,t,r,i,a,s,n,d){Object.defineProperty(this,"dpopKey",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"serverMetadata",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"clientMetadata",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"dpopNonces",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"oauthResolver",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"runtime",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"keyset",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"dpopFetch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.dpopFetch=(0,u.dpopFetchWrapper)({fetch:(0,o.bindFetch)(d),iss:r.client_id,key:e,supportedAlgs:t.dpop_signing_alg_values_supported,sha256:async e=>s.sha256(e),nonces:i,isAuthServer:!0})}get issuer(){return this.serverMetadata.issuer}async revoke(e){try{await this.request("revocation",{token:e})}catch{}}async exchangeCode(e,t){let r=Date.now(),i=await this.request("token",{grant_type:"authorization_code",redirect_uri:this.clientMetadata.redirect_uris[0],code:e,code_verifier:t});try{return{aud:await this.verifyIssuer(i.sub),sub:i.sub,iss:this.issuer,scope:i.scope,refresh_token:i.refresh_token,access_token:i.access_token,token_type:i.token_type,expires_at:"number"==typeof i.expires_in?new Date(r+1e3*i.expires_in).toISOString():void 0}}catch(e){throw await this.revoke(i.access_token),e}}async refresh(e){if(!e.refresh_token)throw new c.TokenRefreshError(e.sub,"No refresh token available");let t=await this.verifyIssuer(e.sub),r=Date.now(),i=await this.request("token",{grant_type:"refresh_token",refresh_token:e.refresh_token});return{aud:t,sub:e.sub,iss:this.issuer,scope:i.scope,refresh_token:i.refresh_token,access_token:i.access_token,token_type:i.token_type,expires_at:"number"==typeof i.expires_in?new Date(r+1e3*i.expires_in).toISOString():void 0}}async verifyIssuer(e){let t={stack:[],error:void 0,hasError:!1};try{let r=a(t,(0,p.timeoutSignal)(1e4),!1),i=await this.oauthResolver.resolveFromIdentity(e,{noCache:!0,allowStale:!1,signal:r});if(this.issuer!==i.metadata.issuer)throw TypeError("Issuer mismatch");return i.identity.pds.href}catch(e){t.error=e,t.hasError=!0}finally{s(t)}}async request(e,t){let r=this.serverMetadata[`${e}_endpoint`];if(!r)throw Error(`No ${e} endpoint available`);let i=await this.buildClientAuth(e),{response:a,json:s}=await this.dpopFetch(r,{method:"POST",headers:{...i.headers,"Content-Type":"application/json"},body:JSON.stringify({...t,...i.payload})}).then((0,o.fetchJsonProcessor)());if(a.ok)switch(e){case"token":return d.atprotoTokenResponseSchema.parse(s);case"pushed_authorization_request":return n.oauthParResponseSchema.parse(s);default:return s}else throw new h.OAuthResponseError(a,s)}async buildClientAuth(e){let t=this.serverMetadata.token_endpoint_auth_methods_supported,r=this.clientMetadata.token_endpoint_auth_method;if("private_key_jwt"===r||this.keyset&&!r&&t?.includes("private_key_jwt")){if(!this.keyset)throw Error("No keyset available");try{let e=this.serverMetadata.token_endpoint_auth_signing_alg_values_supported??l.FALLBACK_ALG,t=this.clientMetadata.jwks?.keys.map(({kid:e})=>e).filter(e=>"string"==typeof e);return{payload:{client_id:this.clientMetadata.client_id,client_assertion_type:n.CLIENT_ASSERTION_TYPE_JWT_BEARER,client_assertion:await this.keyset.createJwt({alg:e,kid:t},{iss:this.clientMetadata.client_id,sub:this.clientMetadata.client_id,aud:this.serverMetadata.issuer,jti:await this.runtime.generateNonce(),iat:Math.floor(Date.now()/1e3)})}}}catch(e){if("private_key_jwt"===r)throw e}}if("none"===r||!r&&(t?.includes("none")??!0))return{payload:{client_id:this.clientMetadata.client_id}};throw Error(`Unsupported ${e} authentication method`)}}t.OAuthServerAgent=f},4605:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthServerFactory=void 0;let i=r(7751);class a{constructor(e,t,r,i,a,s){Object.defineProperty(this,"clientMetadata",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"runtime",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"resolver",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"fetch",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"keyset",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"dpopNonceCache",{enumerable:!0,configurable:!0,writable:!0,value:s})}async fromIssuer(e,t,r){let i=await this.resolver.getAuthorizationServerMetadata(e,r);return this.fromMetadata(i,t)}async fromMetadata(e,t){return new i.OAuthServerAgent(t,e,this.clientMetadata,this.dpopNonceCache,this.resolver,this.runtime,this.keyset,this.fetch)}}t.OAuthServerFactory=a},4222:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthSession=void 0;let i=r(162),a=r(3871),s=r(6861),n=r(5121),o=globalThis.ReadableStream;class d{constructor(e,t,r,a=globalThis.fetch){Object.defineProperty(this,"server",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"sub",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"sessionGetter",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"dpopFetch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.dpopFetch=(0,n.dpopFetchWrapper)({fetch:(0,i.bindFetch)(a),iss:e.clientMetadata.client_id,key:e.dpopKey,supportedAlgs:e.serverMetadata.dpop_signing_alg_values_supported,sha256:async t=>e.runtime.sha256(t),nonces:e.dpopNonces,isAuthServer:!1})}get did(){return this.sub}get serverMetadata(){return this.server.serverMetadata}async getTokenSet(e){let{tokenSet:t}=await this.sessionGetter.get(this.sub,{noCache:!0===e,allowStale:!1===e});return t}async getTokenInfo(e="auto"){let t=await this.getTokenSet(e),r=null==t.expires_at?void 0:new Date(t.expires_at);return{expiresAt:r,get expired(){return null==r?void 0:r.getTime()<Date.now()-5e3},scope:t.scope,iss:t.iss,aud:t.aud,sub:t.sub}}async signOut(){try{let e=await this.getTokenSet(!1);await this.server.revoke(e.access_token)}finally{await this.sessionGetter.delStored(this.sub,new s.TokenRevokedError(this.sub))}}async fetchHandler(e,t){let r;let i=await this.getTokenSet("auto"),s=new URL(e,i.aud),n=`${i.token_type} ${i.access_token}`,d=new Headers(t?.headers);d.set("Authorization",n);let c=await this.dpopFetch(s,{...t,headers:d});if(!l(c))return c;try{r=await this.getTokenSet(!0)}catch(e){return c}if(o&&t?.body instanceof o)return c;let u=`${r.token_type} ${r.access_token}`,h=new URL(e,r.aud);d.set("Authorization",u);let p=await this.dpopFetch(h,{...t,headers:d});return l(p)&&await this.sessionGetter.delStored(this.sub,new a.TokenInvalidError(this.sub)),p}}function l(e){if(401!==e.status)return!1;let t=e.headers.get("WWW-Authenticate");return null!=t&&(t.startsWith("Bearer ")||t.startsWith("DPoP "))&&t.includes('error="invalid_token"')}t.OAuthSession=d},8576:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},4546:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Runtime=void 0;let i=r(4825),a=r(4129);class s{constructor(e){Object.defineProperty(this,"implementation",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"hasImplementationLock",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usingLock",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{requestLock:t}=e;this.hasImplementationLock=null!=t,this.usingLock=t?.bind(e)||a.requestLocalLock}async generateKey(e){let t=Array.from(e).sort(n);return this.implementation.createKey(t)}async sha256(e){let t=new TextEncoder().encode(e),r=await this.implementation.digest(t,{name:"sha256"});return i.base64url.baseEncode(r)}async generateNonce(e=16){let t=await this.implementation.getRandomValues(e);return i.base64url.baseEncode(t)}async generatePKCE(e){let t=await this.generateVerifier(e);return{verifier:t,challenge:await this.sha256(t),method:"S256"}}async calculateJwkThumbprint(e){let t=JSON.stringify(function(e){let t=t=>{let r=e[t];if("string"!=typeof r||!r)throw TypeError(`"${t}" Parameter missing or invalid`);return r};switch(e.kty){case"EC":return{crv:t("crv"),kty:t("kty"),x:t("x"),y:t("y")};case"OKP":return{crv:t("crv"),kty:t("kty"),x:t("x")};case"RSA":return{e:t("e"),kty:t("kty"),n:t("n")};case"oct":return{k:t("k"),kty:t("kty")};default:throw TypeError('"kty" (Key Type) Parameter missing or unsupported')}}(e));return this.sha256(t)}async generateVerifier(e=32){if(e<32||e>96)throw TypeError("Invalid code_verifier length");let t=await this.implementation.getRandomValues(e);return i.base64url.baseEncode(t)}}function n(e,t){if("ES256K"===e)return -1;if("ES256K"===t)return 1;for(let r of["ES","PS","RS"]){if(e.startsWith(r)){if(t.startsWith(r))return parseInt(e.slice(2,5))-parseInt(t.slice(2,5));return -1}if(t.startsWith(r))return 1}return 0}t.Runtime=s},6336:function(e,t,r){"use strict";var i,a=this&&this.__addDisposableResource||function(e,t,r){if(null!=t){var i,a;if("object"!=typeof t&&"function"!=typeof t)throw TypeError("Object expected.");if(r){if(!Symbol.asyncDispose)throw TypeError("Symbol.asyncDispose is not defined.");i=t[Symbol.asyncDispose]}if(void 0===i){if(!Symbol.dispose)throw TypeError("Symbol.dispose is not defined.");i=t[Symbol.dispose],r&&(a=i)}if("function"!=typeof i)throw TypeError("Object not disposable.");a&&(i=function(){try{a.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:i,async:r})}else r&&e.stack.push({async:!0});return t},s=this&&this.__disposeResources||(i="function"==typeof SuppressedError?SuppressedError:function(e,t,r){var i=Error(r);return i.name="SuppressedError",i.error=e,i.suppressed=t,i},function(e){function t(t){e.error=e.hasError?new i(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}var r,a=0;return function i(){for(;r=e.stack.pop();)try{if(!r.async&&1===a)return a=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var s=r.dispose.call(r.value);if(r.async)return a|=2,Promise.resolve(s).then(i,function(e){return t(e),i()})}else a|=1}catch(e){t(e)}if(1===a)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}()});Object.defineProperty(t,"__esModule",{value:!0}),t.SessionGetter=void 0;let n=r(6228),o=r(3871),d=r(5054),l=r(6861),c=r(6189),u=r(6815);class h extends n.CachedGetter{constructor(e,t,r){super(async(e,i,a)=>{if(void 0===a){let t=new d.TokenRefreshError(e,"The session was deleted by another process");throw this.dispatchEvent("deleted",{sub:e,cause:t}),t}let{dpopKey:s,tokenSet:n}=a;if(e!==n.sub)throw new d.TokenRefreshError(e,"Stored session sub mismatch");if(!n.refresh_token)throw new d.TokenRefreshError(e,"No refresh token available");let o=await t.fromIssuer(n.iss,s);i?.signal?.throwIfAborted();try{let t=await o.refresh(n);if(e!==t.sub)throw new d.TokenRefreshError(e,"Token set sub mismatch");return{dpopKey:s,tokenSet:t}}catch(t){if(t instanceof c.OAuthResponseError&&400===t.status&&"invalid_grant"===t.error){if(!r.hasImplementationLock){await new Promise(e=>setTimeout(e,1e3));let r=await this.getStored(e);if(void 0===r)throw new d.TokenRefreshError(e,"The session was deleted by another process",{cause:t});if(r.tokenSet.access_token!==n.access_token||r.tokenSet.refresh_token!==n.refresh_token)return r}let i=t.errorDescription??"The session was revoked";throw new d.TokenRefreshError(e,i,{cause:t})}throw t}},e,{isStale:(e,{tokenSet:t})=>null!=t.expires_at&&new Date(t.expires_at).getTime()<Date.now()+1e4+3e4*Math.random(),onStoreError:async(e,r,{tokenSet:i,dpopKey:a})=>{let s=await t.fromIssuer(i.iss,a);throw await s.revoke(i.refresh_token??i.access_token),e},deleteOnError:async e=>e instanceof d.TokenRefreshError||e instanceof l.TokenRevokedError||e instanceof o.TokenInvalidError}),Object.defineProperty(this,"runtime",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"eventTarget",{enumerable:!0,configurable:!0,writable:!0,value:new u.CustomEventTarget})}addEventListener(e,t,r){this.eventTarget.addEventListener(e,t,r)}removeEventListener(e,t,r){this.eventTarget.removeEventListener(e,t,r)}dispatchEvent(e,t){return this.eventTarget.dispatchCustomEvent(e,t)}async setStored(e,t){if(e!==t.tokenSet.sub)throw TypeError("Token set does not match the expected sub");await super.setStored(e,t),this.dispatchEvent("updated",{sub:e,...t})}async delStored(e,t){await super.delStored(e,t),this.dispatchEvent("deleted",{sub:e,cause:t})}async getSession(e,t){return this.get(e,{noCache:!0===t,allowStale:!1===t})}async get(e,t){let r=await this.runtime.usingLock(`@atproto-oauth-client-${e}`,async()=>{let r={stack:[],error:void 0,hasError:!1};try{let i=a(r,(0,u.timeoutSignal)(3e4,t),!1),s=a(r,(0,u.combineSignals)([t?.signal,i]),!1);return await super.get(e,{...t,signal:s.signal})}catch(e){r.error=e,r.hasError=!0}finally{s(r)}});if(e!==r.tokenSet.sub)throw Error("Token set does not match the expected sub");return r}}t.SessionGetter=h},5485:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},2972:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clientMetadataSchema=void 0;let i=r(4747),a=r(3377);t.clientMetadataSchema=a.oauthClientMetadataSchema.extend({client_id:i.z.union([a.oauthClientIdDiscoverableSchema,a.oauthClientIdLoopbackSchema])})},6815:function(e,t){"use strict";var r=this&&this.__classPrivateFieldSet||function(e,t,r,i,a){if("m"===i)throw TypeError("Private method is not writable");if("a"===i&&!a)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?a.call(e,r):a?a.value=r:t.set(e,r),r},i=this&&this.__classPrivateFieldGet||function(e,t,r,i){if("a"===r&&!i)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?i:"a"===r?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.includesSpaceSeparatedValue=t.CustomEventTarget=t.CustomEvent=t.timeoutSignal=t.ifString=void 0,t.contentMime=function(e){return e.get("content-type")?.split(";")[0].trim()},t.combineSignals=function(e){let t=new AbortController,r=function(e){let r=Error("This operation was aborted",{cause:this.reason});t.abort(r)};for(let i of e)if(i){if(i.aborted)throw t.abort(),Error("One of the signals is already aborted",{cause:i.reason});i.addEventListener("abort",r,{signal:t.signal})}return t[Symbol.dispose]=()=>{let e=Error("AbortController was disposed");t.abort(e)},t},Symbol.dispose??(Symbol.dispose=Symbol("@@dispose")),t.ifString=e=>"string"==typeof e?e:void 0,t.timeoutSignal=(e,t)=>{if(!Number.isInteger(e)||e<0)throw TypeError("Expected a positive integer");t?.signal?.throwIfAborted();let r=new AbortController,{signal:i}=r;t?.signal?.addEventListener("abort",e=>r.abort(e),{once:!0,signal:i});let a=setTimeout(e=>r.abort(e),e,Error("Timeout"));return a?.unref?.(),i.addEventListener("abort",()=>clearTimeout(a),{once:!0,signal:i}),Object.defineProperty(i,Symbol.dispose,{value:()=>r.abort()}),i},t.CustomEvent=globalThis.CustomEvent??(()=>{var e;class t extends Event{constructor(t,i){if(!arguments.length)throw TypeError("type argument is required");super(t,i),e.set(this,void 0),r(this,e,i?.detail??null,"f")}get detail(){return i(this,e,"f")}}return e=new WeakMap,Object.defineProperties(t.prototype,{[Symbol.toStringTag]:{writable:!1,enumerable:!1,configurable:!0,value:"CustomEvent"},detail:{enumerable:!0}}),t})();class a{constructor(){Object.defineProperty(this,"eventTarget",{enumerable:!0,configurable:!0,writable:!0,value:new EventTarget})}addEventListener(e,t,r){this.eventTarget.addEventListener(e,t,r)}removeEventListener(e,t,r){this.eventTarget.removeEventListener(e,t,r)}dispatchCustomEvent(e,r,i){return this.eventTarget.dispatchEvent(new t.CustomEvent(e,{...i,detail:r}))}}t.CustomEventTarget=a,t.includesSpaceSeparatedValue=(e,t)=>{let r;if(0===t.length)throw TypeError("Value cannot be empty");if(t.includes(" "))throw TypeError("Value cannot contain spaces");let i=e.length,a=t.length;if(i<a)return!1;let s=e.indexOf(t);for(;-1!==s;){if(r=s+a,(0===s||" "===e[s-1])&&(r===i||" "===e[r]))return!0;s=e.indexOf(t,r+1)}return!1}},7567:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateClientMetadata=function(e,t){if(e.jwks){if(!t)throw TypeError("Keyset must not be provided when jwks is provided");for(let r of e.jwks.keys)if(r.kid){if(!t.has(r.kid))throw TypeError(`Key with kid "${r.kid}" not found in keyset`)}else throw TypeError('Key must have a "kid" property')}!e.jwks&&!e.jwks_uri&&t?.size&&(e={...e,jwks:t.toJSON()});let r=a.clientMetadataSchema.parse(e);r.client_id.startsWith("http:")?(0,i.assertOAuthLoopbackClientId)(r.client_id):(0,i.assertOAuthDiscoverableClientId)(r.client_id);let o=r.scope?.split(" ");if(!o?.includes("atproto"))throw TypeError('Client metadata must include the "atproto" scope');if(!r.response_types.includes("code"))throw TypeError('"response_types" must include "code"');if(!r.grant_types.includes("authorization_code"))throw TypeError('"grant_types" must include "authorization_code"');let d=r[s];switch(d){case void 0:throw TypeError(`${s} must be provided`);case"none":if(r[n])throw TypeError(`${n} must not be provided when ${s} is "${d}"`);break;case"private_key_jwt":if(!t?.size)throw TypeError(`A non-empty keyset must be provided when ${s} is "${d}"`);if(!r[n])throw TypeError(`${n} must be provided when ${s} is "${d}"`);break;default:throw TypeError(`Invalid "token_endpoint_auth_method" value: ${d}`)}return r};let i=r(3377),a=r(2972),s="token_endpoint_auth_method",n="token_endpoint_auth_signing_alg"},970:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.atprotoLoopbackClientMetadata=function(e){let{scope:t="atproto",redirect_uris:r=["http://127.0.0.1/","http://[::1]/"]}=(0,i.parseOAuthLoopbackClientId)(e);return{client_id:e,scope:t,redirect_uris:r,response_types:["code"],grant_types:["authorization_code","refresh_token"],token_endpoint_auth_method:"none",application_type:"native",dpop_bound_access_tokens:!0}};let i=r(9460)},2761:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CLIENT_ASSERTION_TYPE_JWT_BEARER=void 0,t.CLIENT_ASSERTION_TYPE_JWT_BEARER="urn:ietf:params:oauth:client-assertion-type:jwt-bearer"},3377:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,a)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(2761),t),a(r(1130),t),a(r(4798),t),a(r(970),t),a(r(2437),t),a(r(3509),t),a(r(2989),t),a(r(3001),t),a(r(7727),t),a(r(2250),t),a(r(1681),t),a(r(9169),t),a(r(3668),t),a(r(8792),t),a(r(8815),t),a(r(5943),t),a(r(5572),t),a(r(9460),t),a(r(4984),t),a(r(4991),t),a(r(8799),t),a(r(7230),t),a(r(4636),t),a(r(2332),t),a(r(8708),t),a(r(4862),t),a(r(4857),t),a(r(6318),t),a(r(1377),t),a(r(4587),t),a(r(9003),t),a(r(2663),t),a(r(1289),t),a(r(6028),t),a(r(3106),t),a(r(3805),t),a(r(1603),t),a(r(4728),t),a(r(4032),t),a(r(2274),t),a(r(1376),t),a(r(4903),t),a(r(6454),t),a(r(1153),t)},2437:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthAccessTokenSchema=void 0;let i=r(4747);t.oauthAccessTokenSchema=i.z.string().min(1)},3509:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthAuthenticationErrorResponseSchema=void 0;let i=r(4747);t.oauthAuthenticationErrorResponseSchema=i.z.enum(["invalid_request","unauthorized_client","access_denied","unsupported_response_type","invalid_scope","server_error","temporarily_unavailable"])},2989:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthAuthorizationCodeGrantTokenRequestSchema=void 0;let i=r(4747),a=r(1377);t.oauthAuthorizationCodeGrantTokenRequestSchema=i.z.object({grant_type:i.z.literal("authorization_code"),code:i.z.string().min(1),redirect_uri:a.oauthRedirectUriSchema,code_verifier:i.z.string().min(43).max(128).regex(/^[a-zA-Z0-9-._~]+$/).optional()})},3001:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthAuthorizationDetailsSchema=t.oauthAuthorizationDetailSchema=void 0;let i=r(4747),a=r(1130);t.oauthAuthorizationDetailSchema=i.z.object({type:i.z.string(),locations:i.z.array(a.dangerousUriSchema).optional(),actions:i.z.array(i.z.string()).optional(),datatypes:i.z.array(i.z.string()).optional(),identifier:i.z.string().optional(),privileges:i.z.array(i.z.string()).optional()}),t.oauthAuthorizationDetailsSchema=i.z.array(t.oauthAuthorizationDetailSchema)},7727:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthAuthorizationRequestJarSchema=void 0;let i=r(4747),a=r(9538);t.oauthAuthorizationRequestJarSchema=i.z.object({request:i.z.union([a.signedJwtSchema,a.unsignedJwtSchema])})},2250:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthAuthorizationRequestParSchema=void 0;let i=r(4747),a=r(7727),s=r(1681);t.oauthAuthorizationRequestParSchema=i.z.union([s.oauthAuthorizationRequestParametersSchema,a.oauthAuthorizationRequestJarSchema])},1681:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthAuthorizationRequestParametersSchema=void 0;let i=r(4747),a=r(9538),s=r(3001),n=r(4984),o=r(7559),d=r(1377),l=r(1289),c=r(6028),u=r(3106),h=r(1376),p=r(4903),f=r(6454);t.oauthAuthorizationRequestParametersSchema=i.z.object({client_id:n.oauthClientIdSchema,state:i.z.string().optional(),redirect_uri:d.oauthRedirectUriSchema.optional(),scope:u.oauthScopeSchema.optional(),response_type:c.oauthResponseTypeSchema,code_challenge:i.z.string().optional(),code_challenge_method:o.oauthCodeChallengeMethodSchema.default("S256").optional(),dpop_jkt:i.z.string().optional(),response_mode:l.oauthResponseModeSchema.optional(),nonce:i.z.string().optional(),max_age:i.z.number().int().min(0).optional(),claims:i.z.record(f.oidcEntityTypeSchema,i.z.record(h.oidcClaimsParameterSchema,i.z.union([i.z.literal(null),p.oidcClaimsPropertiesSchema]))).optional(),login_hint:i.z.string().min(1).optional(),ui_locales:i.z.string().regex(/^[a-z]{2,3}(-[A-Z]{2})?( [a-z]{2,3}(-[A-Z]{2})?)*$/).optional(),id_token_hint:a.signedJwtSchema.optional(),display:i.z.enum(["page","popup","touch","wap"]).optional(),prompt:i.z.enum(["none","login","consent","select_account"]).optional(),authorization_details:s.oauthAuthorizationDetailsSchema.optional()})},9169:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthAuthorizationRequestQuerySchema=void 0;let i=r(4747),a=r(7727),s=r(1681),n=r(3668);t.oauthAuthorizationRequestQuerySchema=i.z.union([s.oauthAuthorizationRequestParametersSchema,a.oauthAuthorizationRequestJarSchema,n.oauthAuthorizationRequestUriSchema])},3668:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthAuthorizationRequestUriSchema=void 0;let i=r(4747),a=r(2663);t.oauthAuthorizationRequestUriSchema=i.z.object({request_uri:a.oauthRequestUriSchema})},8792:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthAuthorizationServerMetadataValidator=t.oauthAuthorizationServerMetadataSchema=void 0;let i=r(4747),a=r(7559),s=r(8708),n=r(1130);t.oauthAuthorizationServerMetadataSchema=i.z.object({issuer:s.oauthIssuerIdentifierSchema,claims_supported:i.z.array(i.z.string()).optional(),claims_locales_supported:i.z.array(i.z.string()).optional(),claims_parameter_supported:i.z.boolean().optional(),request_parameter_supported:i.z.boolean().optional(),request_uri_parameter_supported:i.z.boolean().optional(),require_request_uri_registration:i.z.boolean().optional(),scopes_supported:i.z.array(i.z.string()).optional(),subject_types_supported:i.z.array(i.z.string()).optional(),response_types_supported:i.z.array(i.z.string()).optional(),response_modes_supported:i.z.array(i.z.string()).optional(),grant_types_supported:i.z.array(i.z.string()).optional(),code_challenge_methods_supported:i.z.array(a.oauthCodeChallengeMethodSchema).min(1).optional(),ui_locales_supported:i.z.array(i.z.string()).optional(),id_token_signing_alg_values_supported:i.z.array(i.z.string()).optional(),display_values_supported:i.z.array(i.z.string()).optional(),request_object_signing_alg_values_supported:i.z.array(i.z.string()).optional(),authorization_response_iss_parameter_supported:i.z.boolean().optional(),authorization_details_types_supported:i.z.array(i.z.string()).optional(),request_object_encryption_alg_values_supported:i.z.array(i.z.string()).optional(),request_object_encryption_enc_values_supported:i.z.array(i.z.string()).optional(),jwks_uri:n.webUriSchema.optional(),authorization_endpoint:n.webUriSchema,token_endpoint:n.webUriSchema,token_endpoint_auth_methods_supported:i.z.array(i.z.string()).optional(),token_endpoint_auth_signing_alg_values_supported:i.z.array(i.z.string()).optional(),revocation_endpoint:n.webUriSchema.optional(),introspection_endpoint:n.webUriSchema.optional(),pushed_authorization_request_endpoint:n.webUriSchema.optional(),require_pushed_authorization_requests:i.z.boolean().optional(),userinfo_endpoint:n.webUriSchema.optional(),end_session_endpoint:n.webUriSchema.optional(),registration_endpoint:n.webUriSchema.optional(),dpop_signing_alg_values_supported:i.z.array(i.z.string()).optional(),protected_resources:i.z.array(n.webUriSchema).optional(),client_id_metadata_document_supported:i.z.boolean().optional()}),t.oauthAuthorizationServerMetadataValidator=t.oauthAuthorizationServerMetadataSchema.superRefine((e,t)=>{e.require_pushed_authorization_requests&&!e.pushed_authorization_request_endpoint&&t.addIssue({code:i.z.ZodIssueCode.custom,message:'"pushed_authorization_request_endpoint" required when "require_pushed_authorization_requests" is true'})}).superRefine((e,t)=>{e.response_types_supported&&!e.response_types_supported.includes("code")&&t.addIssue({code:i.z.ZodIssueCode.custom,message:'Response type "code" is required'})})},8815:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthClientCredentialsGrantTokenRequestSchema=void 0;let i=r(4747);t.oauthClientCredentialsGrantTokenRequestSchema=i.z.object({grant_type:i.z.literal("client_credentials")})},5943:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthClientCredentialsSchema=t.oauthClientCredentialsNoneSchema=t.oauthClientCredentialsSecretPostSchema=t.oauthClientCredentialsJwtBearerSchema=void 0;let i=r(4747),a=r(9538),s=r(2761),n=r(4984);t.oauthClientCredentialsJwtBearerSchema=i.z.object({client_id:n.oauthClientIdSchema,client_assertion_type:i.z.literal(s.CLIENT_ASSERTION_TYPE_JWT_BEARER),client_assertion:a.signedJwtSchema}),t.oauthClientCredentialsSecretPostSchema=i.z.object({client_id:n.oauthClientIdSchema,client_secret:i.z.string()}),t.oauthClientCredentialsNoneSchema=i.z.object({client_id:n.oauthClientIdSchema}),t.oauthClientCredentialsSchema=i.z.union([t.oauthClientCredentialsJwtBearerSchema,t.oauthClientCredentialsSecretPostSchema,t.oauthClientCredentialsNoneSchema])},5572:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.conventionalOAuthClientIdSchema=t.oauthClientIdDiscoverableSchema=void 0,t.isOAuthClientIdDiscoverable=function(e){return t.oauthClientIdDiscoverableSchema.safeParse(e).success},t.isConventionalOAuthClientId=function(e){return t.conventionalOAuthClientIdSchema.safeParse(e).success},t.assertOAuthDiscoverableClientId=function(e){t.oauthClientIdDiscoverableSchema.parse(e)},t.parseOAuthDiscoverableClientId=function(e){return new URL(t.oauthClientIdDiscoverableSchema.parse(e))};let i=r(4747),a=r(4984),s=r(1130),n=r(4798);t.oauthClientIdDiscoverableSchema=i.z.intersection(a.oauthClientIdSchema,s.httpsUriSchema).superRefine((e,t)=>{let r=new URL(e);return r.username||r.password?(t.addIssue({code:i.z.ZodIssueCode.custom,message:"ClientID must not contain credentials"}),!1):r.hash?(t.addIssue({code:i.z.ZodIssueCode.custom,message:"ClientID must not contain a fragment"}),!1):"/"===r.pathname?(t.addIssue({code:i.z.ZodIssueCode.custom,message:'ClientID must contain a path component (e.g. "/client-metadata.json")'}),!1):r.pathname.endsWith("/")?(t.addIssue({code:i.z.ZodIssueCode.custom,message:"ClientID path must not end with a trailing slash"}),!1):(0,n.isHostnameIP)(r.hostname)?(t.addIssue({code:i.z.ZodIssueCode.custom,message:"ClientID hostname must not be an IP address"}),!1):(0,n.extractUrlPath)(e)===r.pathname||(t.addIssue({code:i.z.ZodIssueCode.custom,message:`ClientID must be in canonical form ("${r.href}", got "${e}")`}),!1)}),t.conventionalOAuthClientIdSchema=t.oauthClientIdDiscoverableSchema.superRefine((e,t)=>{let r=new URL(e);return r.port?(t.addIssue({code:i.z.ZodIssueCode.custom,message:"ClientID must not contain a port"}),!1):r.search?(t.addIssue({code:i.z.ZodIssueCode.custom,message:"ClientID must not contain a query string"}),!1):"/oauth-client-metadata.json"===r.pathname||(t.addIssue({code:i.z.ZodIssueCode.custom,message:'ClientID must be "/oauth-client-metadata.json"'}),!1)})},9460:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthClientIdLoopbackSchema=void 0,t.isOAuthClientIdLoopback=function(e){try{return d(e),!0}catch{return!1}},t.assertOAuthLoopbackClientId=function(e){d(e)},t.parseOAuthLoopbackClientId=d;let i=r(4747),a=r(4984),s=r(1377),n=r(3106),o="http://localhost";function d(e){if(e.startsWith(o)){if(e.includes("#",o.length))throw TypeError("Loopback ClientID must not contain a hash component")}else throw TypeError(`Loopback ClientID must start with "${o}"`);let t=e.length>o.length&&"/"===e[o.length]?o.length+1:o.length;if(e.length===t)return{};if("?"!==e[t])throw TypeError("Loopback ClientID must not contain a path component");let r=new URLSearchParams(e.slice(t+1));for(let e of r.keys())if("redirect_uri"!==e&&"scope"!==e)throw TypeError(`Invalid query parameter "${e}" in client ID`);let i=r.get("scope")??void 0;if(null!=i){if(r.getAll("scope").length>1)throw TypeError("Loopback ClientID must contain at most one scope query parameter");if(!n.oauthScopeSchema.safeParse(i).success)throw TypeError("Invalid scope query parameter in client ID")}return{scope:i,redirect_uris:r.has("redirect_uri")?r.getAll("redirect_uri").map(e=>s.oauthLoopbackRedirectURISchema.parse(e)):void 0}}t.oauthClientIdLoopbackSchema=a.oauthClientIdSchema.superRefine((e,t)=>{try{return d(e),!0}catch(e){return t.addIssue({code:i.ZodIssueCode.custom,message:e instanceof TypeError?e.message:"Invalid loopback client ID"}),!1}})},4984:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthClientIdSchema=void 0;let i=r(4747);t.oauthClientIdSchema=i.z.string().min(1)},4991:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthClientMetadataSchema=void 0;let i=r(4747),a=r(9538),s=r(4984),n=r(8799),o=r(4636),d=r(1377),l=r(6028),c=r(3106),u=r(1130);t.oauthClientMetadataSchema=i.z.object({redirect_uris:i.z.array(d.oauthRedirectUriSchema).nonempty(),response_types:i.z.array(l.oauthResponseTypeSchema).nonempty().default(["code"]),grant_types:i.z.array(o.oauthGrantTypeSchema).nonempty().default(["authorization_code"]),scope:c.oauthScopeSchema.optional(),token_endpoint_auth_method:n.oauthEndpointAuthMethod.default("none").optional(),token_endpoint_auth_signing_alg:i.z.string().optional(),userinfo_signed_response_alg:i.z.string().optional(),userinfo_encrypted_response_alg:i.z.string().optional(),jwks_uri:u.webUriSchema.optional(),jwks:a.jwksPubSchema.optional(),application_type:i.z.enum(["web","native"]).default("web").optional(),subject_type:i.z.enum(["public","pairwise"]).default("public").optional(),request_object_signing_alg:i.z.string().optional(),id_token_signed_response_alg:i.z.string().optional(),authorization_signed_response_alg:i.z.string().default("RS256").optional(),authorization_encrypted_response_enc:i.z.enum(["A128CBC-HS256"]).optional(),authorization_encrypted_response_alg:i.z.string().optional(),client_id:s.oauthClientIdSchema.optional(),client_name:i.z.string().optional(),client_uri:u.webUriSchema.optional(),policy_uri:u.webUriSchema.optional(),tos_uri:u.webUriSchema.optional(),logo_uri:u.webUriSchema.optional(),default_max_age:i.z.number().optional(),require_auth_time:i.z.boolean().optional(),contacts:i.z.array(i.z.string().email()).optional(),tls_client_certificate_bound_access_tokens:i.z.boolean().optional(),dpop_bound_access_tokens:i.z.boolean().optional(),authorization_details_types:i.z.array(i.z.string()).optional()})},7559:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthCodeChallengeMethodSchema=void 0;let i=r(4747);t.oauthCodeChallengeMethodSchema=i.z.enum(["S256","plain"])},8799:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthEndpointAuthMethod=void 0;let i=r(4747);t.oauthEndpointAuthMethod=i.z.enum(["client_secret_basic","client_secret_jwt","client_secret_post","none","private_key_jwt","self_signed_tls_client_auth","tls_client_auth"])},7230:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OAUTH_ENDPOINT_NAMES=void 0,t.OAUTH_ENDPOINT_NAMES=["token","revocation","introspection","pushed_authorization_request"]},4636:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthGrantTypeSchema=void 0;let i=r(4747);t.oauthGrantTypeSchema=i.z.enum(["authorization_code","implicit","refresh_token","password","client_credentials","urn:ietf:params:oauth:grant-type:jwt-bearer","urn:ietf:params:oauth:grant-type:saml2-bearer"])},2332:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},8708:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthIssuerIdentifierSchema=void 0;let i=r(4747),a=r(1130);t.oauthIssuerIdentifierSchema=a.webUriSchema.superRefine((e,t)=>{if(e.endsWith("/"))return t.addIssue({code:i.z.ZodIssueCode.custom,message:"Issuer URL must not end with a slash"}),!1;let r=new URL(e);return r.username||r.password?(t.addIssue({code:i.z.ZodIssueCode.custom,message:"Issuer URL must not contain a username or password"}),!1):r.hash||r.search?(t.addIssue({code:i.z.ZodIssueCode.custom,message:"Issuer URL must not contain a query or fragment"}),!1):e===("/"===r.pathname?r.origin:r.href)||(t.addIssue({code:i.z.ZodIssueCode.custom,message:"Issuer URL must be in the canonical form"}),!1)})},4862:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthParResponseSchema=void 0;let i=r(4747);t.oauthParResponseSchema=i.z.object({request_uri:i.z.string(),expires_in:i.z.number().int().positive()})},4857:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthPasswordGrantTokenRequestSchema=void 0;let i=r(4747);t.oauthPasswordGrantTokenRequestSchema=i.z.object({grant_type:i.z.literal("password"),username:i.z.string(),password:i.z.string()})},6318:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthProtectedResourceMetadataSchema=void 0;let i=r(4747),a=r(8708),s=r(1130);t.oauthProtectedResourceMetadataSchema=i.z.object({resource:s.webUriSchema.refine(e=>!e.includes("?"),{message:"Resource URL must not contain query parameters"}).refine(e=>!e.includes("#"),{message:"Resource URL must not contain a fragment"}),authorization_servers:i.z.array(a.oauthIssuerIdentifierSchema).optional(),jwks_uri:s.webUriSchema.optional(),scopes_supported:i.z.array(i.z.string()).optional(),bearer_methods_supported:i.z.array(i.z.enum(["header","body","query"])).optional(),resource_signing_alg_values_supported:i.z.array(i.z.string()).optional(),resource_documentation:s.webUriSchema.optional(),resource_policy_uri:s.webUriSchema.optional(),resource_tos_uri:s.webUriSchema.optional()})},1377:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthRedirectUriSchema=t.oauthPrivateUseRedirectURISchema=t.oauthHttpsRedirectURISchema=t.oauthLoopbackRedirectURISchema=void 0;let i=r(4747),a=r(1130);t.oauthLoopbackRedirectURISchema=a.loopbackUriSchema.superRefine((e,t)=>!e.startsWith("http://localhost")||(t.addIssue({code:i.ZodIssueCode.custom,message:'Use of "localhost" hostname is not allowed (RFC 8252), use a loopback IP such as "127.0.0.1" instead'}),!1)),t.oauthHttpsRedirectURISchema=a.httpsUriSchema,t.oauthPrivateUseRedirectURISchema=a.privateUseUriSchema,t.oauthRedirectUriSchema=i.z.union([t.oauthLoopbackRedirectURISchema,t.oauthHttpsRedirectURISchema,t.oauthPrivateUseRedirectURISchema],{message:'URL must use the "https:" or "http:" protocol, or a private-use URI scheme (RFC 8252)'})},4587:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthRefreshTokenGrantTokenRequestSchema=void 0;let i=r(4747),a=r(9003);t.oauthRefreshTokenGrantTokenRequestSchema=i.z.object({grant_type:i.z.literal("refresh_token"),refresh_token:a.oauthRefreshTokenSchema})},9003:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthRefreshTokenSchema=void 0;let i=r(4747);t.oauthRefreshTokenSchema=i.z.string().min(1)},2663:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthRequestUriSchema=void 0;let i=r(4747);t.oauthRequestUriSchema=i.z.string()},1289:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthResponseModeSchema=void 0;let i=r(4747);t.oauthResponseModeSchema=i.z.enum(["query","fragment","form_post"])},6028:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthResponseTypeSchema=void 0;let i=r(4747);t.oauthResponseTypeSchema=i.z.enum(["code","token","none","code id_token token","code id_token","code token","id_token token","id_token"])},3106:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthScopeSchema=void 0;let i=r(4747);t.oauthScopeSchema=i.z.string().regex(/^[\x21\x23-\x5B\x5D-\x7E]+(?: [\x21\x23-\x5B\x5D-\x7E]+)*$/)},3805:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthTokenIdentificationSchema=void 0;let i=r(4747),a=r(2437),s=r(9003);t.oauthTokenIdentificationSchema=i.z.object({token:i.z.union([a.oauthAccessTokenSchema,s.oauthRefreshTokenSchema]),token_type_hint:i.z.enum(["access_token","refresh_token"]).optional()})},1603:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthTokenRequestSchema=void 0;let i=r(4747),a=r(2989),s=r(8815),n=r(4857),o=r(4587);t.oauthTokenRequestSchema=i.z.discriminatedUnion("grant_type",[a.oauthAuthorizationCodeGrantTokenRequestSchema,o.oauthRefreshTokenGrantTokenRequestSchema,n.oauthPasswordGrantTokenRequestSchema,s.oauthClientCredentialsGrantTokenRequestSchema])},4728:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthTokenResponseSchema=void 0;let i=r(4747),a=r(9538),s=r(3001),n=r(4032);t.oauthTokenResponseSchema=i.z.object({access_token:i.z.string(),token_type:n.oauthTokenTypeSchema,scope:i.z.string().optional(),refresh_token:i.z.string().optional(),expires_in:i.z.number().optional(),id_token:a.signedJwtSchema.optional(),authorization_details:s.oauthAuthorizationDetailsSchema.optional()}).passthrough()},4032:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthTokenTypeSchema=void 0;let i=r(4747);t.oauthTokenTypeSchema=i.z.union([i.z.string().regex(/^DPoP$/i).transform(()=>"DPoP"),i.z.string().regex(/^Bearer$/i).transform(()=>"Bearer")])},2274:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oidcAuthenticationErrorResponseSchema=void 0;let i=r(4747);t.oidcAuthenticationErrorResponseSchema=i.z.enum(["interaction_required","login_required","account_selection_required","consent_required","invalid_request_uri","invalid_request_object","request_not_supported","request_uri_not_supported","registration_not_supported"])},1376:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oidcClaimsParameterSchema=void 0;let i=r(4747);t.oidcClaimsParameterSchema=i.z.enum(["auth_time","nonce","acr","name","family_name","given_name","middle_name","nickname","preferred_username","gender","picture","profile","website","birthdate","zoneinfo","locale","updated_at","email","email_verified","phone_number","phone_number_verified","address"])},4903:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oidcClaimsPropertiesSchema=void 0;let i=r(4747),a=i.z.union([i.z.string(),i.z.number(),i.z.boolean()]);t.oidcClaimsPropertiesSchema=i.z.object({essential:i.z.boolean().optional(),value:a.optional(),values:i.z.array(a).optional()})},6454:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oidcEntityTypeSchema=void 0;let i=r(4747);t.oidcEntityTypeSchema=i.z.enum(["userinfo","id_token"])},1153:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oidcUserinfoSchema=void 0;let i=r(4747);t.oidcUserinfoSchema=i.z.object({sub:i.z.string(),iss:i.z.string().url().optional(),aud:i.z.union([i.z.string(),i.z.array(i.z.string()).min(1)]).optional(),email:i.z.string().email().optional(),email_verified:i.z.boolean().optional(),name:i.z.string().optional(),preferred_username:i.z.string().optional(),picture:i.z.string().url().optional()})},1130:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.privateUseUriSchema=t.webUriSchema=t.httpsUriSchema=t.loopbackUriSchema=t.dangerousUriSchema=void 0;let i=r(4747),a=r(4798),s=URL.canParse??(e=>{try{return new URL(e),!0}catch{return!1}});t.dangerousUriSchema=i.z.string().refine(e=>e.includes(":")&&s(e),{message:"Invalid URL"}),t.loopbackUriSchema=t.dangerousUriSchema.superRefine((e,t)=>{if(!e.startsWith("http://"))return t.addIssue({code:i.ZodIssueCode.custom,message:'URL must use the "http:" protocol'}),!1;let r=new URL(e);return!!(0,a.isLoopbackHost)(r.hostname)||(t.addIssue({code:i.ZodIssueCode.custom,message:'URL must use "localhost", "127.0.0.1" or "[::1]" as hostname'}),!1)}),t.httpsUriSchema=t.dangerousUriSchema.superRefine((e,t)=>{if(!e.startsWith("https://"))return t.addIssue({code:i.ZodIssueCode.custom,message:'URL must use the "https:" protocol'}),!1;let r=new URL(e);if((0,a.isLoopbackHost)(r.hostname))return t.addIssue({code:i.ZodIssueCode.custom,message:"https: URL must not use a loopback host"}),!1;if((0,a.isHostnameIP)(r.hostname));else{if(!r.hostname.includes("."))return t.addIssue({code:i.ZodIssueCode.custom,message:"Domain name must contain at least two segments"}),!1;if(r.hostname.endsWith(".local"))return t.addIssue({code:i.ZodIssueCode.custom,message:'Domain name must not end with ".local"'}),!1}return!0}),t.webUriSchema=i.z.string().superRefine((e,r)=>{if(e.startsWith("http://")){let i=t.loopbackUriSchema.safeParse(e);return i.success||i.error.issues.forEach(r.addIssue,r),i.success}if(e.startsWith("https://")){let i=t.httpsUriSchema.safeParse(e);return i.success||i.error.issues.forEach(r.addIssue,r),i.success}return r.addIssue({code:i.ZodIssueCode.custom,message:'URL must use the "http:" or "https:" protocol'}),!1}),t.privateUseUriSchema=t.dangerousUriSchema.superRefine((e,t)=>{let r=e.indexOf("."),a=e.indexOf(":");if(-1===r||-1===a||r>a)return t.addIssue({code:i.ZodIssueCode.custom,message:'Private-use URI scheme requires a "." as part of the protocol'}),!1;let s=new URL(e);return s.protocol.includes(".")?!s.hostname||(t.addIssue({code:i.ZodIssueCode.custom,message:'Private-use URI schemes must not include a hostname (only one "/" is allowed after the protocol, as per RFC 8252)'}),!1):(t.addIssue({code:i.ZodIssueCode.custom,message:"Invalid private-use URI scheme"}),!1)})},4798:function(e,t){"use strict";function r(e){return"localhost"===e||"127.0.0.1"===e||"[::1]"===e}Object.defineProperty(t,"__esModule",{value:!0}),t.isHostnameIP=function(e){return!!(e.match(/^\d+\.\d+\.\d+\.\d+$/)||e.startsWith("[")&&e.endsWith("]"))},t.isLoopbackHost=r,t.isLoopbackUrl=function(e){return r(("string"==typeof e?new URL(e):e).hostname)},t.safeUrl=function(e){try{return new URL(e)}catch{return null}},t.extractUrlPath=function(e){let t=e.startsWith("https://")?8:e.startsWith("http://")?7:-1;if(-1===t)throw TypeError('URL must use the "https:" or "http:" protocol');let r=e.indexOf("#",t),i=e.indexOf("?",t),a=-1!==i&&(-1===r||i<r)?i:-1,s=-1===r?-1===a?e.length:a:-1===a?r:Math.min(r,a),n=e.indexOf("/",t),o=-1===n||n>s?s:n;if(t===o)throw TypeError("URL must contain a host");return e.substring(o,s)}},329:function(e,t,r){"use strict";var i=r(257);Object.defineProperty(t,"__esModule",{value:!0}),t.LRUCache=void 0;let a="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,s=new Set,n="object"==typeof i&&i?i:{},o=(e,t,r,i)=>{"function"==typeof n.emitWarning?n.emitWarning(e,t,r,i):console.error(`[${r}] ${t}: ${e}`)},d=globalThis.AbortController,l=globalThis.AbortSignal;if(void 0===d){l=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(e,t){this._onabort.push(t)}},d=class{constructor(){t()}signal=new l;abort(e){if(!this.signal.aborted){for(let t of(this.signal.reason=e,this.signal.aborted=!0,this.signal._onabort))t(e);this.signal.onabort?.(e)}}};let e=n.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1",t=()=>{e&&(e=!1,o("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}let c=e=>!s.has(e);Symbol("type");let u=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),h=e=>u(e)?e<=256?Uint8Array:e<=65536?Uint16Array:e<=4294967296?Uint32Array:e<=Number.MAX_SAFE_INTEGER?p:null:null;class p extends Array{constructor(e){super(e),this.fill(0)}}class f{heap;length;static #e=!1;static create(e){let t=h(e);if(!t)return[];f.#e=!0;let r=new f(e,t);return f.#e=!1,r}constructor(e,t){if(!f.#e)throw TypeError("instantiate Stack using Stack.create(n)");this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}}class y{#t;#r;#i;#a;#s;#n;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#o;#d;#l;#c;#u;#h;#p;#f;#y;#m;#g;#w;#v;#b;#_;#S;#E;static unsafeExposeInternals(e){return{starts:e.#v,ttls:e.#b,sizes:e.#w,keyMap:e.#l,keyList:e.#c,valList:e.#u,next:e.#h,prev:e.#p,get head(){return e.#f},get tail(){return e.#y},free:e.#m,isBackgroundFetch:t=>e.#k(t),backgroundFetch:(t,r,i,a)=>e.#A(t,r,i,a),moveToTail:t=>e.#P(t),indexes:t=>e.#I(t),rindexes:t=>e.#T(t),isStale:t=>e.#C(t)}}get max(){return this.#t}get maxSize(){return this.#r}get calculatedSize(){return this.#d}get size(){return this.#o}get fetchMethod(){return this.#s}get memoMethod(){return this.#n}get dispose(){return this.#i}get disposeAfter(){return this.#a}constructor(e){let{max:t=0,ttl:r,ttlResolution:i=1,ttlAutopurge:a,updateAgeOnGet:n,updateAgeOnHas:d,allowStale:l,dispose:p,disposeAfter:m,noDisposeOnSet:g,noUpdateTTL:w,maxSize:v=0,maxEntrySize:b=0,sizeCalculation:_,fetchMethod:S,memoMethod:E,noDeleteOnFetchRejection:k,noDeleteOnStaleGet:A,allowStaleOnFetchRejection:P,allowStaleOnFetchAbort:I,ignoreFetchAbort:T}=e;if(0!==t&&!u(t))throw TypeError("max option must be a nonnegative integer");let C=t?h(t):Array;if(!C)throw Error("invalid max value: "+t);if(this.#t=t,this.#r=v,this.maxEntrySize=b||this.#r,this.sizeCalculation=_,this.sizeCalculation){if(!this.#r&&!this.maxEntrySize)throw TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if("function"!=typeof this.sizeCalculation)throw TypeError("sizeCalculation set to non-function")}if(void 0!==E&&"function"!=typeof E)throw TypeError("memoMethod must be a function if defined");if(this.#n=E,void 0!==S&&"function"!=typeof S)throw TypeError("fetchMethod must be a function if specified");if(this.#s=S,this.#S=!!S,this.#l=new Map,this.#c=Array(t).fill(void 0),this.#u=Array(t).fill(void 0),this.#h=new C(t),this.#p=new C(t),this.#f=0,this.#y=0,this.#m=f.create(t),this.#o=0,this.#d=0,"function"==typeof p&&(this.#i=p),"function"==typeof m?(this.#a=m,this.#g=[]):(this.#a=void 0,this.#g=void 0),this.#_=!!this.#i,this.#E=!!this.#a,this.noDisposeOnSet=!!g,this.noUpdateTTL=!!w,this.noDeleteOnFetchRejection=!!k,this.allowStaleOnFetchRejection=!!P,this.allowStaleOnFetchAbort=!!I,this.ignoreFetchAbort=!!T,0!==this.maxEntrySize){if(0!==this.#r&&!u(this.#r))throw TypeError("maxSize must be a positive integer if specified");if(!u(this.maxEntrySize))throw TypeError("maxEntrySize must be a positive integer if specified");this.#O()}if(this.allowStale=!!l,this.noDeleteOnStaleGet=!!A,this.updateAgeOnGet=!!n,this.updateAgeOnHas=!!d,this.ttlResolution=u(i)||0===i?i:1,this.ttlAutopurge=!!a,this.ttl=r||0,this.ttl){if(!u(this.ttl))throw TypeError("ttl must be a positive integer if specified");this.#x()}if(0===this.#t&&0===this.ttl&&0===this.#r)throw TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#t&&!this.#r){let e="LRU_CACHE_UNBOUNDED";c(e)&&(s.add(e),o("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",e,y))}}getRemainingTTL(e){return this.#l.has(e)?1/0:0}#x(){let e=new p(this.#t),t=new p(this.#t);this.#b=e,this.#v=t,this.#R=(r,i,s=a.now())=>{if(t[r]=0!==i?s:0,e[r]=i,0!==i&&this.ttlAutopurge){let e=setTimeout(()=>{this.#C(r)&&this.#j(this.#c[r],"expire")},i+1);e.unref&&e.unref()}},this.#D=r=>{t[r]=0!==e[r]?a.now():0},this.#z=(a,s)=>{if(e[s]){let n=e[s],o=t[s];if(!n||!o)return;a.ttl=n,a.start=o,a.now=r||i();let d=a.now-o;a.remainingTTL=n-d}};let r=0,i=()=>{let e=a.now();if(this.ttlResolution>0){r=e;let t=setTimeout(()=>r=0,this.ttlResolution);t.unref&&t.unref()}return e};this.getRemainingTTL=a=>{let s=this.#l.get(a);if(void 0===s)return 0;let n=e[s],o=t[s];return n&&o?n-((r||i())-o):1/0},this.#C=a=>{let s=t[a],n=e[a];return!!n&&!!s&&(r||i())-s>n}}#D=()=>{};#z=()=>{};#R=()=>{};#C=()=>!1;#O(){let e=new p(this.#t);this.#d=0,this.#w=e,this.#M=t=>{this.#d-=e[t],e[t]=0},this.#U=(e,t,r,i)=>{if(this.#k(t))return 0;if(!u(r)){if(i){if("function"!=typeof i)throw TypeError("sizeCalculation must be a function");if(!u(r=i(t,e)))throw TypeError("sizeCalculation return invalid (expect positive integer)")}else throw TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.")}return r},this.#W=(t,r,i)=>{if(e[t]=r,this.#r){let r=this.#r-e[t];for(;this.#d>r;)this.#K(!0)}this.#d+=e[t],i&&(i.entrySize=r,i.totalCalculatedSize=this.#d)}}#M=e=>{};#W=(e,t,r)=>{};#U=(e,t,r,i)=>{if(r||i)throw TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#I({allowStale:e=this.allowStale}={}){if(this.#o)for(let t=this.#y;this.#Z(t)&&((e||!this.#C(t))&&(yield t),t!==this.#f);)t=this.#p[t]}*#T({allowStale:e=this.allowStale}={}){if(this.#o)for(let t=this.#f;this.#Z(t)&&((e||!this.#C(t))&&(yield t),t!==this.#y);)t=this.#h[t]}#Z(e){return void 0!==e&&this.#l.get(this.#c[e])===e}*entries(){for(let e of this.#I())void 0===this.#u[e]||void 0===this.#c[e]||this.#k(this.#u[e])||(yield[this.#c[e],this.#u[e]])}*rentries(){for(let e of this.#T())void 0===this.#u[e]||void 0===this.#c[e]||this.#k(this.#u[e])||(yield[this.#c[e],this.#u[e]])}*keys(){for(let e of this.#I()){let t=this.#c[e];void 0===t||this.#k(this.#u[e])||(yield t)}}*rkeys(){for(let e of this.#T()){let t=this.#c[e];void 0===t||this.#k(this.#u[e])||(yield t)}}*values(){for(let e of this.#I())void 0===this.#u[e]||this.#k(this.#u[e])||(yield this.#u[e])}*rvalues(){for(let e of this.#T())void 0===this.#u[e]||this.#k(this.#u[e])||(yield this.#u[e])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(e,t={}){for(let r of this.#I()){let i=this.#u[r],a=this.#k(i)?i.__staleWhileFetching:i;if(void 0!==a&&e(a,this.#c[r],this))return this.get(this.#c[r],t)}}forEach(e,t=this){for(let r of this.#I()){let i=this.#u[r],a=this.#k(i)?i.__staleWhileFetching:i;void 0!==a&&e.call(t,a,this.#c[r],this)}}rforEach(e,t=this){for(let r of this.#T()){let i=this.#u[r],a=this.#k(i)?i.__staleWhileFetching:i;void 0!==a&&e.call(t,a,this.#c[r],this)}}purgeStale(){let e=!1;for(let t of this.#T({allowStale:!0}))this.#C(t)&&(this.#j(this.#c[t],"expire"),e=!0);return e}info(e){let t=this.#l.get(e);if(void 0===t)return;let r=this.#u[t],i=this.#k(r)?r.__staleWhileFetching:r;if(void 0===i)return;let s={value:i};if(this.#b&&this.#v){let e=this.#b[t],r=this.#v[t];if(e&&r){let t=e-(a.now()-r);s.ttl=t,s.start=Date.now()}}return this.#w&&(s.size=this.#w[t]),s}dump(){let e=[];for(let t of this.#I({allowStale:!0})){let r=this.#c[t],i=this.#u[t],s=this.#k(i)?i.__staleWhileFetching:i;if(void 0===s||void 0===r)continue;let n={value:s};if(this.#b&&this.#v){n.ttl=this.#b[t];let e=a.now()-this.#v[t];n.start=Math.floor(Date.now()-e)}this.#w&&(n.size=this.#w[t]),e.unshift([r,n])}return e}load(e){for(let[t,r]of(this.clear(),e)){if(r.start){let e=Date.now()-r.start;r.start=a.now()-e}this.set(t,r.value,r)}}set(e,t,r={}){if(void 0===t)return this.delete(e),this;let{ttl:i=this.ttl,start:a,noDisposeOnSet:s=this.noDisposeOnSet,sizeCalculation:n=this.sizeCalculation,status:o}=r,{noUpdateTTL:d=this.noUpdateTTL}=r,l=this.#U(e,t,r.size||0,n);if(this.maxEntrySize&&l>this.maxEntrySize)return o&&(o.set="miss",o.maxEntrySizeExceeded=!0),this.#j(e,"set"),this;let c=0===this.#o?void 0:this.#l.get(e);if(void 0===c)c=0===this.#o?this.#y:0!==this.#m.length?this.#m.pop():this.#o===this.#t?this.#K(!1):this.#o,this.#c[c]=e,this.#u[c]=t,this.#l.set(e,c),this.#h[this.#y]=c,this.#p[c]=this.#y,this.#y=c,this.#o++,this.#W(c,l,o),o&&(o.set="add"),d=!1;else{this.#P(c);let r=this.#u[c];if(t!==r){if(this.#S&&this.#k(r)){r.__abortController.abort(Error("replaced"));let{__staleWhileFetching:t}=r;void 0!==t&&!s&&(this.#_&&this.#i?.(t,e,"set"),this.#E&&this.#g?.push([t,e,"set"]))}else!s&&(this.#_&&this.#i?.(r,e,"set"),this.#E&&this.#g?.push([r,e,"set"]));if(this.#M(c),this.#W(c,l,o),this.#u[c]=t,o){o.set="replace";let e=r&&this.#k(r)?r.__staleWhileFetching:r;void 0!==e&&(o.oldValue=e)}}else o&&(o.set="update")}if(0===i||this.#b||this.#x(),this.#b&&(d||this.#R(c,i,a),o&&this.#z(o,c)),!s&&this.#E&&this.#g){let e;let t=this.#g;for(;e=t?.shift();)this.#a?.(...e)}return this}pop(){try{for(;this.#o;){let e=this.#u[this.#f];if(this.#K(!0),this.#k(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(void 0!==e)return e}}finally{if(this.#E&&this.#g){let e;let t=this.#g;for(;e=t?.shift();)this.#a?.(...e)}}}#K(e){let t=this.#f,r=this.#c[t],i=this.#u[t];return this.#S&&this.#k(i)?i.__abortController.abort(Error("evicted")):(this.#_||this.#E)&&(this.#_&&this.#i?.(i,r,"evict"),this.#E&&this.#g?.push([i,r,"evict"])),this.#M(t),e&&(this.#c[t]=void 0,this.#u[t]=void 0,this.#m.push(t)),1===this.#o?(this.#f=this.#y=0,this.#m.length=0):this.#f=this.#h[t],this.#l.delete(r),this.#o--,t}has(e,t={}){let{updateAgeOnHas:r=this.updateAgeOnHas,status:i}=t,a=this.#l.get(e);if(void 0!==a){let e=this.#u[a];if(this.#k(e)&&void 0===e.__staleWhileFetching)return!1;if(!this.#C(a))return r&&this.#D(a),i&&(i.has="hit",this.#z(i,a)),!0;i&&(i.has="stale",this.#z(i,a))}else i&&(i.has="miss");return!1}peek(e,t={}){let{allowStale:r=this.allowStale}=t,i=this.#l.get(e);if(void 0===i||!r&&this.#C(i))return;let a=this.#u[i];return this.#k(a)?a.__staleWhileFetching:a}#A(e,t,r,i){let a=void 0===t?void 0:this.#u[t];if(this.#k(a))return a;let s=new d,{signal:n}=r;n?.addEventListener("abort",()=>s.abort(n.reason),{signal:s.signal});let o={signal:s.signal,options:r,context:i},l=(i,a=!1)=>{let{aborted:n}=s.signal,d=r.ignoreFetchAbort&&void 0!==i;return(r.status&&(n&&!a?(r.status.fetchAborted=!0,r.status.fetchError=s.signal.reason,d&&(r.status.fetchAbortIgnored=!0)):r.status.fetchResolved=!0),!n||d||a)?(this.#u[t]===u&&(void 0===i?u.__staleWhileFetching?this.#u[t]=u.__staleWhileFetching:this.#j(e,"fetch"):(r.status&&(r.status.fetchUpdated=!0),this.set(e,i,o.options))),i):c(s.signal.reason)},c=i=>{let{aborted:a}=s.signal,n=a&&r.allowStaleOnFetchAbort,o=n||r.allowStaleOnFetchRejection,d=o||r.noDeleteOnFetchRejection;if(this.#u[t]!==u||(d&&void 0!==u.__staleWhileFetching?n||(this.#u[t]=u.__staleWhileFetching):this.#j(e,"fetch")),o)return r.status&&void 0!==u.__staleWhileFetching&&(r.status.returnedStale=!0),u.__staleWhileFetching;if(u.__returned===u)throw i};r.status&&(r.status.fetchDispatched=!0);let u=new Promise((t,i)=>{let n=this.#s?.(e,a,o);n&&n instanceof Promise&&n.then(e=>t(void 0===e?void 0:e),i),s.signal.addEventListener("abort",()=>{(!r.ignoreFetchAbort||r.allowStaleOnFetchAbort)&&(t(void 0),r.allowStaleOnFetchAbort&&(t=e=>l(e,!0)))})}).then(l,e=>(r.status&&(r.status.fetchRejected=!0,r.status.fetchError=e),c(e))),h=Object.assign(u,{__abortController:s,__staleWhileFetching:a,__returned:void 0});return void 0===t?(this.set(e,h,{...o.options,status:void 0}),t=this.#l.get(e)):this.#u[t]=h,h}#k(e){return!!this.#S&&!!e&&e instanceof Promise&&e.hasOwnProperty("__staleWhileFetching")&&e.__abortController instanceof d}async fetch(e,t={}){let{allowStale:r=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:a=this.noDeleteOnStaleGet,ttl:s=this.ttl,noDisposeOnSet:n=this.noDisposeOnSet,size:o=0,sizeCalculation:d=this.sizeCalculation,noUpdateTTL:l=this.noUpdateTTL,noDeleteOnFetchRejection:c=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:u=this.allowStaleOnFetchRejection,ignoreFetchAbort:h=this.ignoreFetchAbort,allowStaleOnFetchAbort:p=this.allowStaleOnFetchAbort,context:f,forceRefresh:y=!1,status:m,signal:g}=t;if(!this.#S)return m&&(m.fetch="get"),this.get(e,{allowStale:r,updateAgeOnGet:i,noDeleteOnStaleGet:a,status:m});let w={allowStale:r,updateAgeOnGet:i,noDeleteOnStaleGet:a,ttl:s,noDisposeOnSet:n,size:o,sizeCalculation:d,noUpdateTTL:l,noDeleteOnFetchRejection:c,allowStaleOnFetchRejection:u,allowStaleOnFetchAbort:p,ignoreFetchAbort:h,status:m,signal:g},v=this.#l.get(e);if(void 0===v){m&&(m.fetch="miss");let t=this.#A(e,v,w,f);return t.__returned=t}{let t=this.#u[v];if(this.#k(t)){let e=r&&void 0!==t.__staleWhileFetching;return m&&(m.fetch="inflight",e&&(m.returnedStale=!0)),e?t.__staleWhileFetching:t.__returned=t}let a=this.#C(v);if(!y&&!a)return m&&(m.fetch="hit"),this.#P(v),i&&this.#D(v),m&&this.#z(m,v),t;let s=this.#A(e,v,w,f),n=void 0!==s.__staleWhileFetching&&r;return m&&(m.fetch=a?"stale":"refresh",n&&a&&(m.returnedStale=!0)),n?s.__staleWhileFetching:s.__returned=s}}async forceFetch(e,t={}){let r=await this.fetch(e,t);if(void 0===r)throw Error("fetch() returned undefined");return r}memo(e,t={}){let r=this.#n;if(!r)throw Error("no memoMethod provided to constructor");let{context:i,forceRefresh:a,...s}=t,n=this.get(e,s);if(!a&&void 0!==n)return n;let o=r(e,n,{options:s,context:i});return this.set(e,o,s),o}get(e,t={}){let{allowStale:r=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:a=this.noDeleteOnStaleGet,status:s}=t,n=this.#l.get(e);if(void 0!==n){let t=this.#u[n],o=this.#k(t);return(s&&this.#z(s,n),this.#C(n))?(s&&(s.get="stale"),o)?(s&&r&&void 0!==t.__staleWhileFetching&&(s.returnedStale=!0),r?t.__staleWhileFetching:void 0):(a||this.#j(e,"expire"),s&&r&&(s.returnedStale=!0),r?t:void 0):(s&&(s.get="hit"),o)?t.__staleWhileFetching:(this.#P(n),i&&this.#D(n),t)}s&&(s.get="miss")}#L(e,t){this.#p[t]=e,this.#h[e]=t}#P(e){e!==this.#y&&(e===this.#f?this.#f=this.#h[e]:this.#L(this.#p[e],this.#h[e]),this.#L(this.#y,e),this.#y=e)}delete(e){return this.#j(e,"delete")}#j(e,t){let r=!1;if(0!==this.#o){let i=this.#l.get(e);if(void 0!==i){if(r=!0,1===this.#o)this.#H(t);else{this.#M(i);let r=this.#u[i];if(this.#k(r)?r.__abortController.abort(Error("deleted")):(this.#_||this.#E)&&(this.#_&&this.#i?.(r,e,t),this.#E&&this.#g?.push([r,e,t])),this.#l.delete(e),this.#c[i]=void 0,this.#u[i]=void 0,i===this.#y)this.#y=this.#p[i];else if(i===this.#f)this.#f=this.#h[i];else{let e=this.#p[i];this.#h[e]=this.#h[i];let t=this.#h[i];this.#p[t]=this.#p[i]}this.#o--,this.#m.push(i)}}}if(this.#E&&this.#g?.length){let e;let t=this.#g;for(;e=t?.shift();)this.#a?.(...e)}return r}clear(){return this.#H("delete")}#H(e){for(let t of this.#T({allowStale:!0})){let r=this.#u[t];if(this.#k(r))r.__abortController.abort(Error("deleted"));else{let i=this.#c[t];this.#_&&this.#i?.(r,i,e),this.#E&&this.#g?.push([r,i,e])}}if(this.#l.clear(),this.#u.fill(void 0),this.#c.fill(void 0),this.#b&&this.#v&&(this.#b.fill(0),this.#v.fill(0)),this.#w&&this.#w.fill(0),this.#f=0,this.#y=0,this.#m.length=0,this.#d=0,this.#o=0,this.#E&&this.#g){let e;let t=this.#g;for(;e=t?.shift();)this.#a?.(...e)}}}t.LRUCache=y},6924:function(e,t,r){"use strict";let i,a,s;r.r(t),r.d(t,{CompactEncrypt:function(){return t_},CompactSign:function(){return tk},EmbeddedJWK:function(){return tD},EncryptJWT:function(){return tO},FlattenedEncrypt:function(){return ta},FlattenedSign:function(){return tE},GeneralEncrypt:function(){return tn},GeneralSign:function(){return tP},SignJWT:function(){return tC},UnsecuredJWT:function(){return t$},base64url:function(){return o},calculateJwkThumbprint:function(){return tR},calculateJwkThumbprintUri:function(){return tj},compactDecrypt:function(){return e8},compactVerify:function(){return tu},createLocalJWKSet:function(){return tK},createRemoteJWKSet:function(){return tN},cryptoRuntime:function(){return t1},decodeJwt:function(){return tq},decodeProtectedHeader:function(){return tB},errors:function(){return n},experimental_jwksCache:function(){return tJ},exportJWK:function(){return tr},exportPKCS8:function(){return tt},exportSPKI:function(){return te},flattenedDecrypt:function(){return e6},flattenedVerify:function(){return tc},generalDecrypt:function(){return e9},generalVerify:function(){return th},generateKeyPair:function(){return tQ},generateSecret:function(){return t0},importJWK:function(){return eN},importPKCS8:function(){return eH},importSPKI:function(){return eZ},importX509:function(){return eL},jwksCache:function(){return tL},jwtDecrypt:function(){return tb},jwtVerify:function(){return tv}});var n={};r.r(n),r.d(n,{JOSEAlgNotAllowed:function(){return P},JOSEError:function(){return E},JOSENotSupported:function(){return I},JWEDecryptionFailed:function(){return T},JWEInvalid:function(){return C},JWKInvalid:function(){return R},JWKSInvalid:function(){return j},JWKSMultipleMatchingKeys:function(){return z},JWKSNoMatchingKey:function(){return D},JWKSTimeout:function(){return M},JWSInvalid:function(){return O},JWSSignatureVerificationFailed:function(){return U},JWTClaimValidationFailed:function(){return k},JWTExpired:function(){return A},JWTInvalid:function(){return x}});var o={};r.r(o),r.d(o,{decode:function(){return tV},encode:function(){return tF}});var d=crypto;let l=e=>e instanceof CryptoKey,c=async(e,t)=>{let r=`SHA-${e.slice(-3)}`;return new Uint8Array(await d.subtle.digest(r,t))},u=new TextEncoder,h=new TextDecoder;function p(...e){let t=new Uint8Array(e.reduce((e,{length:t})=>e+t,0)),r=0;for(let i of e)t.set(i,r),r+=i.length;return t}function f(e,t,r){if(t<0||t>=4294967296)throw RangeError(`value must be >= 0 and <= ${4294967296-1}. Received ${t}`);e.set([t>>>24,t>>>16,t>>>8,255&t],r)}function y(e){let t=new Uint8Array(8);return f(t,Math.floor(e/4294967296),0),f(t,e%4294967296,4),t}function m(e){let t=new Uint8Array(4);return f(t,e),t}function g(e){return p(m(e.length),e)}async function w(e,t,r){let i=Math.ceil((t>>3)/32),a=new Uint8Array(32*i);for(let t=0;t<i;t++){let i=new Uint8Array(4+e.length+r.length);i.set(m(t+1)),i.set(e,4),i.set(r,4+e.length),a.set(await c("sha256",i),32*t)}return a.slice(0,t>>3)}let v=e=>{let t=e;"string"==typeof t&&(t=u.encode(t));let r=[];for(let e=0;e<t.length;e+=32768)r.push(String.fromCharCode.apply(null,t.subarray(e,e+32768)));return btoa(r.join(""))},b=e=>v(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),_=e=>{let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r},S=e=>{let t=e;t instanceof Uint8Array&&(t=h.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return _(t)}catch{throw TypeError("The input to be decoded is not correctly encoded.")}};class E extends Error{constructor(e,t){super(e,t),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}E.code="ERR_JOSE_GENERIC";class k extends E{constructor(e,t,r="unspecified",i="unspecified"){super(e,{cause:{claim:r,reason:i,payload:t}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=r,this.reason=i,this.payload=t}}k.code="ERR_JWT_CLAIM_VALIDATION_FAILED";class A extends E{constructor(e,t,r="unspecified",i="unspecified"){super(e,{cause:{claim:r,reason:i,payload:t}}),this.code="ERR_JWT_EXPIRED",this.claim=r,this.reason=i,this.payload=t}}A.code="ERR_JWT_EXPIRED";class P extends E{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}}P.code="ERR_JOSE_ALG_NOT_ALLOWED";class I extends E{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}}I.code="ERR_JOSE_NOT_SUPPORTED";class T extends E{constructor(e="decryption operation failed",t){super(e,t),this.code="ERR_JWE_DECRYPTION_FAILED"}}T.code="ERR_JWE_DECRYPTION_FAILED";class C extends E{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}}C.code="ERR_JWE_INVALID";class O extends E{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}}O.code="ERR_JWS_INVALID";class x extends E{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}}x.code="ERR_JWT_INVALID";class R extends E{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}}R.code="ERR_JWK_INVALID";class j extends E{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}}j.code="ERR_JWKS_INVALID";class D extends E{constructor(e="no applicable key found in the JSON Web Key Set",t){super(e,t),this.code="ERR_JWKS_NO_MATCHING_KEY"}}D.code="ERR_JWKS_NO_MATCHING_KEY";class z extends E{constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}z.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";class M extends E{constructor(e="request timed out",t){super(e,t),this.code="ERR_JWKS_TIMEOUT"}}M.code="ERR_JWKS_TIMEOUT";class U extends E{constructor(e="signature verification failed",t){super(e,t),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}U.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";var W=d.getRandomValues.bind(d);function K(e){switch(e){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new I(`Unsupported JWE Algorithm: ${e}`)}}var Z=e=>W(new Uint8Array(K(e)>>3)),L=(e,t)=>{if(t.length<<3!==K(e))throw new C("Invalid Initialization Vector length")},H=(e,t)=>{let r=e.byteLength<<3;if(r!==t)throw new C(`Invalid Content Encryption Key length. Expected ${t} bits, got ${r} bits`)},N=(e,t)=>{if(!(e instanceof Uint8Array))throw TypeError("First argument must be a buffer");if(!(t instanceof Uint8Array))throw TypeError("Second argument must be a buffer");if(e.length!==t.length)throw TypeError("Input buffers must have the same length");let r=e.length,i=0,a=-1;for(;++a<r;)i|=e[a]^t[a];return 0===i};function J(e,t="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function $(e,t){return e.name===t}function F(e){return parseInt(e.name.slice(4),10)}function V(e,t){if(t.length&&!t.some(t=>e.usages.includes(t))){let e="CryptoKey does not support this operation, its usages must include ";if(t.length>2){let r=t.pop();e+=`one of ${t.join(", ")}, or ${r}.`}else 2===t.length?e+=`one of ${t[0]} or ${t[1]}.`:e+=`${t[0]}.`;throw TypeError(e)}}function B(e,t,...r){switch(t){case"A128GCM":case"A192GCM":case"A256GCM":{if(!$(e.algorithm,"AES-GCM"))throw J("AES-GCM");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw J(r,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!$(e.algorithm,"AES-KW"))throw J("AES-KW");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw J(r,"algorithm.length");break}case"ECDH":switch(e.algorithm.name){case"ECDH":case"X25519":case"X448":break;default:throw J("ECDH, X25519, or X448")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!$(e.algorithm,"PBKDF2"))throw J("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!$(e.algorithm,"RSA-OAEP"))throw J("RSA-OAEP");let r=parseInt(t.slice(9),10)||1;if(F(e.algorithm.hash)!==r)throw J(`SHA-${r}`,"algorithm.hash");break}default:throw TypeError("CryptoKey does not support this operation")}V(e,r)}function q(e,t,...r){if((r=r.filter(Boolean)).length>2){let t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}var G=(e,...t)=>q("Key must be ",e,...t);function X(e,t,...r){return q(`Key for the ${e} algorithm must be `,t,...r)}var Y=e=>!!l(e)||e?.[Symbol.toStringTag]==="KeyObject";let Q=["CryptoKey"];async function ee(e,t,r,i,a,s){let n,o;if(!(t instanceof Uint8Array))throw TypeError(G(t,"Uint8Array"));let l=parseInt(e.slice(1,4),10),c=await d.subtle.importKey("raw",t.subarray(l>>3),"AES-CBC",!1,["decrypt"]),u=await d.subtle.importKey("raw",t.subarray(0,l>>3),{hash:`SHA-${l<<1}`,name:"HMAC"},!1,["sign"]),h=p(s,i,r,y(s.length<<3)),f=new Uint8Array((await d.subtle.sign("HMAC",u,h)).slice(0,l>>3));try{n=N(a,f)}catch{}if(!n)throw new T;try{o=new Uint8Array(await d.subtle.decrypt({iv:i,name:"AES-CBC"},c,r))}catch{}if(!o)throw new T;return o}async function et(e,t,r,i,a,s){let n;t instanceof Uint8Array?n=await d.subtle.importKey("raw",t,"AES-GCM",!1,["decrypt"]):(B(t,e,"decrypt"),n=t);try{return new Uint8Array(await d.subtle.decrypt({additionalData:s,iv:i,name:"AES-GCM",tagLength:128},n,p(r,a)))}catch{throw new T}}let er=async(e,t,r,i,a,s)=>{if(!l(t)&&!(t instanceof Uint8Array))throw TypeError(G(t,...Q,"Uint8Array"));if(!i)throw new C("JWE Initialization Vector missing");if(!a)throw new C("JWE Authentication Tag missing");switch(L(e,i),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return t instanceof Uint8Array&&H(t,parseInt(e.slice(-3),10)),ee(e,t,r,i,a,s);case"A128GCM":case"A192GCM":case"A256GCM":return t instanceof Uint8Array&&H(t,parseInt(e.slice(1,4),10)),et(e,t,r,i,a,s);default:throw new I("Unsupported JWE Content Encryption Algorithm")}};var ei=(...e)=>{let t;let r=e.filter(Boolean);if(0===r.length||1===r.length)return!0;for(let e of r){let r=Object.keys(e);if(!t||0===t.size){t=new Set(r);continue}for(let e of r){if(t.has(e))return!1;t.add(e)}}return!0};function ea(e){if(!("object"==typeof e&&null!==e)||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}var es=[{hash:"SHA-256",name:"HMAC"},!0,["sign"]];function en(e,t){if(e.algorithm.length!==parseInt(t.slice(1,4),10))throw TypeError(`Invalid key size for alg: ${t}`)}function eo(e,t,r){if(l(e))return B(e,t,r),e;if(e instanceof Uint8Array)return d.subtle.importKey("raw",e,"AES-KW",!0,[r]);throw TypeError(G(e,...Q,"Uint8Array"))}let ed=async(e,t,r)=>{let i=await eo(t,e,"wrapKey");en(i,e);let a=await d.subtle.importKey("raw",r,...es);return new Uint8Array(await d.subtle.wrapKey("raw",a,i,"AES-KW"))},el=async(e,t,r)=>{let i=await eo(t,e,"unwrapKey");en(i,e);let a=await d.subtle.unwrapKey("raw",r,i,"AES-KW",...es);return new Uint8Array(await d.subtle.exportKey("raw",a))};async function ec(e,t,r,i,a=new Uint8Array(0),s=new Uint8Array(0)){let n;if(!l(e))throw TypeError(G(e,...Q));if(B(e,"ECDH"),!l(t))throw TypeError(G(t,...Q));B(t,"ECDH","deriveBits");let o=p(g(u.encode(r)),g(a),g(s),m(i));return n="X25519"===e.algorithm.name?256:"X448"===e.algorithm.name?448:Math.ceil(parseInt(e.algorithm.namedCurve.substr(-3),10)/8)<<3,w(new Uint8Array(await d.subtle.deriveBits({name:e.algorithm.name,public:e},t,n)),i,o)}async function eu(e){if(!l(e))throw TypeError(G(e,...Q));return d.subtle.generateKey(e.algorithm,!0,["deriveBits"])}function eh(e){if(!l(e))throw TypeError(G(e,...Q));return["P-256","P-384","P-521"].includes(e.algorithm.namedCurve)||"X25519"===e.algorithm.name||"X448"===e.algorithm.name}async function ep(e,t,r,i){!function(e){if(!(e instanceof Uint8Array)||e.length<8)throw new C("PBES2 Salt Input must be 8 or more octets")}(e);let a=p(u.encode(t),new Uint8Array([0]),e),s=parseInt(t.slice(13,16),10),n={hash:`SHA-${t.slice(8,11)}`,iterations:r,name:"PBKDF2",salt:a},o=await function(e,t){if(e instanceof Uint8Array)return d.subtle.importKey("raw",e,"PBKDF2",!1,["deriveBits"]);if(l(e))return B(e,t,"deriveBits","deriveKey"),e;throw TypeError(G(e,...Q,"Uint8Array"))}(i,t);if(o.usages.includes("deriveBits"))return new Uint8Array(await d.subtle.deriveBits(n,o,s));if(o.usages.includes("deriveKey"))return d.subtle.deriveKey(n,o,{length:s,name:"AES-KW"},!1,["wrapKey","unwrapKey"]);throw TypeError('PBKDF2 key "usages" must include "deriveBits" or "deriveKey"')}let ef=async(e,t,r,i=2048,a=W(new Uint8Array(16)))=>{let s=await ep(a,e,i,t);return{encryptedKey:await ed(e.slice(-6),s,r),p2c:i,p2s:b(a)}},ey=async(e,t,r,i,a)=>{let s=await ep(a,e,i,t);return el(e.slice(-6),s,r)};function em(e){switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new I(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}var eg=(e,t)=>{if(e.startsWith("RS")||e.startsWith("PS")){let{modulusLength:r}=t.algorithm;if("number"!=typeof r||r<2048)throw TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}};let ew=async(e,t,r)=>{if(!l(t))throw TypeError(G(t,...Q));if(B(t,e,"encrypt","wrapKey"),eg(e,t),t.usages.includes("encrypt"))return new Uint8Array(await d.subtle.encrypt(em(e),t,r));if(t.usages.includes("wrapKey")){let i=await d.subtle.importKey("raw",r,...es);return new Uint8Array(await d.subtle.wrapKey("raw",i,t,em(e)))}throw TypeError('RSA-OAEP key "usages" must include "encrypt" or "wrapKey" for this operation')},ev=async(e,t,r)=>{if(!l(t))throw TypeError(G(t,...Q));if(B(t,e,"decrypt","unwrapKey"),eg(e,t),t.usages.includes("decrypt"))return new Uint8Array(await d.subtle.decrypt(em(e),t,r));if(t.usages.includes("unwrapKey")){let i=await d.subtle.unwrapKey("raw",r,t,em(e),...es);return new Uint8Array(await d.subtle.exportKey("raw",i))}throw TypeError('RSA-OAEP key "usages" must include "decrypt" or "unwrapKey" for this operation')};function eb(e){return ea(e)&&"string"==typeof e.kty}let e_=async e=>{if(!e.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:t,keyUsages:r}=function(e){let t,r;switch(e.kty){case"RSA":switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new I('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new I('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(e.alg){case"Ed25519":t={name:"Ed25519"},r=e.d?["sign"]:["verify"];break;case"EdDSA":t={name:e.crv},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new I('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new I('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}(e),i=[t,e.ext??!1,e.key_ops??r],a={...e};return delete a.alg,delete a.use,d.subtle.importKey("jwk",a,...i)},eS=e=>S(e),eE=e=>e?.[Symbol.toStringTag]==="KeyObject",ek=async(e,t,r,i,a=!1)=>{let s=e.get(t);if(s?.[i])return s[i];let n=await e_({...r,alg:i});return a&&Object.freeze(t),s?s[i]=n:e.set(t,{[i]:n}),n};var eA={normalizePublicKey:(e,t)=>{if(eE(e)){let r=e.export({format:"jwk"});return(delete r.d,delete r.dp,delete r.dq,delete r.p,delete r.q,delete r.qi,r.k)?eS(r.k):(a||(a=new WeakMap),ek(a,e,r,t))}return eb(e)?e.k?S(e.k):(a||(a=new WeakMap),ek(a,e,e,t,!0)):e},normalizePrivateKey:(e,t)=>{if(eE(e)){let r=e.export({format:"jwk"});return r.k?eS(r.k):(i||(i=new WeakMap),ek(i,e,r,t))}return eb(e)?e.k?S(e.k):(i||(i=new WeakMap),ek(i,e,e,t,!0)):e}};function eP(e){switch(e){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new I(`Unsupported JWE Algorithm: ${e}`)}}var eI=e=>W(new Uint8Array(eP(e)>>3)),eT=(e,t)=>{let r=(e.match(/.{1,64}/g)||[]).join("\n");return`-----BEGIN ${t}-----
${r}
-----END ${t}-----`};let eC=async(e,t,r)=>{if(!l(r))throw TypeError(G(r,...Q));if(!r.extractable)throw TypeError("CryptoKey is not extractable");if(r.type!==e)throw TypeError(`key is not a ${e} key`);return eT(v(new Uint8Array(await d.subtle.exportKey(t,r))),`${e.toUpperCase()} KEY`)},eO=e=>eC("public","spki",e),ex=e=>eC("private","pkcs8",e),eR=(e,t,r=0)=>{0===r&&(t.unshift(t.length),t.unshift(6));let i=e.indexOf(t[0],r);if(-1===i)return!1;let a=e.subarray(i,i+t.length);return a.length===t.length&&(a.every((e,r)=>e===t[r])||eR(e,t,i+1))},ej=e=>{switch(!0){case eR(e,[42,134,72,206,61,3,1,7]):return"P-256";case eR(e,[43,129,4,0,34]):return"P-384";case eR(e,[43,129,4,0,35]):return"P-521";case eR(e,[43,101,110]):return"X25519";case eR(e,[43,101,111]):return"X448";case eR(e,[43,101,112]):return"Ed25519";case eR(e,[43,101,113]):return"Ed448";default:throw new I("Invalid or unsupported EC Key Curve or OKP Key Sub Type")}},eD=async(e,t,r,i,a)=>{let s,n;let o=new Uint8Array(atob(r.replace(e,"")).split("").map(e=>e.charCodeAt(0))),l="spki"===t;switch(i){case"PS256":case"PS384":case"PS512":s={name:"RSA-PSS",hash:`SHA-${i.slice(-3)}`},n=l?["verify"]:["sign"];break;case"RS256":case"RS384":case"RS512":s={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${i.slice(-3)}`},n=l?["verify"]:["sign"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":s={name:"RSA-OAEP",hash:`SHA-${parseInt(i.slice(-3),10)||1}`},n=l?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":s={name:"ECDSA",namedCurve:"P-256"},n=l?["verify"]:["sign"];break;case"ES384":s={name:"ECDSA",namedCurve:"P-384"},n=l?["verify"]:["sign"];break;case"ES512":s={name:"ECDSA",namedCurve:"P-521"},n=l?["verify"]:["sign"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let e=ej(o);s=e.startsWith("P-")?{name:"ECDH",namedCurve:e}:{name:e},n=l?[]:["deriveBits"];break}case"Ed25519":s={name:"Ed25519"},n=l?["verify"]:["sign"];break;case"EdDSA":s={name:ej(o)},n=l?["verify"]:["sign"];break;default:throw new I('Invalid or unsupported "alg" (Algorithm) value')}return d.subtle.importKey(t,o,s,a?.extractable??!1,n)},ez=(e,t,r)=>eD(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,"pkcs8",e,t,r),eM=(e,t,r)=>eD(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",e,t,r);function eU(e){let t=[],r=0;for(;r<e.length;){let i=eW(e.subarray(r));t.push(i),r+=i.byteLength}return t}function eW(e){let t=0,r=31&e[0];if(t++,31===r){for(r=0;e[t]>=128;)r=128*r+e[t]-128,t++;r=128*r+e[t]-128,t++}let i=0;if(e[t]<128)i=e[t],t++;else if(128===i){for(i=0;0!==e[t+i]||0!==e[t+i+1];){if(i>e.byteLength)throw TypeError("invalid indefinite form length");i++}let r=t+i+2;return{byteLength:r,contents:e.subarray(t,t+i),raw:e.subarray(0,r)}}else{let r=127&e[t];t++,i=0;for(let a=0;a<r;a++)i=256*i+e[t],t++}let a=t+i;return{byteLength:a,contents:e.subarray(t,a),raw:e.subarray(0,a)}}let eK=(e,t,r)=>{let i;try{i=eT(function(e){let t=eU(eU(eW(e).contents)[0].contents);return v(t[160===t[0].raw[0]?6:5].raw)}(_(e.replace(/(?:-----(?:BEGIN|END) CERTIFICATE-----|\s)/g,""))),"PUBLIC KEY")}catch(e){throw TypeError("Failed to parse the X.509 certificate",{cause:e})}return eM(i,t,r)};async function eZ(e,t,r){if("string"!=typeof e||0!==e.indexOf("-----BEGIN PUBLIC KEY-----"))throw TypeError('"spki" must be SPKI formatted string');return eM(e,t,r)}async function eL(e,t,r){if("string"!=typeof e||0!==e.indexOf("-----BEGIN CERTIFICATE-----"))throw TypeError('"x509" must be X.509 formatted string');return eK(e,t,r)}async function eH(e,t,r){if("string"!=typeof e||0!==e.indexOf("-----BEGIN PRIVATE KEY-----"))throw TypeError('"pkcs8" must be PKCS#8 formatted string');return ez(e,t,r)}async function eN(e,t){if(!ea(e))throw TypeError("JWK must be an object");switch(t||(t=e.alg),e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');return S(e.k);case"RSA":if("oth"in e&&void 0!==e.oth)throw new I('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return e_({...e,alg:t});default:throw new I('Unsupported "kty" (Key Type) Parameter value')}}let eJ=e=>e?.[Symbol.toStringTag],e$=(e,t,r)=>{if(void 0!==t.use&&"sig"!==t.use)throw TypeError("Invalid key for this operation, when present its use must be sig");if(void 0!==t.key_ops&&t.key_ops.includes?.(r)!==!0)throw TypeError(`Invalid key for this operation, when present its key_ops must include ${r}`);if(void 0!==t.alg&&t.alg!==e)throw TypeError(`Invalid key for this operation, when present its alg must be ${e}`);return!0},eF=(e,t,r,i)=>{if(!(t instanceof Uint8Array)){if(i&&eb(t)){if(eb(t)&&"oct"===t.kty&&"string"==typeof t.k&&e$(e,t,r))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Y(t))throw TypeError(X(e,t,...Q,"Uint8Array",i?"JSON Web Key":null));if("secret"!==t.type)throw TypeError(`${eJ(t)} instances for symmetric algorithms must be of type "secret"`)}},eV=(e,t,r,i)=>{if(i&&eb(t))switch(r){case"sign":if("oct"!==t.kty&&"string"==typeof t.d&&e$(e,t,r))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"verify":if("oct"!==t.kty&&void 0===t.d&&e$(e,t,r))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!Y(t))throw TypeError(X(e,t,...Q,i?"JSON Web Key":null));if("secret"===t.type)throw TypeError(`${eJ(t)} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===r&&"public"===t.type)throw TypeError(`${eJ(t)} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===r&&"public"===t.type)throw TypeError(`${eJ(t)} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&"verify"===r&&"private"===t.type)throw TypeError(`${eJ(t)} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&"encrypt"===r&&"private"===t.type)throw TypeError(`${eJ(t)} instances for asymmetric algorithm encryption must be of type "public"`)};function eB(e,t,r,i){t.startsWith("HS")||"dir"===t||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?eF(t,r,i,e):eV(t,r,i,e)}var eq=eB.bind(void 0,!1);let eG=eB.bind(void 0,!0);async function eX(e,t,r,i,a){if(!(r instanceof Uint8Array))throw TypeError(G(r,"Uint8Array"));let s=parseInt(e.slice(1,4),10),n=await d.subtle.importKey("raw",r.subarray(s>>3),"AES-CBC",!1,["encrypt"]),o=await d.subtle.importKey("raw",r.subarray(0,s>>3),{hash:`SHA-${s<<1}`,name:"HMAC"},!1,["sign"]),l=new Uint8Array(await d.subtle.encrypt({iv:i,name:"AES-CBC"},n,t)),c=p(a,i,l,y(a.length<<3));return{ciphertext:l,tag:new Uint8Array((await d.subtle.sign("HMAC",o,c)).slice(0,s>>3)),iv:i}}async function eY(e,t,r,i,a){let s;r instanceof Uint8Array?s=await d.subtle.importKey("raw",r,"AES-GCM",!1,["encrypt"]):(B(r,e,"encrypt"),s=r);let n=new Uint8Array(await d.subtle.encrypt({additionalData:a,iv:i,name:"AES-GCM",tagLength:128},s,t)),o=n.slice(-16);return{ciphertext:n.slice(0,-16),tag:o,iv:i}}let eQ=async(e,t,r,i,a)=>{if(!l(r)&&!(r instanceof Uint8Array))throw TypeError(G(r,...Q,"Uint8Array"));switch(i?L(e,i):i=Z(e),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return r instanceof Uint8Array&&H(r,parseInt(e.slice(-3),10)),eX(e,t,r,i,a);case"A128GCM":case"A192GCM":case"A256GCM":return r instanceof Uint8Array&&H(r,parseInt(e.slice(1,4),10)),eY(e,t,r,i,a);default:throw new I("Unsupported JWE Content Encryption Algorithm")}};async function e0(e,t,r,i){let a=e.slice(0,7),s=await eQ(a,r,t,i,new Uint8Array(0));return{encryptedKey:s.ciphertext,iv:b(s.iv),tag:b(s.tag)}}async function e1(e,t,r,i,a){return er(e.slice(0,7),t,r,i,a,new Uint8Array(0))}async function e2(e,t,r,i,a){switch(eq(e,t,"decrypt"),t=await eA.normalizePrivateKey?.(t,e)||t,e){case"dir":if(void 0!==r)throw new C("Encountered unexpected JWE Encrypted Key");return t;case"ECDH-ES":if(void 0!==r)throw new C("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let a,s;if(!ea(i.epk))throw new C('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!eh(t))throw new I("ECDH with the provided key is not allowed or not supported by your javascript runtime");let n=await eN(i.epk,e);if(void 0!==i.apu){if("string"!=typeof i.apu)throw new C('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{a=S(i.apu)}catch{throw new C("Failed to base64url decode the apu")}}if(void 0!==i.apv){if("string"!=typeof i.apv)throw new C('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{s=S(i.apv)}catch{throw new C("Failed to base64url decode the apv")}}let o=await ec(n,t,"ECDH-ES"===e?i.enc:e,"ECDH-ES"===e?eP(i.enc):parseInt(e.slice(-5,-2),10),a,s);if("ECDH-ES"===e)return o;if(void 0===r)throw new C("JWE Encrypted Key missing");return el(e.slice(-6),o,r)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(void 0===r)throw new C("JWE Encrypted Key missing");return ev(e,t,r);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{let s;if(void 0===r)throw new C("JWE Encrypted Key missing");if("number"!=typeof i.p2c)throw new C('JOSE Header "p2c" (PBES2 Count) missing or invalid');let n=a?.maxPBES2Count||1e4;if(i.p2c>n)throw new C('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof i.p2s)throw new C('JOSE Header "p2s" (PBES2 Salt) missing or invalid');try{s=S(i.p2s)}catch{throw new C("Failed to base64url decode the p2s")}return ey(e,t,r,i.p2c,s)}case"A128KW":case"A192KW":case"A256KW":if(void 0===r)throw new C("JWE Encrypted Key missing");return el(e,t,r);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{let a,s;if(void 0===r)throw new C("JWE Encrypted Key missing");if("string"!=typeof i.iv)throw new C('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof i.tag)throw new C('JOSE Header "tag" (Authentication Tag) missing or invalid');try{a=S(i.iv)}catch{throw new C("Failed to base64url decode the iv")}try{s=S(i.tag)}catch{throw new C("Failed to base64url decode the tag")}return e1(e,t,r,a,s)}default:throw new I('Invalid or unsupported "alg" (JWE Algorithm) header value')}}var e4=function(e,t,r,i,a){let s;if(void 0!==a.crit&&i?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!i||void 0===i.crit)return new Set;if(!Array.isArray(i.crit)||0===i.crit.length||i.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let n of(s=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t,i.crit)){if(!s.has(n))throw new I(`Extension Header Parameter "${n}" is not recognized`);if(void 0===a[n])throw new e(`Extension Header Parameter "${n}" is missing`);if(s.get(n)&&void 0===i[n])throw new e(`Extension Header Parameter "${n}" MUST be integrity protected`)}return new Set(i.crit)},e5=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)};async function e6(e,t,r){let i,a,s,n,o,d,l;if(!ea(e))throw new C("Flattened JWE must be an object");if(void 0===e.protected&&void 0===e.header&&void 0===e.unprotected)throw new C("JOSE Header missing");if(void 0!==e.iv&&"string"!=typeof e.iv)throw new C("JWE Initialization Vector incorrect type");if("string"!=typeof e.ciphertext)throw new C("JWE Ciphertext missing or incorrect type");if(void 0!==e.tag&&"string"!=typeof e.tag)throw new C("JWE Authentication Tag incorrect type");if(void 0!==e.protected&&"string"!=typeof e.protected)throw new C("JWE Protected Header incorrect type");if(void 0!==e.encrypted_key&&"string"!=typeof e.encrypted_key)throw new C("JWE Encrypted Key incorrect type");if(void 0!==e.aad&&"string"!=typeof e.aad)throw new C("JWE AAD incorrect type");if(void 0!==e.header&&!ea(e.header))throw new C("JWE Shared Unprotected Header incorrect type");if(void 0!==e.unprotected&&!ea(e.unprotected))throw new C("JWE Per-Recipient Unprotected Header incorrect type");if(e.protected)try{let t=S(e.protected);i=JSON.parse(h.decode(t))}catch{throw new C("JWE Protected Header is invalid")}if(!ei(i,e.header,e.unprotected))throw new C("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let c={...i,...e.header,...e.unprotected};if(e4(C,new Map,r?.crit,i,c),void 0!==c.zip)throw new I('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:f,enc:y}=c;if("string"!=typeof f||!f)throw new C("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof y||!y)throw new C("missing JWE Encryption Algorithm (enc) in JWE Header");let m=r&&e5("keyManagementAlgorithms",r.keyManagementAlgorithms),g=r&&e5("contentEncryptionAlgorithms",r.contentEncryptionAlgorithms);if(m&&!m.has(f)||!m&&f.startsWith("PBES2"))throw new P('"alg" (Algorithm) Header Parameter value not allowed');if(g&&!g.has(y))throw new P('"enc" (Encryption Algorithm) Header Parameter value not allowed');if(void 0!==e.encrypted_key)try{a=S(e.encrypted_key)}catch{throw new C("Failed to base64url decode the encrypted_key")}let w=!1;"function"==typeof t&&(t=await t(i,e),w=!0);try{s=await e2(f,t,a,c,r)}catch(e){if(e instanceof TypeError||e instanceof C||e instanceof I)throw e;s=eI(y)}if(void 0!==e.iv)try{n=S(e.iv)}catch{throw new C("Failed to base64url decode the iv")}if(void 0!==e.tag)try{o=S(e.tag)}catch{throw new C("Failed to base64url decode the tag")}let v=u.encode(e.protected??"");d=void 0!==e.aad?p(v,u.encode("."),u.encode(e.aad)):v;try{l=S(e.ciphertext)}catch{throw new C("Failed to base64url decode the ciphertext")}let b={plaintext:await er(y,s,l,n,o,d)};if(void 0!==e.protected&&(b.protectedHeader=i),void 0!==e.aad)try{b.additionalAuthenticatedData=S(e.aad)}catch{throw new C("Failed to base64url decode the aad")}return(void 0!==e.unprotected&&(b.sharedUnprotectedHeader=e.unprotected),void 0!==e.header&&(b.unprotectedHeader=e.header),w)?{...b,key:t}:b}async function e8(e,t,r){if(e instanceof Uint8Array&&(e=h.decode(e)),"string"!=typeof e)throw new C("Compact JWE must be a string or Uint8Array");let{0:i,1:a,2:s,3:n,4:o,length:d}=e.split(".");if(5!==d)throw new C("Invalid Compact JWE");let l=await e6({ciphertext:n,iv:s||void 0,protected:i,tag:o||void 0,encrypted_key:a||void 0},t,r),c={plaintext:l.plaintext,protectedHeader:l.protectedHeader};return"function"==typeof t?{...c,key:l.key}:c}async function e9(e,t,r){if(!ea(e))throw new C("General JWE must be an object");if(!Array.isArray(e.recipients)||!e.recipients.every(ea))throw new C("JWE Recipients missing or incorrect type");if(!e.recipients.length)throw new C("JWE Recipients has no members");for(let i of e.recipients)try{return await e6({aad:e.aad,ciphertext:e.ciphertext,encrypted_key:i.encrypted_key,header:i.header,iv:e.iv,protected:e.protected,tag:e.tag,unprotected:e.unprotected},t,r)}catch{}throw new T}let e3=Symbol(),e7=async e=>{if(e instanceof Uint8Array)return{kty:"oct",k:b(e)};if(!l(e))throw TypeError(G(e,...Q,"Uint8Array"));if(!e.extractable)throw TypeError("non-extractable CryptoKey cannot be exported as a JWK");let{ext:t,key_ops:r,alg:i,use:a,...s}=await d.subtle.exportKey("jwk",e);return s};async function te(e){return eO(e)}async function tt(e){return ex(e)}async function tr(e){return e7(e)}async function ti(e,t,r,i,a={}){let s,n,o;switch(eq(e,r,"encrypt"),r=await eA.normalizePublicKey?.(r,e)||r,e){case"dir":o=r;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!eh(r))throw new I("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:d,apv:l}=a,{epk:c}=a;c||(c=(await eu(r)).privateKey);let{x:u,y:h,crv:p,kty:f}=await tr(c),y=await ec(r,c,"ECDH-ES"===e?t:e,"ECDH-ES"===e?eP(t):parseInt(e.slice(-5,-2),10),d,l);if(n={epk:{x:u,crv:p,kty:f}},"EC"===f&&(n.epk.y=h),d&&(n.apu=b(d)),l&&(n.apv=b(l)),"ECDH-ES"===e){o=y;break}o=i||eI(t);let m=e.slice(-6);s=await ed(m,y,o);break}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":o=i||eI(t),s=await ew(e,r,o);break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{o=i||eI(t);let{p2c:d,p2s:l}=a;({encryptedKey:s,...n}=await ef(e,r,o,d,l));break}case"A128KW":case"A192KW":case"A256KW":o=i||eI(t),s=await ed(e,r,o);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{o=i||eI(t);let{iv:d}=a;({encryptedKey:s,...n}=await e0(e,r,o,d));break}default:throw new I('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:o,encryptedKey:s,parameters:n}}class ta{constructor(e){if(!(e instanceof Uint8Array))throw TypeError("plaintext must be an instance of Uint8Array");this._plaintext=e}setKeyManagementParameters(e){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._sharedUnprotectedHeader)throw TypeError("setSharedUnprotectedHeader can only be called once");return this._sharedUnprotectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}setContentEncryptionKey(e){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=e,this}async encrypt(e,t){let r,i,a,s,n;if(!this._protectedHeader&&!this._unprotectedHeader&&!this._sharedUnprotectedHeader)throw new C("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!ei(this._protectedHeader,this._unprotectedHeader,this._sharedUnprotectedHeader))throw new C("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let o={...this._protectedHeader,...this._unprotectedHeader,...this._sharedUnprotectedHeader};if(e4(C,new Map,t?.crit,this._protectedHeader,o),void 0!==o.zip)throw new I('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:d,enc:l}=o;if("string"!=typeof d||!d)throw new C('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("string"!=typeof l||!l)throw new C('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(this._cek&&("dir"===d||"ECDH-ES"===d))throw TypeError(`setContentEncryptionKey cannot be called with JWE "alg" (Algorithm) Header ${d}`);{let a;({cek:i,encryptedKey:r,parameters:a}=await ti(d,l,e,this._cek,this._keyManagementParameters)),a&&(t&&e3 in t?this._unprotectedHeader?this._unprotectedHeader={...this._unprotectedHeader,...a}:this.setUnprotectedHeader(a):this._protectedHeader?this._protectedHeader={...this._protectedHeader,...a}:this.setProtectedHeader(a))}s=this._protectedHeader?u.encode(b(JSON.stringify(this._protectedHeader))):u.encode(""),this._aad?(n=b(this._aad),a=p(s,u.encode("."),u.encode(n))):a=s;let{ciphertext:c,tag:f,iv:y}=await eQ(l,this._plaintext,i,this._iv,a),m={ciphertext:b(c)};return y&&(m.iv=b(y)),f&&(m.tag=b(f)),r&&(m.encrypted_key=b(r)),n&&(m.aad=n),this._protectedHeader&&(m.protected=h.decode(s)),this._sharedUnprotectedHeader&&(m.unprotected=this._sharedUnprotectedHeader),this._unprotectedHeader&&(m.header=this._unprotectedHeader),m}}class ts{constructor(e,t,r){this.parent=e,this.key=t,this.options=r}setUnprotectedHeader(e){if(this.unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=e,this}addRecipient(...e){return this.parent.addRecipient(...e)}encrypt(...e){return this.parent.encrypt(...e)}done(){return this.parent}}class tn{constructor(e){this._recipients=[],this._plaintext=e}addRecipient(e,t){let r=new ts(this,e,{crit:t?.crit});return this._recipients.push(r),r}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setSharedUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}async encrypt(){let e;if(!this._recipients.length)throw new C("at least one recipient must be added");if(1===this._recipients.length){let[e]=this._recipients,t=await new ta(this._plaintext).setAdditionalAuthenticatedData(this._aad).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(e.unprotectedHeader).encrypt(e.key,{...e.options}),r={ciphertext:t.ciphertext,iv:t.iv,recipients:[{}],tag:t.tag};return t.aad&&(r.aad=t.aad),t.protected&&(r.protected=t.protected),t.unprotected&&(r.unprotected=t.unprotected),t.encrypted_key&&(r.recipients[0].encrypted_key=t.encrypted_key),t.header&&(r.recipients[0].header=t.header),r}for(let t=0;t<this._recipients.length;t++){let r=this._recipients[t];if(!ei(this._protectedHeader,this._unprotectedHeader,r.unprotectedHeader))throw new C("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let i={...this._protectedHeader,...this._unprotectedHeader,...r.unprotectedHeader},{alg:a}=i;if("string"!=typeof a||!a)throw new C('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("dir"===a||"ECDH-ES"===a)throw new C('"dir" and "ECDH-ES" alg may only be used with a single recipient');if("string"!=typeof i.enc||!i.enc)throw new C('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(e){if(e!==i.enc)throw new C('JWE "enc" (Encryption Algorithm) Header Parameter must be the same for all recipients')}else e=i.enc;if(e4(C,new Map,r.options.crit,this._protectedHeader,i),void 0!==i.zip)throw new I('JWE "zip" (Compression Algorithm) Header Parameter is not supported.')}let t=eI(e),r={ciphertext:"",iv:"",recipients:[],tag:""};for(let i=0;i<this._recipients.length;i++){let a=this._recipients[i],s={};r.recipients.push(s);let n=({...this._protectedHeader,...this._unprotectedHeader,...a.unprotectedHeader}).alg.startsWith("PBES2")?2048+i:void 0;if(0===i){let e=await new ta(this._plaintext).setAdditionalAuthenticatedData(this._aad).setContentEncryptionKey(t).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(a.unprotectedHeader).setKeyManagementParameters({p2c:n}).encrypt(a.key,{...a.options,[e3]:!0});r.ciphertext=e.ciphertext,r.iv=e.iv,r.tag=e.tag,e.aad&&(r.aad=e.aad),e.protected&&(r.protected=e.protected),e.unprotected&&(r.unprotected=e.unprotected),s.encrypted_key=e.encrypted_key,e.header&&(s.header=e.header);continue}let{encryptedKey:o,parameters:d}=await ti(a.unprotectedHeader?.alg||this._protectedHeader?.alg||this._unprotectedHeader?.alg,e,a.key,t,{p2c:n});s.encrypted_key=b(o),(a.unprotectedHeader||d)&&(s.header={...a.unprotectedHeader,...d})}return r}}function to(e,t){let r=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:e.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:t.namedCurve};case"Ed25519":return{name:"Ed25519"};case"EdDSA":return{name:t.name};default:throw new I(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}async function td(e,t,r){if("sign"===r&&(t=await eA.normalizePrivateKey(t,e)),"verify"===r&&(t=await eA.normalizePublicKey(t,e)),l(t))return!function(e,t,...r){switch(t){case"HS256":case"HS384":case"HS512":{if(!$(e.algorithm,"HMAC"))throw J("HMAC");let r=parseInt(t.slice(2),10);if(F(e.algorithm.hash)!==r)throw J(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!$(e.algorithm,"RSASSA-PKCS1-v1_5"))throw J("RSASSA-PKCS1-v1_5");let r=parseInt(t.slice(2),10);if(F(e.algorithm.hash)!==r)throw J(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!$(e.algorithm,"RSA-PSS"))throw J("RSA-PSS");let r=parseInt(t.slice(2),10);if(F(e.algorithm.hash)!==r)throw J(`SHA-${r}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==e.algorithm.name&&"Ed448"!==e.algorithm.name)throw J("Ed25519 or Ed448");break;case"Ed25519":if(!$(e.algorithm,"Ed25519"))throw J("Ed25519");break;case"ES256":case"ES384":case"ES512":{if(!$(e.algorithm,"ECDSA"))throw J("ECDSA");let r=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(t);if(e.algorithm.namedCurve!==r)throw J(r,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}V(e,r)}(t,e,r),t;if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw TypeError(G(t,...Q));return d.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[r])}throw TypeError(G(t,...Q,"Uint8Array","JSON Web Key"))}let tl=async(e,t,r,i)=>{let a=await td(e,t,"verify");eg(e,a);let s=to(e,a.algorithm);try{return await d.subtle.verify(s,a,r,i)}catch{return!1}};async function tc(e,t,r){let i,a;if(!ea(e))throw new O("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new O('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new O("JWS Protected Header incorrect type");if(void 0===e.payload)throw new O("JWS Payload missing");if("string"!=typeof e.signature)throw new O("JWS Signature missing or incorrect type");if(void 0!==e.header&&!ea(e.header))throw new O("JWS Unprotected Header incorrect type");let s={};if(e.protected)try{let t=S(e.protected);s=JSON.parse(h.decode(t))}catch{throw new O("JWS Protected Header is invalid")}if(!ei(s,e.header))throw new O("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let n={...s,...e.header},o=e4(O,new Map([["b64",!0]]),r?.crit,s,n),d=!0;if(o.has("b64")&&"boolean"!=typeof(d=s.b64))throw new O('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:l}=n;if("string"!=typeof l||!l)throw new O('JWS "alg" (Algorithm) Header Parameter missing or invalid');let c=r&&e5("algorithms",r.algorithms);if(c&&!c.has(l))throw new P('"alg" (Algorithm) Header Parameter value not allowed');if(d){if("string"!=typeof e.payload)throw new O("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new O("JWS Payload must be a string or an Uint8Array instance");let f=!1;"function"==typeof t?(t=await t(s,e),f=!0,eG(l,t,"verify"),eb(t)&&(t=await eN(t,l))):eG(l,t,"verify");let y=p(u.encode(e.protected??""),u.encode("."),"string"==typeof e.payload?u.encode(e.payload):e.payload);try{i=S(e.signature)}catch{throw new O("Failed to base64url decode the signature")}if(!await tl(l,t,i,y))throw new U;if(d)try{a=S(e.payload)}catch{throw new O("Failed to base64url decode the payload")}else a="string"==typeof e.payload?u.encode(e.payload):e.payload;let m={payload:a};return(void 0!==e.protected&&(m.protectedHeader=s),void 0!==e.header&&(m.unprotectedHeader=e.header),f)?{...m,key:t}:m}async function tu(e,t,r){if(e instanceof Uint8Array&&(e=h.decode(e)),"string"!=typeof e)throw new O("Compact JWS must be a string or Uint8Array");let{0:i,1:a,2:s,length:n}=e.split(".");if(3!==n)throw new O("Invalid Compact JWS");let o=await tc({payload:a,protected:i,signature:s},t,r),d={payload:o.payload,protectedHeader:o.protectedHeader};return"function"==typeof t?{...d,key:o.key}:d}async function th(e,t,r){if(!ea(e))throw new O("General JWS must be an object");if(!Array.isArray(e.signatures)||!e.signatures.every(ea))throw new O("JWS Signatures missing or incorrect type");for(let i of e.signatures)try{return await tc({header:i.header,payload:e.payload,protected:i.protected,signature:i.signature},t,r)}catch{}throw new U}var tp=e=>Math.floor(e.getTime()/1e3);let tf=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;var ty=e=>{let t;let r=tf.exec(e);if(!r||r[4]&&r[1])throw TypeError("Invalid time period format");let i=parseFloat(r[2]);switch(r[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":t=Math.round(i);break;case"minute":case"minutes":case"min":case"mins":case"m":t=Math.round(60*i);break;case"hour":case"hours":case"hr":case"hrs":case"h":t=Math.round(3600*i);break;case"day":case"days":case"d":t=Math.round(86400*i);break;case"week":case"weeks":case"w":t=Math.round(604800*i);break;default:t=Math.round(31557600*i)}return"-"===r[1]||"ago"===r[4]?-t:t};let tm=e=>e.toLowerCase().replace(/^application\//,""),tg=(e,t)=>"string"==typeof e?t.includes(e):!!Array.isArray(e)&&t.some(Set.prototype.has.bind(new Set(e)));var tw=(e,t,r={})=>{let i,a;try{i=JSON.parse(h.decode(t))}catch{}if(!ea(i))throw new x("JWT Claims Set must be a top-level JSON object");let{typ:s}=r;if(s&&("string"!=typeof e.typ||tm(e.typ)!==tm(s)))throw new k('unexpected "typ" JWT header value',i,"typ","check_failed");let{requiredClaims:n=[],issuer:o,subject:d,audience:l,maxTokenAge:c}=r,u=[...n];for(let e of(void 0!==c&&u.push("iat"),void 0!==l&&u.push("aud"),void 0!==d&&u.push("sub"),void 0!==o&&u.push("iss"),new Set(u.reverse())))if(!(e in i))throw new k(`missing required "${e}" claim`,i,e,"missing");if(o&&!(Array.isArray(o)?o:[o]).includes(i.iss))throw new k('unexpected "iss" claim value',i,"iss","check_failed");if(d&&i.sub!==d)throw new k('unexpected "sub" claim value',i,"sub","check_failed");if(l&&!tg(i.aud,"string"==typeof l?[l]:l))throw new k('unexpected "aud" claim value',i,"aud","check_failed");switch(typeof r.clockTolerance){case"string":a=ty(r.clockTolerance);break;case"number":a=r.clockTolerance;break;case"undefined":a=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:p}=r,f=tp(p||new Date);if((void 0!==i.iat||c)&&"number"!=typeof i.iat)throw new k('"iat" claim must be a number',i,"iat","invalid");if(void 0!==i.nbf){if("number"!=typeof i.nbf)throw new k('"nbf" claim must be a number',i,"nbf","invalid");if(i.nbf>f+a)throw new k('"nbf" claim timestamp check failed',i,"nbf","check_failed")}if(void 0!==i.exp){if("number"!=typeof i.exp)throw new k('"exp" claim must be a number',i,"exp","invalid");if(i.exp<=f-a)throw new A('"exp" claim timestamp check failed',i,"exp","check_failed")}if(c){let e=f-i.iat;if(e-a>("number"==typeof c?c:ty(c)))throw new A('"iat" claim timestamp check failed (too far in the past)',i,"iat","check_failed");if(e<0-a)throw new k('"iat" claim timestamp check failed (it should be in the past)',i,"iat","check_failed")}return i};async function tv(e,t,r){let i=await tu(e,t,r);if(i.protectedHeader.crit?.includes("b64")&&!1===i.protectedHeader.b64)throw new x("JWTs MUST NOT use unencoded payload");let a={payload:tw(i.protectedHeader,i.payload,r),protectedHeader:i.protectedHeader};return"function"==typeof t?{...a,key:i.key}:a}async function tb(e,t,r){let i=await e8(e,t,r),a=tw(i.protectedHeader,i.plaintext,r),{protectedHeader:s}=i;if(void 0!==s.iss&&s.iss!==a.iss)throw new k('replicated "iss" claim header parameter mismatch',a,"iss","mismatch");if(void 0!==s.sub&&s.sub!==a.sub)throw new k('replicated "sub" claim header parameter mismatch',a,"sub","mismatch");if(void 0!==s.aud&&JSON.stringify(s.aud)!==JSON.stringify(a.aud))throw new k('replicated "aud" claim header parameter mismatch',a,"aud","mismatch");let n={payload:a,protectedHeader:s};return"function"==typeof t?{...n,key:i.key}:n}class t_{constructor(e){this._flattened=new ta(e)}setContentEncryptionKey(e){return this._flattened.setContentEncryptionKey(e),this}setInitializationVector(e){return this._flattened.setInitializationVector(e),this}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}setKeyManagementParameters(e){return this._flattened.setKeyManagementParameters(e),this}async encrypt(e,t){let r=await this._flattened.encrypt(e,t);return[r.protected,r.encrypted_key,r.iv,r.ciphertext,r.tag].join(".")}}let tS=async(e,t,r)=>{let i=await td(e,t,"sign");return eg(e,i),new Uint8Array(await d.subtle.sign(to(e,i.algorithm),i,r))};class tE{constructor(e){if(!(e instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){let r;if(!this._protectedHeader&&!this._unprotectedHeader)throw new O("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!ei(this._protectedHeader,this._unprotectedHeader))throw new O("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let i={...this._protectedHeader,...this._unprotectedHeader},a=e4(O,new Map([["b64",!0]]),t?.crit,this._protectedHeader,i),s=!0;if(a.has("b64")&&"boolean"!=typeof(s=this._protectedHeader.b64))throw new O('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:n}=i;if("string"!=typeof n||!n)throw new O('JWS "alg" (Algorithm) Header Parameter missing or invalid');eG(n,e,"sign");let o=this._payload;s&&(o=u.encode(b(o)));let d=p(r=this._protectedHeader?u.encode(b(JSON.stringify(this._protectedHeader))):u.encode(""),u.encode("."),o),l={signature:b(await tS(n,e,d)),payload:""};return s&&(l.payload=h.decode(o)),this._unprotectedHeader&&(l.header=this._unprotectedHeader),this._protectedHeader&&(l.protected=h.decode(r)),l}}class tk{constructor(e){this._flattened=new tE(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){let r=await this._flattened.sign(e,t);if(void 0===r.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`}}class tA{constructor(e,t,r){this.parent=e,this.key=t,this.options=r}setProtectedHeader(e){if(this.protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this.protectedHeader=e,this}setUnprotectedHeader(e){if(this.unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=e,this}addSignature(...e){return this.parent.addSignature(...e)}sign(...e){return this.parent.sign(...e)}done(){return this.parent}}class tP{constructor(e){this._signatures=[],this._payload=e}addSignature(e,t){let r=new tA(this,e,t);return this._signatures.push(r),r}async sign(){if(!this._signatures.length)throw new O("at least one signature must be added");let e={signatures:[],payload:""};for(let t=0;t<this._signatures.length;t++){let r=this._signatures[t],i=new tE(this._payload);i.setProtectedHeader(r.protectedHeader),i.setUnprotectedHeader(r.unprotectedHeader);let{payload:a,...s}=await i.sign(r.key,r.options);if(0===t)e.payload=a;else if(e.payload!==a)throw new O("inconsistent use of JWS Unencoded Payload (RFC7797)");e.signatures.push(s)}return e}}function tI(e,t){if(!Number.isFinite(t))throw TypeError(`Invalid ${e} input`);return t}class tT{constructor(e={}){if(!ea(e))throw TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return"number"==typeof e?this._payload={...this._payload,nbf:tI("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:tI("setNotBefore",tp(e))}:this._payload={...this._payload,nbf:tp(new Date)+ty(e)},this}setExpirationTime(e){return"number"==typeof e?this._payload={...this._payload,exp:tI("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:tI("setExpirationTime",tp(e))}:this._payload={...this._payload,exp:tp(new Date)+ty(e)},this}setIssuedAt(e){return void 0===e?this._payload={...this._payload,iat:tp(new Date)}:e instanceof Date?this._payload={...this._payload,iat:tI("setIssuedAt",tp(e))}:"string"==typeof e?this._payload={...this._payload,iat:tI("setIssuedAt",tp(new Date)+ty(e))}:this._payload={...this._payload,iat:tI("setIssuedAt",e)},this}}class tC extends tT{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){let r=new tk(u.encode(JSON.stringify(this._payload)));if(r.setProtectedHeader(this._protectedHeader),Array.isArray(this._protectedHeader?.crit)&&this._protectedHeader.crit.includes("b64")&&!1===this._protectedHeader.b64)throw new x("JWTs MUST NOT use unencoded payload");return r.sign(e,t)}}class tO extends tT{setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setKeyManagementParameters(e){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setContentEncryptionKey(e){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=e,this}replicateIssuerAsHeader(){return this._replicateIssuerAsHeader=!0,this}replicateSubjectAsHeader(){return this._replicateSubjectAsHeader=!0,this}replicateAudienceAsHeader(){return this._replicateAudienceAsHeader=!0,this}async encrypt(e,t){let r=new t_(u.encode(JSON.stringify(this._payload)));return this._replicateIssuerAsHeader&&(this._protectedHeader={...this._protectedHeader,iss:this._payload.iss}),this._replicateSubjectAsHeader&&(this._protectedHeader={...this._protectedHeader,sub:this._payload.sub}),this._replicateAudienceAsHeader&&(this._protectedHeader={...this._protectedHeader,aud:this._payload.aud}),r.setProtectedHeader(this._protectedHeader),this._iv&&r.setInitializationVector(this._iv),this._cek&&r.setContentEncryptionKey(this._cek),this._keyManagementParameters&&r.setKeyManagementParameters(this._keyManagementParameters),r.encrypt(e,t)}}let tx=(e,t)=>{if("string"!=typeof e||!e)throw new R(`${t} missing or invalid`)};async function tR(e,t){let r;if(!ea(e))throw TypeError("JWK must be an object");if(t??(t="sha256"),"sha256"!==t&&"sha384"!==t&&"sha512"!==t)throw TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');switch(e.kty){case"EC":tx(e.crv,'"crv" (Curve) Parameter'),tx(e.x,'"x" (X Coordinate) Parameter'),tx(e.y,'"y" (Y Coordinate) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x,y:e.y};break;case"OKP":tx(e.crv,'"crv" (Subtype of Key Pair) Parameter'),tx(e.x,'"x" (Public Key) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x};break;case"RSA":tx(e.e,'"e" (Exponent) Parameter'),tx(e.n,'"n" (Modulus) Parameter'),r={e:e.e,kty:e.kty,n:e.n};break;case"oct":tx(e.k,'"k" (Key Value) Parameter'),r={k:e.k,kty:e.kty};break;default:throw new I('"kty" (Key Type) Parameter missing or unsupported')}let i=u.encode(JSON.stringify(r));return b(await c(t,i))}async function tj(e,t){t??(t="sha256");let r=await tR(e,t);return`urn:ietf:params:oauth:jwk-thumbprint:sha-${t.slice(-3)}:${r}`}async function tD(e,t){let r={...e,...t?.header};if(!ea(r.jwk))throw new O('"jwk" (JSON Web Key) Header Parameter must be a JSON object');let i=await eN({...r.jwk,ext:!0},r.alg);if(i instanceof Uint8Array||"public"!==i.type)throw new O('"jwk" (JSON Web Key) Header Parameter must be a public key');return i}function tz(e){return ea(e)}function tM(e){return"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}class tU{constructor(e){if(this._cached=new WeakMap,!(e&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(tz)))throw new j("JSON Web Key Set malformed");this._jwks=tM(e)}async getKey(e,t){let{alg:r,kid:i}={...e,...t?.header},a=function(e){switch("string"==typeof e&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new I('Unsupported "alg" value for a JSON Web Key Set')}}(r),s=this._jwks.keys.filter(e=>{let t=a===e.kty;if(t&&"string"==typeof i&&(t=i===e.kid),t&&"string"==typeof e.alg&&(t=r===e.alg),t&&"string"==typeof e.use&&(t="sig"===e.use),t&&Array.isArray(e.key_ops)&&(t=e.key_ops.includes("verify")),t)switch(r){case"ES256":t="P-256"===e.crv;break;case"ES256K":t="secp256k1"===e.crv;break;case"ES384":t="P-384"===e.crv;break;case"ES512":t="P-521"===e.crv;break;case"Ed25519":t="Ed25519"===e.crv;break;case"EdDSA":t="Ed25519"===e.crv||"Ed448"===e.crv}return t}),{0:n,length:o}=s;if(0===o)throw new D;if(1!==o){let e=new z,{_cached:t}=this;throw e[Symbol.asyncIterator]=async function*(){for(let e of s)try{yield await tW(t,e,r)}catch{}},e}return tW(this._cached,n,r)}}async function tW(e,t,r){let i=e.get(t)||e.set(t,{}).get(t);if(void 0===i[r]){let e=await eN({...t,ext:!0},r);if(e instanceof Uint8Array||"public"!==e.type)throw new j("JSON Web Key Set members must be public keys");i[r]=e}return i[r]}function tK(e){let t=new tU(e),r=async(e,r)=>t.getKey(e,r);return Object.defineProperties(r,{jwks:{value:()=>tM(t._jwks),enumerable:!0,configurable:!1,writable:!1}}),r}let tZ=async(e,t,r)=>{let i,a;let s=!1;"function"==typeof AbortController&&(i=new AbortController,a=setTimeout(()=>{s=!0,i.abort()},t));let n=await fetch(e.href,{signal:i?i.signal:void 0,redirect:"manual",headers:r.headers}).catch(e=>{if(s)throw new M;throw e});if(void 0!==a&&clearTimeout(a),200!==n.status)throw new E("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await n.json()}catch{throw new E("Failed to parse the JSON Web Key Set HTTP response as JSON")}};"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(s="jose/v5.10.0");let tL=Symbol();class tH{constructor(e,t){if(!(e instanceof URL))throw TypeError("url must be an instance of URL");if(this._url=new URL(e.href),this._options={agent:t?.agent,headers:t?.headers},this._timeoutDuration="number"==typeof t?.timeoutDuration?t?.timeoutDuration:5e3,this._cooldownDuration="number"==typeof t?.cooldownDuration?t?.cooldownDuration:3e4,this._cacheMaxAge="number"==typeof t?.cacheMaxAge?t?.cacheMaxAge:6e5,t?.[tL]!==void 0){var r,i;this._cache=t?.[tL],r=t?.[tL],i=this._cacheMaxAge,!("object"!=typeof r||null===r||!("uat"in r)||"number"!=typeof r.uat||Date.now()-r.uat>=i)&&"jwks"in r&&ea(r.jwks)&&Array.isArray(r.jwks.keys)&&Array.prototype.every.call(r.jwks.keys,ea)&&(this._jwksTimestamp=this._cache.uat,this._local=tK(this._cache.jwks))}}coolingDown(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cooldownDuration}fresh(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cacheMaxAge}async getKey(e,t){this._local&&this.fresh()||await this.reload();try{return await this._local(e,t)}catch(r){if(r instanceof D&&!1===this.coolingDown())return await this.reload(),this._local(e,t);throw r}}async reload(){this._pendingFetch&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this._pendingFetch=void 0);let e=new Headers(this._options.headers);s&&!e.has("User-Agent")&&(e.set("User-Agent",s),this._options.headers=Object.fromEntries(e.entries())),this._pendingFetch||(this._pendingFetch=tZ(this._url,this._timeoutDuration,this._options).then(e=>{this._local=tK(e),this._cache&&(this._cache.uat=Date.now(),this._cache.jwks=e),this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(e=>{throw this._pendingFetch=void 0,e})),await this._pendingFetch}}function tN(e,t){let r=new tH(e,t),i=async(e,t)=>r.getKey(e,t);return Object.defineProperties(i,{coolingDown:{get:()=>r.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>r.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>r.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>!!r._pendingFetch,enumerable:!0,configurable:!1},jwks:{value:()=>r._local?.jwks(),enumerable:!0,configurable:!1,writable:!1}}),i}let tJ=tL;class t$ extends tT{encode(){let e=b(JSON.stringify({alg:"none"})),t=b(JSON.stringify(this._payload));return`${e}.${t}.`}static decode(e,t){let r;if("string"!=typeof e)throw new x("Unsecured JWT must be a string");let{0:i,1:a,2:s,length:n}=e.split(".");if(3!==n||""!==s)throw new x("Invalid Unsecured JWT");try{if(r=JSON.parse(h.decode(S(i))),"none"!==r.alg)throw Error()}catch{throw new x("Invalid Unsecured JWT")}return{payload:tw(r,S(a),t),header:r}}}let tF=b,tV=S;function tB(e){let t;if("string"==typeof e){let r=e.split(".");(3===r.length||5===r.length)&&([t]=r)}else if("object"==typeof e&&e){if("protected"in e)t=e.protected;else throw TypeError("Token does not contain a Protected Header")}try{if("string"!=typeof t||!t)throw Error();let e=JSON.parse(h.decode(tV(t)));if(!ea(e))throw Error();return e}catch{throw TypeError("Invalid Token or Protected Header formatting")}}function tq(e){let t,r;if("string"!=typeof e)throw new x("JWTs must use Compact JWS serialization, JWT must be a string");let{1:i,length:a}=e.split(".");if(5===a)throw new x("Only JWTs using Compact JWS serialization can be decoded");if(3!==a)throw new x("Invalid JWT");if(!i)throw new x("JWTs must contain a payload");try{t=tV(i)}catch{throw new x("Failed to base64url decode the payload")}try{r=JSON.parse(h.decode(t))}catch{throw new x("Failed to parse the decoded payload as JSON")}if(!ea(r))throw new x("Invalid JWT Claims Set");return r}async function tG(e,t){let r,i,a;switch(e){case"HS256":case"HS384":case"HS512":r=parseInt(e.slice(-3),10),i={name:"HMAC",hash:`SHA-${r}`,length:r},a=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return W(new Uint8Array((r=parseInt(e.slice(-3),10))>>3));case"A128KW":case"A192KW":case"A256KW":i={name:"AES-KW",length:r=parseInt(e.slice(1,4),10)},a=["wrapKey","unwrapKey"];break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":case"A128GCM":case"A192GCM":case"A256GCM":i={name:"AES-GCM",length:r=parseInt(e.slice(1,4),10)},a=["encrypt","decrypt"];break;default:throw new I('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return d.subtle.generateKey(i,t?.extractable??!1,a)}function tX(e){let t=e?.modulusLength??2048;if("number"!=typeof t||t<2048)throw new I("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return t}async function tY(e,t){let r,i;switch(e){case"PS256":case"PS384":case"PS512":r={name:"RSA-PSS",hash:`SHA-${e.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:tX(t)},i=["sign","verify"];break;case"RS256":case"RS384":case"RS512":r={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:tX(t)},i=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":r={name:"RSA-OAEP",hash:`SHA-${parseInt(e.slice(-3),10)||1}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:tX(t)},i=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":r={name:"ECDSA",namedCurve:"P-256"},i=["sign","verify"];break;case"ES384":r={name:"ECDSA",namedCurve:"P-384"},i=["sign","verify"];break;case"ES512":r={name:"ECDSA",namedCurve:"P-521"},i=["sign","verify"];break;case"Ed25519":r={name:"Ed25519"},i=["sign","verify"];break;case"EdDSA":{i=["sign","verify"];let e=t?.crv??"Ed25519";switch(e){case"Ed25519":case"Ed448":r={name:e};break;default:throw new I("Invalid or unsupported crv option provided")}break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{i=["deriveKey","deriveBits"];let e=t?.crv??"P-256";switch(e){case"P-256":case"P-384":case"P-521":r={name:"ECDH",namedCurve:e};break;case"X25519":case"X448":r={name:e};break;default:throw new I("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}break}default:throw new I('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return d.subtle.generateKey(r,t?.extractable??!1,i)}async function tQ(e,t){return tY(e,t)}async function t0(e,t){return tG(e,t)}var t1="WebCryptoAPI"},4825:function(e,t,r){"use strict";r.r(t),r.d(t,{base64:function(){return h},base64pad:function(){return p},base64url:function(){return f},base64urlpad:function(){return y}}),new Uint8Array(0);class i{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class a{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return n(this,e)}}class s{constructor(e){this.decoders=e}or(e){return n(this,e)}decode(e){let t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let n=(e,t)=>new s({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class o{constructor(e,t,r,s){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=s,this.encoder=new i(e,t,r),this.decoder=new a(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}let d=({name:e,prefix:t,encode:r,decode:i})=>new o(e,t,r,i),l=(e,t,r,i)=>{let a={};for(let e=0;e<t.length;++e)a[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;let n=new Uint8Array(s*r/8|0),o=0,d=0,l=0;for(let t=0;t<s;++t){let s=a[e[t]];if(void 0===s)throw SyntaxError(`Non-${i} character`);d=d<<r|s,(o+=r)>=8&&(o-=8,n[l++]=255&d>>o)}if(o>=r||255&d<<8-o)throw SyntaxError("Unexpected end of data");return n},c=(e,t,r)=>{let i="="===t[t.length-1],a=(1<<r)-1,s="",n=0,o=0;for(let i=0;i<e.length;++i)for(o=o<<8|e[i],n+=8;n>r;)n-=r,s+=t[a&o>>n];if(n&&(s+=t[a&o<<r-n]),i)for(;s.length*r&7;)s+="=";return s},u=({name:e,prefix:t,bitsPerChar:r,alphabet:i})=>d({prefix:t,name:e,encode:e=>c(e,i,r),decode:t=>l(t,i,r,e)}),h=u({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),p=u({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),f=u({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),y=u({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})}}]);