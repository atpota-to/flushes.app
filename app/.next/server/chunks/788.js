"use strict";exports.id=788,exports.ids=[788],exports.modules={88910:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.AtUri=t.ATP_URI_REGEX=void 0,i(r(72616),t),t.ATP_URI_REGEX=/^(at:\/\/)?((?:did:[a-z0-9:%-]+)|(?:[a-z0-9][a-z0-9.:-]*))(\/[^?#\s]*)?(\?[^#\s]+)?(#[^\s]+)?$/i;let o=/^(\/[^?#\s]*)?(\?[^#\s]+)?(#[^\s]+)?$/i;class n{constructor(e,t){let r;if(Object.defineProperty(this,"hash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"host",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pathname",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"searchParams",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),t){if(!(r=s(t)))throw Error(`Invalid at uri: ${t}`);let a=function(e){let t=o.exec(e);if(t)return{hash:t[3]||"",pathname:t[1]||"",searchParams:new URLSearchParams(t[2]||"")}}(e);if(!a)throw Error(`Invalid path: ${e}`);Object.assign(r,a)}else if(!(r=s(e)))throw Error(`Invalid at uri: ${e}`);this.hash=r.hash,this.host=r.host,this.pathname=r.pathname,this.searchParams=r.searchParams}static make(e,t,r){let a=e;return t&&(a+="/"+t),r&&(a+="/"+r),new n(a)}get protocol(){return"at:"}get origin(){return`at://${this.host}`}get hostname(){return this.host}set hostname(e){this.host=e}get search(){return this.searchParams.toString()}set search(e){this.searchParams=new URLSearchParams(e)}get collection(){return this.pathname.split("/").filter(Boolean)[0]||""}set collection(e){let t=this.pathname.split("/").filter(Boolean);t[0]=e,this.pathname=t.join("/")}get rkey(){return this.pathname.split("/").filter(Boolean)[1]||""}set rkey(e){let t=this.pathname.split("/").filter(Boolean);t[0]||(t[0]="undefined"),t[1]=e,this.pathname=t.join("/")}get href(){return this.toString()}toString(){let e=this.pathname||"/";e.startsWith("/")||(e=`/${e}`);let t=this.searchParams.toString();t&&!t.startsWith("?")&&(t=`?${t}`);let r=this.hash;return r&&!r.startsWith("#")&&(r=`#${r}`),`at://${this.host}${e}${t}${r}`}}function s(e){let r=t.ATP_URI_REGEX.exec(e);if(r)return{hash:r[5]||"",host:r[2]||"",pathname:r[3]||"",searchParams:new URLSearchParams(r[4]||"")}}t.AtUri=n},72616:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ensureValidAtUriRegex=t.ensureValidAtUri=void 0;let a=r(65781),i=r(93816),o=r(18354);t.ensureValidAtUri=e=>{let t=e.split("#");if(t.length>2)throw Error('ATURI can have at most one "#", separating fragment out');let r=t[1]||null;if(e=t[0],!/^[a-zA-Z0-9._~:@!$&')(*+,;=%/-]*$/.test(e))throw Error("Disallowed characters in ATURI (ASCII)");let n=e.split("/");if(n.length>=3&&("at:"!==n[0]||0!==n[1].length))throw Error('ATURI must start with "at://"');if(n.length<3)throw Error("ATURI requires at least method and authority sections");try{n[2].startsWith("did:")?(0,a.ensureValidDid)(n[2]):(0,i.ensureValidHandle)(n[2])}catch{throw Error("ATURI authority must be a valid handle or DID")}if(n.length>=4){if(0===n[3].length)throw Error("ATURI can not have a slash after authority without a path segment");try{(0,o.ensureValidNsid)(n[3])}catch{throw Error("ATURI requires first path segment (if supplied) to be valid NSID")}}if(n.length>=5&&0===n[4].length)throw Error("ATURI can not have a slash after collection, unless record key is provided");if(n.length>=6)throw Error("ATURI path can have at most two parts, and no trailing slash");if(t.length>=2&&null==r)throw Error("ATURI fragment must be non-empty and start with slash");if(null!=r){if(0===r.length||"/"!==r[0])throw Error("ATURI fragment must be non-empty and start with slash");if(!/^\/[a-zA-Z0-9._~:@!$&')(*+,;=%[\]/-]*$/.test(r))throw Error("Disallowed characters in ATURI fragment (ASCII)")}if(e.length>8192)throw Error("ATURI is far too long")},t.ensureValidAtUriRegex=e=>{let t=e.match(/^at:\/\/(?<authority>[a-zA-Z0-9._:%-]+)(\/(?<collection>[a-zA-Z0-9-.]+)(\/(?<rkey>[a-zA-Z0-9._~:@!$&%')(*+,;=-]+))?)?(#(?<fragment>\/[a-zA-Z0-9._~:@!$&%')(*+,;=\-[\]/\\]*))?$/);if(!t||!t.groups)throw Error("ATURI didn't validate via regex");let r=t.groups;try{(0,i.ensureValidHandleRegex)(r.authority)}catch{try{(0,a.ensureValidDidRegex)(r.authority)}catch{throw Error("ATURI authority must be a valid handle or DID")}}if(r.collection)try{(0,o.ensureValidNsidRegex)(r.collection)}catch{throw Error("ATURI collection path segment must be a valid NSID")}if(e.length>8192)throw Error("ATURI is far too long")}},90048:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidDatetimeError=t.normalizeDatetimeAlways=t.normalizeDatetime=t.isValidDatetime=t.ensureValidDatetime=void 0,t.ensureValidDatetime=e=>{let t=new Date(e);if(isNaN(t.getTime()))throw new r("datetime did not parse as ISO 8601");if(t.toISOString().startsWith("-"))throw new r("datetime normalized to a negative time");if(!/^[0-9]{4}-[01][0-9]-[0-3][0-9]T[0-2][0-9]:[0-6][0-9]:[0-6][0-9](.[0-9]{1,20})?(Z|([+-][0-2][0-9]:[0-5][0-9]))$/.test(e))throw new r("datetime didn't validate via regex");if(e.length>64)throw new r("datetime is too long (64 chars max)");if(e.endsWith("-00:00"))throw new r('datetime can not use "-00:00" for UTC timezone');if(e.startsWith("000"))throw new r("datetime so close to year zero not allowed")},t.isValidDatetime=e=>{try{(0,t.ensureValidDatetime)(e)}catch(e){if(e instanceof r)return!1;throw e}return!0},t.normalizeDatetime=e=>{if((0,t.isValidDatetime)(e)){let r=new Date(e).toISOString();if((0,t.isValidDatetime)(r))return r}if(!/.*(([+-]\d\d:?\d\d)|[a-zA-Z])$/.test(e)){let r=new Date(e+"Z");if(!isNaN(r.getTime())){let e=r.toISOString();if((0,t.isValidDatetime)(e))return e}}let a=new Date(e);if(isNaN(a.getTime()))throw new r("datetime did not parse as any timestamp format");let i=a.toISOString();if((0,t.isValidDatetime)(i))return i;throw new r("datetime normalized to invalid timestamp string")},t.normalizeDatetimeAlways=e=>{try{return(0,t.normalizeDatetime)(e)}catch(e){if(e instanceof r)return new Date(0).toISOString();throw e}};class r extends Error{}t.InvalidDatetimeError=r},65781:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidDidError=t.ensureValidDidRegex=t.ensureValidDid=void 0,t.ensureValidDid=e=>{if(!e.startsWith("did:"))throw new r('DID requires "did:" prefix');if(!/^[a-zA-Z0-9._:%-]*$/.test(e))throw new r("Disallowed characters in DID (ASCII letters, digits, and a couple other characters only)");let{length:t,1:a}=e.split(":");if(t<3)throw new r("DID requires prefix, method, and method-specific content");if(!/^[a-z]+$/.test(a))throw new r("DID method must be lower-case letters");if(e.endsWith(":")||e.endsWith("%"))throw new r('DID can not end with ":" or "%"');if(e.length>2048)throw new r("DID is too long (2048 chars max)")},t.ensureValidDidRegex=e=>{if(!/^did:[a-z]+:[a-zA-Z0-9._:%-]*[a-zA-Z0-9._-]$/.test(e))throw new r("DID didn't validate via regex");if(e.length>2048)throw new r("DID is too long (2048 chars max)")};class r extends Error{}t.InvalidDidError=r},93816:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DisallowedDomainError=t.UnsupportedDomainError=t.ReservedHandleError=t.InvalidHandleError=t.isValidTld=t.isValidHandle=t.normalizeAndEnsureValidHandle=t.normalizeHandle=t.ensureValidHandleRegex=t.ensureValidHandle=t.DISALLOWED_TLDS=t.INVALID_HANDLE=void 0,t.INVALID_HANDLE="handle.invalid",t.DISALLOWED_TLDS=[".local",".arpa",".invalid",".localhost",".internal",".example",".alt",".onion"],t.ensureValidHandle=e=>{if(!/^[a-zA-Z0-9.-]*$/.test(e))throw new r("Disallowed characters in handle (ASCII letters, digits, dashes, periods only)");if(e.length>253)throw new r("Handle is too long (253 chars max)");let t=e.split(".");if(t.length<2)throw new r("Handle domain needs at least two parts");for(let e=0;e<t.length;e++){let a=t[e];if(a.length<1)throw new r("Handle parts can not be empty");if(a.length>63)throw new r("Handle part too long (max 63 chars)");if(a.endsWith("-")||a.startsWith("-"))throw new r("Handle parts can not start or end with hyphens");if(e+1===t.length&&!/^[a-zA-Z]/.test(a))throw new r("Handle final component (TLD) must start with ASCII letter")}},t.ensureValidHandleRegex=e=>{if(!/^([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?$/.test(e))throw new r("Handle didn't validate via regex");if(e.length>253)throw new r("Handle is too long (253 chars max)")},t.normalizeHandle=e=>e.toLowerCase(),t.normalizeAndEnsureValidHandle=e=>{let r=(0,t.normalizeHandle)(e);return(0,t.ensureValidHandle)(r),r},t.isValidHandle=e=>{try{(0,t.ensureValidHandle)(e)}catch(e){if(e instanceof r)return!1;throw e}return!0},t.isValidTld=e=>!t.DISALLOWED_TLDS.some(t=>e.endsWith(t));class r extends Error{}t.InvalidHandleError=r;class a extends Error{}t.ReservedHandleError=a;class i extends Error{}t.UnsupportedDomainError=i;class o extends Error{}t.DisallowedDomainError=o},68227:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(93816),t),i(r(65781),t),i(r(18354),t),i(r(88910),t),i(r(22106),t),i(r(19461),t),i(r(90048),t)},18354:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidNsidError=t.ensureValidNsidRegex=t.ensureValidNsid=t.NSID=void 0;class r{static parse(e){return new r(e)}static create(e,t){return new r([...e.split(".").reverse(),t].join("."))}static isValid(e){try{return r.parse(e),!0}catch(e){return!1}}constructor(e){Object.defineProperty(this,"segments",{enumerable:!0,configurable:!0,writable:!0,value:[]}),(0,t.ensureValidNsid)(e),this.segments=e.split(".")}get authority(){return this.segments.slice(0,this.segments.length-1).reverse().join(".")}get name(){return this.segments.at(this.segments.length-1)}toString(){return this.segments.join(".")}}t.NSID=r,t.ensureValidNsid=e=>{if(!/^[a-zA-Z0-9.-]*$/.test(e))throw new a("Disallowed characters in NSID (ASCII letters, digits, dashes, periods only)");if(e.length>317)throw new a("NSID is too long (317 chars max)");let t=e.split(".");if(t.length<3)throw new a("NSID needs at least three parts");for(let e=0;e<t.length;e++){let r=t[e];if(r.length<1)throw new a("NSID parts can not be empty");if(r.length>63)throw new a("NSID part too long (max 63 chars)");if(r.endsWith("-")||r.startsWith("-"))throw new a("NSID parts can not start or end with hyphen");if(/^[0-9]/.test(r)&&0===e)throw new a("NSID first part may not start with a digit");if(!/^[a-zA-Z][a-zA-Z0-9]*$/.test(r)&&e+1===t.length)throw new a("NSID name part must be only letters and digits (and no leading digit)")}},t.ensureValidNsidRegex=e=>{if(!/^[a-zA-Z]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(\.[a-zA-Z]([a-zA-Z0-9]{0,62})?)$/.test(e))throw new a("NSID didn't validate via regex");if(e.length>317)throw new a("NSID is too long (317 chars max)")};class a extends Error{}t.InvalidNsidError=a},19461:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidRecordKeyError=t.isValidRecordKey=t.ensureValidRecordKey=void 0,t.ensureValidRecordKey=e=>{if(e.length>512||e.length<1)throw new r("record key must be 1 to 512 characters");if(!/^[a-zA-Z0-9_~.:-]{1,512}$/.test(e))throw new r("record key syntax not valid (regex)");if("."===e||".."===e)throw new r('record key can not be "." or ".."')},t.isValidRecordKey=e=>{try{(0,t.ensureValidRecordKey)(e)}catch(e){if(e instanceof r)return!1;throw e}return!0};class r extends Error{}t.InvalidRecordKeyError=r},22106:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidTidError=t.isValidTid=t.ensureValidTid=void 0;let r=/^[234567abcdefghij][234567abcdefghijklmnopqrstuvwxyz]{12}$/;t.ensureValidTid=e=>{if(13!==e.length)throw new a("TID must be 13 characters");if(!r.test(e))throw new a("TID syntax not valid (regex)")},t.isValidTid=e=>13===e.length&&r.test(e);class a extends Error{}t.InvalidTidError=a},55547:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.cryptoRuntime=t.base64url=t.generateSecret=t.generateKeyPair=t.errors=t.decodeJwt=t.decodeProtectedHeader=t.importJWK=t.importX509=t.importPKCS8=t.importSPKI=t.exportJWK=t.exportSPKI=t.exportPKCS8=t.UnsecuredJWT=t.experimental_jwksCache=t.jwksCache=t.createRemoteJWKSet=t.createLocalJWKSet=t.EmbeddedJWK=t.calculateJwkThumbprintUri=t.calculateJwkThumbprint=t.EncryptJWT=t.SignJWT=t.GeneralSign=t.FlattenedSign=t.CompactSign=t.FlattenedEncrypt=t.CompactEncrypt=t.jwtDecrypt=t.jwtVerify=t.generalVerify=t.flattenedVerify=t.compactVerify=t.GeneralEncrypt=t.generalDecrypt=t.flattenedDecrypt=t.compactDecrypt=void 0;var a=r(82290);Object.defineProperty(t,"compactDecrypt",{enumerable:!0,get:function(){return a.compactDecrypt}});var i=r(1806);Object.defineProperty(t,"flattenedDecrypt",{enumerable:!0,get:function(){return i.flattenedDecrypt}});var o=r(9908);Object.defineProperty(t,"generalDecrypt",{enumerable:!0,get:function(){return o.generalDecrypt}});var n=r(92416);Object.defineProperty(t,"GeneralEncrypt",{enumerable:!0,get:function(){return n.GeneralEncrypt}});var s=r(161);Object.defineProperty(t,"compactVerify",{enumerable:!0,get:function(){return s.compactVerify}});var d=r(40122);Object.defineProperty(t,"flattenedVerify",{enumerable:!0,get:function(){return d.flattenedVerify}});var l=r(6229);Object.defineProperty(t,"generalVerify",{enumerable:!0,get:function(){return l.generalVerify}});var c=r(38176);Object.defineProperty(t,"jwtVerify",{enumerable:!0,get:function(){return c.jwtVerify}});var u=r(83337);Object.defineProperty(t,"jwtDecrypt",{enumerable:!0,get:function(){return u.jwtDecrypt}});var h=r(88777);Object.defineProperty(t,"CompactEncrypt",{enumerable:!0,get:function(){return h.CompactEncrypt}});var p=r(31979);Object.defineProperty(t,"FlattenedEncrypt",{enumerable:!0,get:function(){return p.FlattenedEncrypt}});var f=r(3131);Object.defineProperty(t,"CompactSign",{enumerable:!0,get:function(){return f.CompactSign}});var y=r(24532);Object.defineProperty(t,"FlattenedSign",{enumerable:!0,get:function(){return y.FlattenedSign}});var m=r(44945);Object.defineProperty(t,"GeneralSign",{enumerable:!0,get:function(){return m.GeneralSign}});var g=r(1373);Object.defineProperty(t,"SignJWT",{enumerable:!0,get:function(){return g.SignJWT}});var v=r(51612);Object.defineProperty(t,"EncryptJWT",{enumerable:!0,get:function(){return v.EncryptJWT}});var w=r(62826);Object.defineProperty(t,"calculateJwkThumbprint",{enumerable:!0,get:function(){return w.calculateJwkThumbprint}}),Object.defineProperty(t,"calculateJwkThumbprintUri",{enumerable:!0,get:function(){return w.calculateJwkThumbprintUri}});var _=r(27576);Object.defineProperty(t,"EmbeddedJWK",{enumerable:!0,get:function(){return _.EmbeddedJWK}});var b=r(5979);Object.defineProperty(t,"createLocalJWKSet",{enumerable:!0,get:function(){return b.createLocalJWKSet}});var S=r(25267);Object.defineProperty(t,"createRemoteJWKSet",{enumerable:!0,get:function(){return S.createRemoteJWKSet}}),Object.defineProperty(t,"jwksCache",{enumerable:!0,get:function(){return S.jwksCache}}),Object.defineProperty(t,"experimental_jwksCache",{enumerable:!0,get:function(){return S.experimental_jwksCache}});var E=r(29211);Object.defineProperty(t,"UnsecuredJWT",{enumerable:!0,get:function(){return E.UnsecuredJWT}});var k=r(85175);Object.defineProperty(t,"exportPKCS8",{enumerable:!0,get:function(){return k.exportPKCS8}}),Object.defineProperty(t,"exportSPKI",{enumerable:!0,get:function(){return k.exportSPKI}}),Object.defineProperty(t,"exportJWK",{enumerable:!0,get:function(){return k.exportJWK}});var P=r(54183);Object.defineProperty(t,"importSPKI",{enumerable:!0,get:function(){return P.importSPKI}}),Object.defineProperty(t,"importPKCS8",{enumerable:!0,get:function(){return P.importPKCS8}}),Object.defineProperty(t,"importX509",{enumerable:!0,get:function(){return P.importX509}}),Object.defineProperty(t,"importJWK",{enumerable:!0,get:function(){return P.importJWK}});var I=r(96678);Object.defineProperty(t,"decodeProtectedHeader",{enumerable:!0,get:function(){return I.decodeProtectedHeader}});var A=r(91758);Object.defineProperty(t,"decodeJwt",{enumerable:!0,get:function(){return A.decodeJwt}}),t.errors=r(3674);var O=r(62730);Object.defineProperty(t,"generateKeyPair",{enumerable:!0,get:function(){return O.generateKeyPair}});var T=r(53029);Object.defineProperty(t,"generateSecret",{enumerable:!0,get:function(){return T.generateSecret}}),t.base64url=r(46486);var C=r(1357);Object.defineProperty(t,"cryptoRuntime",{enumerable:!0,get:function(){return C.default}})},82290:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.compactDecrypt=n;let a=r(1806),i=r(3674),o=r(41444);async function n(e,t,r){if(e instanceof Uint8Array&&(e=o.decoder.decode(e)),"string"!=typeof e)throw new i.JWEInvalid("Compact JWE must be a string or Uint8Array");let{0:n,1:s,2:d,3:l,4:c,length:u}=e.split(".");if(5!==u)throw new i.JWEInvalid("Invalid Compact JWE");let h=await (0,a.flattenedDecrypt)({ciphertext:l,iv:d||void 0,protected:n,tag:c||void 0,encrypted_key:s||void 0},t,r),p={plaintext:h.plaintext,protectedHeader:h.protectedHeader};return"function"==typeof t?{...p,key:h.key}:p}},88777:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CompactEncrypt=void 0;let a=r(31979);class i{_flattened;constructor(e){this._flattened=new a.FlattenedEncrypt(e)}setContentEncryptionKey(e){return this._flattened.setContentEncryptionKey(e),this}setInitializationVector(e){return this._flattened.setInitializationVector(e),this}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}setKeyManagementParameters(e){return this._flattened.setKeyManagementParameters(e),this}async encrypt(e,t){let r=await this._flattened.encrypt(e,t);return[r.protected,r.encrypted_key,r.iv,r.ciphertext,r.tag].join(".")}}t.CompactEncrypt=i},1806:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.flattenedDecrypt=p;let a=r(77145),i=r(49622),o=r(3674),n=r(17905),s=r(95788),d=r(10806),l=r(41444),c=r(54463),u=r(97430),h=r(62642);async function p(e,t,r){let p,f,y,m,g,v,w;if(!(0,s.default)(e))throw new o.JWEInvalid("Flattened JWE must be an object");if(void 0===e.protected&&void 0===e.header&&void 0===e.unprotected)throw new o.JWEInvalid("JOSE Header missing");if(void 0!==e.iv&&"string"!=typeof e.iv)throw new o.JWEInvalid("JWE Initialization Vector incorrect type");if("string"!=typeof e.ciphertext)throw new o.JWEInvalid("JWE Ciphertext missing or incorrect type");if(void 0!==e.tag&&"string"!=typeof e.tag)throw new o.JWEInvalid("JWE Authentication Tag incorrect type");if(void 0!==e.protected&&"string"!=typeof e.protected)throw new o.JWEInvalid("JWE Protected Header incorrect type");if(void 0!==e.encrypted_key&&"string"!=typeof e.encrypted_key)throw new o.JWEInvalid("JWE Encrypted Key incorrect type");if(void 0!==e.aad&&"string"!=typeof e.aad)throw new o.JWEInvalid("JWE AAD incorrect type");if(void 0!==e.header&&!(0,s.default)(e.header))throw new o.JWEInvalid("JWE Shared Unprotected Header incorrect type");if(void 0!==e.unprotected&&!(0,s.default)(e.unprotected))throw new o.JWEInvalid("JWE Per-Recipient Unprotected Header incorrect type");if(e.protected)try{let t=(0,a.decode)(e.protected);p=JSON.parse(l.decoder.decode(t))}catch{throw new o.JWEInvalid("JWE Protected Header is invalid")}if(!(0,n.default)(p,e.header,e.unprotected))throw new o.JWEInvalid("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let _={...p,...e.header,...e.unprotected};if((0,u.default)(o.JWEInvalid,new Map,r?.crit,p,_),void 0!==_.zip)throw new o.JOSENotSupported('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:b,enc:S}=_;if("string"!=typeof b||!b)throw new o.JWEInvalid("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof S||!S)throw new o.JWEInvalid("missing JWE Encryption Algorithm (enc) in JWE Header");let E=r&&(0,h.default)("keyManagementAlgorithms",r.keyManagementAlgorithms),k=r&&(0,h.default)("contentEncryptionAlgorithms",r.contentEncryptionAlgorithms);if(E&&!E.has(b)||!E&&b.startsWith("PBES2"))throw new o.JOSEAlgNotAllowed('"alg" (Algorithm) Header Parameter value not allowed');if(k&&!k.has(S))throw new o.JOSEAlgNotAllowed('"enc" (Encryption Algorithm) Header Parameter value not allowed');if(void 0!==e.encrypted_key)try{f=(0,a.decode)(e.encrypted_key)}catch{throw new o.JWEInvalid("Failed to base64url decode the encrypted_key")}let P=!1;"function"==typeof t&&(t=await t(p,e),P=!0);try{y=await (0,d.default)(b,t,f,_,r)}catch(e){if(e instanceof TypeError||e instanceof o.JWEInvalid||e instanceof o.JOSENotSupported)throw e;y=(0,c.default)(S)}if(void 0!==e.iv)try{m=(0,a.decode)(e.iv)}catch{throw new o.JWEInvalid("Failed to base64url decode the iv")}if(void 0!==e.tag)try{g=(0,a.decode)(e.tag)}catch{throw new o.JWEInvalid("Failed to base64url decode the tag")}let I=l.encoder.encode(e.protected??"");v=void 0!==e.aad?(0,l.concat)(I,l.encoder.encode("."),l.encoder.encode(e.aad)):I;try{w=(0,a.decode)(e.ciphertext)}catch{throw new o.JWEInvalid("Failed to base64url decode the ciphertext")}let A={plaintext:await (0,i.default)(S,y,w,m,g,v)};if(void 0!==e.protected&&(A.protectedHeader=p),void 0!==e.aad)try{A.additionalAuthenticatedData=(0,a.decode)(e.aad)}catch{throw new o.JWEInvalid("Failed to base64url decode the aad")}return(void 0!==e.unprotected&&(A.sharedUnprotectedHeader=e.unprotected),void 0!==e.header&&(A.unprotectedHeader=e.header),P)?{...A,key:t}:A}},31979:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FlattenedEncrypt=void 0;let a=r(77145),i=r(70061),o=r(75712),n=r(25983),s=r(3674),d=r(17905),l=r(41444),c=r(97430);class u{_plaintext;_protectedHeader;_sharedUnprotectedHeader;_unprotectedHeader;_aad;_cek;_iv;_keyManagementParameters;constructor(e){if(!(e instanceof Uint8Array))throw TypeError("plaintext must be an instance of Uint8Array");this._plaintext=e}setKeyManagementParameters(e){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._sharedUnprotectedHeader)throw TypeError("setSharedUnprotectedHeader can only be called once");return this._sharedUnprotectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}setContentEncryptionKey(e){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=e,this}async encrypt(e,t){let r,u,h,p,f;if(!this._protectedHeader&&!this._unprotectedHeader&&!this._sharedUnprotectedHeader)throw new s.JWEInvalid("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!(0,d.default)(this._protectedHeader,this._unprotectedHeader,this._sharedUnprotectedHeader))throw new s.JWEInvalid("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let y={...this._protectedHeader,...this._unprotectedHeader,...this._sharedUnprotectedHeader};if((0,c.default)(s.JWEInvalid,new Map,t?.crit,this._protectedHeader,y),void 0!==y.zip)throw new s.JOSENotSupported('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:m,enc:g}=y;if("string"!=typeof m||!m)throw new s.JWEInvalid('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("string"!=typeof g||!g)throw new s.JWEInvalid('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(this._cek&&("dir"===m||"ECDH-ES"===m))throw TypeError(`setContentEncryptionKey cannot be called with JWE "alg" (Algorithm) Header ${m}`);{let a;({cek:u,encryptedKey:r,parameters:a}=await (0,n.default)(m,g,e,this._cek,this._keyManagementParameters)),a&&(t&&i.unprotected in t?this._unprotectedHeader?this._unprotectedHeader={...this._unprotectedHeader,...a}:this.setUnprotectedHeader(a):this._protectedHeader?this._protectedHeader={...this._protectedHeader,...a}:this.setProtectedHeader(a))}p=this._protectedHeader?l.encoder.encode((0,a.encode)(JSON.stringify(this._protectedHeader))):l.encoder.encode(""),this._aad?(f=(0,a.encode)(this._aad),h=(0,l.concat)(p,l.encoder.encode("."),l.encoder.encode(f))):h=p;let{ciphertext:v,tag:w,iv:_}=await (0,o.default)(g,this._plaintext,u,this._iv,h),b={ciphertext:(0,a.encode)(v)};return _&&(b.iv=(0,a.encode)(_)),w&&(b.tag=(0,a.encode)(w)),r&&(b.encrypted_key=(0,a.encode)(r)),f&&(b.aad=f),this._protectedHeader&&(b.protected=l.decoder.decode(p)),this._sharedUnprotectedHeader&&(b.unprotected=this._sharedUnprotectedHeader),this._unprotectedHeader&&(b.header=this._unprotectedHeader),b}}t.FlattenedEncrypt=u},9908:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generalDecrypt=n;let a=r(1806),i=r(3674),o=r(95788);async function n(e,t,r){if(!(0,o.default)(e))throw new i.JWEInvalid("General JWE must be an object");if(!Array.isArray(e.recipients)||!e.recipients.every(o.default))throw new i.JWEInvalid("JWE Recipients missing or incorrect type");if(!e.recipients.length)throw new i.JWEInvalid("JWE Recipients has no members");for(let i of e.recipients)try{return await (0,a.flattenedDecrypt)({aad:e.aad,ciphertext:e.ciphertext,encrypted_key:i.encrypted_key,header:i.header,iv:e.iv,protected:e.protected,tag:e.tag,unprotected:e.unprotected},t,r)}catch{}throw new i.JWEDecryptionFailed}},92416:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GeneralEncrypt=void 0;let a=r(31979),i=r(70061),o=r(3674),n=r(54463),s=r(17905),d=r(25983),l=r(77145),c=r(97430);class u{parent;unprotectedHeader;key;options;constructor(e,t,r){this.parent=e,this.key=t,this.options=r}setUnprotectedHeader(e){if(this.unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=e,this}addRecipient(...e){return this.parent.addRecipient(...e)}encrypt(...e){return this.parent.encrypt(...e)}done(){return this.parent}}class h{_plaintext;_recipients=[];_protectedHeader;_unprotectedHeader;_aad;constructor(e){this._plaintext=e}addRecipient(e,t){let r=new u(this,e,{crit:t?.crit});return this._recipients.push(r),r}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setSharedUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}async encrypt(){let e;if(!this._recipients.length)throw new o.JWEInvalid("at least one recipient must be added");if(1===this._recipients.length){let[e]=this._recipients,t=await new a.FlattenedEncrypt(this._plaintext).setAdditionalAuthenticatedData(this._aad).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(e.unprotectedHeader).encrypt(e.key,{...e.options}),r={ciphertext:t.ciphertext,iv:t.iv,recipients:[{}],tag:t.tag};return t.aad&&(r.aad=t.aad),t.protected&&(r.protected=t.protected),t.unprotected&&(r.unprotected=t.unprotected),t.encrypted_key&&(r.recipients[0].encrypted_key=t.encrypted_key),t.header&&(r.recipients[0].header=t.header),r}for(let t=0;t<this._recipients.length;t++){let r=this._recipients[t];if(!(0,s.default)(this._protectedHeader,this._unprotectedHeader,r.unprotectedHeader))throw new o.JWEInvalid("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let a={...this._protectedHeader,...this._unprotectedHeader,...r.unprotectedHeader},{alg:i}=a;if("string"!=typeof i||!i)throw new o.JWEInvalid('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("dir"===i||"ECDH-ES"===i)throw new o.JWEInvalid('"dir" and "ECDH-ES" alg may only be used with a single recipient');if("string"!=typeof a.enc||!a.enc)throw new o.JWEInvalid('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(e){if(e!==a.enc)throw new o.JWEInvalid('JWE "enc" (Encryption Algorithm) Header Parameter must be the same for all recipients')}else e=a.enc;if((0,c.default)(o.JWEInvalid,new Map,r.options.crit,this._protectedHeader,a),void 0!==a.zip)throw new o.JOSENotSupported('JWE "zip" (Compression Algorithm) Header Parameter is not supported.')}let t=(0,n.default)(e),r={ciphertext:"",iv:"",recipients:[],tag:""};for(let o=0;o<this._recipients.length;o++){let n=this._recipients[o],s={};r.recipients.push(s);let c=({...this._protectedHeader,...this._unprotectedHeader,...n.unprotectedHeader}).alg.startsWith("PBES2")?2048+o:void 0;if(0===o){let e=await new a.FlattenedEncrypt(this._plaintext).setAdditionalAuthenticatedData(this._aad).setContentEncryptionKey(t).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(n.unprotectedHeader).setKeyManagementParameters({p2c:c}).encrypt(n.key,{...n.options,[i.unprotected]:!0});r.ciphertext=e.ciphertext,r.iv=e.iv,r.tag=e.tag,e.aad&&(r.aad=e.aad),e.protected&&(r.protected=e.protected),e.unprotected&&(r.unprotected=e.unprotected),s.encrypted_key=e.encrypted_key,e.header&&(s.header=e.header);continue}let{encryptedKey:u,parameters:h}=await (0,d.default)(n.unprotectedHeader?.alg||this._protectedHeader?.alg||this._unprotectedHeader?.alg,e,n.key,t,{p2c:c});s.encrypted_key=(0,l.encode)(u),(n.unprotectedHeader||h)&&(s.header={...n.unprotectedHeader,...h})}return r}}t.GeneralEncrypt=h},27576:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EmbeddedJWK=n;let a=r(54183),i=r(95788),o=r(3674);async function n(e,t){let r={...e,...t?.header};if(!(0,i.default)(r.jwk))throw new o.JWSInvalid('"jwk" (JSON Web Key) Header Parameter must be a JSON object');let n=await (0,a.importJWK)({...r.jwk,ext:!0},r.alg);if(n instanceof Uint8Array||"public"!==n.type)throw new o.JWSInvalid('"jwk" (JSON Web Key) Header Parameter must be a public key');return n}},62826:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.calculateJwkThumbprint=l,t.calculateJwkThumbprintUri=c;let a=r(35657),i=r(77145),o=r(3674),n=r(41444),s=r(95788),d=(e,t)=>{if("string"!=typeof e||!e)throw new o.JWKInvalid(`${t} missing or invalid`)};async function l(e,t){let r;if(!(0,s.default)(e))throw TypeError("JWK must be an object");if("sha256"!==(t??="sha256")&&"sha384"!==t&&"sha512"!==t)throw TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');switch(e.kty){case"EC":d(e.crv,'"crv" (Curve) Parameter'),d(e.x,'"x" (X Coordinate) Parameter'),d(e.y,'"y" (Y Coordinate) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x,y:e.y};break;case"OKP":d(e.crv,'"crv" (Subtype of Key Pair) Parameter'),d(e.x,'"x" (Public Key) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x};break;case"RSA":d(e.e,'"e" (Exponent) Parameter'),d(e.n,'"n" (Modulus) Parameter'),r={e:e.e,kty:e.kty,n:e.n};break;case"oct":d(e.k,'"k" (Key Value) Parameter'),r={k:e.k,kty:e.kty};break;default:throw new o.JOSENotSupported('"kty" (Key Type) Parameter missing or unsupported')}let l=n.encoder.encode(JSON.stringify(r));return(0,i.encode)(await (0,a.default)(t,l))}async function c(e,t){t??="sha256";let r=await l(e,t);return`urn:ietf:params:oauth:jwk-thumbprint:sha-${t.slice(-3)}:${r}`}},5979:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createLocalJWKSet=function(e){let t=new d(e),r=async(e,r)=>t.getKey(e,r);return Object.defineProperties(r,{jwks:{value:()=>s(t._jwks),enumerable:!0,configurable:!1,writable:!1}}),r};let a=r(54183),i=r(3674),o=r(95788);function n(e){return(0,o.default)(e)}function s(e){return"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}class d{_jwks;_cached=new WeakMap;constructor(e){if(!function(e){return e&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(n)}(e))throw new i.JWKSInvalid("JSON Web Key Set malformed");this._jwks=s(e)}async getKey(e,t){let{alg:r,kid:a}={...e,...t?.header},o=function(e){switch("string"==typeof e&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new i.JOSENotSupported('Unsupported "alg" value for a JSON Web Key Set')}}(r),n=this._jwks.keys.filter(e=>{let t=o===e.kty;if(t&&"string"==typeof a&&(t=a===e.kid),t&&"string"==typeof e.alg&&(t=r===e.alg),t&&"string"==typeof e.use&&(t="sig"===e.use),t&&Array.isArray(e.key_ops)&&(t=e.key_ops.includes("verify")),t)switch(r){case"ES256":t="P-256"===e.crv;break;case"ES256K":t="secp256k1"===e.crv;break;case"ES384":t="P-384"===e.crv;break;case"ES512":t="P-521"===e.crv;break;case"Ed25519":t="Ed25519"===e.crv;break;case"EdDSA":t="Ed25519"===e.crv||"Ed448"===e.crv}return t}),{0:s,length:d}=n;if(0===d)throw new i.JWKSNoMatchingKey;if(1!==d){let e=new i.JWKSMultipleMatchingKeys,{_cached:t}=this;throw e[Symbol.asyncIterator]=async function*(){for(let e of n)try{yield await l(t,e,r)}catch{}},e}return l(this._cached,s,r)}}async function l(e,t,r){let o=e.get(t)||e.set(t,{}).get(t);if(void 0===o[r]){let e=await (0,a.importJWK)({...t,ext:!0},r);if(e instanceof Uint8Array||"public"!==e.type)throw new i.JWKSInvalid("JSON Web Key Set members must be public keys");o[r]=e}return o[r]}},25267:(e,t,r)=>{let a;Object.defineProperty(t,"__esModule",{value:!0}),t.experimental_jwksCache=t.jwksCache=void 0,t.createRemoteJWKSet=function(e,t){let r=new d(e,t),a=async(e,t)=>r.getKey(e,t);return Object.defineProperties(a,{coolingDown:{get:()=>r.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>r.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>r.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>!!r._pendingFetch,enumerable:!0,configurable:!1},jwks:{value:()=>r._local?.jwks(),enumerable:!0,configurable:!1,writable:!1}}),a};let i=r(43264),o=r(3674),n=r(5979),s=r(95788);"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(a="jose/v5.10.0"),t.jwksCache=Symbol();class d{_url;_timeoutDuration;_cooldownDuration;_cacheMaxAge;_jwksTimestamp;_pendingFetch;_options;_local;_cache;constructor(e,r){if(!(e instanceof URL))throw TypeError("url must be an instance of URL");this._url=new URL(e.href),this._options={agent:r?.agent,headers:r?.headers},this._timeoutDuration="number"==typeof r?.timeoutDuration?r?.timeoutDuration:5e3,this._cooldownDuration="number"==typeof r?.cooldownDuration?r?.cooldownDuration:3e4,this._cacheMaxAge="number"==typeof r?.cacheMaxAge?r?.cacheMaxAge:6e5,r?.[t.jwksCache]!==void 0&&(this._cache=r?.[t.jwksCache],function(e,t){return!!(!("object"!=typeof e||null===e||!("uat"in e)||"number"!=typeof e.uat||Date.now()-e.uat>=t)&&"jwks"in e&&(0,s.default)(e.jwks)&&Array.isArray(e.jwks.keys)&&Array.prototype.every.call(e.jwks.keys,s.default))}(r?.[t.jwksCache],this._cacheMaxAge)&&(this._jwksTimestamp=this._cache.uat,this._local=(0,n.createLocalJWKSet)(this._cache.jwks)))}coolingDown(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cooldownDuration}fresh(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cacheMaxAge}async getKey(e,t){this._local&&this.fresh()||await this.reload();try{return await this._local(e,t)}catch(r){if(r instanceof o.JWKSNoMatchingKey&&!1===this.coolingDown())return await this.reload(),this._local(e,t);throw r}}async reload(){this._pendingFetch&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this._pendingFetch=void 0);let e=new Headers(this._options.headers);a&&!e.has("User-Agent")&&(e.set("User-Agent",a),this._options.headers=Object.fromEntries(e.entries())),this._pendingFetch||=(0,i.default)(this._url,this._timeoutDuration,this._options).then(e=>{this._local=(0,n.createLocalJWKSet)(e),this._cache&&(this._cache.uat=Date.now(),this._cache.jwks=e),this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(e=>{throw this._pendingFetch=void 0,e}),await this._pendingFetch}}t.experimental_jwksCache=t.jwksCache},3131:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CompactSign=void 0;let a=r(24532);class i{_flattened;constructor(e){this._flattened=new a.FlattenedSign(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){let r=await this._flattened.sign(e,t);if(void 0===r.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`}}t.CompactSign=i},161:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.compactVerify=n;let a=r(40122),i=r(3674),o=r(41444);async function n(e,t,r){if(e instanceof Uint8Array&&(e=o.decoder.decode(e)),"string"!=typeof e)throw new i.JWSInvalid("Compact JWS must be a string or Uint8Array");let{0:n,1:s,2:d,length:l}=e.split(".");if(3!==l)throw new i.JWSInvalid("Invalid Compact JWS");let c=await (0,a.flattenedVerify)({payload:s,protected:n,signature:d},t,r),u={payload:c.payload,protectedHeader:c.protectedHeader};return"function"==typeof t?{...u,key:c.key}:u}},24532:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FlattenedSign=void 0;let a=r(77145),i=r(87200),o=r(17905),n=r(3674),s=r(41444),d=r(50168),l=r(97430);class c{_payload;_protectedHeader;_unprotectedHeader;constructor(e){if(!(e instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){let r;if(!this._protectedHeader&&!this._unprotectedHeader)throw new n.JWSInvalid("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!(0,o.default)(this._protectedHeader,this._unprotectedHeader))throw new n.JWSInvalid("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let c={...this._protectedHeader,...this._unprotectedHeader},u=(0,l.default)(n.JWSInvalid,new Map([["b64",!0]]),t?.crit,this._protectedHeader,c),h=!0;if(u.has("b64")&&"boolean"!=typeof(h=this._protectedHeader.b64))throw new n.JWSInvalid('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:p}=c;if("string"!=typeof p||!p)throw new n.JWSInvalid('JWS "alg" (Algorithm) Header Parameter missing or invalid');(0,d.checkKeyTypeWithJwk)(p,e,"sign");let f=this._payload;h&&(f=s.encoder.encode((0,a.encode)(f))),r=this._protectedHeader?s.encoder.encode((0,a.encode)(JSON.stringify(this._protectedHeader))):s.encoder.encode("");let y=(0,s.concat)(r,s.encoder.encode("."),f),m=await (0,i.default)(p,e,y),g={signature:(0,a.encode)(m),payload:""};return h&&(g.payload=s.decoder.decode(f)),this._unprotectedHeader&&(g.header=this._unprotectedHeader),this._protectedHeader&&(g.protected=s.decoder.decode(r)),g}}t.FlattenedSign=c},40122:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.flattenedVerify=f;let a=r(77145),i=r(4008),o=r(3674),n=r(41444),s=r(17905),d=r(95788),l=r(50168),c=r(97430),u=r(62642),h=r(5620),p=r(54183);async function f(e,t,r){let f,y;if(!(0,d.default)(e))throw new o.JWSInvalid("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new o.JWSInvalid('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new o.JWSInvalid("JWS Protected Header incorrect type");if(void 0===e.payload)throw new o.JWSInvalid("JWS Payload missing");if("string"!=typeof e.signature)throw new o.JWSInvalid("JWS Signature missing or incorrect type");if(void 0!==e.header&&!(0,d.default)(e.header))throw new o.JWSInvalid("JWS Unprotected Header incorrect type");let m={};if(e.protected)try{let t=(0,a.decode)(e.protected);m=JSON.parse(n.decoder.decode(t))}catch{throw new o.JWSInvalid("JWS Protected Header is invalid")}if(!(0,s.default)(m,e.header))throw new o.JWSInvalid("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let g={...m,...e.header},v=(0,c.default)(o.JWSInvalid,new Map([["b64",!0]]),r?.crit,m,g),w=!0;if(v.has("b64")&&"boolean"!=typeof(w=m.b64))throw new o.JWSInvalid('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:_}=g;if("string"!=typeof _||!_)throw new o.JWSInvalid('JWS "alg" (Algorithm) Header Parameter missing or invalid');let b=r&&(0,u.default)("algorithms",r.algorithms);if(b&&!b.has(_))throw new o.JOSEAlgNotAllowed('"alg" (Algorithm) Header Parameter value not allowed');if(w){if("string"!=typeof e.payload)throw new o.JWSInvalid("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new o.JWSInvalid("JWS Payload must be a string or an Uint8Array instance");let S=!1;"function"==typeof t?(t=await t(m,e),S=!0,(0,l.checkKeyTypeWithJwk)(_,t,"verify"),(0,h.isJWK)(t)&&(t=await (0,p.importJWK)(t,_))):(0,l.checkKeyTypeWithJwk)(_,t,"verify");let E=(0,n.concat)(n.encoder.encode(e.protected??""),n.encoder.encode("."),"string"==typeof e.payload?n.encoder.encode(e.payload):e.payload);try{f=(0,a.decode)(e.signature)}catch{throw new o.JWSInvalid("Failed to base64url decode the signature")}if(!await (0,i.default)(_,t,f,E))throw new o.JWSSignatureVerificationFailed;if(w)try{y=(0,a.decode)(e.payload)}catch{throw new o.JWSInvalid("Failed to base64url decode the payload")}else y="string"==typeof e.payload?n.encoder.encode(e.payload):e.payload;let k={payload:y};return(void 0!==e.protected&&(k.protectedHeader=m),void 0!==e.header&&(k.unprotectedHeader=e.header),S)?{...k,key:t}:k}},44945:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GeneralSign=void 0;let a=r(24532),i=r(3674);class o{parent;protectedHeader;unprotectedHeader;options;key;constructor(e,t,r){this.parent=e,this.key=t,this.options=r}setProtectedHeader(e){if(this.protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this.protectedHeader=e,this}setUnprotectedHeader(e){if(this.unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=e,this}addSignature(...e){return this.parent.addSignature(...e)}sign(...e){return this.parent.sign(...e)}done(){return this.parent}}class n{_payload;_signatures=[];constructor(e){this._payload=e}addSignature(e,t){let r=new o(this,e,t);return this._signatures.push(r),r}async sign(){if(!this._signatures.length)throw new i.JWSInvalid("at least one signature must be added");let e={signatures:[],payload:""};for(let t=0;t<this._signatures.length;t++){let r=this._signatures[t],o=new a.FlattenedSign(this._payload);o.setProtectedHeader(r.protectedHeader),o.setUnprotectedHeader(r.unprotectedHeader);let{payload:n,...s}=await o.sign(r.key,r.options);if(0===t)e.payload=n;else if(e.payload!==n)throw new i.JWSInvalid("inconsistent use of JWS Unencoded Payload (RFC7797)");e.signatures.push(s)}return e}}t.GeneralSign=n},6229:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generalVerify=n;let a=r(40122),i=r(3674),o=r(95788);async function n(e,t,r){if(!(0,o.default)(e))throw new i.JWSInvalid("General JWS must be an object");if(!Array.isArray(e.signatures)||!e.signatures.every(o.default))throw new i.JWSInvalid("JWS Signatures missing or incorrect type");for(let i of e.signatures)try{return await (0,a.flattenedVerify)({header:i.header,payload:e.payload,protected:i.protected,signature:i.signature},t,r)}catch{}throw new i.JWSSignatureVerificationFailed}},83337:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.jwtDecrypt=n;let a=r(82290),i=r(61473),o=r(3674);async function n(e,t,r){let n=await (0,a.compactDecrypt)(e,t,r),s=(0,i.default)(n.protectedHeader,n.plaintext,r),{protectedHeader:d}=n;if(void 0!==d.iss&&d.iss!==s.iss)throw new o.JWTClaimValidationFailed('replicated "iss" claim header parameter mismatch',s,"iss","mismatch");if(void 0!==d.sub&&d.sub!==s.sub)throw new o.JWTClaimValidationFailed('replicated "sub" claim header parameter mismatch',s,"sub","mismatch");if(void 0!==d.aud&&JSON.stringify(d.aud)!==JSON.stringify(s.aud))throw new o.JWTClaimValidationFailed('replicated "aud" claim header parameter mismatch',s,"aud","mismatch");let l={payload:s,protectedHeader:d};return"function"==typeof t?{...l,key:n.key}:l}},51612:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EncryptJWT=void 0;let a=r(88777),i=r(41444),o=r(19007);class n extends o.ProduceJWT{_cek;_iv;_keyManagementParameters;_protectedHeader;_replicateIssuerAsHeader;_replicateSubjectAsHeader;_replicateAudienceAsHeader;setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setKeyManagementParameters(e){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setContentEncryptionKey(e){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=e,this}replicateIssuerAsHeader(){return this._replicateIssuerAsHeader=!0,this}replicateSubjectAsHeader(){return this._replicateSubjectAsHeader=!0,this}replicateAudienceAsHeader(){return this._replicateAudienceAsHeader=!0,this}async encrypt(e,t){let r=new a.CompactEncrypt(i.encoder.encode(JSON.stringify(this._payload)));return this._replicateIssuerAsHeader&&(this._protectedHeader={...this._protectedHeader,iss:this._payload.iss}),this._replicateSubjectAsHeader&&(this._protectedHeader={...this._protectedHeader,sub:this._payload.sub}),this._replicateAudienceAsHeader&&(this._protectedHeader={...this._protectedHeader,aud:this._payload.aud}),r.setProtectedHeader(this._protectedHeader),this._iv&&r.setInitializationVector(this._iv),this._cek&&r.setContentEncryptionKey(this._cek),this._keyManagementParameters&&r.setKeyManagementParameters(this._keyManagementParameters),r.encrypt(e,t)}}t.EncryptJWT=n},19007:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProduceJWT=void 0;let a=r(173),i=r(95788),o=r(48892);function n(e,t){if(!Number.isFinite(t))throw TypeError(`Invalid ${e} input`);return t}class s{_payload;constructor(e={}){if(!(0,i.default)(e))throw TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return"number"==typeof e?this._payload={...this._payload,nbf:n("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:n("setNotBefore",(0,a.default)(e))}:this._payload={...this._payload,nbf:(0,a.default)(new Date)+(0,o.default)(e)},this}setExpirationTime(e){return"number"==typeof e?this._payload={...this._payload,exp:n("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:n("setExpirationTime",(0,a.default)(e))}:this._payload={...this._payload,exp:(0,a.default)(new Date)+(0,o.default)(e)},this}setIssuedAt(e){return void 0===e?this._payload={...this._payload,iat:(0,a.default)(new Date)}:e instanceof Date?this._payload={...this._payload,iat:n("setIssuedAt",(0,a.default)(e))}:"string"==typeof e?this._payload={...this._payload,iat:n("setIssuedAt",(0,a.default)(new Date)+(0,o.default)(e))}:this._payload={...this._payload,iat:n("setIssuedAt",e)},this}}t.ProduceJWT=s},1373:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SignJWT=void 0;let a=r(3131),i=r(3674),o=r(41444),n=r(19007);class s extends n.ProduceJWT{_protectedHeader;setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){let r=new a.CompactSign(o.encoder.encode(JSON.stringify(this._payload)));if(r.setProtectedHeader(this._protectedHeader),Array.isArray(this._protectedHeader?.crit)&&this._protectedHeader.crit.includes("b64")&&!1===this._protectedHeader.b64)throw new i.JWTInvalid("JWTs MUST NOT use unencoded payload");return r.sign(e,t)}}t.SignJWT=s},29211:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnsecuredJWT=void 0;let a=r(77145),i=r(41444),o=r(3674),n=r(61473),s=r(19007);class d extends s.ProduceJWT{encode(){let e=a.encode(JSON.stringify({alg:"none"})),t=a.encode(JSON.stringify(this._payload));return`${e}.${t}.`}static decode(e,t){let r;if("string"!=typeof e)throw new o.JWTInvalid("Unsecured JWT must be a string");let{0:s,1:d,2:l,length:c}=e.split(".");if(3!==c||""!==l)throw new o.JWTInvalid("Invalid Unsecured JWT");try{if(r=JSON.parse(i.decoder.decode(a.decode(s))),"none"!==r.alg)throw Error()}catch{throw new o.JWTInvalid("Invalid Unsecured JWT")}return{payload:(0,n.default)(r,a.decode(d),t),header:r}}}t.UnsecuredJWT=d},38176:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.jwtVerify=n;let a=r(161),i=r(61473),o=r(3674);async function n(e,t,r){let n=await (0,a.compactVerify)(e,t,r);if(n.protectedHeader.crit?.includes("b64")&&!1===n.protectedHeader.b64)throw new o.JWTInvalid("JWTs MUST NOT use unencoded payload");let s={payload:(0,i.default)(n.protectedHeader,n.payload,r),protectedHeader:n.protectedHeader};return"function"==typeof t?{...s,key:n.key}:s}},85175:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.exportSPKI=n,t.exportPKCS8=s,t.exportJWK=d;let a=r(95758),i=r(95758),o=r(50450);async function n(e){return(0,a.toSPKI)(e)}async function s(e){return(0,i.toPKCS8)(e)}async function d(e){return(0,o.default)(e)}},62730:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateKeyPair=i;let a=r(21785);async function i(e,t){return(0,a.generateKeyPair)(e,t)}},53029:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateSecret=i;let a=r(21785);async function i(e,t){return(0,a.generateSecret)(e,t)}},54183:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.importSPKI=d,t.importX509=l,t.importPKCS8=c,t.importJWK=u;let a=r(77145),i=r(95758),o=r(67542),n=r(3674),s=r(95788);async function d(e,t,r){if("string"!=typeof e||0!==e.indexOf("-----BEGIN PUBLIC KEY-----"))throw TypeError('"spki" must be SPKI formatted string');return(0,i.fromSPKI)(e,t,r)}async function l(e,t,r){if("string"!=typeof e||0!==e.indexOf("-----BEGIN CERTIFICATE-----"))throw TypeError('"x509" must be X.509 formatted string');return(0,i.fromX509)(e,t,r)}async function c(e,t,r){if("string"!=typeof e||0!==e.indexOf("-----BEGIN PRIVATE KEY-----"))throw TypeError('"pkcs8" must be PKCS#8 formatted string');return(0,i.fromPKCS8)(e,t,r)}async function u(e,t){if(!(0,s.default)(e))throw TypeError("JWK must be an object");switch(t||=e.alg,e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');return(0,a.decode)(e.k);case"RSA":if("oth"in e&&void 0!==e.oth)throw new n.JOSENotSupported('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return(0,o.default)({...e,alg:t});default:throw new n.JOSENotSupported('Unsupported "kty" (Key Type) Parameter value')}}},97265:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.wrap=n,t.unwrap=s;let a=r(75712),i=r(49622),o=r(77145);async function n(e,t,r,i){let n=e.slice(0,7),s=await (0,a.default)(n,r,t,i,new Uint8Array(0));return{encryptedKey:s.ciphertext,iv:(0,o.encode)(s.iv),tag:(0,o.encode)(s.tag)}}async function s(e,t,r,a,o){let n=e.slice(0,7);return(0,i.default)(n,t,r,a,o,new Uint8Array(0))}},41444:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decoder=t.encoder=void 0,t.concat=i,t.p2s=function(e,r){return i(t.encoder.encode(e),new Uint8Array([0]),r)},t.uint64be=function(e){let t=new Uint8Array(8);return o(t,Math.floor(e/4294967296),0),o(t,e%4294967296,4),t},t.uint32be=n,t.lengthAndInput=function(e){return i(n(e.length),e)},t.concatKdf=s;let a=r(35657);function i(...e){let t=new Uint8Array(e.reduce((e,{length:t})=>e+t,0)),r=0;for(let a of e)t.set(a,r),r+=a.length;return t}function o(e,t,r){if(t<0||t>=4294967296)throw RangeError(`value must be >= 0 and <= ${4294967296-1}. Received ${t}`);e.set([t>>>24,t>>>16,t>>>8,255&t],r)}function n(e){let t=new Uint8Array(4);return o(t,e),t}async function s(e,t,r){let i=Math.ceil((t>>3)/32),o=new Uint8Array(32*i);for(let t=0;t<i;t++){let i=new Uint8Array(4+e.length+r.length);i.set(n(t+1)),i.set(e,4),i.set(r,4+e.length),o.set(await (0,a.default)("sha256",i),32*t)}return o.slice(0,t>>3)}t.encoder=new TextEncoder,t.decoder=new TextDecoder},54463:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.bitLength=o;let a=r(3674),i=r(90831);function o(e){switch(e){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new a.JOSENotSupported(`Unsupported JWE Algorithm: ${e}`)}}t.default=e=>(0,i.default)(new Uint8Array(o(e)>>3))},57719:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let a=r(3674),i=r(12081);t.default=(e,t)=>{if(t.length<<3!==(0,i.bitLength)(e))throw new a.JWEInvalid("Invalid Initialization Vector length")}},50168:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.checkKeyTypeWithJwk=void 0;let a=r(41707),i=r(25595),o=r(5620),n=e=>e?.[Symbol.toStringTag],s=(e,t,r)=>{if(void 0!==t.use&&"sig"!==t.use)throw TypeError("Invalid key for this operation, when present its use must be sig");if(void 0!==t.key_ops&&t.key_ops.includes?.(r)!==!0)throw TypeError(`Invalid key for this operation, when present its key_ops must include ${r}`);if(void 0!==t.alg&&t.alg!==e)throw TypeError(`Invalid key for this operation, when present its alg must be ${e}`);return!0},d=(e,t,r,d)=>{if(!(t instanceof Uint8Array)){if(d&&o.isJWK(t)){if(o.isSecretJWK(t)&&s(e,t,r))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!(0,i.default)(t))throw TypeError((0,a.withAlg)(e,t,...i.types,"Uint8Array",d?"JSON Web Key":null));if("secret"!==t.type)throw TypeError(`${n(t)} instances for symmetric algorithms must be of type "secret"`)}},l=(e,t,r,d)=>{if(d&&o.isJWK(t))switch(r){case"sign":if(o.isPrivateJWK(t)&&s(e,t,r))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(o.isPublicJWK(t)&&s(e,t,r))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!(0,i.default)(t))throw TypeError((0,a.withAlg)(e,t,...i.types,d?"JSON Web Key":null));if("secret"===t.type)throw TypeError(`${n(t)} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===r&&"public"===t.type)throw TypeError(`${n(t)} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===r&&"public"===t.type)throw TypeError(`${n(t)} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&"verify"===r&&"private"===t.type)throw TypeError(`${n(t)} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&"encrypt"===r&&"private"===t.type)throw TypeError(`${n(t)} instances for asymmetric algorithm encryption must be of type "public"`)};function c(e,t,r,a){t.startsWith("HS")||"dir"===t||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?d(t,r,a,e):l(t,r,a,e)}t.default=c.bind(void 0,!1),t.checkKeyTypeWithJwk=c.bind(void 0,!0)},64759:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!(e instanceof Uint8Array)||e.length<8)throw new a.JWEInvalid("PBES2 Salt Input must be 8 or more octets")};let a=r(3674)},4820:(e,t)=>{function r(e,t="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function a(e,t){return e.name===t}function i(e){return parseInt(e.name.slice(4),10)}function o(e,t){if(t.length&&!t.some(t=>e.usages.includes(t))){let e="CryptoKey does not support this operation, its usages must include ";if(t.length>2){let r=t.pop();e+=`one of ${t.join(", ")}, or ${r}.`}else 2===t.length?e+=`one of ${t[0]} or ${t[1]}.`:e+=`${t[0]}.`;throw TypeError(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.checkSigCryptoKey=function(e,t,...n){switch(t){case"HS256":case"HS384":case"HS512":{if(!a(e.algorithm,"HMAC"))throw r("HMAC");let o=parseInt(t.slice(2),10);if(i(e.algorithm.hash)!==o)throw r(`SHA-${o}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!a(e.algorithm,"RSASSA-PKCS1-v1_5"))throw r("RSASSA-PKCS1-v1_5");let o=parseInt(t.slice(2),10);if(i(e.algorithm.hash)!==o)throw r(`SHA-${o}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!a(e.algorithm,"RSA-PSS"))throw r("RSA-PSS");let o=parseInt(t.slice(2),10);if(i(e.algorithm.hash)!==o)throw r(`SHA-${o}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==e.algorithm.name&&"Ed448"!==e.algorithm.name)throw r("Ed25519 or Ed448");break;case"Ed25519":if(!a(e.algorithm,"Ed25519"))throw r("Ed25519");break;case"ES256":case"ES384":case"ES512":{if(!a(e.algorithm,"ECDSA"))throw r("ECDSA");let i=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(t);if(e.algorithm.namedCurve!==i)throw r(i,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}o(e,n)},t.checkEncCryptoKey=function(e,t,...n){switch(t){case"A128GCM":case"A192GCM":case"A256GCM":{if(!a(e.algorithm,"AES-GCM"))throw r("AES-GCM");let i=parseInt(t.slice(1,4),10);if(e.algorithm.length!==i)throw r(i,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!a(e.algorithm,"AES-KW"))throw r("AES-KW");let i=parseInt(t.slice(1,4),10);if(e.algorithm.length!==i)throw r(i,"algorithm.length");break}case"ECDH":switch(e.algorithm.name){case"ECDH":case"X25519":case"X448":break;default:throw r("ECDH, X25519, or X448")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!a(e.algorithm,"PBKDF2"))throw r("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!a(e.algorithm,"RSA-OAEP"))throw r("RSA-OAEP");let o=parseInt(t.slice(9),10)||1;if(i(e.algorithm.hash)!==o)throw r(`SHA-${o}`,"algorithm.hash");break}default:throw TypeError("CryptoKey does not support this operation")}o(e,n)}},10806:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let a=r(75186),i=r(90141),o=r(19052),n=r(88524),s=r(77145),d=r(34741),l=r(3674),c=r(54463),u=r(54183),h=r(50168),p=r(95788),f=r(97265);async function y(e,t,r,y,m){switch((0,h.default)(e,t,"decrypt"),t=await d.default.normalizePrivateKey?.(t,e)||t,e){case"dir":if(void 0!==r)throw new l.JWEInvalid("Encountered unexpected JWE Encrypted Key");return t;case"ECDH-ES":if(void 0!==r)throw new l.JWEInvalid("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let o,n;if(!(0,p.default)(y.epk))throw new l.JWEInvalid('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!i.ecdhAllowed(t))throw new l.JOSENotSupported("ECDH with the provided key is not allowed or not supported by your javascript runtime");let d=await (0,u.importJWK)(y.epk,e);if(void 0!==y.apu){if("string"!=typeof y.apu)throw new l.JWEInvalid('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{o=(0,s.decode)(y.apu)}catch{throw new l.JWEInvalid("Failed to base64url decode the apu")}}if(void 0!==y.apv){if("string"!=typeof y.apv)throw new l.JWEInvalid('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{n=(0,s.decode)(y.apv)}catch{throw new l.JWEInvalid("Failed to base64url decode the apv")}}let h=await i.deriveKey(d,t,"ECDH-ES"===e?y.enc:e,"ECDH-ES"===e?(0,c.bitLength)(y.enc):parseInt(e.slice(-5,-2),10),o,n);if("ECDH-ES"===e)return h;if(void 0===r)throw new l.JWEInvalid("JWE Encrypted Key missing");return(0,a.unwrap)(e.slice(-6),h,r)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(void 0===r)throw new l.JWEInvalid("JWE Encrypted Key missing");return(0,n.decrypt)(e,t,r);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{let a;if(void 0===r)throw new l.JWEInvalid("JWE Encrypted Key missing");if("number"!=typeof y.p2c)throw new l.JWEInvalid('JOSE Header "p2c" (PBES2 Count) missing or invalid');let i=m?.maxPBES2Count||1e4;if(y.p2c>i)throw new l.JWEInvalid('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof y.p2s)throw new l.JWEInvalid('JOSE Header "p2s" (PBES2 Salt) missing or invalid');try{a=(0,s.decode)(y.p2s)}catch{throw new l.JWEInvalid("Failed to base64url decode the p2s")}return(0,o.decrypt)(e,t,r,y.p2c,a)}case"A128KW":case"A192KW":case"A256KW":if(void 0===r)throw new l.JWEInvalid("JWE Encrypted Key missing");return(0,a.unwrap)(e,t,r);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{let a,i;if(void 0===r)throw new l.JWEInvalid("JWE Encrypted Key missing");if("string"!=typeof y.iv)throw new l.JWEInvalid('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof y.tag)throw new l.JWEInvalid('JOSE Header "tag" (Authentication Tag) missing or invalid');try{a=(0,s.decode)(y.iv)}catch{throw new l.JWEInvalid("Failed to base64url decode the iv")}try{i=(0,s.decode)(y.tag)}catch{throw new l.JWEInvalid("Failed to base64url decode the tag")}return(0,f.unwrap)(e,t,r,a,i)}default:throw new l.JOSENotSupported('Invalid or unsupported "alg" (JWE Algorithm) header value')}}t.default=y},25983:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let a=r(75186),i=r(90141),o=r(19052),n=r(88524),s=r(77145),d=r(34741),l=r(54463),c=r(3674),u=r(85175),h=r(50168),p=r(97265);async function f(e,t,r,f,y={}){let m,g,v;switch((0,h.default)(e,r,"encrypt"),r=await d.default.normalizePublicKey?.(r,e)||r,e){case"dir":v=r;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!i.ecdhAllowed(r))throw new c.JOSENotSupported("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:o,apv:n}=y,{epk:d}=y;d||=(await i.generateEpk(r)).privateKey;let{x:h,y:p,crv:w,kty:_}=await (0,u.exportJWK)(d),b=await i.deriveKey(r,d,"ECDH-ES"===e?t:e,"ECDH-ES"===e?(0,l.bitLength)(t):parseInt(e.slice(-5,-2),10),o,n);if(g={epk:{x:h,crv:w,kty:_}},"EC"===_&&(g.epk.y=p),o&&(g.apu=(0,s.encode)(o)),n&&(g.apv=(0,s.encode)(n)),"ECDH-ES"===e){v=b;break}v=f||(0,l.default)(t);let S=e.slice(-6);m=await (0,a.wrap)(S,b,v);break}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":v=f||(0,l.default)(t),m=await (0,n.encrypt)(e,r,v);break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{v=f||(0,l.default)(t);let{p2c:a,p2s:i}=y;({encryptedKey:m,...g}=await (0,o.encrypt)(e,r,v,a,i));break}case"A128KW":case"A192KW":case"A256KW":v=f||(0,l.default)(t),m=await (0,a.wrap)(e,r,v);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{v=f||(0,l.default)(t);let{iv:a}=y;({encryptedKey:m,...g}=await (0,p.wrap)(e,r,v,a));break}default:throw new c.JOSENotSupported('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:v,encryptedKey:m,parameters:g}}t.default=f},173:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>Math.floor(e.getTime()/1e3)},41707:(e,t)=>{function r(e,t,...a){if((a=a.filter(Boolean)).length>2){let t=a.pop();e+=`one of type ${a.join(", ")}, or ${t}.`}else 2===a.length?e+=`one of type ${a[0]} or ${a[1]}.`:e+=`of type ${a[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}Object.defineProperty(t,"__esModule",{value:!0}),t.withAlg=function(e,t,...a){return r(`Key for the ${e} algorithm must be `,t,...a)},t.default=(e,...t)=>r("Key must be ",e,...t)},17905:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=(...e)=>{let t;let r=e.filter(Boolean);if(0===r.length||1===r.length)return!0;for(let e of r){let r=Object.keys(e);if(!t||0===t.size){t=new Set(r);continue}for(let e of r){if(t.has(e))return!1;t.add(e)}}return!0}},5620:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isJWK=i,t.isPrivateJWK=function(e){return"oct"!==e.kty&&"string"==typeof e.d},t.isPublicJWK=function(e){return"oct"!==e.kty&&void 0===e.d},t.isSecretJWK=function(e){return i(e)&&"oct"===e.kty&&"string"==typeof e.k};let a=r(95788);function i(e){return(0,a.default)(e)&&"string"==typeof e.kty}},95788:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!("object"==typeof e&&null!==e)||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}},12081:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.bitLength=o;let a=r(3674),i=r(90831);function o(e){switch(e){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new a.JOSENotSupported(`Unsupported JWE Algorithm: ${e}`)}}t.default=e=>(0,i.default)(new Uint8Array(o(e)>>3))},61473:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let a=r(3674),i=r(41444),o=r(173),n=r(48892),s=r(95788),d=e=>e.toLowerCase().replace(/^application\//,""),l=(e,t)=>"string"==typeof e?t.includes(e):!!Array.isArray(e)&&t.some(Set.prototype.has.bind(new Set(e)));t.default=(e,t,r={})=>{let c,u;try{c=JSON.parse(i.decoder.decode(t))}catch{}if(!(0,s.default)(c))throw new a.JWTInvalid("JWT Claims Set must be a top-level JSON object");let{typ:h}=r;if(h&&("string"!=typeof e.typ||d(e.typ)!==d(h)))throw new a.JWTClaimValidationFailed('unexpected "typ" JWT header value',c,"typ","check_failed");let{requiredClaims:p=[],issuer:f,subject:y,audience:m,maxTokenAge:g}=r,v=[...p];for(let e of(void 0!==g&&v.push("iat"),void 0!==m&&v.push("aud"),void 0!==y&&v.push("sub"),void 0!==f&&v.push("iss"),new Set(v.reverse())))if(!(e in c))throw new a.JWTClaimValidationFailed(`missing required "${e}" claim`,c,e,"missing");if(f&&!(Array.isArray(f)?f:[f]).includes(c.iss))throw new a.JWTClaimValidationFailed('unexpected "iss" claim value',c,"iss","check_failed");if(y&&c.sub!==y)throw new a.JWTClaimValidationFailed('unexpected "sub" claim value',c,"sub","check_failed");if(m&&!l(c.aud,"string"==typeof m?[m]:m))throw new a.JWTClaimValidationFailed('unexpected "aud" claim value',c,"aud","check_failed");switch(typeof r.clockTolerance){case"string":u=(0,n.default)(r.clockTolerance);break;case"number":u=r.clockTolerance;break;case"undefined":u=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:w}=r,_=(0,o.default)(w||new Date);if((void 0!==c.iat||g)&&"number"!=typeof c.iat)throw new a.JWTClaimValidationFailed('"iat" claim must be a number',c,"iat","invalid");if(void 0!==c.nbf){if("number"!=typeof c.nbf)throw new a.JWTClaimValidationFailed('"nbf" claim must be a number',c,"nbf","invalid");if(c.nbf>_+u)throw new a.JWTClaimValidationFailed('"nbf" claim timestamp check failed',c,"nbf","check_failed")}if(void 0!==c.exp){if("number"!=typeof c.exp)throw new a.JWTClaimValidationFailed('"exp" claim must be a number',c,"exp","invalid");if(c.exp<=_-u)throw new a.JWTExpired('"exp" claim timestamp check failed',c,"exp","check_failed")}if(g){let e=_-c.iat;if(e-u>("number"==typeof g?g:(0,n.default)(g)))throw new a.JWTExpired('"iat" claim timestamp check failed (too far in the past)',c,"iat","check_failed");if(e<0-u)throw new a.JWTClaimValidationFailed('"iat" claim timestamp check failed (it should be in the past)',c,"iat","check_failed")}return c}},70061:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.unprotected=void 0,t.unprotected=Symbol()},48892:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});let r=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;t.default=e=>{let t;let a=r.exec(e);if(!a||a[4]&&a[1])throw TypeError("Invalid time period format");let i=parseFloat(a[2]);switch(a[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":t=Math.round(i);break;case"minute":case"minutes":case"min":case"mins":case"m":t=Math.round(60*i);break;case"hour":case"hours":case"hr":case"hrs":case"h":t=Math.round(3600*i);break;case"day":case"days":case"d":t=Math.round(86400*i);break;case"week":case"weeks":case"w":t=Math.round(604800*i);break;default:t=Math.round(31557600*i)}return"-"===a[1]||"ago"===a[4]?-t:t}},62642:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)}},97430:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let a=r(3674);t.default=function(e,t,r,i,o){let n;if(void 0!==o.crit&&i?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!i||void 0===i.crit)return new Set;if(!Array.isArray(i.crit)||0===i.crit.length||i.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let s of(n=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t,i.crit)){if(!n.has(s))throw new a.JOSENotSupported(`Extension Header Parameter "${s}" is not recognized`);if(void 0===o[s])throw new e(`Extension Header Parameter "${s}" is missing`);if(n.get(s)&&void 0===i[s])throw new e(`Extension Header Parameter "${s}" MUST be integrity protected`)}return new Set(i.crit)}},75186:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.unwrap=t.wrap=void 0;let a=r(72254),i=r(6005),o=r(3674),n=r(41444),s=r(6419),d=r(4820),l=r(31745),c=r(41707),u=r(97959),h=r(25595);function p(e,t){if(e.symmetricKeySize<<3!==parseInt(t.slice(1,4),10))throw TypeError(`Invalid key size for alg: ${t}`)}function f(e,t,r){if((0,l.default)(e))return e;if(e instanceof Uint8Array)return(0,i.createSecretKey)(e);if((0,s.isCryptoKey)(e))return(0,d.checkEncCryptoKey)(e,t,r),i.KeyObject.from(e);throw TypeError((0,c.default)(e,...h.types,"Uint8Array"))}t.wrap=(e,t,r)=>{let s=parseInt(e.slice(1,4),10),d=`aes${s}-wrap`;if(!(0,u.default)(d))throw new o.JOSENotSupported(`alg ${e} is not supported either by JOSE or your javascript runtime`);let l=f(t,e,"wrapKey");p(l,e);let c=(0,i.createCipheriv)(d,l,a.Buffer.alloc(8,166));return(0,n.concat)(c.update(r),c.final())},t.unwrap=(e,t,r)=>{let s=parseInt(e.slice(1,4),10),d=`aes${s}-wrap`;if(!(0,u.default)(d))throw new o.JOSENotSupported(`alg ${e} is not supported either by JOSE or your javascript runtime`);let l=f(t,e,"unwrapKey");p(l,e);let c=(0,i.createDecipheriv)(d,l,a.Buffer.alloc(8,166));return(0,n.concat)(c.update(r),c.final())}},95758:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fromX509=t.fromSPKI=t.fromPKCS8=t.toPKCS8=t.toSPKI=void 0;let a=r(6005),i=r(72254),o=r(6419),n=r(31745),s=r(41707),d=r(25595),l=(e,t,r)=>{let i;if((0,o.isCryptoKey)(r)){if(!r.extractable)throw TypeError("CryptoKey is not extractable");i=a.KeyObject.from(r)}else if((0,n.default)(r))i=r;else throw TypeError((0,s.default)(r,...d.types));if(i.type!==e)throw TypeError(`key is not a ${e} key`);return i.export({format:"pem",type:t})};t.toSPKI=e=>l("public","spki",e),t.toPKCS8=e=>l("private","pkcs8",e),t.fromPKCS8=e=>(0,a.createPrivateKey)({key:i.Buffer.from(e.replace(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,""),"base64"),type:"pkcs8",format:"der"}),t.fromSPKI=e=>(0,a.createPublicKey)({key:i.Buffer.from(e.replace(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,""),"base64"),type:"spki",format:"der"}),t.fromX509=e=>(0,a.createPublicKey)({key:e,type:"spki",format:"pem"})},77145:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decode=t.encode=t.encodeBase64=t.decodeBase64=void 0;let a=r(72254),i=r(41444);t.encode=e=>a.Buffer.from(e).toString("base64url"),t.decodeBase64=e=>new Uint8Array(a.Buffer.from(e,"base64")),t.encodeBase64=e=>a.Buffer.from(e).toString("base64"),t.decode=e=>new Uint8Array(a.Buffer.from(function(e){let t=e;return t instanceof Uint8Array&&(t=i.decoder.decode(t)),t}(e),"base64url"))},79701:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,o,n,s){let d=(0,i.concat)(e,t,r,(0,i.uint64be)(e.length<<3)),l=(0,a.createHmac)(`sha${o}`,n);return l.update(d),l.digest().slice(0,s>>3)};let a=r(6005),i=r(41444)},35380:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let a=r(3674),i=r(31745);t.default=(e,t)=>{let r;switch(e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":r=parseInt(e.slice(-3),10);break;case"A128GCM":case"A192GCM":case"A256GCM":r=parseInt(e.slice(1,4),10);break;default:throw new a.JOSENotSupported(`Content Encryption Algorithm ${e} is not supported either by JOSE or your javascript runtime`)}if(t instanceof Uint8Array){let e=t.byteLength<<3;if(e!==r)throw new a.JWEInvalid(`Invalid Content Encryption Key length. Expected ${r} bits, got ${e} bits`);return}if((0,i.default)(t)&&"secret"===t.type){let e=t.symmetricKeySize<<3;if(e!==r)throw new a.JWEInvalid(`Invalid Content Encryption Key length. Expected ${r} bits, got ${e} bits`);return}throw TypeError("Invalid Content Encryption Key type")}},50644:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let a=r(6005);t.default=(e,t)=>{let r;try{r=e instanceof a.KeyObject?e.asymmetricKeyDetails?.modulusLength:Buffer.from(e.n,"base64url").byteLength<<3}catch{}if("number"!=typeof r||r<2048)throw TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)}},97959:(e,t,r)=>{let a;Object.defineProperty(t,"__esModule",{value:!0});let i=r(6005);t.default=e=>(a||=new Set((0,i.getCiphers)())).has(e)},49622:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let a=r(6005),i=r(57719),o=r(35380),n=r(41444),s=r(3674),d=r(21478),l=r(79701),c=r(6419),u=r(4820),h=r(31745),p=r(41707),f=r(97959),y=r(25595);t.default=(e,t,r,m,g,v)=>{let w;if((0,c.isCryptoKey)(t))(0,u.checkEncCryptoKey)(t,e,"decrypt"),w=a.KeyObject.from(t);else if(t instanceof Uint8Array||(0,h.default)(t))w=t;else throw TypeError((0,p.default)(t,...y.types,"Uint8Array"));if(!m)throw new s.JWEInvalid("JWE Initialization Vector missing");if(!g)throw new s.JWEInvalid("JWE Authentication Tag missing");switch((0,o.default)(e,w),(0,i.default)(e,m),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return function(e,t,r,i,o,c){let u,p;let y=parseInt(e.slice(1,4),10);(0,h.default)(t)&&(t=t.export());let m=t.subarray(y>>3),g=t.subarray(0,y>>3),v=parseInt(e.slice(-3),10),w=`aes-${y}-cbc`;if(!(0,f.default)(w))throw new s.JOSENotSupported(`alg ${e} is not supported by your javascript runtime`);let _=(0,l.default)(c,i,r,v,g,y);try{u=(0,d.default)(o,_)}catch{}if(!u)throw new s.JWEDecryptionFailed;try{let e=(0,a.createDecipheriv)(w,m,i);p=(0,n.concat)(e.update(r),e.final())}catch{}if(!p)throw new s.JWEDecryptionFailed;return p}(e,w,r,m,g,v);case"A128GCM":case"A192GCM":case"A256GCM":return function(e,t,r,i,o,n){let d=parseInt(e.slice(1,4),10),l=`aes-${d}-gcm`;if(!(0,f.default)(l))throw new s.JOSENotSupported(`alg ${e} is not supported by your javascript runtime`);try{let e=(0,a.createDecipheriv)(l,t,i,{authTagLength:16});e.setAuthTag(o),n.byteLength&&e.setAAD(n,{plaintextLength:r.length});let s=e.update(r);return e.final(),s}catch{throw new s.JWEDecryptionFailed}}(e,w,r,m,g,v);default:throw new s.JOSENotSupported("Unsupported JWE Content Encryption Algorithm")}}},35657:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let a=r(6005);t.default=(e,t)=>(0,a.createHash)(e).update(t).digest()},37927:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){switch(e){case"PS256":case"RS256":case"ES256":case"ES256K":return"sha256";case"PS384":case"RS384":case"ES384":return"sha384";case"PS512":case"RS512":case"ES512":return"sha512";case"Ed25519":case"EdDSA":return;default:throw new a.JOSENotSupported(`alg ${e} is not supported either by JOSE or your javascript runtime`)}};let a=r(3674)},90141:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ecdhAllowed=void 0,t.deriveKey=f,t.generateEpk=y;let a=r(6005),i=r(47261),o=r(519),n=r(41444),s=r(3674),d=r(6419),l=r(4820),c=r(31745),u=r(41707),h=r(25595),p=(0,i.promisify)(a.generateKeyPair);async function f(e,t,r,i,o=new Uint8Array(0),s=new Uint8Array(0)){let p,f;if((0,d.isCryptoKey)(e))(0,l.checkEncCryptoKey)(e,"ECDH"),p=a.KeyObject.from(e);else if((0,c.default)(e))p=e;else throw TypeError((0,u.default)(e,...h.types));if((0,d.isCryptoKey)(t))(0,l.checkEncCryptoKey)(t,"ECDH","deriveBits"),f=a.KeyObject.from(t);else if((0,c.default)(t))f=t;else throw TypeError((0,u.default)(t,...h.types));let y=(0,n.concat)((0,n.lengthAndInput)(n.encoder.encode(r)),(0,n.lengthAndInput)(o),(0,n.lengthAndInput)(s),(0,n.uint32be)(i)),m=(0,a.diffieHellman)({privateKey:f,publicKey:p});return(0,n.concatKdf)(m,i,y)}async function y(e){let t;if((0,d.isCryptoKey)(e))t=a.KeyObject.from(e);else if((0,c.default)(e))t=e;else throw TypeError((0,u.default)(e,...h.types));switch(t.asymmetricKeyType){case"x25519":return p("x25519");case"x448":return p("x448");case"ec":return p("ec",{namedCurve:(0,o.default)(t)});default:throw new s.JOSENotSupported("Invalid or unsupported EPK")}}t.ecdhAllowed=e=>["P-256","P-384","P-521","X25519","X448"].includes((0,o.default)(e))},75712:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let a=r(6005),i=r(57719),o=r(35380),n=r(41444),s=r(79701),d=r(6419),l=r(4820),c=r(31745),u=r(41707),h=r(12081),p=r(3674),f=r(97959),y=r(25595);t.default=(e,t,r,m,g)=>{let v;if((0,d.isCryptoKey)(r))(0,l.checkEncCryptoKey)(r,e,"encrypt"),v=a.KeyObject.from(r);else if(r instanceof Uint8Array||(0,c.default)(r))v=r;else throw TypeError((0,u.default)(r,...y.types,"Uint8Array"));switch((0,o.default)(e,v),m?(0,i.default)(e,m):m=(0,h.default)(e),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return function(e,t,r,i,o){let d=parseInt(e.slice(1,4),10);(0,c.default)(r)&&(r=r.export());let l=r.subarray(d>>3),u=r.subarray(0,d>>3),h=`aes-${d}-cbc`;if(!(0,f.default)(h))throw new p.JOSENotSupported(`alg ${e} is not supported by your javascript runtime`);let y=(0,a.createCipheriv)(h,l,i),m=(0,n.concat)(y.update(t),y.final()),g=parseInt(e.slice(-3),10),v=(0,s.default)(o,i,m,g,u,d);return{ciphertext:m,tag:v,iv:i}}(e,t,v,m,g);case"A128GCM":case"A192GCM":case"A256GCM":return function(e,t,r,i,o){let n=parseInt(e.slice(1,4),10),s=`aes-${n}-gcm`;if(!(0,f.default)(s))throw new p.JOSENotSupported(`alg ${e} is not supported by your javascript runtime`);let d=(0,a.createCipheriv)(s,r,i,{authTagLength:16});o.byteLength&&d.setAAD(o,{plaintextLength:t.length});let l=d.update(t);return d.final(),{ciphertext:l,tag:d.getAuthTag(),iv:i}}(e,t,v,m,g);default:throw new p.JOSENotSupported("Unsupported JWE Content Encryption Algorithm")}}},43264:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let a=r(88849),i=r(22286),o=r(15673),n=r(3674),s=r(41444),d=async(e,t,r)=>{let d;switch(e.protocol){case"https:":d=i.get;break;case"http:":d=a.get;break;default:throw TypeError("Unsupported URL protocol.")}let{agent:l,headers:c}=r,u=d(e.href,{agent:l,timeout:t,headers:c}),[h]=await Promise.race([(0,o.once)(u,"response"),(0,o.once)(u,"timeout")]);if(!h)throw u.destroy(),new n.JWKSTimeout;if(200!==h.statusCode)throw new n.JOSEError("Expected 200 OK from the JSON Web Key Set HTTP response");let p=[];for await(let e of h)p.push(e);try{return JSON.parse(s.decoder.decode((0,s.concat)(...p)))}catch{throw new n.JOSEError("Failed to parse the JSON Web Key Set HTTP response as JSON")}};t.default=d},21785:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateSecret=d,t.generateKeyPair=l;let a=r(6005),i=r(47261),o=r(90831),n=r(3674),s=(0,i.promisify)(a.generateKeyPair);async function d(e,t){let r;switch(e){case"HS256":case"HS384":case"HS512":case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":r=parseInt(e.slice(-3),10);break;case"A128KW":case"A192KW":case"A256KW":case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":case"A128GCM":case"A192GCM":case"A256GCM":r=parseInt(e.slice(1,4),10);break;default:throw new n.JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return(0,a.createSecretKey)((0,o.default)(new Uint8Array(r>>3)))}async function l(e,t){switch(e){case"RS256":case"RS384":case"RS512":case"PS256":case"PS384":case"PS512":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":case"RSA1_5":{let e=t?.modulusLength??2048;if("number"!=typeof e||e<2048)throw new n.JOSENotSupported("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return await s("rsa",{modulusLength:e,publicExponent:65537})}case"ES256":return s("ec",{namedCurve:"P-256"});case"ES256K":return s("ec",{namedCurve:"secp256k1"});case"ES384":return s("ec",{namedCurve:"P-384"});case"ES512":return s("ec",{namedCurve:"P-521"});case"Ed25519":return s("ed25519");case"EdDSA":switch(t?.crv){case void 0:case"Ed25519":return s("ed25519");case"Ed448":return s("ed448");default:throw new n.JOSENotSupported("Invalid or unsupported crv option provided, supported values are Ed25519 and Ed448")}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let e=t?.crv??"P-256";switch(e){case void 0:case"P-256":case"P-384":case"P-521":return s("ec",{namedCurve:e});case"X25519":return s("x25519");case"X448":return s("x448");default:throw new n.JOSENotSupported("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}}default:throw new n.JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}}},519:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.weakMap=void 0;let a=r(6005),i=r(3674),o=r(6419),n=r(31745),s=r(41707),d=r(25595),l=r(5620);t.weakMap=new WeakMap;let c=e=>{switch(e){case"prime256v1":return"P-256";case"secp384r1":return"P-384";case"secp521r1":return"P-521";case"secp256k1":return"secp256k1";default:throw new i.JOSENotSupported("Unsupported key curve for this operation")}};t.default=(e,t)=>{let r;if((0,o.isCryptoKey)(e))r=a.KeyObject.from(e);else if((0,n.default)(e))r=e;else if((0,l.isJWK)(e))return e.crv;else throw TypeError((0,s.default)(e,...d.types));if("secret"===r.type)throw TypeError('only "private" or "public" type keys can be used for this operation');switch(r.asymmetricKeyType){case"ed25519":case"ed448":return`Ed${r.asymmetricKeyType.slice(2)}`;case"x25519":case"x448":return`X${r.asymmetricKeyType.slice(1)}`;case"ec":{let e=r.asymmetricKeyDetails.namedCurve;if(t)return e;return c(e)}default:throw TypeError("Invalid asymmetric key type for this operation")}}},17885:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw TypeError((0,n.default)(t,...s.types));return(0,a.createSecretKey)(t)}if(t instanceof a.KeyObject)return t;if((0,i.isCryptoKey)(t))return(0,o.checkSigCryptoKey)(t,e,r),a.KeyObject.from(t);if(d.isJWK(t))return e.startsWith("HS")?(0,a.createSecretKey)(Buffer.from(t.k,"base64url")):t;throw TypeError((0,n.default)(t,...s.types,"Uint8Array","JSON Web Key"))};let a=r(6005),i=r(6419),o=r(4820),n=r(41707),s=r(25595),d=r(5620)},49618:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){switch(e){case"HS256":return"sha256";case"HS384":return"sha384";case"HS512":return"sha512";default:throw new a.JOSENotSupported(`alg ${e} is not supported either by JOSE or your javascript runtime`)}};let a=r(3674)},25595:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.types=void 0;let a=r(6419),i=r(31745);t.default=e=>(0,i.default)(e)||(0,a.isCryptoKey)(e);let o=["KeyObject"];t.types=o,(globalThis.CryptoKey||a.default?.CryptoKey)&&o.push("CryptoKey")},31745:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let a=r(47261);t.default=e=>a.types.isKeyObject(e)},67542:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let a=r(6005);t.default=e=>e.d?(0,a.createPrivateKey)({format:"jwk",key:e}):(0,a.createPublicKey)({format:"jwk",key:e})},50450:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let a=r(6005),i=r(77145),o=r(3674),n=r(6419),s=r(31745),d=r(41707),l=r(25595);t.default=e=>{let t;if((0,n.isCryptoKey)(e)){if(!e.extractable)throw TypeError("CryptoKey is not extractable");t=a.KeyObject.from(e)}else if((0,s.default)(e))t=e;else if(e instanceof Uint8Array)return{kty:"oct",k:(0,i.encode)(e)};else throw TypeError((0,d.default)(e,...l.types,"Uint8Array"));if("secret"!==t.type&&!["rsa","ec","ed25519","x25519","ed448","x448"].includes(t.asymmetricKeyType))throw new o.JOSENotSupported("Unsupported key asymmetricKeyType");return t.export({format:"jwk"})}},15274:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let r,d,l,c;if(t instanceof a.KeyObject)r=t.asymmetricKeyType,d=t.asymmetricKeyDetails;else switch(l=!0,t.kty){case"RSA":r="rsa";break;case"EC":r="ec";break;case"OKP":if("Ed25519"===t.crv){r="ed25519";break}if("Ed448"===t.crv){r="ed448";break}throw TypeError("Invalid key for this operation, its crv must be Ed25519 or Ed448");default:throw TypeError("Invalid key for this operation, its kty must be RSA, OKP, or EC")}switch(e){case"Ed25519":if("ed25519"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519");break;case"EdDSA":if(!["ed25519","ed448"].includes(r))throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519 or ed448");break;case"RS256":case"RS384":case"RS512":if("rsa"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");(0,n.default)(t,e);break;case"PS256":case"PS384":case"PS512":if("rsa-pss"===r){let{hashAlgorithm:t,mgf1HashAlgorithm:r,saltLength:a}=d,i=parseInt(e.slice(-3),10);if(void 0!==t&&(t!==`sha${i}`||r!==t))throw TypeError(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${e}`);if(void 0!==a&&a>i>>3)throw TypeError(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${e}`)}else if("rsa"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa or rsa-pss");(0,n.default)(t,e),c={padding:a.constants.RSA_PKCS1_PSS_PADDING,saltLength:a.constants.RSA_PSS_SALTLEN_DIGEST};break;case"ES256":case"ES256K":case"ES384":case"ES512":{if("ec"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ec");let a=(0,i.default)(t),o=s.get(e);if(a!==o)throw TypeError(`Invalid key curve for the algorithm, its curve must be ${o}, got ${a}`);c={dsaEncoding:"ieee-p1363"};break}default:throw new o.JOSENotSupported(`alg ${e} is not supported either by JOSE or your javascript runtime`)}return l?{format:"jwk",key:t,...c}:c?{...c,key:t}:t};let a=r(6005),i=r(519),o=r(3674),n=r(50644),s=new Map([["ES256","P-256"],["ES256K","secp256k1"],["ES384","P-384"],["ES512","P-521"]])},34741:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default={}},19052:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decrypt=t.encrypt=void 0;let a=r(47261),i=r(6005),o=r(90831),n=r(41444),s=r(77145),d=r(75186),l=r(64759),c=r(6419),u=r(4820),h=r(31745),p=r(41707),f=r(25595),y=(0,a.promisify)(i.pbkdf2);function m(e,t){if((0,h.default)(e))return e.export();if(e instanceof Uint8Array)return e;if((0,c.isCryptoKey)(e))return(0,u.checkEncCryptoKey)(e,t,"deriveBits","deriveKey"),i.KeyObject.from(e).export();throw TypeError((0,p.default)(e,...f.types,"Uint8Array"))}let g=async(e,t,r,a=2048,i=(0,o.default)(new Uint8Array(16)))=>{(0,l.default)(i);let c=(0,n.p2s)(e,i),u=parseInt(e.slice(13,16),10)>>3,h=m(t,e),p=await y(h,c,a,u,`sha${e.slice(8,11)}`);return{encryptedKey:await (0,d.wrap)(e.slice(-6),p,r),p2c:a,p2s:(0,s.encode)(i)}};t.encrypt=g;let v=async(e,t,r,a,i)=>{(0,l.default)(i);let o=(0,n.p2s)(e,i),s=parseInt(e.slice(13,16),10)>>3,c=m(t,e),u=await y(c,o,a,s,`sha${e.slice(8,11)}`);return(0,d.unwrap)(e.slice(-6),u,r)};t.decrypt=v},90831:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(6005);Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a.randomFillSync}})},88524:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decrypt=t.encrypt=void 0;let a=r(6005),i=r(47261),o=r(50644),n=r(6419),s=r(4820),d=r(31745),l=r(41707),c=r(25595),u=(e,t)=>{if("rsa"!==e.asymmetricKeyType)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");(0,o.default)(e,t)},h=(0,i.deprecate)(()=>a.constants.RSA_PKCS1_PADDING,'The RSA1_5 "alg" (JWE Algorithm) is deprecated and will be removed in the next major revision.'),p=e=>{switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return a.constants.RSA_PKCS1_OAEP_PADDING;case"RSA1_5":return h();default:return}},f=e=>{switch(e){case"RSA-OAEP":return"sha1";case"RSA-OAEP-256":return"sha256";case"RSA-OAEP-384":return"sha384";case"RSA-OAEP-512":return"sha512";default:return}};function y(e,t,...r){if((0,d.default)(e))return e;if((0,n.isCryptoKey)(e))return(0,s.checkEncCryptoKey)(e,t,...r),a.KeyObject.from(e);throw TypeError((0,l.default)(e,...c.types))}t.encrypt=(e,t,r)=>{let i=p(e),o=f(e),n=y(t,e,"wrapKey","encrypt");return u(n,e),(0,a.publicEncrypt)({key:n,oaepHash:o,padding:i},r)},t.decrypt=(e,t,r)=>{let i=p(e),o=f(e),n=y(t,e,"unwrapKey","decrypt");return u(n,e),(0,a.privateDecrypt)({key:n,oaepHash:o,padding:i},r)}},34265:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default="node:crypto"},87200:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let a=r(6005),i=r(47261),o=r(37927),n=r(49618),s=r(15274),d=r(17885),l=(0,i.promisify)(a.sign),c=async(e,t,r)=>{let i=(0,d.default)(e,t,"sign");if(e.startsWith("HS")){let t=a.createHmac((0,n.default)(e),i);return t.update(r),t.digest()}return l((0,o.default)(e),r,(0,s.default)(e,i))};t.default=c},21478:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let a=r(6005).timingSafeEqual;t.default=a},4008:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let a=r(6005),i=r(47261),o=r(37927),n=r(15274),s=r(87200),d=r(17885),l=(0,i.promisify)(a.verify),c=async(e,t,r,i)=>{let c=(0,d.default)(e,t,"verify");if(e.startsWith("HS")){let t=await (0,s.default)(e,c,i);try{return a.timingSafeEqual(r,t)}catch{return!1}}let u=(0,o.default)(e),h=(0,n.default)(e,c);try{return await l(u,i,h,r)}catch{return!1}};t.default=c},6419:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isCryptoKey=void 0;let a=r(6005),i=r(47261),o=a.webcrypto;t.default=o,t.isCryptoKey=e=>i.types.isCryptoKey(e)},46486:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decode=t.encode=void 0;let a=r(77145);t.encode=a.encode,t.decode=a.decode},91758:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decodeJwt=function(e){let t,r;if("string"!=typeof e)throw new n.JWTInvalid("JWTs must use Compact JWS serialization, JWT must be a string");let{1:s,length:d}=e.split(".");if(5===d)throw new n.JWTInvalid("Only JWTs using Compact JWS serialization can be decoded");if(3!==d)throw new n.JWTInvalid("Invalid JWT");if(!s)throw new n.JWTInvalid("JWTs must contain a payload");try{t=(0,a.decode)(s)}catch{throw new n.JWTInvalid("Failed to base64url decode the payload")}try{r=JSON.parse(i.decoder.decode(t))}catch{throw new n.JWTInvalid("Failed to parse the decoded payload as JSON")}if(!(0,o.default)(r))throw new n.JWTInvalid("Invalid JWT Claims Set");return r};let a=r(46486),i=r(41444),o=r(95788),n=r(3674)},96678:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decodeProtectedHeader=function(e){let t;if("string"==typeof e){let r=e.split(".");(3===r.length||5===r.length)&&([t]=r)}else if("object"==typeof e&&e){if("protected"in e)t=e.protected;else throw TypeError("Token does not contain a Protected Header")}try{if("string"!=typeof t||!t)throw Error();let e=JSON.parse(i.decoder.decode((0,a.decode)(t)));if(!(0,o.default)(e))throw Error();return e}catch{throw TypeError("Invalid Token or Protected Header formatting")}};let a=r(46486),i=r(41444),o=r(95788)},3674:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.JWSSignatureVerificationFailed=t.JWKSTimeout=t.JWKSMultipleMatchingKeys=t.JWKSNoMatchingKey=t.JWKSInvalid=t.JWKInvalid=t.JWTInvalid=t.JWSInvalid=t.JWEInvalid=t.JWEDecryptionFailed=t.JOSENotSupported=t.JOSEAlgNotAllowed=t.JWTExpired=t.JWTClaimValidationFailed=t.JOSEError=void 0;class r extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(e,t){super(e,t),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}t.JOSEError=r;class a extends r{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(e,t,r="unspecified",a="unspecified"){super(e,{cause:{claim:r,reason:a,payload:t}}),this.claim=r,this.reason=a,this.payload=t}}t.JWTClaimValidationFailed=a;class i extends r{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(e,t,r="unspecified",a="unspecified"){super(e,{cause:{claim:r,reason:a,payload:t}}),this.claim=r,this.reason=a,this.payload=t}}t.JWTExpired=i;class o extends r{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}t.JOSEAlgNotAllowed=o;class n extends r{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}t.JOSENotSupported=n;class s extends r{static code="ERR_JWE_DECRYPTION_FAILED";code="ERR_JWE_DECRYPTION_FAILED";constructor(e="decryption operation failed",t){super(e,t)}}t.JWEDecryptionFailed=s;class d extends r{static code="ERR_JWE_INVALID";code="ERR_JWE_INVALID"}t.JWEInvalid=d;class l extends r{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}t.JWSInvalid=l;class c extends r{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}t.JWTInvalid=c;class u extends r{static code="ERR_JWK_INVALID";code="ERR_JWK_INVALID"}t.JWKInvalid=u;class h extends r{static code="ERR_JWKS_INVALID";code="ERR_JWKS_INVALID"}t.JWKSInvalid=h;class p extends r{static code="ERR_JWKS_NO_MATCHING_KEY";code="ERR_JWKS_NO_MATCHING_KEY";constructor(e="no applicable key found in the JSON Web Key Set",t){super(e,t)}}t.JWKSNoMatchingKey=p;class f extends r{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t)}}t.JWKSMultipleMatchingKeys=f;class y extends r{static code="ERR_JWKS_TIMEOUT";code="ERR_JWKS_TIMEOUT";constructor(e="request timed out",t){super(e,t)}}t.JWKSTimeout=y;class m extends r{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(e="signature verification failed",t){super(e,t)}}t.JWSSignatureVerificationFailed=m},1357:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let a=r(34265);t.default=a.default},60060:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var a=r(12877),i=r(41549);class o{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class n{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return d(this,e)}}class s{constructor(e){this.decoders=e}or(e){return d(this,e)}decode(e){let t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let d=(e,t)=>new s({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class l{constructor(e,t,r,a){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=a,this.encoder=new o(e,t,r),this.decoder=new n(e,t,a)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}let c=({name:e,prefix:t,encode:r,decode:a})=>new l(e,t,r,a),u=(e,t,r,a)=>{let i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let o=e.length;for(;"="===e[o-1];)--o;let n=new Uint8Array(o*r/8|0),s=0,d=0,l=0;for(let t=0;t<o;++t){let o=i[e[t]];if(void 0===o)throw SyntaxError(`Non-${a} character`);d=d<<r|o,(s+=r)>=8&&(s-=8,n[l++]=255&d>>s)}if(s>=r||255&d<<8-s)throw SyntaxError("Unexpected end of data");return n},h=(e,t,r)=>{let a="="===t[t.length-1],i=(1<<r)-1,o="",n=0,s=0;for(let a=0;a<e.length;++a)for(s=s<<8|e[a],n+=8;n>r;)n-=r,o+=t[i&s>>n];if(n&&(o+=t[i&s<<r-n]),a)for(;o.length*r&7;)o+="=";return o};t.Codec=l,t.baseX=({prefix:e,name:t,alphabet:r})=>{let{encode:o,decode:n}=a(r,t);return c({prefix:e,name:t,encode:o,decode:e=>i.coerce(n(e))})},t.from=c,t.or=d,t.rfc4648=({name:e,prefix:t,bitsPerChar:r,alphabet:a})=>c({prefix:t,name:e,encode:e=>h(e,a,r),decode:t=>u(t,a,r,e)})},59716:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var a=r(60060);let i=a.rfc4648({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),o=a.rfc4648({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),n=a.rfc4648({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),s=a.rfc4648({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});t.base64=i,t.base64pad=o,t.base64url=n,t.base64urlpad=s},41549:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});let r=new Uint8Array(0);t.coerce=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw Error("Unknown type, must be binary type")},t.empty=r,t.equals=(e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},t.fromHex=e=>{let t=e.match(/../g);return t?new Uint8Array(t.map(e=>parseInt(e,16))):r},t.fromString=e=>new TextEncoder().encode(e),t.isBinary=e=>e instanceof ArrayBuffer||ArrayBuffer.isView(e),t.toHex=e=>e.reduce((e,t)=>e+t.toString(16).padStart(2,"0"),""),t.toString=e=>new TextDecoder().decode(e)},12877:e=>{e.exports=function(e,t){if(e.length>=255)throw TypeError("Alphabet too long");for(var r=new Uint8Array(256),a=0;a<r.length;a++)r[a]=255;for(var i=0;i<e.length;i++){var o=e.charAt(i),n=o.charCodeAt(0);if(255!==r[n])throw TypeError(o+" is ambiguous");r[n]=i}var s=e.length,d=e.charAt(0),l=Math.log(s)/Math.log(256),c=Math.log(256)/Math.log(s);function u(e){if("string"!=typeof e)throw TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[0]){for(var a=0,i=0;e[t]===d;)a++,t++;for(var o=(e.length-t)*l+1>>>0,n=new Uint8Array(o);e[t];){var c=r[e.charCodeAt(t)];if(255===c)return;for(var u=0,h=o-1;(0!==c||u<i)&&-1!==h;h--,u++)c+=s*n[h]>>>0,n[h]=c%256>>>0,c=c/256>>>0;if(0!==c)throw Error("Non-zero carry");i=u,t++}if(" "!==e[t]){for(var p=o-i;p!==o&&0===n[p];)p++;for(var f=new Uint8Array(a+(o-p)),y=a;p!==o;)f[y++]=n[p++];return f}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,a=0,i=0,o=t.length;i!==o&&0===t[i];)i++,r++;for(var n=(o-i)*c+1>>>0,l=new Uint8Array(n);i!==o;){for(var u=t[i],h=0,p=n-1;(0!==u||h<a)&&-1!==p;p--,h++)u+=256*l[p]>>>0,l[p]=u%s>>>0,u=u/s>>>0;if(0!==u)throw Error("Non-zero carry");a=h,i++}for(var f=n-a;f!==n&&0===l[f];)f++;for(var y=d.repeat(r);f<n;++f)y+=e.charAt(l[f]);return y},decodeUnsafe:u,decode:function(e){var r=u(e);if(r)return r;throw Error(`Non-${t} character`)}}}},69657:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ZodError=t.quotelessJson=t.ZodIssueCode=void 0;let a=r(61701);t.ZodIssueCode=a.util.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),t.quotelessJson=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class i extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},a=e=>{for(let i of e.issues)if("invalid_union"===i.code)i.unionErrors.map(a);else if("invalid_return_type"===i.code)a(i.returnTypeError);else if("invalid_arguments"===i.code)a(i.argumentsError);else if(0===i.path.length)r._errors.push(t(i));else{let e=r,a=0;for(;a<i.path.length;){let r=i.path[a];a===i.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(i))):e[r]=e[r]||{_errors:[]},e=e[r],a++}}};return a(this),r}static assert(e){if(!(e instanceof i))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,a.util.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):r.push(e(a));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}t.ZodError=i,i.create=e=>new i(e)},56414:function(e,t,r){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorMap=t.setErrorMap=t.defaultErrorMap=void 0;let i=a(r(7611));t.defaultErrorMap=i.default;let o=i.default;t.setErrorMap=function(e){o=e},t.getErrorMap=function(){return o}},8674:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(56414),t),i(r(82813),t),i(r(15072),t),i(r(61701),t),i(r(22478),t),i(r(69657),t)},68902:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.errorUtil=void 0,function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(r||(t.errorUtil=r={}))},82813:function(e,t,r){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isAsync=t.isValid=t.isDirty=t.isAborted=t.OK=t.DIRTY=t.INVALID=t.ParseStatus=t.addIssueToContext=t.EMPTY_PATH=t.makeIssue=void 0;let i=r(56414),o=a(r(7611));t.makeIssue=e=>{let{data:t,path:r,errorMaps:a,issueData:i}=e,o=[...r,...i.path||[]],n={...i,path:o};if(void 0!==i.message)return{...i,path:o,message:i.message};let s="";for(let e of a.filter(e=>!!e).slice().reverse())s=e(n,{data:t,defaultError:s}).message;return{...i,path:o,message:s}},t.EMPTY_PATH=[],t.addIssueToContext=function(e,r){let a=(0,i.getErrorMap)(),n=(0,t.makeIssue)({issueData:r,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,a,a===o.default?void 0:o.default].filter(e=>!!e)});e.common.issues.push(n)};class n{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,r){let a=[];for(let i of r){if("aborted"===i.status)return t.INVALID;"dirty"===i.status&&e.dirty(),a.push(i.value)}return{status:e.value,value:a}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,a=await e.value;r.push({key:t,value:a})}return n.mergeObjectSync(e,r)}static mergeObjectSync(e,r){let a={};for(let i of r){let{key:r,value:o}=i;if("aborted"===r.status||"aborted"===o.status)return t.INVALID;"dirty"===r.status&&e.dirty(),"dirty"===o.status&&e.dirty(),"__proto__"!==r.value&&(void 0!==o.value||i.alwaysSet)&&(a[r.value]=o.value)}return{status:e.value,value:a}}}t.ParseStatus=n,t.INVALID=Object.freeze({status:"aborted"}),t.DIRTY=e=>({status:"dirty",value:e}),t.OK=e=>({status:"valid",value:e}),t.isAborted=e=>"aborted"===e.status,t.isDirty=e=>"dirty"===e.status,t.isValid=e=>"valid"===e.status,t.isAsync=e=>"undefined"!=typeof Promise&&e instanceof Promise},15072:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},61701:(e,t)=>{var r,a;Object.defineProperty(t,"__esModule",{value:!0}),t.getParsedType=t.ZodParsedType=t.objectUtil=t.util=void 0,function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},e.getValidEnumValues=t=>{let r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),a={};for(let e of r)a[e]=t[e];return e.objectValues(a)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(let r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(r||(t.util=r={})),(a||(t.objectUtil=a={})).mergeShapes=(e,t)=>({...e,...t}),t.ZodParsedType=r.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),t.getParsedType=e=>{switch(typeof e){case"undefined":return t.ZodParsedType.undefined;case"string":return t.ZodParsedType.string;case"number":return isNaN(e)?t.ZodParsedType.nan:t.ZodParsedType.number;case"boolean":return t.ZodParsedType.boolean;case"function":return t.ZodParsedType.function;case"bigint":return t.ZodParsedType.bigint;case"symbol":return t.ZodParsedType.symbol;case"object":if(Array.isArray(e))return t.ZodParsedType.array;if(null===e)return t.ZodParsedType.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return t.ZodParsedType.promise;if("undefined"!=typeof Map&&e instanceof Map)return t.ZodParsedType.map;if("undefined"!=typeof Set&&e instanceof Set)return t.ZodParsedType.set;if("undefined"!=typeof Date&&e instanceof Date)return t.ZodParsedType.date;return t.ZodParsedType.object;default:return t.ZodParsedType.unknown}}},96625:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return i(t,e),t},n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.z=void 0;let s=o(r(8674));t.z=s,n(r(8674),t),t.default=s},7611:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let a=r(61701),i=r(69657);t.default=(e,t)=>{let r;switch(e.code){case i.ZodIssueCode.invalid_type:r=e.received===a.ZodParsedType.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case i.ZodIssueCode.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,a.util.jsonStringifyReplacer)}`;break;case i.ZodIssueCode.unrecognized_keys:r=`Unrecognized key(s) in object: ${a.util.joinValues(e.keys,", ")}`;break;case i.ZodIssueCode.invalid_union:r="Invalid input";break;case i.ZodIssueCode.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${a.util.joinValues(e.options)}`;break;case i.ZodIssueCode.invalid_enum_value:r=`Invalid enum value. Expected ${a.util.joinValues(e.options)}, received '${e.received}'`;break;case i.ZodIssueCode.invalid_arguments:r="Invalid function arguments";break;case i.ZodIssueCode.invalid_return_type:r="Invalid function return type";break;case i.ZodIssueCode.invalid_date:r="Invalid date";break;case i.ZodIssueCode.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:a.util.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case i.ZodIssueCode.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case i.ZodIssueCode.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case i.ZodIssueCode.custom:r="Invalid input";break;case i.ZodIssueCode.invalid_intersection_types:r="Intersection results could not be merged";break;case i.ZodIssueCode.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case i.ZodIssueCode.not_finite:r="Number must be finite";break;default:r=t.defaultError,a.util.assertNever(e)}return{message:r}}},22478:function(e,t,r){let a;var i,o,n,s,d=this&&this.__classPrivateFieldGet||function(e,t,r,a){if("a"===r&&!a)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)},l=this&&this.__classPrivateFieldSet||function(e,t,r,a,i){if("m"===a)throw TypeError("Private method is not writable");if("a"===a&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(e,r):i?i.value=r:t.set(e,r),r};Object.defineProperty(t,"__esModule",{value:!0}),t.boolean=t.bigint=t.array=t.any=t.coerce=t.ZodFirstPartyTypeKind=t.late=t.ZodSchema=t.Schema=t.custom=t.ZodReadonly=t.ZodPipeline=t.ZodBranded=t.BRAND=t.ZodNaN=t.ZodCatch=t.ZodDefault=t.ZodNullable=t.ZodOptional=t.ZodTransformer=t.ZodEffects=t.ZodPromise=t.ZodNativeEnum=t.ZodEnum=t.ZodLiteral=t.ZodLazy=t.ZodFunction=t.ZodSet=t.ZodMap=t.ZodRecord=t.ZodTuple=t.ZodIntersection=t.ZodDiscriminatedUnion=t.ZodUnion=t.ZodObject=t.ZodArray=t.ZodVoid=t.ZodNever=t.ZodUnknown=t.ZodAny=t.ZodNull=t.ZodUndefined=t.ZodSymbol=t.ZodDate=t.ZodBoolean=t.ZodBigInt=t.ZodNumber=t.ZodString=t.datetimeRegex=t.ZodType=void 0,t.NEVER=t.void=t.unknown=t.union=t.undefined=t.tuple=t.transformer=t.symbol=t.string=t.strictObject=t.set=t.record=t.promise=t.preprocess=t.pipeline=t.ostring=t.optional=t.onumber=t.oboolean=t.object=t.number=t.nullable=t.null=t.never=t.nativeEnum=t.nan=t.map=t.literal=t.lazy=t.intersection=t.instanceof=t.function=t.enum=t.effect=t.discriminatedUnion=t.date=void 0;let c=r(56414),u=r(68902),h=r(82813),p=r(61701),f=r(69657);class y{constructor(e,t,r,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let m=(e,t)=>{if((0,h.isValid)(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new f.ZodError(e.common.issues);return this._error=t,this._error}}};function g(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:a,description:i}=e;if(t&&(r||a))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:i}:{errorMap:(t,i)=>{var o,n;let{message:s}=e;return"invalid_enum_value"===t.code?{message:null!=s?s:i.defaultError}:void 0===i.data?{message:null!==(o=null!=s?s:a)&&void 0!==o?o:i.defaultError}:"invalid_type"!==t.code?{message:i.defaultError}:{message:null!==(n=null!=s?s:r)&&void 0!==n?n:i.defaultError}},description:i}}class v{get description(){return this._def.description}_getType(e){return(0,p.getParsedType)(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:(0,p.getParsedType)(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new h.ParseStatus,ctx:{common:e.parent.common,data:e.data,parsedType:(0,p.getParsedType)(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if((0,h.isAsync)(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;let a={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,p.getParsedType)(e)},i=this._parseSync({data:e,path:a.path,parent:a});return m(a,i)}"~validate"(e){var t,r;let a={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,p.getParsedType)(e)};if(!this["~standard"].async)try{let t=this._parseSync({data:e,path:[],parent:a});return(0,h.isValid)(t)?{value:t.value}:{issues:a.common.issues}}catch(e){(null===(r=null===(t=null==e?void 0:e.message)||void 0===t?void 0:t.toLowerCase())||void 0===r?void 0:r.includes("encountered"))&&(this["~standard"].async=!0),a.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:a}).then(e=>(0,h.isValid)(e)?{value:e.value}:{issues:a.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,p.getParsedType)(e)},a=this._parse({data:e,path:r.path,parent:r});return m(r,await ((0,h.isAsync)(a)?a:Promise.resolve(a)))}refine(e,t){let r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,a)=>{let i=e(t),o=()=>a.addIssue({code:f.ZodIssueCode.custom,...r(t)});return"undefined"!=typeof Promise&&i instanceof Promise?i.then(e=>!!e||(o(),!1)):!!i||(o(),!1)})}refinement(e,t){return this._refinement((r,a)=>!!e(r)||(a.addIssue("function"==typeof t?t(r,a):t),!1))}_refinement(e){return new eh({schema:this,typeName:s.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return ep.create(this,this._def)}nullable(){return ef.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return q.create(this)}promise(){return eu.create(this,this._def)}or(e){return X.create([this,e],this._def)}and(e){return ee.create(this,e,this._def)}transform(e){return new eh({...g(this._def),schema:this,typeName:s.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new ey({...g(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:s.ZodDefault})}brand(){return new ev({typeName:s.ZodBranded,type:this,...g(this._def)})}catch(e){return new em({...g(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:s.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return ew.create(this,e)}readonly(){return e_.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}t.ZodType=v,t.Schema=v,t.ZodSchema=v;let w=/^c[^\s-]{8,}$/i,_=/^[0-9a-z]+$/,b=/^[0-9A-HJKMNP-TV-Z]{26}$/i,S=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,E=/^[a-z0-9_-]{21}$/i,k=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,P=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,I=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,A=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,O=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,T=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,C=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,j=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,x=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,R="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",D=RegExp(`^${R}$`);function z(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}function M(e){let t=`${R}T${z(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)}t.datetimeRegex=M;class W extends v{_parse(e){var t,r,i,o;let n;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==p.ZodParsedType.string){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.string,received:t.parsedType}),h.INVALID}let s=new h.ParseStatus;for(let d of this._def.checks)if("min"===d.kind)e.data.length<d.value&&(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{code:f.ZodIssueCode.too_small,minimum:d.value,type:"string",inclusive:!0,exact:!1,message:d.message}),s.dirty());else if("max"===d.kind)e.data.length>d.value&&(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{code:f.ZodIssueCode.too_big,maximum:d.value,type:"string",inclusive:!0,exact:!1,message:d.message}),s.dirty());else if("length"===d.kind){let t=e.data.length>d.value,r=e.data.length<d.value;(t||r)&&(n=this._getOrReturnCtx(e,n),t?(0,h.addIssueToContext)(n,{code:f.ZodIssueCode.too_big,maximum:d.value,type:"string",inclusive:!0,exact:!0,message:d.message}):r&&(0,h.addIssueToContext)(n,{code:f.ZodIssueCode.too_small,minimum:d.value,type:"string",inclusive:!0,exact:!0,message:d.message}),s.dirty())}else if("email"===d.kind)I.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"email",code:f.ZodIssueCode.invalid_string,message:d.message}),s.dirty());else if("emoji"===d.kind)a||(a=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),a.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"emoji",code:f.ZodIssueCode.invalid_string,message:d.message}),s.dirty());else if("uuid"===d.kind)S.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"uuid",code:f.ZodIssueCode.invalid_string,message:d.message}),s.dirty());else if("nanoid"===d.kind)E.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"nanoid",code:f.ZodIssueCode.invalid_string,message:d.message}),s.dirty());else if("cuid"===d.kind)w.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"cuid",code:f.ZodIssueCode.invalid_string,message:d.message}),s.dirty());else if("cuid2"===d.kind)_.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"cuid2",code:f.ZodIssueCode.invalid_string,message:d.message}),s.dirty());else if("ulid"===d.kind)b.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"ulid",code:f.ZodIssueCode.invalid_string,message:d.message}),s.dirty());else if("url"===d.kind)try{new URL(e.data)}catch(t){n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"url",code:f.ZodIssueCode.invalid_string,message:d.message}),s.dirty()}else"regex"===d.kind?(d.regex.lastIndex=0,d.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"regex",code:f.ZodIssueCode.invalid_string,message:d.message}),s.dirty())):"trim"===d.kind?e.data=e.data.trim():"includes"===d.kind?e.data.includes(d.value,d.position)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{code:f.ZodIssueCode.invalid_string,validation:{includes:d.value,position:d.position},message:d.message}),s.dirty()):"toLowerCase"===d.kind?e.data=e.data.toLowerCase():"toUpperCase"===d.kind?e.data=e.data.toUpperCase():"startsWith"===d.kind?e.data.startsWith(d.value)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{code:f.ZodIssueCode.invalid_string,validation:{startsWith:d.value},message:d.message}),s.dirty()):"endsWith"===d.kind?e.data.endsWith(d.value)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{code:f.ZodIssueCode.invalid_string,validation:{endsWith:d.value},message:d.message}),s.dirty()):"datetime"===d.kind?M(d).test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{code:f.ZodIssueCode.invalid_string,validation:"datetime",message:d.message}),s.dirty()):"date"===d.kind?D.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{code:f.ZodIssueCode.invalid_string,validation:"date",message:d.message}),s.dirty()):"time"===d.kind?RegExp(`^${z(d)}$`).test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{code:f.ZodIssueCode.invalid_string,validation:"time",message:d.message}),s.dirty()):"duration"===d.kind?P.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"duration",code:f.ZodIssueCode.invalid_string,message:d.message}),s.dirty()):"ip"===d.kind?(t=e.data,("v4"===(r=d.version)||!r)&&A.test(t)||("v6"===r||!r)&&T.test(t)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"ip",code:f.ZodIssueCode.invalid_string,message:d.message}),s.dirty())):"jwt"===d.kind?!function(e,t){if(!k.test(e))return!1;try{let[r]=e.split("."),a=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(a));if("object"!=typeof i||null===i||!i.typ||!i.alg||t&&i.alg!==t)return!1;return!0}catch(e){return!1}}(e.data,d.alg)&&(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"jwt",code:f.ZodIssueCode.invalid_string,message:d.message}),s.dirty()):"cidr"===d.kind?(i=e.data,("v4"===(o=d.version)||!o)&&O.test(i)||("v6"===o||!o)&&C.test(i)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"cidr",code:f.ZodIssueCode.invalid_string,message:d.message}),s.dirty())):"base64"===d.kind?j.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"base64",code:f.ZodIssueCode.invalid_string,message:d.message}),s.dirty()):"base64url"===d.kind?x.test(e.data)||(n=this._getOrReturnCtx(e,n),(0,h.addIssueToContext)(n,{validation:"base64url",code:f.ZodIssueCode.invalid_string,message:d.message}),s.dirty()):p.util.assertNever(d);return{status:s.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:f.ZodIssueCode.invalid_string,...u.errorUtil.errToObj(r)})}_addCheck(e){return new W({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...u.errorUtil.errToObj(e)})}url(e){return this._addCheck({kind:"url",...u.errorUtil.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...u.errorUtil.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...u.errorUtil.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...u.errorUtil.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...u.errorUtil.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...u.errorUtil.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...u.errorUtil.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...u.errorUtil.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...u.errorUtil.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...u.errorUtil.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...u.errorUtil.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...u.errorUtil.errToObj(e)})}datetime(e){var t,r;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(r=null==e?void 0:e.local)&&void 0!==r&&r,...u.errorUtil.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...u.errorUtil.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...u.errorUtil.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...u.errorUtil.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...u.errorUtil.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...u.errorUtil.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...u.errorUtil.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...u.errorUtil.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...u.errorUtil.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...u.errorUtil.errToObj(t)})}nonempty(e){return this.min(1,u.errorUtil.errToObj(e))}trim(){return new W({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new W({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new W({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}t.ZodString=W,W.create=e=>{var t;return new W({checks:[],typeName:s.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...g(e)})};class J extends v{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==p.ZodParsedType.number){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.number,received:t.parsedType}),h.INVALID}let r=new h.ParseStatus;for(let a of this._def.checks)"int"===a.kind?p.util.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:"integer",received:"float",message:a.message}),r.dirty()):"min"===a.kind?(a.inclusive?e.data<a.value:e.data<=a.value)&&(t=this._getOrReturnCtx(e,t),(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):"max"===a.kind?(a.inclusive?e.data>a.value:e.data>=a.value)&&(t=this._getOrReturnCtx(e,t),(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):"multipleOf"===a.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,i=r>a?r:a;return parseInt(e.toFixed(i).replace(".",""))%parseInt(t.toFixed(i).replace(".",""))/Math.pow(10,i)}(e.data,a.value)&&(t=this._getOrReturnCtx(e,t),(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):"finite"===a.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.not_finite,message:a.message}),r.dirty()):p.util.assertNever(a);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,u.errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,u.errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,u.errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,u.errorUtil.toString(t))}setLimit(e,t,r,a){return new J({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:u.errorUtil.toString(a)}]})}_addCheck(e){return new J({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:u.errorUtil.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:u.errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:u.errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:u.errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:u.errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:u.errorUtil.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:u.errorUtil.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:u.errorUtil.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:u.errorUtil.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&p.util.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}t.ZodNumber=J,J.create=e=>new J({checks:[],typeName:s.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...g(e)});class K extends v{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch(t){return this._getInvalidInput(e)}if(this._getType(e)!==p.ZodParsedType.bigint)return this._getInvalidInput(e);let r=new h.ParseStatus;for(let a of this._def.checks)"min"===a.kind?(a.inclusive?e.data<a.value:e.data<=a.value)&&(t=this._getOrReturnCtx(e,t),(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):"max"===a.kind?(a.inclusive?e.data>a.value:e.data>=a.value)&&(t=this._getOrReturnCtx(e,t),(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):"multipleOf"===a.kind?e.data%a.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):p.util.assertNever(a);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.bigint,received:t.parsedType}),h.INVALID}gte(e,t){return this.setLimit("min",e,!0,u.errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,u.errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,u.errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,u.errorUtil.toString(t))}setLimit(e,t,r,a){return new K({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:u.errorUtil.toString(a)}]})}_addCheck(e){return new K({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:u.errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:u.errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:u.errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:u.errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:u.errorUtil.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}t.ZodBigInt=K,K.create=e=>{var t;return new K({checks:[],typeName:s.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...g(e)})};class U extends v{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==p.ZodParsedType.boolean){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.boolean,received:t.parsedType}),h.INVALID}return(0,h.OK)(e.data)}}t.ZodBoolean=U,U.create=e=>new U({typeName:s.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...g(e)});class L extends v{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==p.ZodParsedType.date){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.date,received:t.parsedType}),h.INVALID}if(isNaN(e.data.getTime())){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_date}),h.INVALID}let r=new h.ParseStatus;for(let a of this._def.checks)"min"===a.kind?e.data.getTime()<a.value&&(t=this._getOrReturnCtx(e,t),(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):"max"===a.kind?e.data.getTime()>a.value&&(t=this._getOrReturnCtx(e,t),(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):p.util.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new L({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:u.errorUtil.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:u.errorUtil.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}t.ZodDate=L,L.create=e=>new L({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:s.ZodDate,...g(e)});class Z extends v{_parse(e){if(this._getType(e)!==p.ZodParsedType.symbol){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.symbol,received:t.parsedType}),h.INVALID}return(0,h.OK)(e.data)}}t.ZodSymbol=Z,Z.create=e=>new Z({typeName:s.ZodSymbol,...g(e)});class N extends v{_parse(e){if(this._getType(e)!==p.ZodParsedType.undefined){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.undefined,received:t.parsedType}),h.INVALID}return(0,h.OK)(e.data)}}t.ZodUndefined=N,N.create=e=>new N({typeName:s.ZodUndefined,...g(e)});class H extends v{_parse(e){if(this._getType(e)!==p.ZodParsedType.null){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.null,received:t.parsedType}),h.INVALID}return(0,h.OK)(e.data)}}t.ZodNull=H,H.create=e=>new H({typeName:s.ZodNull,...g(e)});class $ extends v{constructor(){super(...arguments),this._any=!0}_parse(e){return(0,h.OK)(e.data)}}t.ZodAny=$,$.create=e=>new $({typeName:s.ZodAny,...g(e)});class F extends v{constructor(){super(...arguments),this._unknown=!0}_parse(e){return(0,h.OK)(e.data)}}t.ZodUnknown=F,F.create=e=>new F({typeName:s.ZodUnknown,...g(e)});class V extends v{_parse(e){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.never,received:t.parsedType}),h.INVALID}}t.ZodNever=V,V.create=e=>new V({typeName:s.ZodNever,...g(e)});class B extends v{_parse(e){if(this._getType(e)!==p.ZodParsedType.undefined){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.void,received:t.parsedType}),h.INVALID}return(0,h.OK)(e.data)}}t.ZodVoid=B,B.create=e=>new B({typeName:s.ZodVoid,...g(e)});class q extends v{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),a=this._def;if(t.parsedType!==p.ZodParsedType.array)return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.array,received:t.parsedType}),h.INVALID;if(null!==a.exactLength){let e=t.data.length>a.exactLength.value,i=t.data.length<a.exactLength.value;(e||i)&&((0,h.addIssueToContext)(t,{code:e?f.ZodIssueCode.too_big:f.ZodIssueCode.too_small,minimum:i?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&((0,h.addIssueToContext)(t,{code:f.ZodIssueCode.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&((0,h.addIssueToContext)(t,{code:f.ZodIssueCode.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>a.type._parseAsync(new y(t,e,t.path,r)))).then(e=>h.ParseStatus.mergeArray(r,e));let i=[...t.data].map((e,r)=>a.type._parseSync(new y(t,e,t.path,r)));return h.ParseStatus.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new q({...this._def,minLength:{value:e,message:u.errorUtil.toString(t)}})}max(e,t){return new q({...this._def,maxLength:{value:e,message:u.errorUtil.toString(t)}})}length(e,t){return new q({...this._def,exactLength:{value:e,message:u.errorUtil.toString(t)}})}nonempty(e){return this.min(1,e)}}t.ZodArray=q,q.create=(e,t)=>new q({type:e,minLength:null,maxLength:null,exactLength:null,typeName:s.ZodArray,...g(t)});class G extends v{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=p.util.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==p.ZodParsedType.object){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.object,received:t.parsedType}),h.INVALID}let{status:t,ctx:r}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof V&&"strip"===this._def.unknownKeys))for(let e in r.data)i.includes(e)||o.push(e);let n=[];for(let e of i){let t=a[e],i=r.data[e];n.push({key:{status:"valid",value:e},value:t._parse(new y(r,i,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof V){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of o)n.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)o.length>0&&((0,h.addIssueToContext)(r,{code:f.ZodIssueCode.unrecognized_keys,keys:o}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of o){let a=r.data[t];n.push({key:{status:"valid",value:t},value:e._parse(new y(r,a,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of n){let r=await t.key,a=await t.value;e.push({key:r,value:a,alwaysSet:t.alwaysSet})}return e}).then(e=>h.ParseStatus.mergeObjectSync(t,e)):h.ParseStatus.mergeObjectSync(t,n)}get shape(){return this._def.shape()}strict(e){return u.errorUtil.errToObj,new G({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var a,i,o,n;let s=null!==(o=null===(i=(a=this._def).errorMap)||void 0===i?void 0:i.call(a,t,r).message)&&void 0!==o?o:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(n=u.errorUtil.errToObj(e).message)&&void 0!==n?n:s}:{message:s}}}:{}})}strip(){return new G({...this._def,unknownKeys:"strip"})}passthrough(){return new G({...this._def,unknownKeys:"passthrough"})}extend(e){return new G({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new G({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:s.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new G({...this._def,catchall:e})}pick(e){let t={};return p.util.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new G({...this._def,shape:()=>t})}omit(e){let t={};return p.util.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new G({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof G){let r={};for(let a in t.shape){let i=t.shape[a];r[a]=ep.create(e(i))}return new G({...t._def,shape:()=>r})}return t instanceof q?new q({...t._def,type:e(t.element)}):t instanceof ep?ep.create(e(t.unwrap())):t instanceof ef?ef.create(e(t.unwrap())):t instanceof et?et.create(t.items.map(t=>e(t))):t}(this)}partial(e){let t={};return p.util.objectKeys(this.shape).forEach(r=>{let a=this.shape[r];e&&!e[r]?t[r]=a:t[r]=a.optional()}),new G({...this._def,shape:()=>t})}required(e){let t={};return p.util.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof ep;)e=e._def.innerType;t[r]=e}}),new G({...this._def,shape:()=>t})}keyof(){return ed(p.util.objectKeys(this.shape))}}t.ZodObject=G,G.create=(e,t)=>new G({shape:()=>e,unknownKeys:"strip",catchall:V.create(),typeName:s.ZodObject,...g(t)}),G.strictCreate=(e,t)=>new G({shape:()=>e,unknownKeys:"strict",catchall:V.create(),typeName:s.ZodObject,...g(t)}),G.lazycreate=(e,t)=>new G({shape:e,unknownKeys:"strip",catchall:V.create(),typeName:s.ZodObject,...g(t)});class X extends v{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new f.ZodError(e.ctx.common.issues));return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_union,unionErrors:r}),h.INVALID});{let e;let a=[];for(let i of r){let r={...t,common:{...t.common,issues:[]},parent:null},o=i._parseSync({data:t.data,path:t.path,parent:r});if("valid"===o.status)return o;"dirty"!==o.status||e||(e={result:o,ctx:r}),r.common.issues.length&&a.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let i=a.map(e=>new f.ZodError(e));return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_union,unionErrors:i}),h.INVALID}}get options(){return this._def.options}}t.ZodUnion=X,X.create=(e,t)=>new X({options:e,typeName:s.ZodUnion,...g(t)});let Y=e=>{if(e instanceof en)return Y(e.schema);if(e instanceof eh)return Y(e.innerType());if(e instanceof es)return[e.value];if(e instanceof el)return e.options;if(e instanceof ec)return p.util.objectValues(e.enum);if(e instanceof ey)return Y(e._def.innerType);if(e instanceof N)return[void 0];else if(e instanceof H)return[null];else if(e instanceof ep)return[void 0,...Y(e.unwrap())];else if(e instanceof ef)return[null,...Y(e.unwrap())];else if(e instanceof ev)return Y(e.unwrap());else if(e instanceof e_)return Y(e.unwrap());else if(e instanceof em)return Y(e._def.innerType);else return[]};class Q extends v{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==p.ZodParsedType.object)return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.object,received:t.parsedType}),h.INVALID;let r=this.discriminator,a=t.data[r],i=this.optionsMap.get(a);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):((0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),h.INVALID)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let a=new Map;for(let r of t){let t=Y(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let i of t){if(a.has(i))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(i)}`);a.set(i,r)}}return new Q({typeName:s.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...g(r)})}}t.ZodDiscriminatedUnion=Q;class ee extends v{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=(e,a)=>{if((0,h.isAborted)(e)||(0,h.isAborted)(a))return h.INVALID;let i=function e(t,r){let a=(0,p.getParsedType)(t),i=(0,p.getParsedType)(r);if(t===r)return{valid:!0,data:t};if(a===p.ZodParsedType.object&&i===p.ZodParsedType.object){let a=p.util.objectKeys(r),i=p.util.objectKeys(t).filter(e=>-1!==a.indexOf(e)),o={...t,...r};for(let a of i){let i=e(t[a],r[a]);if(!i.valid)return{valid:!1};o[a]=i.data}return{valid:!0,data:o}}if(a===p.ZodParsedType.array&&i===p.ZodParsedType.array){if(t.length!==r.length)return{valid:!1};let a=[];for(let i=0;i<t.length;i++){let o=e(t[i],r[i]);if(!o.valid)return{valid:!1};a.push(o.data)}return{valid:!0,data:a}}return a===p.ZodParsedType.date&&i===p.ZodParsedType.date&&+t==+r?{valid:!0,data:t}:{valid:!1}}(e.value,a.value);return i.valid?(((0,h.isDirty)(e)||(0,h.isDirty)(a))&&t.dirty(),{status:t.value,value:i.data}):((0,h.addIssueToContext)(r,{code:f.ZodIssueCode.invalid_intersection_types}),h.INVALID)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>a(e,t)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}t.ZodIntersection=ee,ee.create=(e,t,r)=>new ee({left:e,right:t,typeName:s.ZodIntersection,...g(r)});class et extends v{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==p.ZodParsedType.array)return(0,h.addIssueToContext)(r,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.array,received:r.parsedType}),h.INVALID;if(r.data.length<this._def.items.length)return(0,h.addIssueToContext)(r,{code:f.ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),h.INVALID;!this._def.rest&&r.data.length>this._def.items.length&&((0,h.addIssueToContext)(r,{code:f.ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let a=[...r.data].map((e,t)=>{let a=this._def.items[t]||this._def.rest;return a?a._parse(new y(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(a).then(e=>h.ParseStatus.mergeArray(t,e)):h.ParseStatus.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new et({...this._def,rest:e})}}t.ZodTuple=et,et.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new et({items:e,typeName:s.ZodTuple,rest:null,...g(t)})};class er extends v{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==p.ZodParsedType.object)return(0,h.addIssueToContext)(r,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.object,received:r.parsedType}),h.INVALID;let a=[],i=this._def.keyType,o=this._def.valueType;for(let e in r.data)a.push({key:i._parse(new y(r,e,r.path,e)),value:o._parse(new y(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?h.ParseStatus.mergeObjectAsync(t,a):h.ParseStatus.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,r){return new er(t instanceof v?{keyType:e,valueType:t,typeName:s.ZodRecord,...g(r)}:{keyType:W.create(),valueType:e,typeName:s.ZodRecord,...g(t)})}}t.ZodRecord=er;class ea extends v{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==p.ZodParsedType.map)return(0,h.addIssueToContext)(r,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.map,received:r.parsedType}),h.INVALID;let a=this._def.keyType,i=this._def.valueType,o=[...r.data.entries()].map(([e,t],o)=>({key:a._parse(new y(r,e,r.path,[o,"key"])),value:i._parse(new y(r,t,r.path,[o,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of o){let a=await r.key,i=await r.value;if("aborted"===a.status||"aborted"===i.status)return h.INVALID;("dirty"===a.status||"dirty"===i.status)&&t.dirty(),e.set(a.value,i.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of o){let a=r.key,i=r.value;if("aborted"===a.status||"aborted"===i.status)return h.INVALID;("dirty"===a.status||"dirty"===i.status)&&t.dirty(),e.set(a.value,i.value)}return{status:t.value,value:e}}}}t.ZodMap=ea,ea.create=(e,t,r)=>new ea({valueType:t,keyType:e,typeName:s.ZodMap,...g(r)});class ei extends v{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==p.ZodParsedType.set)return(0,h.addIssueToContext)(r,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.set,received:r.parsedType}),h.INVALID;let a=this._def;null!==a.minSize&&r.data.size<a.minSize.value&&((0,h.addIssueToContext)(r,{code:f.ZodIssueCode.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&r.data.size>a.maxSize.value&&((0,h.addIssueToContext)(r,{code:f.ZodIssueCode.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());let i=this._def.valueType;function o(e){let r=new Set;for(let a of e){if("aborted"===a.status)return h.INVALID;"dirty"===a.status&&t.dirty(),r.add(a.value)}return{status:t.value,value:r}}let n=[...r.data.values()].map((e,t)=>i._parse(new y(r,e,r.path,t)));return r.common.async?Promise.all(n).then(e=>o(e)):o(n)}min(e,t){return new ei({...this._def,minSize:{value:e,message:u.errorUtil.toString(t)}})}max(e,t){return new ei({...this._def,maxSize:{value:e,message:u.errorUtil.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}t.ZodSet=ei,ei.create=(e,t)=>new ei({valueType:e,minSize:null,maxSize:null,typeName:s.ZodSet,...g(t)});class eo extends v{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==p.ZodParsedType.function)return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.function,received:t.parsedType}),h.INVALID;function r(e,r){return(0,h.makeIssue)({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,(0,c.getErrorMap)(),c.defaultErrorMap].filter(e=>!!e),issueData:{code:f.ZodIssueCode.invalid_arguments,argumentsError:r}})}function a(e,r){return(0,h.makeIssue)({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,(0,c.getErrorMap)(),c.defaultErrorMap].filter(e=>!!e),issueData:{code:f.ZodIssueCode.invalid_return_type,returnTypeError:r}})}let i={errorMap:t.common.contextualErrorMap},o=t.data;if(this._def.returns instanceof eu){let e=this;return(0,h.OK)(async function(...t){let n=new f.ZodError([]),s=await e._def.args.parseAsync(t,i).catch(e=>{throw n.addIssue(r(t,e)),n}),d=await Reflect.apply(o,this,s);return await e._def.returns._def.type.parseAsync(d,i).catch(e=>{throw n.addIssue(a(d,e)),n})})}{let e=this;return(0,h.OK)(function(...t){let n=e._def.args.safeParse(t,i);if(!n.success)throw new f.ZodError([r(t,n.error)]);let s=Reflect.apply(o,this,n.data),d=e._def.returns.safeParse(s,i);if(!d.success)throw new f.ZodError([a(s,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new eo({...this._def,args:et.create(e).rest(F.create())})}returns(e){return new eo({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new eo({args:e||et.create([]).rest(F.create()),returns:t||F.create(),typeName:s.ZodFunction,...g(r)})}}t.ZodFunction=eo;class en extends v{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}t.ZodLazy=en,en.create=(e,t)=>new en({getter:e,typeName:s.ZodLazy,...g(t)});class es extends v{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{received:t.data,code:f.ZodIssueCode.invalid_literal,expected:this._def.value}),h.INVALID}return{status:"valid",value:e.data}}get value(){return this._def.value}}function ed(e,t){return new el({values:e,typeName:s.ZodEnum,...g(t)})}t.ZodLiteral=es,es.create=(e,t)=>new es({value:e,typeName:s.ZodLiteral,...g(t)});class el extends v{constructor(){super(...arguments),o.set(this,void 0)}_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return(0,h.addIssueToContext)(t,{expected:p.util.joinValues(r),received:t.parsedType,code:f.ZodIssueCode.invalid_type}),h.INVALID}if(d(this,o,"f")||l(this,o,new Set(this._def.values),"f"),!d(this,o,"f").has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return(0,h.addIssueToContext)(t,{received:t.data,code:f.ZodIssueCode.invalid_enum_value,options:r}),h.INVALID}return(0,h.OK)(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return el.create(e,{...this._def,...t})}exclude(e,t=this._def){return el.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}t.ZodEnum=el,o=new WeakMap,el.create=ed;class ec extends v{constructor(){super(...arguments),n.set(this,void 0)}_parse(e){let t=p.util.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==p.ZodParsedType.string&&r.parsedType!==p.ZodParsedType.number){let e=p.util.objectValues(t);return(0,h.addIssueToContext)(r,{expected:p.util.joinValues(e),received:r.parsedType,code:f.ZodIssueCode.invalid_type}),h.INVALID}if(d(this,n,"f")||l(this,n,new Set(p.util.getValidEnumValues(this._def.values)),"f"),!d(this,n,"f").has(e.data)){let e=p.util.objectValues(t);return(0,h.addIssueToContext)(r,{received:r.data,code:f.ZodIssueCode.invalid_enum_value,options:e}),h.INVALID}return(0,h.OK)(e.data)}get enum(){return this._def.values}}t.ZodNativeEnum=ec,n=new WeakMap,ec.create=(e,t)=>new ec({values:e,typeName:s.ZodNativeEnum,...g(t)});class eu extends v{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==p.ZodParsedType.promise&&!1===t.common.async)return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.promise,received:t.parsedType}),h.INVALID;let r=t.parsedType===p.ZodParsedType.promise?t.data:Promise.resolve(t.data);return(0,h.OK)(r.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}t.ZodPromise=eu,eu.create=(e,t)=>new eu({type:e,typeName:s.ZodPromise,...g(t)});class eh extends v{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===s.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=this._def.effect||null,i={addIssue:e=>{(0,h.addIssueToContext)(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),"preprocess"===a.type){let e=a.transform(r.data,i);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return h.INVALID;let a=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===a.status?h.INVALID:"dirty"===a.status||"dirty"===t.value?(0,h.DIRTY)(a.value):a});{if("aborted"===t.value)return h.INVALID;let a=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===a.status?h.INVALID:"dirty"===a.status||"dirty"===t.value?(0,h.DIRTY)(a.value):a}}if("refinement"===a.type){let e=e=>{let t=a.refinement(e,i);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?h.INVALID:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===a.status?h.INVALID:("dirty"===a.status&&t.dirty(),e(a.value),{status:t.value,value:a.value})}}if("transform"===a.type){if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>(0,h.isValid)(e)?Promise.resolve(a.transform(e.value,i)).then(e=>({status:t.value,value:e})):e);{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!(0,h.isValid)(e))return e;let o=a.transform(e.value,i);if(o instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}}p.util.assertNever(a)}}t.ZodEffects=eh,t.ZodTransformer=eh,eh.create=(e,t,r)=>new eh({schema:e,typeName:s.ZodEffects,effect:t,...g(r)}),eh.createWithPreprocess=(e,t,r)=>new eh({schema:t,effect:{type:"preprocess",transform:e},typeName:s.ZodEffects,...g(r)});class ep extends v{_parse(e){return this._getType(e)===p.ZodParsedType.undefined?(0,h.OK)(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}t.ZodOptional=ep,ep.create=(e,t)=>new ep({innerType:e,typeName:s.ZodOptional,...g(t)});class ef extends v{_parse(e){return this._getType(e)===p.ZodParsedType.null?(0,h.OK)(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}t.ZodNullable=ef,ef.create=(e,t)=>new ef({innerType:e,typeName:s.ZodNullable,...g(t)});class ey extends v{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===p.ZodParsedType.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}t.ZodDefault=ey,ey.create=(e,t)=>new ey({innerType:e,typeName:s.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...g(t)});class em extends v{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return(0,h.isAsync)(a)?a.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new f.ZodError(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new f.ZodError(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}t.ZodCatch=em,em.create=(e,t)=>new em({innerType:e,typeName:s.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...g(t)});class eg extends v{_parse(e){if(this._getType(e)!==p.ZodParsedType.nan){let t=this._getOrReturnCtx(e);return(0,h.addIssueToContext)(t,{code:f.ZodIssueCode.invalid_type,expected:p.ZodParsedType.nan,received:t.parsedType}),h.INVALID}return{status:"valid",value:e.data}}}t.ZodNaN=eg,eg.create=e=>new eg({typeName:s.ZodNaN,...g(e)}),t.BRAND=Symbol("zod_brand");class ev extends v{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}t.ZodBranded=ev;class ew extends v{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?h.INVALID:"dirty"===e.status?(t.dirty(),(0,h.DIRTY)(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?h.INVALID:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new ew({in:e,out:t,typeName:s.ZodPipeline})}}t.ZodPipeline=ew;class e_ extends v{_parse(e){let t=this._def.innerType._parse(e),r=e=>((0,h.isValid)(e)&&(e.value=Object.freeze(e.value)),e);return(0,h.isAsync)(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}function eb(e,t){let r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function eS(e,t={},r){return e?$.create().superRefine((a,i)=>{var o,n;let s=e(a);if(s instanceof Promise)return s.then(e=>{var o,n;if(!e){let e=eb(t,a),s=null===(n=null!==(o=e.fatal)&&void 0!==o?o:r)||void 0===n||n;i.addIssue({code:"custom",...e,fatal:s})}});if(!s){let e=eb(t,a),s=null===(n=null!==(o=e.fatal)&&void 0!==o?o:r)||void 0===n||n;i.addIssue({code:"custom",...e,fatal:s})}}):$.create()}t.ZodReadonly=e_,e_.create=(e,t)=>new e_({innerType:e,typeName:s.ZodReadonly,...g(t)}),t.custom=eS,t.late={object:G.lazycreate},(i=s||(t.ZodFirstPartyTypeKind=s={})).ZodString="ZodString",i.ZodNumber="ZodNumber",i.ZodNaN="ZodNaN",i.ZodBigInt="ZodBigInt",i.ZodBoolean="ZodBoolean",i.ZodDate="ZodDate",i.ZodSymbol="ZodSymbol",i.ZodUndefined="ZodUndefined",i.ZodNull="ZodNull",i.ZodAny="ZodAny",i.ZodUnknown="ZodUnknown",i.ZodNever="ZodNever",i.ZodVoid="ZodVoid",i.ZodArray="ZodArray",i.ZodObject="ZodObject",i.ZodUnion="ZodUnion",i.ZodDiscriminatedUnion="ZodDiscriminatedUnion",i.ZodIntersection="ZodIntersection",i.ZodTuple="ZodTuple",i.ZodRecord="ZodRecord",i.ZodMap="ZodMap",i.ZodSet="ZodSet",i.ZodFunction="ZodFunction",i.ZodLazy="ZodLazy",i.ZodLiteral="ZodLiteral",i.ZodEnum="ZodEnum",i.ZodEffects="ZodEffects",i.ZodNativeEnum="ZodNativeEnum",i.ZodOptional="ZodOptional",i.ZodNullable="ZodNullable",i.ZodDefault="ZodDefault",i.ZodCatch="ZodCatch",i.ZodPromise="ZodPromise",i.ZodBranded="ZodBranded",i.ZodPipeline="ZodPipeline",i.ZodReadonly="ZodReadonly",t.instanceof=(e,t={message:`Input not instance of ${e.name}`})=>eS(t=>t instanceof e,t);let eE=W.create;t.string=eE;let ek=J.create;t.number=ek;let eP=eg.create;t.nan=eP;let eI=K.create;t.bigint=eI;let eA=U.create;t.boolean=eA;let eO=L.create;t.date=eO;let eT=Z.create;t.symbol=eT;let eC=N.create;t.undefined=eC;let ej=H.create;t.null=ej;let ex=$.create;t.any=ex;let eR=F.create;t.unknown=eR;let eD=V.create;t.never=eD;let ez=B.create;t.void=ez;let eM=q.create;t.array=eM;let eW=G.create;t.object=eW;let eJ=G.strictCreate;t.strictObject=eJ;let eK=X.create;t.union=eK;let eU=Q.create;t.discriminatedUnion=eU;let eL=ee.create;t.intersection=eL;let eZ=et.create;t.tuple=eZ;let eN=er.create;t.record=eN;let eH=ea.create;t.map=eH;let e$=ei.create;t.set=e$;let eF=eo.create;t.function=eF;let eV=en.create;t.lazy=eV;let eB=es.create;t.literal=eB;let eq=el.create;t.enum=eq;let eG=ec.create;t.nativeEnum=eG;let eX=eu.create;t.promise=eX;let eY=eh.create;t.effect=eY,t.transformer=eY;let eQ=ep.create;t.optional=eQ;let e0=ef.create;t.nullable=e0;let e1=eh.createWithPreprocess;t.preprocess=e1;let e2=ew.create;t.pipeline=e2,t.ostring=()=>eE().optional(),t.onumber=()=>ek().optional(),t.oboolean=()=>eA().optional(),t.coerce={string:e=>W.create({...e,coerce:!0}),number:e=>J.create({...e,coerce:!0}),boolean:e=>U.create({...e,coerce:!0}),bigint:e=>K.create({...e,coerce:!0}),date:e=>L.create({...e,coerce:!0})},t.NEVER=h.INVALID},19788:(e,t,r)=>{async function a(e,t){throw Error("Sign in can only be called on the client side")}async function i(e){throw Error("Restore session can only be called on the client side")}async function o(){throw Error("Sign out can only be called on the client side")}r.d(t,{restoreSession:()=>i,signIn:()=>a,signOut:()=>o}),r(12930)},22079:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DidCacheMemory=void 0;let a=r(79993);class i extends a.SimpleStoreMemory{constructor(e){super(e?.max==null?{ttl:36e5,maxSize:52428800,...e}:{ttl:36e5,...e})}}t.DidCacheMemory=i},13534:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DidResolverCached=void 0;let a=r(2032),i=r(22079);class o{constructor(e,t=new i.DidCacheMemory){Object.defineProperty(this,"getter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.getter=new a.CachedGetter((t,r)=>e.resolve(t,r),t)}async resolve(e,t){return this.getter.get(e,t)}}t.DidResolverCached=o},61654:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},11549:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DidResolverBase=void 0;let a=r(96625),i=r(77964),o=r(31285);class n{constructor(e){Object.defineProperty(this,"methods",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.methods=new Map(Object.entries(e))}async resolve(e,t){t?.signal?.throwIfAborted();let r=(0,i.extractDidMethod)(e),n=this.methods.get(r);if(!n)throw new i.DidError(e,"Unsupported DID method","did-method-invalid",400);try{let r=await n.resolve(e,t);if(r.id!==e)throw new i.DidError(e,`DID document id (${r.id}) does not match DID`,"did-document-id-mismatch",400);return r}catch(t){if(t instanceof o.FetchResponseError){let r=t.response.status>=500?502:t.response.status;throw new i.DidError(e,t.message,"did-fetch-error",r,t)}if(t instanceof o.FetchError)throw new i.DidError(e,t.message,"did-fetch-error",400,t);if(t instanceof a.ZodError)throw new i.DidError(e,t.message,"did-document-format-error",503,t);throw i.DidError.from(t,e)}}}t.DidResolverBase=n},34523:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DidResolverCommon=void 0;let a=r(11549),i=r(71682),o=r(25609);class n extends a.DidResolverBase{constructor(e){super({plc:new i.DidPlcMethod(e),web:new o.DidWebMethod(e)})}}t.DidResolverCommon=n},27864:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},21482:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(77964),t),i(r(22079),t),i(r(13534),t),i(r(61654),t),i(r(34523),t),i(r(27864),t),i(r(27675),t),i(r(51744),t)},27675:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(71682),t),i(r(25609),t)},71682:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DidPlcMethod=void 0;let a=r(77964),i=r(31285),o=(0,r(53749).pipe)((0,i.fetchOkProcessor)(),(0,i.fetchJsonProcessor)(/^application\/(did\+ld\+)?json$/),(0,i.fetchJsonZodProcessor)(a.didDocumentValidator));class n{constructor(e){Object.defineProperty(this,"fetch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"plcDirectoryUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.plcDirectoryUrl=new URL(e?.plcDirectoryUrl||"https://plc.directory/"),this.fetch=(0,i.bindFetch)(e?.fetch)}async resolve(e,t){(0,a.assertDidPlc)(e);let r=new URL(`/${encodeURIComponent(e)}`,this.plcDirectoryUrl);return this.fetch(r,{redirect:"error",headers:{accept:"application/did+ld+json,application/json"},signal:t?.signal}).then(o)}}t.DidPlcMethod=n},25609:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DidWebMethod=void 0,t.buildDidWebDocumentUrl=s;let a=r(77964),i=r(31285),o=(0,r(53749).pipe)((0,i.fetchOkProcessor)(),(0,i.fetchJsonProcessor)(/^application\/(did\+ld\+)?json$/),(0,i.fetchJsonZodProcessor)(a.didDocumentValidator));class n{constructor({fetch:e=globalThis.fetch,allowHttp:t=!0}={}){Object.defineProperty(this,"fetch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"allowHttp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.fetch=(0,i.bindFetch)(e),this.allowHttp=t}async resolve(e,t){let r=s(e);if(!this.allowHttp&&"http:"===r.protocol)throw new a.DidError(e,'Resolution of "http" did:web is not allowed',"did-web-http-not-allowed");return this.fetch(r,{redirect:"error",headers:{accept:"application/did+ld+json,application/json"},signal:t?.signal}).then(o)}}function s(e){let t=(0,a.didWebToUrl)(e);return"/"===t.pathname?new URL("/.well-known/did.json",t):new URL(`${t.pathname}/did.json`,t)}t.DidWebMethod=n},51744:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},42460:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FetchError=void 0;class r extends Error{constructor(e,t,r){super(t,r),Object.defineProperty(this,"statusCode",{enumerable:!0,configurable:!0,writable:!0,value:e})}get expose(){return!0}}t.FetchError=r},77635:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_FORBIDDEN_DOMAIN_NAMES=t.FetchRequestError=void 0,t.protocolCheckRequestTransform=function(e){return(t,r)=>{let{protocol:a,port:s}=(0,o.extractUrl)(t),d=(0,i.asRequest)(t,r),l=Object.hasOwn(e,a)?e[a]:void 0;if(l){if(!0===l);else if(!l.allowCustomPort&&""!==s)throw new n(d,400,`Custom ${a} ports not allowed`)}else throw new n(d,400,`Forbidden protocol "${a}"`);return d}},t.explicitRedirectCheckRequestTransform=function(){return(e,t)=>{let r=(0,i.asRequest)(e,t);if(t?.redirect!=null)return r;if("follow"===r.redirect)throw new n(r,500,'Request redirect must be "error" or "manual"');return r}},t.requireHostHeaderTransform=function(){return(e,t)=>{let{protocol:r,hostname:a}=(0,o.extractUrl)(e),s=(0,i.asRequest)(e,t);if("http:"!==r&&"https:"!==r)throw new n(s,400,`"${r}" requests are not allowed`);if(!a||(0,o.isIp)(a))throw new n(s,400,"Invalid hostname");return s}},t.forbiddenDomainNameRequestTransform=function(e=t.DEFAULT_FORBIDDEN_DOMAIN_NAMES){let r=new Set(e);return 0===r.size?i.asRequest:async(e,t)=>{let{hostname:a}=(0,o.extractUrl)(e),s=(0,i.asRequest)(e,t);if(r.has(a))throw new n(s,403,"Forbidden hostname");let d=a.indexOf(".");for(;-1!==d;){let e=a.slice(d+1);if(r.has(`*.${e}`))throw new n(s,403,"Forbidden hostname");d=a.indexOf(".",d+1)}return s}};let a=r(42460),i=r(95672),o=r(43469);class n extends a.FetchError{constructor(e,t,r,a){if(null==t||!r){let e=function(e){if("string"==typeof e&&e.length>0)return[500,e];if(!(e instanceof Error))return[500,"Failed to fetch"];switch(e.message){case"failed to fetch the data URL":return[400,e.message];case"unexpected redirect":case"cors failure":case"blocked":case"proxy authentication required":return[502,e.message]}let t=e.code;if("string"==typeof t)switch(!0){case"ENOTFOUND"===t:return[400,"Invalid hostname"];case"ECONNREFUSED"===t:return[502,"Connection refused"];case"DEPTH_ZERO_SELF_SIGNED_CERT"===t:return[502,"Self-signed certificate"];case t.startsWith("ERR_TLS"):return[502,"TLS error"];case t.startsWith("ECONN"):return[502,"Connection error"];default:return[500,`${t} error`]}return[500,e.message]}(function(e){return e instanceof TypeError&&"fetch failed"===e.message&&void 0!==e.cause?e.cause:e}(a?.cause));t??(t=e[0]),r||(r=e[1])}super(t,r,a),Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:e})}get expose(){return 500!==this.statusCode}static from(e,t){return t instanceof n?t:new n(e,void 0,void 0,{cause:t})}}t.FetchRequestError=n,t.DEFAULT_FORBIDDEN_DOMAIN_NAMES=["example.com","*.example.com","example.org","*.example.org","example.net","*.example.net","googleusercontent.com","*.googleusercontent.com"]},81783:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fetchJsonZodProcessor=t.FetchResponseError=void 0,t.peekJson=c,t.checkLength=u,t.extractLength=h,t.extractMime=p,t.cancelBodyOnError=f,t.fetchOkProcessor=function(e){return f(t=>y(t,e))},t.fetchOkTransformer=y,t.fetchMaxSizeProcessor=function(e){if(e===1/0)return e=>e;if(!Number.isFinite(e)||e<0)throw TypeError("maxBytes must be a 0, Infinity or a positive number");return f(t=>m(t,e))},t.fetchResponseMaxSizeChecker=m,t.fetchTypeProcessor=g,t.fetchResponseTypeChecker=v,t.fetchResponseJsonTransformer=w,t.fetchJsonProcessor=function(e=s,t=!0){return(0,a.pipe)(g(e,t),f(w))},t.fetchJsonValidatorProcessor=_;let a=r(53749),i=r(42460),o=r(71607),n=r(43469),s=/^application\/(?:[^()<>@,;:/[\]\\?={} \t]+\+)?json$/i;class d extends i.FetchError{constructor(e,t=e.status,r=e.statusText,a){super(t,r,a),Object.defineProperty(this,"response",{enumerable:!0,configurable:!0,writable:!0,value:e})}static async from(e,t=l,r=e.status,a){let i="string"==typeof t?t:"function"==typeof t?await t(e):void 0;return new d(e,r,i,a)}}t.FetchResponseError=d;let l=async e=>{let t=p(e);if(t)try{if("text/plain"===t)return await e.text();if(s.test(t)){let t=await e.json();if("string"==typeof t)return t;if("object"==typeof t&&null!=t){let e=(0,n.ifString)(t.error_description);if(e)return e;let r=(0,n.ifString)(t.error);if(r)return r;let a=(0,n.ifString)(t.message);if(a)return a}}}catch{}};async function c(e,t=1/0){if("application/json"!==p(e))return;u(e,t);let r=e.clone();return(e.body&&t<1/0?new o.TransformedResponse(r,new n.MaxBytesTransformStream(t)):r).json()}function u(e,t){if(!(t>=0))throw TypeError("maxBytes must be a non-negative number");let r=h(e);if(null!=r&&r>t)throw new d(e,502,"Response too large");return r}function h(e){let t=e.headers.get("Content-Length");if(null==t)return;if(!/^\d+$/.test(t))throw new d(e,502,"Invalid Content-Length");let r=Number(t);if(!Number.isSafeInteger(r))throw new d(e,502,"Content-Length too large");return r}function p(e){let t=e.headers.get("Content-Type");if(null!=t)return t.split(";",1)[0].trim()}function f(e,t=n.logCancellationError){return async r=>{try{return await e(r)}catch(e){throw await (0,n.cancelBody)(r,t??void 0),e}}}async function y(e,t){if(e.ok)return e;throw await d.from(e,t)}function m(e,t){if(t===1/0||(u(e,t),!e.body))return e;let r=new n.MaxBytesTransformStream(t);return new o.TransformedResponse(e,r)}function g(e,t=!0){let r="string"==typeof e?t=>t===e:e instanceof RegExp?t=>e.test(t):e;return f(e=>v(e,r,t))}async function v(e,t,r=!0){let a=p(e);if(a){if(!t(a.toLowerCase()))throw await d.from(e,`Unexpected response Content-Type (${a})`,502)}else if(r)throw await d.from(e,"Missing response Content-Type header",502);return e}async function w(e){try{let t=await e.json();return{response:e,json:t}}catch(t){throw new d(e,502,"Unable to parse response as JSON",{cause:t})}}function _(e,t){if("parseAsync"in e&&"function"==typeof e.parseAsync)return async r=>e.parseAsync(r.json,t);if("parse"in e&&"function"==typeof e.parse)return async r=>e.parse(r.json,t);throw TypeError("Invalid schema")}t.fetchJsonZodProcessor=_},72869:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.timedFetch=void 0,t.loggedFetch=function({fetch:e=globalThis.fetch,logRequest:t=!0,logResponse:r=!0,logError:a=!0}){let o=!0===t?async e=>{let t=await (0,n.stringifyMessage)(e);console.info(`> ${e.method} ${e.url}
${(0,n.padLines)(t,"  ")}`)}:t||void 0,s=!0===r?async e=>{let t=await (0,n.stringifyMessage)(e.clone());console.info(`< HTTP/1.1 ${e.status} ${e.statusText}
${(0,n.padLines)(t,"  ")}`)}:r||void 0,d=!0===a?async e=>{console.error("< Error:",e)}:a||void 0;return o||s||d?(0,i.toRequestTransformer)(async function(t){o&&await o(t);try{let r=await e.call(this,t);return s&&await s(r,t),r}catch(e){throw d&&await d(e,t),e}}):e},t.bindFetch=function(e=globalThis.fetch,t=globalThis){return(0,i.toRequestTransformer)(async r=>{try{return await e.call(t,r)}catch(e){throw a.FetchRequestError.from(r,e)}})};let a=r(77635),i=r(95672),o=r(71607),n=r(43469);t.timedFetch=(e=6e4,t=globalThis.fetch)=>{if(e===1/0)return t;if(!Number.isFinite(e)||e<=0)throw TypeError("Timeout must be positive");return(0,i.toRequestTransformer)(async function(r){let a=new AbortController,i=a.signal,n=()=>{a.abort()},s=()=>{clearTimeout(d),r.signal?.removeEventListener("abort",n)},d=setTimeout(n,e);"object"==typeof d&&d.unref?.(),r.signal?.addEventListener("abort",n),i.addEventListener("abort",s);let l=await t.call(this,r,{signal:i});if(!l.body)return s(),l;{let e=new TransformStream({flush:s});return new o.TransformedResponse(l,e)}})}},95672:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toRequestTransformer=function(e){return function(t,a){return e.call(this,r(t,a))}},t.asRequest=r;function r(e,t){return!t&&e instanceof Request?e:new Request(e,t)}},31285:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(42460),t),i(r(77635),t),i(r(81783),t),i(r(72869),t),i(r(95672),t),i(r(43469),t)},71607:function(e,t){var r,a=this&&this.__classPrivateFieldSet||function(e,t,r,a,i){if("m"===a)throw TypeError("Private method is not writable");if("a"===a&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(e,r):i?i.value=r:t.set(e,r),r},i=this&&this.__classPrivateFieldGet||function(e,t,r,a){if("a"===r&&!a)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.TransformedResponse=void 0;class o extends Response{constructor(e,t){if(!e.body)throw TypeError("Response body is not available");if(e.bodyUsed)throw TypeError("Response body is already used");super(e.body.pipeThrough(t),{status:e.status,statusText:e.statusText,headers:e.headers}),r.set(this,void 0),a(this,r,e,"f")}get url(){return i(this,r,"f").url}get redirected(){return i(this,r,"f").redirected}get type(){return i(this,r,"f").type}get statusText(){return i(this,r,"f").statusText}}t.TransformedResponse=o,r=new WeakMap},43469:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.extractUrl=t.MaxBytesTransformStream=t.ifString=void 0,t.isIp=function(e){return!!(e.match(/^\d+\.\d+\.\d+\.\d+$/)||e.startsWith("[")&&e.endsWith("]"))},t.padLines=function(e,t){return e?t+e.replace(a,`$&${t}`):e},t.cancelBody=i,t.logCancellationError=o,t.stringifyMessage=n,t.ifString=e=>"string"==typeof e?e:void 0;class r extends TransformStream{constructor(e){if(!(e>=0))throw TypeError("maxBytes must be a non-negative number");let t=0;super({transform:(r,a)=>{(t+=r.length)<=e?a.enqueue(r):a.error(Error("Response too large"))}})}}t.MaxBytesTransformStream=r;let a=/\r?\n/g;async function i(e,t){!e.body||e.bodyUsed||e.body.locked||"function"!=typeof e.body.cancel||("function"==typeof t?e.body.cancel().catch(t):"log"===t?e.body.cancel().catch(o):await e.body.cancel())}function o(e){console.warn("Failed to cancel response body",e)}async function n(e){try{var t;let r=(t=e.headers,Array.from(t).map(([e,t])=>`${e}: ${t}`).join("\n")),a=await s(e);return r&&a?`${r}
${a}`:r||a}finally{i(e,"log")}}async function s(e){try{let t=await e.blob();if(t.type?.startsWith("text/")){let e=await t.text();return JSON.stringify(e)}if(/application\/(?:\w+\+)?json/.test(t.type)){let e=await t.text();return e.includes("\n")?JSON.stringify(JSON.parse(e)):e}return`[Body size: ${t.size}, type: ${JSON.stringify(t.type)} ]`}catch{return"[Body could not be read]"}}t.extractUrl=e=>"string"==typeof e?new URL(e):e instanceof URL?e:new URL(e.url)},15620:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AppViewHandleResolver=t.xrpcErrorSchema=void 0;let a=r(96625),i=r(94351);t.xrpcErrorSchema=a.z.object({error:a.z.string(),message:a.z.string().optional()});class o{static from(e,t){return"string"==typeof e||e instanceof URL?new o(e,t):e}constructor(e,t){Object.defineProperty(this,"serviceUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.serviceUrl=new URL(e),this.fetch=t?.fetch??globalThis.fetch}async resolve(e,r){let a=new URL("/xrpc/com.atproto.identity.resolveHandle",this.serviceUrl);a.searchParams.set("handle",e);let o=await this.fetch.call(null,a,{cache:r?.noCache?"no-cache":void 0,signal:r?.signal,redirect:"error"}),n=await o.json();if(400===o.status){let e=t.xrpcErrorSchema.parse(n);if("InvalidRequest"===e.error&&"Unable to resolve handle"===e.message)return null}if(!o.ok)throw TypeError("Invalid response from resolveHandle method");let s=n?.did;if(!(0,i.isResolvedHandle)(s))throw TypeError("Invalid DID returned from resolveHandle method");return s}}t.AppViewHandleResolver=o},73516:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AtprotoDohHandleResolver=void 0;let a=r(92923);class i extends a.AtprotoHandleResolver{constructor(e){super({...e,resolveTxt:function({dohEndpoint:e,fetch:t=globalThis.fetch}){return async r=>{let a=new URL(e);a.searchParams.set("type","TXT"),a.searchParams.set("name",r);let i=await t(a,{method:"GET",headers:{accept:"application/dns-json"},redirect:"follow"});try{let e=i.headers.get("content-type")?.trim();if(i.ok){if(e?.match(/application\/(dns-)?json/i)==null)throw TypeError("Unexpected response from DoH server")}else{let t=e?.startsWith("text/plain")?await i.text():`Failed to resolve ${r}`;throw TypeError(t)}let t=function(e){var t;if("object"==typeof e&&null!==e&&"Status"in e&&"number"==typeof e.Status&&(!("Answer"in e)||(t=e.Answer,Array.isArray(t)&&t.every(n))))return e;throw TypeError("Invalid DoH response")}(await i.json());return t.Answer?.filter(s).map(d)??null}finally{!1===i.bodyUsed&&i.body?.cancel().catch(o)}}}(e),resolveTxtFallback:void 0})}}function o(e){e instanceof DOMException&&"AbortError"===e.name||console.error("An error occurred while cancelling the response body:",e)}function n(e){return"object"==typeof e&&null!==e&&"name"in e&&"string"==typeof e.name&&"type"in e&&"number"==typeof e.type&&"data"in e&&"string"==typeof e.data&&"TTL"in e&&"number"==typeof e.TTL}function s(e){return 16===e.type}function d(e){return e.data.replace(/^"|"$/g,"").replace(/\\"/g,'"')}t.AtprotoDohHandleResolver=i},92923:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AtprotoHandleResolver=void 0;let a=r(93285),i=r(52841),o=()=>{};class n{constructor(e){Object.defineProperty(this,"httpResolver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dnsResolver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dnsResolverFallback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.httpResolver=new i.WellKnownHandleResolver(e),this.dnsResolver=new a.DnsHandleResolver(e.resolveTxt),this.dnsResolverFallback=e.resolveTxtFallback?new a.DnsHandleResolver(e.resolveTxtFallback):void 0}async resolve(e,t){t?.signal?.throwIfAborted();let r=new AbortController,{signal:a}=r;t?.signal?.addEventListener("abort",()=>r.abort(),{signal:a});let i={...t,signal:a};try{let t=this.dnsResolver.resolve(e,i),r=this.httpResolver.resolve(e,i);r.catch(o);let n=await t;if(n)return n;a.throwIfAborted();let s=await r;if(s)return s;return a.throwIfAborted(),this.dnsResolverFallback?.resolve(e,i)??null}finally{r.abort()}}}t.AtprotoHandleResolver=n},56821:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CachedHandleResolver=void 0;let a=r(2032),i=r(79993);class o{constructor(e,t=new i.SimpleStoreMemory({max:1e3,ttl:6e5})){Object.defineProperty(this,"getter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.getter=new a.CachedGetter((t,r)=>e.resolve(t,r),t)}async resolve(e,t){return this.getter.get(e,t)}}t.CachedHandleResolver=o},95563:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(94351),t),i(r(15620),t),i(r(73516),t),i(r(92923),t),i(r(56821),t)},93285:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DnsHandleResolver=void 0;let a=r(94351),i="did=";class o{constructor(e){Object.defineProperty(this,"resolveTxt",{enumerable:!0,configurable:!0,writable:!0,value:e})}async resolve(e){let t=await this.resolveTxt.call(null,`_atproto.${e}`);if(!t)return null;for(let e=0;e<t.length;e++){if(!t[e].startsWith(i))continue;for(let r=e+1;r<t.length;r++)if(t[r].startsWith(i))return null;let r=t[e].slice(i.length);return(0,a.isResolvedHandle)(r)?r:null}return null}}t.DnsHandleResolver=o},52841:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WellKnownHandleResolver=void 0;let a=r(94351);class i{constructor(e){Object.defineProperty(this,"fetch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.fetch=e?.fetch??globalThis.fetch}async resolve(e,t){let r=new URL("/.well-known/atproto-did",`https://${e}`);try{let e=await this.fetch.call(null,r,{cache:t?.noCache?"no-cache":void 0,signal:t?.signal,redirect:"error"}),i=(await e.text()).split("\n")[0].trim();if((0,a.isResolvedHandle)(i))return i;return null}catch(e){return t?.signal?.throwIfAborted(),null}}}t.WellKnownHandleResolver=i},94351:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isResolvedHandle=function(e){return null===e||(0,a.isAtprotoDid)(e)};let a=r(77964)},91032:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IdentityResolver=void 0;let a=r(68227),i=r(95563);class o{constructor(e,t){Object.defineProperty(this,"didResolver",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handleResolver",{enumerable:!0,configurable:!0,writable:!0,value:t})}async resolve(e,t){let r=(0,i.isResolvedHandle)(e)?await this.getDocumentFromDid(e,t):await this.getDocumentFromHandle(e,t),a=r.service?.find(n,r);if(!a)throw TypeError(`No valid "AtprotoPersonalDataServer" service found in "${r.id}" DID document`);return{did:r.id,pds:new URL(a.serviceEndpoint)}}async getDocumentFromDid(e,t){return this.didResolver.resolve(e,t)}async getDocumentFromHandle(e,t){let r=(0,a.normalizeAndEnsureValidHandle)(e),i=await this.handleResolver.resolve(r,t);if(!i)throw TypeError(`Handle "${r}" does not resolve to a DID`);t?.signal?.throwIfAborted();let o=await this.didResolver.resolve(i,t);if(!o.alsoKnownAs?.includes(`at://${r}`))throw TypeError(`Did document for "${i}" does not include the handle "${r}"`);return o}}function n(e){return"string"==typeof e.serviceEndpoint&&"AtprotoPersonalDataServer"===e.type&&(e.id.startsWith("#")?"#atproto_pds"===e.id:e.id===`${this.id}#atproto_pds`)}t.IdentityResolver=o},63297:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(91032),t)},53749:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.pipeTwo=t.pipe=void 0;var a=r(81001);Object.defineProperty(t,"pipe",{enumerable:!0,get:function(){return a.pipe}}),Object.defineProperty(t,"pipeTwo",{enumerable:!0,get:function(){return a.pipeTwo}})},81001:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.pipe=function(...e){return e.reduce(r)},t.pipeTwo=r;function r(e,t){return async(...r)=>t(await e(...r))}},79993:function(e,t,r){var a,i=this&&this.__classPrivateFieldSet||function(e,t,r,a,i){if("m"===a)throw TypeError("Private method is not writable");if("a"===a&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(e,r):i?i.value=r:t.set(e,r),r},o=this&&this.__classPrivateFieldGet||function(e,t,r,a){if("a"===r&&!a)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleStoreMemory=void 0;let n=r(27168),s=r(74669),d=Symbol("nullItem"),l=e=>null===e?d:e,c=e=>e===d?null:e;class u{constructor({sizeCalculation:e,...t}){a.set(this,void 0),i(this,a,new n.LRUCache({...t,allowStale:!1,updateAgeOnGet:!1,updateAgeOnHas:!1,sizeCalculation:e?(t,r)=>e(c(t),r):null!=t.maxEntrySize||null!=t.maxSize?s.roughSizeOfObject:void 0}),"f")}get(e){let t=o(this,a,"f").get(e);if(void 0!==t)return c(t)}set(e,t){o(this,a,"f").set(e,l(t))}del(e){o(this,a,"f").delete(e)}clear(){o(this,a,"f").clear()}}t.SimpleStoreMemory=u,a=new WeakMap},74669:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.roughSizeOfObject=function(e){let t=new Set,a=[e],i=0;for(;a.length;){let e=a.pop();switch(typeof e){case"string":i+=12+4*Math.ceil(e.length/4);break;case"number":i+=12;break;case"boolean":i+=4;break;case"object":if(i+=4,null===e)break;if(r.has(e)){i+=r.get(e);break}if(t.has(e))continue;if(t.add(e),Array.isArray(e))i+=4,a.push(...e);else{i+=8;let t=Object.getOwnPropertyNames(e);for(let r=0;r<t.length;r++){i+=4;let o=t[r],n=e[o];void 0!==n&&a.push(n),a.push(o)}}break;case"function":case"symbol":i+=8;break;case"bigint":i+=16}}return"object"==typeof e&&null!==e&&r.set(e,i),i};let r=new WeakMap},89283:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CachedGetter=void 0;let r=()=>!0,a=()=>!1;class i{constructor(e,t,r){Object.defineProperty(this,"getter",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"store",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"pending",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}async get(e,t={}){let i;t.signal?.throwIfAborted();let o=this.options?.isStale,n=t.noCache?a:t.allowStale||null==o?r:async t=>!await o(e,t);for(;i=this.pending.get(e);){try{let{isFresh:e,value:t}=await i;if(e||await n(t))return t}catch{}t.signal?.throwIfAborted()}let s=Promise.resolve().then(async()=>{let r=await this.getStored(e,t);return void 0!==r&&await n(r)?{isFresh:!1,value:r}:Promise.resolve().then(async()=>(0,this.getter)(e,t,r)).catch(async t=>{if(void 0!==r)try{let a=this.options?.deleteOnError;await a?.(t,e,r)&&await this.delStored(e,t)}catch(e){throw AggregateError([t,e],"Error while deleting stored value")}throw t}).then(async t=>(await this.setStored(e,t),{isFresh:!0,value:t}))}).finally(()=>{this.pending.delete(e)});if(this.pending.has(e))throw Error("Concurrent request for the same key");this.pending.set(e,s);let{value:d}=await s;return d}async getStored(e,t){try{return await this.store.get(e,t)}catch(e){return}}async setStored(e,t){try{await this.store.set(e,t)}catch(a){let r=this.options?.onStoreError;await r?.(a,e,t)}}async delStored(e,t){await this.store.del(e)}}t.CachedGetter=i},2032:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(89283),t),i(r(874),t)},874:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},37098:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.atprotoDidSchema=void 0,t.isAtprotoDid=n,t.asAtprotoDid=function(e){return s(e),e},t.assertAtprotoDid=s,t.assertAtprotoDidWeb=d,t.isAtprotoDidWeb=l;let a=r(96625),i=r(67130),o=r(97097);function n(e){return"string"==typeof e&&(e.startsWith(o.DID_PLC_PREFIX)?(0,o.isDidPlc)(e):!!e.startsWith(o.DID_WEB_PREFIX)&&l(e))}function s(e){if("string"!=typeof e)throw new i.InvalidDidError(typeof e,"DID must be a string");if(e.startsWith(o.DID_PLC_PREFIX))(0,o.assertDidPlc)(e);else if(e.startsWith(o.DID_WEB_PREFIX))d(e);else throw new i.InvalidDidError(e,'Atproto only allows "plc" and "web" DID methods')}function d(e){if((0,o.assertDidWeb)(e),e.includes(":",o.DID_WEB_PREFIX.length))throw new i.InvalidDidError(e,"Atproto does not allow path components in Web DIDs");if(e.includes("%3A",o.DID_WEB_PREFIX.length)&&!e.startsWith("did:web:localhost%3A"))throw new i.InvalidDidError(e,"Atproto does not allow port numbers in Web DIDs, except for localhost")}function l(e){try{return d(e),!0}catch{return!1}}t.atprotoDidSchema=a.z.string().refine(n,'Atproto only allows "plc" and "web" DID methods')},76386:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.didDocumentValidator=t.didDocumentSchema=void 0;let a=r(96625),i=r(54582),o=a.z.string().refine(e=>{try{return new URL(e),!0}catch{return!1}},"RFC3968 compliant URI"),n=a.z.union([i.didSchema,a.z.array(i.didSchema)]),s=a.z.union([o,a.z.string().regex(/^#[^#]+$/)]),d=a.z.object({id:s,type:a.z.string().min(1),controller:n,publicKeyJwk:a.z.record(a.z.string(),a.z.unknown()).optional(),publicKeyMultibase:a.z.string().optional()}),l=a.z.union([a.z.string(),a.z.array(a.z.string())]),c=a.z.union([o,a.z.record(a.z.string(),o),a.z.array(a.z.union([o,a.z.record(a.z.string(),o)])).nonempty()]),u=a.z.object({id:s,type:l,serviceEndpoint:c}),h=a.z.union([s,d]);t.didDocumentSchema=a.z.object({"@context":a.z.union([a.z.literal("https://www.w3.org/ns/did/v1"),a.z.array(a.z.string().url()).nonempty().refine(e=>"https://www.w3.org/ns/did/v1"===e[0],{message:"First @context must be https://www.w3.org/ns/did/v1"})]),id:i.didSchema,controller:n.optional(),alsoKnownAs:a.z.array(o).optional(),service:a.z.array(u).optional(),authentication:a.z.array(h).optional(),verificationMethod:a.z.array(a.z.union([d,s])).optional()}),t.didDocumentValidator=t.didDocumentSchema.superRefine(({id:e,service:t},r)=>{if(t){let i=new Set;for(let o=0;o<t.length;o++){let n=t[o],s=n.id.startsWith("#")?`${e}${n.id}`:n.id;i.has(s)?r.addIssue({code:a.z.ZodIssueCode.custom,message:`Duplicate service id (${n.id}) found in the document`,path:["service",o,"id"]}):i.add(s)}}})},67130:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidDidError=t.DidError=void 0;class r extends Error{constructor(e,t,r,a=400,i){super(t,{cause:i}),Object.defineProperty(this,"did",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:a})}get statusCode(){return this.status}toString(){return`${this.constructor.name} ${this.code} (${this.did}): ${this.message}`}static from(e,t){return e instanceof r?e:new r(t,e instanceof Error?e.message:"string"==typeof e?e:"An unknown error occurred","did-unknown-error",("number"==typeof e?.statusCode?e.statusCode:void 0)??("number"==typeof e?.status?e.status:void 0),e)}}t.DidError=r;class a extends r{constructor(e,t,r){super(e,t,"did-invalid",400,r)}}t.InvalidDidError=a},54582:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.didSchema=t.DID_PREFIX=void 0,t.assertDidMethod=s,t.extractDidMethod=function(e){let t=e.indexOf(":",n);return e.slice(n,t)},t.assertDidMsid=d,t.assertDid=l,t.isDid=function(e){try{return l(e),!0}catch(e){if(e instanceof i.DidError)return!1;throw e}},t.asDid=function(e){return l(e),e};let a=r(96625),i=r(67130),o="did:";t.DID_PREFIX=o;let n=o.length;function s(e,t=0,r=e.length){let a;if(!Number.isFinite(r)||!Number.isFinite(t)||r<t||r>e.length)throw TypeError("Invalid start or end position");if(r===t)throw new i.InvalidDidError(e,"Empty method name");for(let o=t;o<r;o++)if(((a=e.charCodeAt(o))<97||a>122)&&(a<48||a>57))throw new i.InvalidDidError(e,`Invalid character at position ${o} in DID method name`)}function d(e,t=0,r=e.length){let a;if(!Number.isFinite(r)||!Number.isFinite(t)||r<t||r>e.length)throw TypeError("Invalid start or end position");if(r===t)throw new i.InvalidDidError(e,"DID method-specific id must not be empty");for(let o=t;o<r;o++)if(((a=e.charCodeAt(o))<97||a>122)&&(a<65||a>90)&&(a<48||a>57)&&46!==a&&45!==a&&95!==a){if(58===a){if(o===r-1)throw new i.InvalidDidError(e,'DID cannot end with ":"');continue}if(37===a){if(((a=e.charCodeAt(++o))<48||a>57)&&(a<65||a>70)||((a=e.charCodeAt(++o))<48||a>57)&&(a<65||a>70))throw new i.InvalidDidError(e,`Invalid pct-encoded character at position ${o}`);if(o>=r)throw new i.InvalidDidError(e,`Incomplete pct-encoded character at position ${o-2}`);continue}throw new i.InvalidDidError(e,`Disallowed character in DID at position ${o}`)}}function l(e){if("string"!=typeof e)throw new i.InvalidDidError(typeof e,"DID must be a string");let{length:t}=e;if(t>2048)throw new i.InvalidDidError(e,"DID is too long (2048 chars max)");if(!e.startsWith(o))throw new i.InvalidDidError(e,`DID requires "${o}" prefix`);let r=e.indexOf(":",n);if(-1===r)throw new i.InvalidDidError(e,"Missing colon after method name");s(e,n,r),d(e,r+1,t)}t.didSchema=a.z.string().superRefine((e,t)=>{try{return l(e),!0}catch(e){return t.addIssue({code:a.z.ZodIssueCode.custom,message:e instanceof Error?e.message:"Unexpected error"}),!1}})},77964:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(37098),t),i(r(76386),t),i(r(67130),t),i(r(54582),t),i(r(97097),t)},97097:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(29979),t),i(r(79322),t)},29979:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DID_PLC_PREFIX=void 0,t.isDidPlc=function(e){if("string"!=typeof e||32!==e.length||!e.startsWith(i))return!1;for(let t=o;t<32;t++)if(!s(e.charCodeAt(t)))return!1;return!0},t.asDidPlc=function(e){return n(e),e},t.assertDidPlc=n;let a=r(67130),i="did:plc:";t.DID_PLC_PREFIX=i;let o=i.length;function n(e){if("string"!=typeof e)throw new a.InvalidDidError(typeof e,"DID must be a string");if(!e.startsWith(i))throw new a.InvalidDidError(e,"Invalid did:plc prefix");if(32!==e.length)throw new a.InvalidDidError(e,"did:plc must be 32 characters long");for(let t=o;t<32;t++)if(!s(e.charCodeAt(t)))throw new a.InvalidDidError(e,`Invalid character at position ${t}`)}let s=e=>e>=97&&e<=122||e>=50&&e<=55},79322:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DID_WEB_PREFIX=void 0,t.isDidWeb=function(e){if("string"!=typeof e||!e.startsWith(t.DID_WEB_PREFIX)||":"===e.charAt(t.DID_WEB_PREFIX.length))return!1;try{return n(e),!0}catch{return!1}},t.asDidWeb=function(e){return o(e),e},t.assertDidWeb=o,t.didWebToUrl=n,t.urlToDidWeb=function(e){let t=e.port?`%3A${e.port}`:"",r="/"===e.pathname?"":e.pathname.replaceAll("/",":");return`did:web:${e.hostname}${t}${r}`};let a=r(67130),i=r(54582);function o(e){if("string"!=typeof e)throw new a.InvalidDidError(typeof e,"DID must be a string");if(!e.startsWith(t.DID_WEB_PREFIX))throw new a.InvalidDidError(e,"Invalid did:web prefix");if(":"===e.charAt(t.DID_WEB_PREFIX.length))throw new a.InvalidDidError(e,"did:web MSID must not start with a colon");n(e)}function n(e){(0,i.assertDidMsid)(e,t.DID_WEB_PREFIX.length);let r=t.DID_WEB_PREFIX.length,o=e.indexOf(":",r),n=-1===o?e.slice(r):e.slice(r,o),s=-1===o?"":e.slice(o);try{let e=new URL(`https://${n.replaceAll("%3A",":")}${s.replaceAll(":","/")}`);return"localhost"===e.hostname&&(e.protocol="http:"),e}catch(t){throw new a.InvalidDidError(e,"Invalid Web DID",t)}}t.DID_WEB_PREFIX="did:web:"},67001:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(16681),t)},16681:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.JoseKey=void 0;let a=r(55547),i=r(16516),o=r(78403),{JOSEError:n}=a.errors;class s extends i.Key{async getKeyObj(e){if(!this.algorithms.includes(e))throw new i.JwkError(`Key cannot be used with algorithm "${e}"`);try{return await (0,a.importJWK)(this.jwk,e)}catch(e){throw new i.JwkError("Failed to import JWK",void 0,{cause:e})}}async createJwt(e,t){try{let{kid:r}=e;if(r&&r!==this.kid)throw new i.JwtCreateError(`Invalid "kid" (${r}) used to sign with key "${this.kid}"`);let{alg:o}=e;if(!o)throw new i.JwtCreateError('Missing "alg" in JWT header');let n=await this.getKeyObj(o),s=new a.SignJWT(t).setProtectedHeader({...e,alg:o,kid:this.kid});return await s.sign(n)}catch(e){if(e instanceof n)throw new i.JwtCreateError(e.message,e.code,{cause:e});throw i.JwtCreateError.from(e)}}async verifyJwt(e,t){try{let r=await (0,a.jwtVerify)(e,async({alg:e})=>this.getKeyObj(e),{...t,algorithms:this.algorithms}),o=i.jwtHeaderSchema.safeParse(r.protectedHeader);if(!o.success)throw new i.JwtVerifyError("Invalid JWT header",void 0,{cause:o.error});let n=i.jwtPayloadSchema.safeParse(r.payload);if(!n.success)throw new i.JwtVerifyError("Invalid JWT payload",void 0,{cause:n.error});return{protectedHeader:o.data,payload:n.data}}catch(e){if(e instanceof n)throw new i.JwtVerifyError(e.message,e.code,{cause:e});throw i.JwtVerifyError.from(e)}}static async generateKeyPair(e=["ES256"],t){if(!e.length)throw new i.JwkError("No algorithms provided for key generation");let r=[];for(let i of e)try{return await (0,a.generateKeyPair)(i,t)}catch(e){r.push(e)}throw new i.JwkError("Failed to generate key pair",void 0,{cause:AggregateError(r,"None of the algorithms worked")})}static async generate(e=["ES256"],t,r){let a=await this.generateKeyPair(e,{...r,extractable:!0});return this.fromImportable(a.privateKey,t)}static async fromImportable(e,t){if("string"==typeof e){if(e.startsWith("-----"))return this.fromPKCS8(e,"",t);if(e.startsWith("{"))return this.fromJWK(e,t);throw new i.JwkError("Invalid input")}if("object"==typeof e)return"kty"in e||"alg"in e?this.fromJWK(e,t):this.fromKeyLike(e,t);throw new i.JwkError("Invalid input")}static async fromKeyLike(e,t,r){let o=await (0,a.exportJWK)(e);if(r){if(o.alg){if(o.alg!==r)throw new i.JwkError('Invalid "alg" in JWK')}else o.alg=r}return this.fromJWK(o,t)}static async fromPKCS8(e,t,r){let i=await (0,a.importPKCS8)(e,t,{extractable:!0});return this.fromKeyLike(i,r)}static async fromJWK(e,t){let r="string"==typeof e?JSON.parse(e):e;if(!r||"object"!=typeof r)throw new i.JwkError("Invalid JWK");let a=(0,o.either)(r.kid,t),n=r.use||"sig";return new s(i.jwkValidator.parse({...r,kid:a,use:n}))}}t.JoseKey=s},78403:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.either=function(e,t){if(null!=e&&null!=t&&e!==t)throw TypeError(`Expected "${t}", got "${e}"`);return e??t??void 0}},39446:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(45999),t)},88617:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toSubtleAlgorithm=function(e,t,r){switch(e){case"PS256":case"PS384":case"PS512":return{name:"RSA-PSS",hash:`SHA-${e.slice(-3)}`,modulusLength:r?.modulusLength??2048,publicExponent:new Uint8Array([1,0,1])};case"RS256":case"RS384":case"RS512":return{name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.slice(-3)}`,modulusLength:r?.modulusLength??2048,publicExponent:new Uint8Array([1,0,1])};case"ES256":case"ES384":return{name:"ECDSA",namedCurve:`P-${e.slice(-3)}`};case"ES512":return{name:"ECDSA",namedCurve:"P-521"};default:throw TypeError(`Unsupported alg "${e}"`)}},t.fromSubtleAlgorithm=function(e){switch(e.name){case"RSA-PSS":case"RSASSA-PKCS1-v1_5":{let t=e.hash.name;switch(t){case"SHA-256":case"SHA-384":case"SHA-512":{let r="RSA-PSS"===e.name?"PS":"RS";return`${r}${t.slice(-3)}`}default:throw TypeError("unsupported RsaHashedKeyAlgorithm hash")}}case"ECDSA":{let t=e.namedCurve;switch(t){case"P-256":case"P-384":case"P-512":return`ES${t.slice(-3)}`;case"P-521":return"ES512";default:throw TypeError("unsupported EcKeyAlgorithm namedCurve")}}case"Ed448":case"Ed25519":return"EdDSA";default:throw TypeError(`Unexpected algorithm "${e.name}"`)}},t.isCryptoKeyPair=function(e,t){return"object"==typeof e&&null!==e&&"privateKey"in e&&e.privateKey instanceof CryptoKey&&"private"===e.privateKey.type&&(null==t||e.privateKey.extractable===t)&&e.privateKey.usages.includes("sign")&&"publicKey"in e&&e.publicKey instanceof CryptoKey&&"public"===e.publicKey.type&&!0===e.publicKey.extractable&&e.publicKey.usages.includes("verify")}},45999:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WebcryptoKey=t.jwkWithAlgSchema=void 0;let a=r(96625),i=r(16516),o=r(67001),n=r(88617);t.jwkWithAlgSchema=a.z.intersection(i.jwkSchema,a.z.object({alg:a.z.string()}));class s extends o.JoseKey{static async generate(e=["ES256"],t=crypto.randomUUID(),r){let a=await this.generateKeyPair(e,r);if(!(0,n.isCryptoKeyPair)(a))throw TypeError("Invalid CryptoKeyPair");return this.fromKeypair(a,t)}static async fromKeypair(e,r){let{key_ops:a,use:i,alg:o=(0,n.fromSubtleAlgorithm)(e.privateKey.algorithm),...d}=await crypto.subtle.exportKey("jwk",e.privateKey.extractable?e.privateKey:e.publicKey);if(i&&"sig"!==i)throw TypeError(`Unsupported JWK use "${i}"`);if(a&&!a.some(e=>"sign"===e||"verify"===e))throw TypeError(`Invalid key_ops "${a}" for "sig" use`);return new s(t.jwkWithAlgSchema.parse({...d,kid:r,alg:o,use:"sig"}),e)}constructor(e,t){super(e),Object.defineProperty(this,"cryptoKeyPair",{enumerable:!0,configurable:!0,writable:!0,value:t})}get isPrivate(){return!0}get privateJwk(){if(super.isPrivate)return this.jwk;throw Error("Private Webcrypto Key not exportable")}async getKeyObj(e){if(this.jwk.alg!==e)throw new i.JwkError(`Key cannot be used with algorithm "${e}"`);return this.cryptoKeyPair.privateKey}}t.WebcryptoKey=s},59226:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.jwkAlgorithms=function*(e){if(e.alg){yield e.alg;return}switch(e.kty){case"EC":if(("enc"===e.use||void 0===e.use)&&(yield"ECDH-ES",yield"ECDH-ES+A128KW",yield"ECDH-ES+A192KW",yield"ECDH-ES+A256KW"),"sig"===e.use||void 0===e.use){let t="crv"in e?e.crv:void 0;switch(t){case"P-256":case"P-384":yield`ES${t.slice(-3)}`;break;case"P-521":yield"ES512";break;case"secp256k1":o&&(yield"ES256K");break;default:throw new a.JwkError(`Unsupported crv "${t}"`)}}return;case"OKP":if(!e.use)throw new a.JwkError('Missing "use" Parameter value');yield"ECDH-ES",yield"ECDH-ES+A128KW",yield"ECDH-ES+A192KW",yield"ECDH-ES+A256KW";return;case"RSA":("enc"===e.use||void 0===e.use)&&(yield"RSA-OAEP",yield"RSA-OAEP-256",yield"RSA-OAEP-384",yield"RSA-OAEP-512",o&&(yield"RSA1_5")),("sig"===e.use||void 0===e.use)&&(yield"PS256",yield"PS384",yield"PS512",yield"RS256",yield"RS384",yield"RS512");return;case"oct":("enc"===e.use||void 0===e.use)&&(yield"A128GCMKW",yield"A192GCMKW",yield"A256GCMKW",yield"A128KW",yield"A192KW",yield"A256KW"),("sig"===e.use||void 0===e.use)&&(yield"HS256",yield"HS384",yield"HS512");return;default:throw new a.JwkError(`Unsupported kty "${e.kty}"`)}};let a=r(58724),{process:i}=globalThis,o=void 0!==i&&"string"==typeof i?.versions?.node},58724:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.JwtVerifyError=t.JwtCreateError=t.JwkError=t.ERR_JWT_VERIFY=t.ERR_JWT_CREATE=t.ERR_JWT_INVALID=t.ERR_JWK_NOT_FOUND=t.ERR_JWK_INVALID=t.ERR_JWKS_NO_MATCHING_KEY=void 0,t.ERR_JWKS_NO_MATCHING_KEY="ERR_JWKS_NO_MATCHING_KEY",t.ERR_JWK_INVALID="ERR_JWK_INVALID",t.ERR_JWK_NOT_FOUND="ERR_JWK_NOT_FOUND",t.ERR_JWT_INVALID="ERR_JWT_INVALID",t.ERR_JWT_CREATE="ERR_JWT_CREATE",t.ERR_JWT_VERIFY="ERR_JWT_VERIFY";class r extends TypeError{constructor(e="JWK error",r=t.ERR_JWK_INVALID,a){super(e,a),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:r})}}t.JwkError=r;class a extends Error{constructor(e="Unable to create JWT",r=t.ERR_JWT_CREATE,a){super(e,a),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:r})}static from(e,t,i){return e instanceof a?e:e instanceof r?new a(i,e.code,{cause:e}):new a(i,t,{cause:e})}}t.JwtCreateError=a;class i extends Error{constructor(e="Invalid JWT",r=t.ERR_JWT_VERIFY,a){super(e,a),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:r})}static from(e,t,a){return e instanceof i?e:e instanceof r?new i(a,e.code,{cause:e}):new i(a,t,{cause:e})}}t.JwtVerifyError=i},16516:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.ValidationError=void 0;var o=r(96625);Object.defineProperty(t,"ValidationError",{enumerable:!0,get:function(){return o.ZodError}}),i(r(59226),t),i(r(58724),t),i(r(21091),t),i(r(83885),t),i(r(77344),t),i(r(43036),t),i(r(30925),t),i(r(59560),t),i(r(95182),t),i(r(6708),t)},21091:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.jwkPubSchema=t.jwkValidator=t.jwkSchema=t.jwkUnknownKeySchema=t.jwkSymKeySchema=t.jwkOkpKeySchema=t.jwkEcSecp256k1KeySchema=t.jwkEcKeySchema=t.jwkRsaKeySchema=t.jwkBaseSchema=t.keyUsageSchema=void 0;let a=r(96625);t.keyUsageSchema=a.z.enum(["sign","verify","encrypt","decrypt","wrapKey","unwrapKey","deriveKey","deriveBits"]),t.jwkBaseSchema=a.z.object({kty:a.z.string().min(1),alg:a.z.string().min(1).optional(),kid:a.z.string().min(1).optional(),ext:a.z.boolean().optional(),use:a.z.enum(["sig","enc"]).optional(),key_ops:a.z.array(t.keyUsageSchema).optional(),x5c:a.z.array(a.z.string()).optional(),x5t:a.z.string().min(1).optional(),"x5t#S256":a.z.string().min(1).optional(),x5u:a.z.string().url().optional()}),t.jwkRsaKeySchema=t.jwkBaseSchema.extend({kty:a.z.literal("RSA"),alg:a.z.enum(["RS256","RS384","RS512","PS256","PS384","PS512"]).optional(),n:a.z.string().min(1),e:a.z.string().min(1),d:a.z.string().min(1).optional(),p:a.z.string().min(1).optional(),q:a.z.string().min(1).optional(),dp:a.z.string().min(1).optional(),dq:a.z.string().min(1).optional(),qi:a.z.string().min(1).optional(),oth:a.z.array(a.z.object({r:a.z.string().optional(),d:a.z.string().optional(),t:a.z.string().optional()})).nonempty().optional()}),t.jwkEcKeySchema=t.jwkBaseSchema.extend({kty:a.z.literal("EC"),alg:a.z.enum(["ES256","ES384","ES512"]).optional(),crv:a.z.enum(["P-256","P-384","P-521"]),x:a.z.string().min(1),y:a.z.string().min(1),d:a.z.string().min(1).optional()}),t.jwkEcSecp256k1KeySchema=t.jwkBaseSchema.extend({kty:a.z.literal("EC"),alg:a.z.enum(["ES256K"]).optional(),crv:a.z.enum(["secp256k1"]),x:a.z.string().min(1),y:a.z.string().min(1),d:a.z.string().min(1).optional()}),t.jwkOkpKeySchema=t.jwkBaseSchema.extend({kty:a.z.literal("OKP"),alg:a.z.enum(["EdDSA"]).optional(),crv:a.z.enum(["Ed25519","Ed448"]),x:a.z.string().min(1),d:a.z.string().min(1).optional()}),t.jwkSymKeySchema=t.jwkBaseSchema.extend({kty:a.z.literal("oct"),alg:a.z.enum(["HS256","HS384","HS512"]).optional(),k:a.z.string()}),t.jwkUnknownKeySchema=t.jwkBaseSchema.extend({kty:a.z.string().refine(e=>"RSA"!==e&&"EC"!==e&&"OKP"!==e&&"oct"!==e)}),t.jwkSchema=a.z.union([t.jwkUnknownKeySchema,t.jwkRsaKeySchema,t.jwkEcKeySchema,t.jwkEcSecp256k1KeySchema,t.jwkOkpKeySchema,t.jwkSymKeySchema]),t.jwkValidator=t.jwkSchema.refine(e=>null!=e.use||null!=e.key_ops,"use or key_ops required").refine(e=>!e.use||!e.key_ops||e.key_ops.every(t=>"sig"===e.use?"sign"===t||"verify"===t:"encrypt"===t||"decrypt"===t),"use and key_ops must be consistent"),t.jwkPubSchema=t.jwkValidator.refine(e=>null!=e.kid,"kid is required").refine(e=>!("k"in e)&&!("d"in e),"private key not allowed")},83885:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.jwksPubSchema=t.jwksSchema=void 0;let a=r(96625),i=r(21091);t.jwksSchema=a.z.object({keys:a.z.array(i.jwkSchema)}),t.jwksPubSchema=a.z.object({keys:a.z.array(i.jwkPubSchema)})},77344:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.unsafeDecodeJwt=function(e){let{0:t,1:r,length:n}=e.split(".");if(n>3||n<2)throw new a.JwtVerifyError(void 0,a.ERR_JWT_INVALID);let s=i.jwtHeaderSchema.parse((0,o.parseB64uJson)(t));if(2===n&&s?.alg!=="none")throw new a.JwtVerifyError(void 0,a.ERR_JWT_INVALID);return{header:s,payload:i.jwtPayloadSchema.parse((0,o.parseB64uJson)(r))}};let a=r(58724),i=r(30925),o=r(6708)},43036:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},30925:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.jwtPayloadSchema=t.jwtHeaderSchema=t.isUnsignedJwt=t.unsignedJwtSchema=t.isSignedJwt=t.signedJwtSchema=void 0;let a=r(96625),i=r(21091),o=r(6708);t.signedJwtSchema=a.z.string().superRefine(o.jwtCharsRefinement).superRefine((0,o.segmentedStringRefinementFactory)(3)),t.isSignedJwt=e=>t.signedJwtSchema.safeParse(e).success,t.unsignedJwtSchema=a.z.string().superRefine(o.jwtCharsRefinement).superRefine((0,o.segmentedStringRefinementFactory)(2)),t.isUnsignedJwt=e=>t.unsignedJwtSchema.safeParse(e).success,t.jwtHeaderSchema=a.z.object({alg:a.z.string(),jku:a.z.string().url().optional(),jwk:a.z.object({kty:a.z.string(),crv:a.z.string().optional(),x:a.z.string().optional(),y:a.z.string().optional(),e:a.z.string().optional(),n:a.z.string().optional()}).optional(),kid:a.z.string().optional(),x5u:a.z.string().optional(),x5c:a.z.array(a.z.string()).optional(),x5t:a.z.string().optional(),"x5t#S256":a.z.string().optional(),typ:a.z.string().optional(),cty:a.z.string().optional(),crit:a.z.array(a.z.string()).optional()}).passthrough(),t.jwtPayloadSchema=a.z.object({iss:a.z.string().optional(),aud:a.z.union([a.z.string(),a.z.array(a.z.string()).nonempty()]).optional(),sub:a.z.string().optional(),exp:a.z.number().int().optional(),nbf:a.z.number().int().optional(),iat:a.z.number().int().optional(),jti:a.z.string().optional(),htm:a.z.string().optional(),htu:a.z.string().optional(),ath:a.z.string().optional(),acr:a.z.string().optional(),azp:a.z.string().optional(),amr:a.z.array(a.z.string()).optional(),cnf:a.z.object({kid:a.z.string().optional(),jwk:i.jwkPubSchema.optional(),jwe:a.z.string().optional(),jku:a.z.string().url().optional(),jkt:a.z.string().optional(),"x5t#S256":a.z.string().optional(),osc:a.z.string().optional()}).optional(),client_id:a.z.string().optional(),scope:a.z.string().optional(),nonce:a.z.string().optional(),at_hash:a.z.string().optional(),c_hash:a.z.string().optional(),s_hash:a.z.string().optional(),auth_time:a.z.number().int().optional(),name:a.z.string().optional(),family_name:a.z.string().optional(),given_name:a.z.string().optional(),middle_name:a.z.string().optional(),nickname:a.z.string().optional(),preferred_username:a.z.string().optional(),gender:a.z.string().optional(),picture:a.z.string().url().optional(),profile:a.z.string().url().optional(),website:a.z.string().url().optional(),birthdate:a.z.string().regex(/\d{4}-\d{2}-\d{2}/).optional(),zoneinfo:a.z.string().regex(/^[A-Za-z0-9_/]+$/).optional(),locale:a.z.string().regex(/^[a-z]{2,3}(-[A-Z]{2})?$/).optional(),updated_at:a.z.number().int().optional(),email:a.z.string().optional(),email_verified:a.z.boolean().optional(),phone_number:a.z.string().optional(),phone_number_verified:a.z.boolean().optional(),address:a.z.object({formatted:a.z.string().optional(),street_address:a.z.string().optional(),locality:a.z.string().optional(),region:a.z.string().optional(),postal_code:a.z.string().optional(),country:a.z.string().optional()}).optional(),authorization_details:a.z.array(a.z.object({type:a.z.string(),locations:a.z.array(a.z.string()).optional(),actions:a.z.array(a.z.string()).optional(),datatypes:a.z.array(a.z.string()).optional(),identifier:a.z.string().optional(),privileges:a.z.array(a.z.string()).optional()}).passthrough()).optional()}).passthrough()},59560:function(e,t,r){let a,i,o,n;var s,d=this&&this.__runInitializers||function(e,t,r){for(var a=arguments.length>2,i=0;i<t.length;i++)r=a?t[i].call(e,r):t[i].call(e);return a?r:void 0},l=this&&this.__esDecorate||function(e,t,r,a,i,o){function n(e){if(void 0!==e&&"function"!=typeof e)throw TypeError("Function expected");return e}for(var s,d=a.kind,l="getter"===d?"get":"setter"===d?"set":"value",c=!t&&e?a.static?e:e.prototype:null,u=t||(c?Object.getOwnPropertyDescriptor(c,a.name):{}),h=!1,p=r.length-1;p>=0;p--){var f={};for(var y in a)f[y]="access"===y?{}:a[y];for(var y in a.access)f.access[y]=a.access[y];f.addInitializer=function(e){if(h)throw TypeError("Cannot add initializers after decoration has completed");o.push(n(e||null))};var m=(0,r[p])("accessor"===d?{get:u.get,set:u.set}:u[l],f);if("accessor"===d){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw TypeError("Object expected");(s=n(m.get))&&(u.get=s),(s=n(m.set))&&(u.set=s),(s=n(m.init))&&i.unshift(s)}else(s=n(m))&&("field"===d?i.unshift(s):u[l]=s)}c&&Object.defineProperty(c,a.name,u),h=!0};Object.defineProperty(t,"__esModule",{value:!0}),t.Key=void 0;let c=r(59226),u=r(58724),h=r(21091),p=r(6708),f=h.jwkSchema.readonly(),y=(n=[],s=class{constructor(e){if(Object.defineProperty(this,"jwk",{enumerable:!0,configurable:!0,writable:!0,value:(d(this,n),e)}),!e.use)throw new u.JwkError('Missing "use" Parameter value')}get isPrivate(){let{jwk:e}=this;return"d"in e&&void 0!==e.d||"k"in e&&void 0!==e.k}get isSymetric(){let{jwk:e}=this;return"k"in e&&void 0!==e.k}get privateJwk(){return this.isPrivate?this.jwk:void 0}get publicJwk(){if(!this.isSymetric)return f.parse({...this.jwk,d:void 0,k:void 0})}get bareJwk(){if(this.isSymetric)return;let{kty:e,crv:t,e:r,n:a,x:i,y:o}=this.jwk;return f.parse({crv:t,e:r,kty:e,n:a,x:i,y:o})}get use(){return this.jwk.use}get alg(){return this.jwk.alg}get kid(){return this.jwk.kid}get crv(){return this.jwk.crv}get algorithms(){return Object.freeze(Array.from((0,c.jwkAlgorithms)(this.jwk)))}},(()=>{let e="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;a=[p.cachedGetter],i=[p.cachedGetter],o=[p.cachedGetter],l(s,null,a,{kind:"getter",name:"publicJwk",static:!1,private:!1,access:{has:e=>"publicJwk"in e,get:e=>e.publicJwk},metadata:e},null,n),l(s,null,i,{kind:"getter",name:"bareJwk",static:!1,private:!1,access:{has:e=>"bareJwk"in e,get:e=>e.bareJwk},metadata:e},null,n),l(s,null,o,{kind:"getter",name:"algorithms",static:!1,private:!1,access:{has:e=>"algorithms"in e,get:e=>e.algorithms},metadata:e},null,n),e&&Object.defineProperty(s,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:e})})(),s);t.Key=y},95182:function(e,t,r){let a,i,o,n;var s,d=this&&this.__runInitializers||function(e,t,r){for(var a=arguments.length>2,i=0;i<t.length;i++)r=a?t[i].call(e,r):t[i].call(e);return a?r:void 0},l=this&&this.__esDecorate||function(e,t,r,a,i,o){function n(e){if(void 0!==e&&"function"!=typeof e)throw TypeError("Function expected");return e}for(var s,d=a.kind,l="getter"===d?"get":"setter"===d?"set":"value",c=!t&&e?a.static?e:e.prototype:null,u=t||(c?Object.getOwnPropertyDescriptor(c,a.name):{}),h=!1,p=r.length-1;p>=0;p--){var f={};for(var y in a)f[y]="access"===y?{}:a[y];for(var y in a.access)f.access[y]=a.access[y];f.addInitializer=function(e){if(h)throw TypeError("Cannot add initializers after decoration has completed");o.push(n(e||null))};var m=(0,r[p])("accessor"===d?{get:u.get,set:u.set}:u[l],f);if("accessor"===d){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw TypeError("Object expected");(s=n(m.get))&&(u.get=s),(s=n(m.set))&&(u.set=s),(s=n(m.init))&&i.unshift(s)}else(s=n(m))&&("field"===d?i.unshift(s):u[l]=s)}c&&Object.defineProperty(c,a.name,u),h=!0};Object.defineProperty(t,"__esModule",{value:!0}),t.Keyset=void 0;let c=r(58724),u=r(77344),h=r(6708),p=e=>e.privateJwk,f=e=>e.publicJwk,y=(n=[],s=class{constructor(e,t=e instanceof s?[...e.preferredSigningAlgorithms]:["EdDSA","ES256K","ES256","PS256","PS384","PS512","HS256","HS384","HS512"]){Object.defineProperty(this,"preferredSigningAlgorithms",{enumerable:!0,configurable:!0,writable:!0,value:(d(this,n),t)}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let r=[],a=new Set;for(let t of e)if(t&&(r.push(t),t.kid)){if(a.has(t.kid))throw new c.JwkError(`Duplicate key: ${t.kid}`);a.add(t.kid)}this.keys=Object.freeze(r)}get size(){return this.keys.length}get signAlgorithms(){let e=new Set;for(let t of this)if("sig"===t.use)for(let r of t.algorithms)e.add(r);return Object.freeze([...e].sort((0,h.preferredOrderCmp)(this.preferredSigningAlgorithms)))}get publicJwks(){return{keys:Array.from(this,f).filter(h.isDefined)}}get privateJwks(){return{keys:Array.from(this,p).filter(h.isDefined)}}has(e){return this.keys.some(t=>t.kid===e)}get(e){for(let t of this.list(e))return t;throw new c.JwkError(`Key not found ${e.kid||e.alg||"<unknown>"}`,c.ERR_JWK_NOT_FOUND)}*list(e){if(e.kid?.length!==0&&e.alg?.length!==0){for(let t of this)if(!e.use||t.use===e.use){if(Array.isArray(e.kid)){if(!t.kid||!e.kid.includes(t.kid))continue}else if(e.kid&&t.kid!==e.kid)continue;if(Array.isArray(e.alg)){if(!e.alg.some(e=>t.algorithms.includes(e)))continue}else if("string"==typeof e.alg&&!t.algorithms.includes(e.alg))continue;yield t}}}findKey({kid:e,alg:t,use:r}){let a=[];for(let i of this.list({kid:e,alg:t,use:r}))if(i.isPrivate){if("string"==typeof t)return[i,t];a.push(i)}let i=(0,h.matchesAny)(t),o=a.map(e=>[e,e.algorithms.filter(i)]);for(let e of this.preferredSigningAlgorithms)for(let[t,r]of o)if(r.includes(e))return[t,e];for(let[e,t]of o)for(let r of t)return[e,r];throw new c.JwkError(`No signing key found for ${e||t||r||"<unknown>"}`,c.ERR_JWK_NOT_FOUND)}[(a=[h.cachedGetter],i=[h.cachedGetter],o=[h.cachedGetter],Symbol.iterator)](){return this.keys.values()}async createJwt({alg:e,kid:t,...r},a){try{let[i,o]=this.findKey({alg:e,kid:t,use:"sig"}),n={...r,alg:o,kid:i.kid};return"function"==typeof a&&(a=await a(n,i)),await i.createJwt(n,a)}catch(e){throw c.JwtCreateError.from(e)}}async verifyJwt(e,t){let{header:r}=(0,u.unsafeDecodeJwt)(e),{kid:a,alg:i}=r,o=[];for(let r of this.list({kid:a,alg:i}))try{return{...await r.verifyJwt(e,t),key:r}}catch(e){o.push(e)}switch(o.length){case 0:throw new c.JwtVerifyError("No key matched",c.ERR_JWKS_NO_MATCHING_KEY);case 1:throw c.JwtVerifyError.from(o[0],c.ERR_JWT_INVALID);default:throw c.JwtVerifyError.from(o,c.ERR_JWT_INVALID)}}toJSON(){return structuredClone(this.publicJwks)}},(()=>{let e="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;l(s,null,a,{kind:"getter",name:"signAlgorithms",static:!1,private:!1,access:{has:e=>"signAlgorithms"in e,get:e=>e.signAlgorithms},metadata:e},null,n),l(s,null,i,{kind:"getter",name:"publicJwks",static:!1,private:!1,access:{has:e=>"publicJwks"in e,get:e=>e.publicJwks},metadata:e},null,n),l(s,null,o,{kind:"getter",name:"privateJwks",static:!1,private:!1,access:{has:e=>"privateJwks"in e,get:e=>e.privateJwks},metadata:e},null,n),e&&Object.defineProperty(s,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:e})})(),s);t.Keyset=y},6708:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.segmentedStringRefinementFactory=t.jwtCharsRefinement=t.cachedGetter=t.preferredOrderCmp=t.isDefined=void 0,t.matchesAny=function(e){return null==e?e=>!0:Array.isArray(e)?t=>e.includes(t):t=>t===e},t.parseB64uJson=function(e){let t=a.base64url.baseDecode(e);return JSON.parse(o.decode(t))};let a=r(59716),i=r(96625);t.isDefined=e=>void 0!==e,t.preferredOrderCmp=e=>(t,r)=>{let a=e.indexOf(t),i=e.indexOf(r);return a===i?0:-1===a?1:-1===i?-1:a-i},t.cachedGetter=(e,t)=>function(){let t=e.call(this);return Object.defineProperty(this,e.name,{get:()=>t,enumerable:!0,configurable:!0}),t};let o=new TextDecoder;t.jwtCharsRefinement=(e,t)=>{let r;for(let a=0;a<e.length;a++)if(65<=(r=e.charCodeAt(a))&&r<=90||97<=r&&r<=122||48<=r&&r<=57||45===r||95===r||46===r);else{let r=String.fromCodePoint(e.codePointAt(a));return t.addIssue({code:i.ZodIssueCode.custom,message:`Invalid character "${r}" in JWT at position ${a}`})}},t.segmentedStringRefinementFactory=(e,t=2)=>{if(!Number.isFinite(e)||e<1||(0|e)!==e)throw TypeError(`Count must be a natural number (got ${e})`);let r=e*t+(e-1),a="Invalid JWT format";return(o,n)=>{if(o.length<r)return n.addIssue({code:i.ZodIssueCode.custom,message:`${a}: too short`}),!1;let s=0;for(let r=0;r<e-1;r++){let d=o.indexOf(".",s);if(-1===d)return n.addIssue({code:i.ZodIssueCode.custom,message:`${a}: expected ${e} segments, got ${r+1}`}),!1;if(d-s<t)return n.addIssue({code:i.ZodIssueCode.custom,message:`${a}: segment ${r+1} is too short`}),!1;s=d+1}return -1!==o.indexOf(".",s)?(n.addIssue({code:i.ZodIssueCode.custom,message:`${a}: too many segments`}),!1):!(o.length-s<t)||(n.addIssue({code:i.ZodIssueCode.custom,message:`${a}: last segment is too short`}),!1)}}},84641:(e,t,r)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserOAuthClient=void 0;let i=r(79798),o=r(72094),n=r(57477),s=r(87008),d=r(22861),l=r(25559),c="@@atproto/oauth-client-browser",u=`${c}(popup-channel)`,h=`${c}(popup-state):`,p=new BroadcastChannel(`${c}(synchronization-channel)`);class f extends i.OAuthClient{static async load({clientId:e,...t}){if(e.startsWith("http:"))return new f({clientMetadata:(0,o.atprotoLoopbackClientMetadata)(e),...t});if(e.startsWith("https:"))return(0,o.assertOAuthDiscoverableClientId)(e),new f({clientMetadata:await i.OAuthClient.fetchMetadata({clientId:e,...t}),...t});throw TypeError(`Invalid client id: ${e}`)}constructor({clientMetadata:e=(0,o.atprotoLoopbackClientMetadata)((0,l.buildLoopbackClientId)(window.location)),responseMode:t="fragment",...r}){if(!globalThis.crypto?.subtle)throw Error("WebCrypto API is required");if(!["query","fragment"].includes(t))throw TypeError(`Invalid response mode: ${t}`);let i=new n.BrowserOAuthDatabase;super({...r,clientMetadata:e,responseMode:t,keyset:void 0,runtimeImplementation:new s.BrowserRuntimeImplementation,sessionStore:i.getSessionStore(),stateStore:i.getStateStore(),didCache:i.getDidCache(),handleCache:i.getHandleCache(),dpopNonceCache:i.getDpopNonceCache(),authorizationServerMetadataCache:i.getAuthorizationServerMetadataCache(),protectedResourceMetadataCache:i.getProtectedResourceMetadataCache()}),Object.defineProperty(this,a,{enumerable:!0,configurable:!0,writable:!0,value:void 0});let d=new AbortController,{signal:u}=d;for(let e of(this[Symbol.dispose]=()=>d.abort(),u.addEventListener("abort",()=>i[Symbol.asyncDispose](),{once:!0}),this.addEventListener("deleted",({detail:{sub:e}})=>{localStorage.getItem(`${c}(sub)`)===e&&localStorage.removeItem(`${c}(sub)`)}),["deleted","updated"]))this.sessionGetter.addEventListener(e,({detail:t})=>{p.postMessage([e,t])});p.addEventListener("message",e=>{if(e.source!==window){let[t,r]=e.data;this.dispatchCustomEvent(t,r)}},{signal:u})}async init(e){await function(e){if(!(0,o.isOAuthClientIdLoopback)(e.client_id)||"localhost"!==window.location.hostname)return;let t=new URL(window.location.href);for(let r of e.redirect_uris){let e=new URL(r);if(("127.0.0.1"===e.hostname||"[::1]"===e.hostname)&&(!e.port||e.port===t.port)&&e.protocol===t.protocol&&e.pathname===t.pathname)throw e.port=t.port,window.location.href=e.href,Error("Redirecting to loopback IP...")}throw Error(`Please use the loopback IP address instead of ${t}`)}(this.clientMetadata);let t=await this.signInCallback();if(t)return localStorage.setItem(`${c}(sub)`,t.session.sub),t;let r=localStorage.getItem(`${c}(sub)`);if(r)try{return{session:await this.restore(r,e)}}catch(e){throw localStorage.removeItem(`${c}(sub)`),e}}async restore(e,t){let r=await super.restore(e,t);return localStorage.setItem(`${c}(sub)`,r.sub),r}async revoke(e){return localStorage.removeItem(`${c}(sub)`),super.revoke(e)}async signIn(e,t){return t?.display==="popup"?this.signInPopup(e,t):this.signInRedirect(e,t)}async signInRedirect(e,t){let r=await this.authorize(e,t);return window.location.href=r.href,new Promise((e,t)=>{setTimeout(e=>{this.abortRequest(r).then(()=>t(e),r=>t(AggregateError([e,r])))},5e3,Error("User navigated back"))})}async signInPopup(e,t){let r="width=600,height=600,menubar=no,toolbar=no",a=window.open("about:blank","_blank",r),o=`${Math.random().toString(36).slice(2)}`,n=await this.authorize(e,{...t,state:`${h}${o}`,display:t?.display??"popup"});return t?.signal?.throwIfAborted(),a?a.window.location.href=n.href:a=window.open(n.href,"_blank",r),a?.focus(),new Promise((e,r)=>{let n=new BroadcastChannel(u),s=()=>{clearTimeout(l),n.removeEventListener("message",c),n.close(),t?.signal?.removeEventListener("abort",d),a?.close()},d=()=>{r(Error(t?.signal?.aborted?"Aborted":"Timeout")),s()};t?.signal?.addEventListener("abort",d);let l=setTimeout(d,3e5),c=async({data:a})=>{if(a.key!==o||!("result"in a))return;n.postMessage({key:o,ack:!0}),s();let{result:d}=a;if("fulfilled"===d.status){let a=d.value;try{t?.signal?.throwIfAborted(),e(await this.restore(a,!1))}catch(e){r(e),this.revoke(a)}}else{let{message:e,params:t}=d.reason;r(new i.OAuthCallbackError(new URLSearchParams(t),e))}};n.addEventListener("message",c)})}readCallbackParams(){let e=new URLSearchParams("fragment"===this.responseMode?location.hash.slice(1):location.search);return e.has("state")&&(e.has("code")||e.has("error"))&&this.clientMetadata.redirect_uris.map(e=>new URL(e)).some(e=>location.origin===e.origin&&location.pathname===e.pathname)?e:null}async signInCallback(){let e=this.readCallbackParams();if(!e)return null;"fragment"===this.responseMode?history.replaceState(null,"",location.pathname+location.search):"query"===this.responseMode&&history.replaceState(null,"",location.pathname);let t=e=>{let t=new BroadcastChannel(u);return new Promise(r=>{let a=e=>{clearTimeout(o),t.removeEventListener("message",i),t.close(),r(e)},i=({data:t})=>{"ack"in t&&e.key===t.key&&a(!0)};t.addEventListener("message",i),t.postMessage(e);let o=setTimeout(a,500,!1)})};return this.callback(e).then(async e=>{if(e.state?.startsWith(h))throw await t({key:e.state.slice(h.length),result:{status:"fulfilled",value:e.session.sub}})||await e.session.signOut(),new d.LoginContinuedInParentWindowError;return e}).catch(async e=>{if(e instanceof i.OAuthCallbackError&&e.state?.startsWith(h))throw await t({key:e.state.slice(h.length),result:{status:"rejected",reason:{message:e.message,params:Array.from(e.params.entries())}}}),new d.LoginContinuedInParentWindowError;throw e}).catch(e=>{throw e instanceof d.LoginContinuedInParentWindowError&&window.close(),e})}dispose(){this[Symbol.dispose]()}}t.BrowserOAuthClient=f,a=Symbol.dispose},57477:function(e,t,r){var a,i,o=this&&this.__classPrivateFieldSet||function(e,t,r,a,i){if("m"===a)throw TypeError("Private method is not writable");if("a"===a&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(e,r):i?i.value=r:t.set(e,r),r},n=this&&this.__classPrivateFieldGet||function(e,t,r,a){if("a"===r&&!a)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserOAuthDatabase=void 0;let s=r(39446),d=r(33528);function l(e){if(!(e instanceof s.WebcryptoKey)||!e.kid)throw Error("Invalid key object");return{keyId:e.kid,keyPair:e.cryptoKeyPair}}async function c(e){return s.WebcryptoKey.fromKeypair(e.keyPair,e.keyId)}let u=["state","session","didCache","dpopNonceCache","handleCache","authorizationServerMetadataCache","protectedResourceMetadataCache"];class h{constructor(e){a.set(this,void 0),i.set(this,void 0),o(this,a,d.DB.open(e?.name??"@atproto-oauth-client",[e=>{for(let t of u)e.createObjectStore(t,{autoIncrement:!0}).createIndex("expiresAt","expiresAt",{unique:!1})}],{durability:e?.durability??"strict"}),"f"),o(this,i,setInterval(()=>{this.cleanup()},e?.cleanupInterval??3e4),"f")}async run(e,t,r){let i=await n(this,a,"f");return await i.transaction([e],t,t=>r(t.objectStore(e)))}createStore(e,{encode:t,decode:r,expiresAt:a}){return{get:async t=>{let a=await this.run(e,"readonly",e=>e.get(t));if(void 0!==a){if(null!=a.expiresAt&&new Date(a.expiresAt)<new Date){await this.run(e,"readwrite",e=>e.delete(t));return}return r(a.value)}},set:async(r,i)=>{let o={value:await t(i),expiresAt:a(i)?.toISOString()};await this.run(e,"readwrite",e=>e.put(o,r))},del:async t=>{await this.run(e,"readwrite",e=>e.delete(t))}}}getSessionStore(){return this.createStore("session",{expiresAt:({tokenSet:e})=>e.refresh_token||null==e.expires_at?null:new Date(e.expires_at),encode:({dpopKey:e,...t})=>({...t,dpopKey:l(e)}),decode:async({dpopKey:e,...t})=>({...t,dpopKey:await c(e)})})}getStateStore(){return this.createStore("state",{expiresAt:e=>new Date(Date.now()+6e5),encode:({dpopKey:e,...t})=>({...t,dpopKey:l(e)}),decode:async({dpopKey:e,...t})=>({...t,dpopKey:await c(e)})})}getDpopNonceCache(){return this.createStore("dpopNonceCache",{expiresAt:e=>new Date(Date.now()+6e5),encode:e=>e,decode:e=>e})}getDidCache(){return this.createStore("didCache",{expiresAt:e=>new Date(Date.now()+6e4),encode:e=>e,decode:e=>e})}getHandleCache(){return this.createStore("handleCache",{expiresAt:e=>new Date(Date.now()+6e4),encode:e=>e,decode:e=>e})}getAuthorizationServerMetadataCache(){return this.createStore("authorizationServerMetadataCache",{expiresAt:e=>new Date(Date.now()+6e4),encode:e=>e,decode:e=>e})}getProtectedResourceMetadataCache(){return this.createStore("protectedResourceMetadataCache",{expiresAt:e=>new Date(Date.now()+6e4),encode:e=>e,decode:e=>e})}async cleanup(){let e=await n(this,a,"f");for(let t of u)await e.transaction([t],"readwrite",e=>e.objectStore(t).index("expiresAt").deleteAll(IDBKeyRange.upperBound(Date.now())))}async [(a=new WeakMap,i=new WeakMap,Symbol.asyncDispose)](){clearInterval(n(this,i,"f")),o(this,i,void 0,"f");let e=n(this,a,"f");o(this,a,Promise.reject(Error("Database has been disposed")),"f"),n(this,a,"f").catch(()=>null);let t=await e.catch(()=>null);t&&await (t[Symbol.asyncDispose]||t[Symbol.dispose]).call(t)}}t.BrowserOAuthDatabase=h},87008:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserRuntimeImplementation=void 0;let a=r(39446),i=navigator.locks?.request?(e,t)=>navigator.locks.request(e,{mode:"exclusive"},async()=>t()):void 0;class o{constructor(){if(Object.defineProperty(this,"requestLock",{enumerable:!0,configurable:!0,writable:!0,value:i}),"object"!=typeof crypto||!crypto?.subtle)throw Error("Crypto with CryptoSubtle is required. If running in a browser, make sure the current page is loaded over HTTPS.");this.requestLock||console.warn("Locks API not available. You should consider using a more recent browser.")}async createKey(e){return a.WebcryptoKey.generate(e)}getRandomValues(e){return crypto.getRandomValues(new Uint8Array(e))}async digest(e,{name:t}){switch(t){case"sha256":case"sha384":case"sha512":return new Uint8Array(await crypto.subtle.digest(`SHA-${t.slice(3)}`,e));default:throw Error(`Unsupported digest algorithm: ${t}`)}}}t.BrowserRuntimeImplementation=o},32856:()=>{Symbol.dispose??(Symbol.dispose=Symbol("@@dispose")),Symbol.asyncDispose??(Symbol.asyncDispose=Symbol("@@asyncDispose"))},22861:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LoginContinuedInParentWindowError=void 0;class r extends Error{constructor(){super("Login complete, please close the popup window."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:"LOGIN_CONTINUED_IN_PARENT_WINDOW"})}}t.LoginContinuedInParentWindowError=r},12930:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.buildLoopbackClientId=void 0,r(32856),i(r(39446),t),i(r(79798),t),i(r(84641),t),i(r(22861),t);var o=r(25559);Object.defineProperty(t,"buildLoopbackClientId",{enumerable:!0,get:function(){return o.buildLoopbackClientId}})},1218:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBIndex=void 0;let a=r(79767);class i{constructor(e){Object.defineProperty(this,"idbIndex",{enumerable:!0,configurable:!0,writable:!0,value:e})}count(e){return(0,a.promisify)(this.idbIndex.count(e))}get(e){return(0,a.promisify)(this.idbIndex.get(e))}getKey(e){return(0,a.promisify)(this.idbIndex.getKey(e))}getAll(e,t){return(0,a.promisify)(this.idbIndex.getAll(e,t))}getAllKeys(e,t){return(0,a.promisify)(this.idbIndex.getAllKeys(e,t))}deleteAll(e){return new Promise((t,r)=>{let a=this.idbIndex.openCursor(e);a.onsuccess=function(e){let r=e.target.result;r?(r.delete(),r.continue()):t()},a.onerror=function(e){r(e.target?.error||Error("Unexpected error"))}})}}t.DBIndex=i},43541:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBObjectStore=void 0;let a=r(1218),i=r(79767);class o{constructor(e){Object.defineProperty(this,"idbObjStore",{enumerable:!0,configurable:!0,writable:!0,value:e})}get name(){return this.idbObjStore.name}index(e){return new a.DBIndex(this.idbObjStore.index(e))}get(e){return(0,i.promisify)(this.idbObjStore.get(e))}getKey(e){return(0,i.promisify)(this.idbObjStore.getKey(e))}getAll(e,t){return(0,i.promisify)(this.idbObjStore.getAll(e,t))}getAllKeys(e,t){return(0,i.promisify)(this.idbObjStore.getAllKeys(e,t))}add(e,t){return(0,i.promisify)(this.idbObjStore.add(e,t))}put(e,t){return(0,i.promisify)(this.idbObjStore.put(e,t))}delete(e){return(0,i.promisify)(this.idbObjStore.delete(e))}clear(){return(0,i.promisify)(this.idbObjStore.clear())}}t.DBObjectStore=o},76199:function(e,t,r){var a,i=this&&this.__classPrivateFieldSet||function(e,t,r,a,i){if("m"===a)throw TypeError("Private method is not writable");if("a"===a&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(e,r):i?i.value=r:t.set(e,r),r},o=this&&this.__classPrivateFieldGet||function(e,t,r,a){if("a"===r&&!a)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.DBTransaction=void 0;let n=r(43541);class s{constructor(e){a.set(this,void 0),i(this,a,e,"f");let t=()=>{o()},r=()=>{o()},o=()=>{i(this,a,null,"f"),e.removeEventListener("abort",t),e.removeEventListener("complete",r)};e.addEventListener("abort",t),e.addEventListener("complete",r)}get tx(){if(!o(this,a,"f"))throw Error("Transaction already ended");return o(this,a,"f")}async abort(){let{tx:e}=this;i(this,a,null,"f"),e.abort()}async commit(){let{tx:e}=this;i(this,a,null,"f"),e.commit?.()}objectStore(e){let t=this.tx.objectStore(e);return new n.DBObjectStore(t)}[(a=new WeakMap,Symbol.dispose)](){o(this,a,"f")&&this.commit()}}t.DBTransaction=s},16430:function(e,t,r){var a,i=this&&this.__classPrivateFieldSet||function(e,t,r,a,i){if("m"===a)throw TypeError("Private method is not writable");if("a"===a&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(e,r):i?i.value=r:t.set(e,r),r},o=this&&this.__classPrivateFieldGet||function(e,t,r,a){if("a"===r&&!a)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.DB=void 0;let n=r(76199);class s{static async open(e,t,r){return new s(await new Promise((r,a)=>{let i=indexedDB.open(e,t.length);i.onerror=()=>a(i.error),i.onsuccess=()=>r(i.result),i.onupgradeneeded=({oldVersion:e,newVersion:r})=>{let o=i.result;try{for(let a=e;a<(r??t.length);++a){let e=t[a];if(e)e(o);else throw Error(`Missing migration for version ${a}`)}}catch(e){o.close(),a(e)}}}),r)}constructor(e,t){Object.defineProperty(this,"txOptions",{enumerable:!0,configurable:!0,writable:!0,value:t}),a.set(this,void 0),i(this,a,e,"f");let r=()=>{i(this,a,null,"f"),e.removeEventListener("versionchange",r),e.removeEventListener("close",r),e.close()};e.addEventListener("versionchange",r),e.addEventListener("close",r)}get db(){if(!o(this,a,"f"))throw Error("Database closed");return o(this,a,"f")}get name(){return this.db.name}get objectStoreNames(){return this.db.objectStoreNames}get version(){return this.db.version}async transaction(e,t,r){return new Promise(async(a,i)=>{try{let o=this.db.transaction(e,t,this.txOptions),s={done:!1};o.oncomplete=()=>{s.done?a(s.value):i(Error("Transaction completed without result"))},o.onerror=()=>i(o.error),o.onabort=()=>i(o.error||Error("Transaction aborted"));try{let e=await r(new n.DBTransaction(o));s={done:!0,value:e},o.commit()}catch(e){throw o.abort(),e}}catch(e){i(e)}})}close(){let{db:e}=this;i(this,a,null,"f"),e.close()}[(a=new WeakMap,Symbol.dispose)](){if(o(this,a,"f"))return this.close()}}t.DB=s},33528:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),r(32856),i(r(16430),t),i(r(1218),t),i(r(43541),t),i(r(76199),t)},79767:(e,t)=>{function r(e,t,r){let a=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{t(e.result),a()},o=()=>{r(e.error||Error("Unknown error")),a()};e.addEventListener("success",i),e.addEventListener("error",o)}Object.defineProperty(t,"__esModule",{value:!0}),t.handleRequest=r,t.promisify=function(e){return new Promise((t,a)=>{r(e,t,a)})}},25559:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildLoopbackClientId=function(e,t="127.0.0.1"){if(!(0,a.isLoopbackHost)(e.hostname))throw TypeError(`Expected a loopback host, got ${e.hostname}`);let r=`http://${"localhost"===e.hostname?t:e.hostname}${e.port&&!e.port.startsWith(":")?`:${e.port}`:e.port}${e.pathname}`;return`http://localhost${"/"===e.pathname?"":e.pathname}?redirect_uri=${encodeURIComponent(r)}`};let a=r(72094)},5028:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.atprotoTokenResponseSchema=t.atprotoScopeSchema=t.isAtprotoScope=void 0;let a=r(96625),i=r(77964),o=r(72094),n=r(44322);t.isAtprotoScope=e=>(0,n.includesSpaceSeparatedValue)(e,"atproto"),t.atprotoScopeSchema=a.z.string().refine(t.isAtprotoScope,'The "atproto" scope is required'),t.atprotoTokenResponseSchema=o.oauthTokenResponseSchema.extend({token_type:a.z.literal("DPoP"),sub:i.atprotoDidSchema,scope:t.atprotoScopeSchema,id_token:a.z.never().optional()})},80580:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FALLBACK_ALG=void 0,t.FALLBACK_ALG="ES256"},2508:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TokenInvalidError=void 0;class r extends Error{constructor(e,t=`The session for "${e}" is invalid`,r){super(t,r),Object.defineProperty(this,"sub",{enumerable:!0,configurable:!0,writable:!0,value:e})}}t.TokenInvalidError=r},47471:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TokenRefreshError=void 0;class r extends Error{constructor(e,t,r){super(t,r),Object.defineProperty(this,"sub",{enumerable:!0,configurable:!0,writable:!0,value:e})}}t.TokenRefreshError=r},41190:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TokenRevokedError=void 0;class r extends Error{constructor(e,t=`The session for "${e}" was successfully revoked`,r){super(t,r),Object.defineProperty(this,"sub",{enumerable:!0,configurable:!0,writable:!0,value:e})}}t.TokenRevokedError=r},71817:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.dpopFetchWrapper=function({key:e,iss:t,supportedAlgs:r,nonces:a,sha256:c=void 0!==o?l:void 0,isAuthServer:u,fetch:h=globalThis.fetch}){if(!c)throw TypeError("crypto.subtle is not available in this environment. Please provide a sha256 function.");let p=function(e,t){if(t){let r=t.find(t=>e.algorithms.includes(t));if(r)return r}else{let[t]=e.algorithms;if(t)return t}throw Error("Key does not match any alg supported by the server")}(e,r);return async function(r,o){let l;if(!e.algorithms.includes(p))throw TypeError(`Key does not support the algorithm ${p}`);let f=null==o&&r instanceof Request?r:new Request(r,o),y=f.headers.get("Authorization"),m=y?.startsWith("DPoP ")?await c(y.slice(5)):void 0,{method:g,url:v}=f,{origin:w}=new URL(v);try{l=await a.get(w)}catch{}let _=await s(e,p,t,g,v,l,m);f.headers.set("DPoP",_);let b=await h.call(this,f),S=b.headers.get("DPoP-Nonce");if(!S||S===l)return b;try{await a.set(w,S)}catch{}if(!await d(b,u)||r===f||n&&o?.body instanceof n)return b;await (0,i.cancelBody)(b,"log");let E=await s(e,p,t,g,v,S,m),k=new Request(r,o);return k.headers.set("DPoP",E),h.call(this,k)}};let a=r(59716),i=r(31285),o=globalThis.crypto?.subtle,n=globalThis.ReadableStream;async function s(e,t,r,a,i,o,n){if(!e.bareJwk)throw Error("Only asymmetric keys can be used as DPoP proofs");let s=Math.floor(Date.now()/1e3);return e.createJwt({alg:t,typ:"dpop+jwt",jwk:e.bareJwk},{iss:r,iat:s,jti:Math.random().toString(36).slice(2),htm:a,htu:i,nonce:o,ath:n})}async function d(e,t){if((void 0===t||!1===t)&&401===e.status){let t=e.headers.get("WWW-Authenticate");if(t?.startsWith("DPoP"))return t.includes('error="use_dpop_nonce"')}if((void 0===t||!0===t)&&400===e.status)try{let t=await (0,i.peekJson)(e,10240);return"object"==typeof t&&t?.error==="use_dpop_nonce"}catch{}return!1}async function l(e){if(null==o)throw Error("crypto.subtle is not available in this environment. Please provide a sha256 function.");let t=new TextEncoder().encode(e),r=new Uint8Array(await o.digest("SHA-256",t));return a.base64url.baseEncode(r)}},79798:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.FetchResponseError=t.FetchRequestError=t.FetchError=void 0,i(r(21482),t);var o=r(31285);Object.defineProperty(t,"FetchError",{enumerable:!0,get:function(){return o.FetchError}}),Object.defineProperty(t,"FetchRequestError",{enumerable:!0,get:function(){return o.FetchRequestError}}),Object.defineProperty(t,"FetchResponseError",{enumerable:!0,get:function(){return o.FetchResponseError}}),i(r(95563),t),i(r(77964),t),i(r(72094),t),i(r(72702),t),i(r(11471),t),i(r(28406),t),i(r(68200),t),i(r(74915),t),i(r(19951),t),i(r(84630),t),i(r(14209),t),i(r(89307),t),i(r(53712),t),i(r(52198),t),i(r(88882),t),i(r(41043),t),i(r(2508),t),i(r(47471),t),i(r(41190),t)},73642:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.requestLocalLock=void 0;let r=new Map;t.requestLocalLock=(e,t)=>(function(e){return new Promise(t=>{let a=(r.get(e)??Promise.resolve()).then(()=>new Promise(i=>{t(()=>{r.get(e)===a&&r.delete(e),i()})}));r.set(e,a)})})(e).then(async e=>{try{return await t()}finally{e()}})},72702:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthAuthorizationServerMetadataResolver=void 0;let a=r(72094),i=r(31285),o=r(2032),n=r(44322);class s extends o.CachedGetter{constructor(e,t,r){super(async(e,t)=>this.fetchMetadata(e,t),e),Object.defineProperty(this,"fetch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"allowHttpIssuer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.fetch=(0,i.bindFetch)(t),this.allowHttpIssuer=r?.allowHttpIssuer===!0}async get(e,t){let r=a.oauthIssuerIdentifierSchema.parse(e);if(!this.allowHttpIssuer&&r.startsWith("http:"))throw TypeError("Unsecure issuer URL protocol only allowed in development and test environments");return super.get(r,t)}async fetchMetadata(e,t){let r=new URL("/.well-known/oauth-authorization-server",e),o=new Request(r,{headers:{accept:"application/json"},cache:t?.noCache?"no-cache":void 0,signal:t?.signal,redirect:"manual"}),s=await this.fetch(o);if(200!==s.status)throw await (0,i.cancelBody)(s,"log"),await i.FetchResponseError.from(s,`Unexpected status code ${s.status} for "${r}"`,void 0,{cause:o});if("application/json"!==(0,n.contentMime)(s.headers))throw await (0,i.cancelBody)(s,"log"),await i.FetchResponseError.from(s,`Unexpected content type for "${r}"`,void 0,{cause:o});let d=a.oauthAuthorizationServerMetadataValidator.parse(await s.json());if(d.issuer!==e)throw TypeError(`Invalid issuer ${d.issuer}`);if(!0!==d.client_id_metadata_document_supported)throw TypeError(`Authorization server "${e}" does not support client_id_metadata_document`);return d}}t.OAuthAuthorizationServerMetadataResolver=s},11471:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthCallbackError=void 0;class r extends Error{static from(e,t,a){return e instanceof r?e:new r(t,e instanceof Error?e.message:void 0,a,e)}constructor(e,t=e.get("error_description")||"OAuth callback error",r,a){super(t,{cause:a}),Object.defineProperty(this,"params",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:r})}}t.OAuthCallbackError=r},28406:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthClient=void 0;let a=r(16516),i=r(72094),o=r(21482),n=r(95563),s=r(63297),d=r(79993),l=r(80580),c=r(41190),u=r(72702),h=r(11471),p=r(68200),f=r(78223),y=r(14209),m=r(89307),g=r(57275),v=r(52198),w=r(44322),_=r(92763);class b extends w.CustomEventTarget{static async fetchMetadata({clientId:e,fetch:t=globalThis.fetch,signal:r}){r?.throwIfAborted();let a=new Request(e,{redirect:"error",signal:r}),o=await t(a);if(200!==o.status)throw o.body?.cancel?.(),TypeError(`Failed to fetch client metadata: ${o.status}`);let n=o.headers.get("content-type")?.split(";")[0].trim();if("application/json"!==n)throw o.body?.cancel?.(),TypeError(`Invalid client metadata content type: ${n}`);let s=await o.json();return r?.throwIfAborted(),i.oauthClientMetadataSchema.parse(s)}constructor({fetch:e=globalThis.fetch,allowHttp:t=!1,stateStore:r,sessionStore:i,didCache:l,dpopNonceCache:c=new d.SimpleStoreMemory({ttl:6e4,max:100}),handleCache:h,authorizationServerMetadataCache:m=new d.SimpleStoreMemory({ttl:6e4,max:100}),protectedResourceMetadataCache:w=new d.SimpleStoreMemory({ttl:6e4,max:100}),responseMode:b,clientMetadata:S,handleResolver:E,plcDirectoryUrl:k,runtimeImplementation:P,keyset:I}){for(let d of(super(),Object.defineProperty(this,"clientMetadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"responseMode",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyset",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runtime",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"oauthResolver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serverFactory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sessionGetter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stateStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyset=I?I instanceof a.Keyset?I:new a.Keyset(I):void 0,this.clientMetadata=(0,_.validateClientMetadata)(S,this.keyset),this.responseMode=b,this.runtime=new g.Runtime(P),this.fetch=e,this.oauthResolver=new f.OAuthResolver(new s.IdentityResolver(new o.DidResolverCached(new o.DidResolverCommon({fetch:e,plcDirectoryUrl:k,allowHttp:t}),l),new n.CachedHandleResolver(n.AppViewHandleResolver.from(E,{fetch:e}),h)),new p.OAuthProtectedResourceMetadataResolver(w,e,{allowHttpResource:t}),new u.OAuthAuthorizationServerMetadataResolver(m,e,{allowHttpIssuer:t})),this.serverFactory=new y.OAuthServerFactory(this.clientMetadata,this.runtime,this.oauthResolver,this.fetch,this.keyset,c),this.sessionGetter=new v.SessionGetter(i,this.serverFactory,this.runtime),this.stateStore=r,["deleted","updated"]))this.sessionGetter.addEventListener(d,e=>{this.dispatchCustomEvent(d,e.detail)||e.preventDefault()})}get identityResolver(){return this.oauthResolver.identityResolver}get didResolver(){return this.identityResolver.didResolver}get handleResolver(){return this.identityResolver.handleResolver}get jwks(){return this.keyset?.publicJwks??{keys:[]}}async authorize(e,{signal:t,...r}={}){let a=r?.redirect_uri??this.clientMetadata.redirect_uris[0];if(!this.clientMetadata.redirect_uris.includes(a))throw TypeError("Invalid redirect_uri");let{identity:i,metadata:o}=await this.oauthResolver.resolve(e,{signal:t}),n=await this.runtime.generatePKCE(),s=await this.runtime.generateKey(o.dpop_signing_alg_values_supported||[l.FALLBACK_ALG]),d=await this.runtime.generateNonce();await this.stateStore.set(d,{iss:o.issuer,dpopKey:s,verifier:n.verifier,appState:r?.state});let c={...r,client_id:this.clientMetadata.client_id,redirect_uri:a,code_challenge:n.challenge,code_challenge_method:n.method,state:d,login_hint:i?e:void 0,response_mode:this.responseMode,response_type:"code",scope:r?.scope??this.clientMetadata.scope},u=new URL(o.authorization_endpoint);if("https:"!==u.protocol&&"http:"!==u.protocol)throw TypeError(`Invalid authorization endpoint protocol: ${u.protocol}`);if(o.pushed_authorization_request_endpoint){let e=await this.serverFactory.fromMetadata(o,s),t=await e.request("pushed_authorization_request",c);return u.searchParams.set("client_id",this.clientMetadata.client_id),u.searchParams.set("request_uri",t.request_uri),u}if(o.require_pushed_authorization_requests)throw Error("Server requires pushed authorization requests (PAR) but no PAR endpoint is available");for(let[e,t]of Object.entries(c))t&&u.searchParams.set(e,String(t));if(u.pathname.length+u.search.length<2048)return u;if(!o.pushed_authorization_request_endpoint)throw Error("Login URL too long");throw Error("Server does not support pushed authorization requests (PAR)")}async abortRequest(e){if(!e.searchParams.get("request_uri"))return}async callback(e){if(null!=e.get("response"))throw new h.OAuthCallbackError(e,"JARM not supported");let t=e.get("iss"),r=e.get("state"),a=e.get("error"),i=e.get("code");if(!r)throw new h.OAuthCallbackError(e,'Missing "state" parameter');let o=await this.stateStore.get(r);if(o)await this.stateStore.del(r);else throw new h.OAuthCallbackError(e,`Unknown authorization session "${r}"`);try{if(null!=a)throw new h.OAuthCallbackError(e,void 0,o.appState);if(!i)throw new h.OAuthCallbackError(e,'Missing "code" query param',o.appState);let r=await this.serverFactory.fromIssuer(o.iss,o.dpopKey);if(null!=t){if(!r.issuer)throw new h.OAuthCallbackError(e,"Issuer not found in metadata",o.appState);if(r.issuer!==t)throw new h.OAuthCallbackError(e,"Issuer mismatch",o.appState)}else if(r.serverMetadata.authorization_response_iss_parameter_supported)throw new h.OAuthCallbackError(e,"iss missing from the response",o.appState);let n=await r.exchangeCode(i,o.verifier);try{return await this.sessionGetter.setStored(n.sub,{dpopKey:o.dpopKey,tokenSet:n}),{session:this.createSession(r,n.sub),state:o.appState??null}}catch(e){throw await r.revoke(n.refresh_token||n.access_token),e}}catch(t){throw h.OAuthCallbackError.from(t,e,o.appState)}}async restore(e,t="auto"){(0,o.assertAtprotoDid)(e);let{dpopKey:r,tokenSet:a}=await this.sessionGetter.get(e,{noCache:!0===t,allowStale:!1===t}),i=await this.serverFactory.fromIssuer(a.iss,r,{noCache:!0===t,allowStale:!1===t});return this.createSession(i,e)}async revoke(e){(0,o.assertAtprotoDid)(e);let{dpopKey:t,tokenSet:r}=await this.sessionGetter.get(e,{allowStale:!0});try{let e=await this.serverFactory.fromIssuer(r.iss,t);await e.revoke(r.access_token)}finally{await this.sessionGetter.delStored(e,new c.TokenRevokedError(e))}}createSession(e,t){return new m.OAuthSession(e,t,this.sessionGetter,this.fetch)}}t.OAuthClient=b},68200:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthProtectedResourceMetadataResolver=void 0;let a=r(72094),i=r(31285),o=r(2032),n=r(44322);class s extends o.CachedGetter{constructor(e,t=globalThis.fetch,r){super(async(e,t)=>this.fetchMetadata(e,t),e),Object.defineProperty(this,"fetch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"allowHttpResource",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.fetch=(0,i.bindFetch)(t),this.allowHttpResource=r?.allowHttpResource===!0}async get(e,t){let{protocol:r,origin:a}=new URL(e);if("https:"!==r&&"http:"!==r)throw TypeError(`Invalid protected resource metadata URL protocol: ${r}`);if("http:"===r&&!this.allowHttpResource)throw TypeError(`Unsecure resource metadata URL (${r}) only allowed in development and test environments`);return super.get(a,t)}async fetchMetadata(e,t){let r=new URL("/.well-known/oauth-protected-resource",e),o=new Request(r,{signal:t?.signal,headers:{accept:"application/json"},cache:t?.noCache?"no-cache":void 0,redirect:"manual"}),s=await this.fetch(o);if(200!==s.status)throw await (0,i.cancelBody)(s,"log"),await i.FetchResponseError.from(s,`Unexpected status code ${s.status} for "${r}"`,void 0,{cause:o});if("application/json"!==(0,n.contentMime)(s.headers))throw await (0,i.cancelBody)(s,"log"),await i.FetchResponseError.from(s,`Unexpected content type for "${r}"`,void 0,{cause:o});let d=a.oauthProtectedResourceMetadataSchema.parse(await s.json());if(d.resource!==e)throw TypeError(`Invalid issuer ${d.resource}`);return d}}t.OAuthProtectedResourceMetadataResolver=s},74915:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthResolverError=void 0;let a=r(96625);class i extends Error{constructor(e,t){super(e,t)}static from(e,t){if(e instanceof i)return e;let r=e instanceof a.ZodError?`${e.errors[0].path} ${e.errors[0].message}`:null;return new i((t??"Unable to resolve identity")+(r?` (${r})`:""),{cause:e})}}t.OAuthResolverError=i},78223:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthResolver=void 0;let a=r(72094),i=r(74915);class o{constructor(e,t,r){Object.defineProperty(this,"identityResolver",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"protectedResourceMetadataResolver",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"authorizationServerMetadataResolver",{enumerable:!0,configurable:!0,writable:!0,value:r})}async resolve(e,t){return/^https?:\/\//.test(e)?this.resolveFromService(e,t):this.resolveFromIdentity(e,t)}async resolveFromService(e,t){try{return{metadata:await this.getResourceServerMetadata(e,t)}}catch(r){if(!t?.signal?.aborted&&r instanceof i.OAuthResolverError)try{let r=a.oauthIssuerIdentifierSchema.safeParse(e);if(r.success)return{metadata:await this.getAuthorizationServerMetadata(r.data,t)}}catch{}throw r}}async resolveFromIdentity(e,t){let r=await this.resolveIdentity(e,t);t?.signal?.throwIfAborted();let a=await this.getResourceServerMetadata(r.pds,t);return{identity:r,metadata:a}}async resolveIdentity(e,t){try{return await this.identityResolver.resolve(e,t)}catch(t){throw i.OAuthResolverError.from(t,`Failed to resolve identity: ${e}`)}}async getAuthorizationServerMetadata(e,t){try{return await this.authorizationServerMetadataResolver.get(e,t)}catch(t){throw i.OAuthResolverError.from(t,`Failed to resolve OAuth server metadata for issuer: ${e}`)}}async getResourceServerMetadata(e,t){try{let r=await this.protectedResourceMetadataResolver.get(e,t);if(r.authorization_servers?.length!==1)throw new i.OAuthResolverError(r.authorization_servers?.length?`Unable to determine authorization server for PDS: ${e}`:`No authorization servers found for PDS: ${e}`);let a=r.authorization_servers[0];t?.signal?.throwIfAborted();let o=await this.getAuthorizationServerMetadata(a,t);if(o.protected_resources&&!o.protected_resources.includes(r.resource))throw new i.OAuthResolverError(`PDS "${e}" not protected by issuer "${a}"`);return o}catch(t){throw i.OAuthResolverError.from(t,`Failed to resolve OAuth server metadata for resource: ${e}`)}}}t.OAuthResolver=o},19951:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthResponseError=void 0;let a=r(44322);class i extends Error{constructor(e,t){let r="object"==typeof t?t:void 0,i=(0,a.ifString)(r?.error),o=(0,a.ifString)(r?.error_description);super(`OAuth ${i?`"${i}"`:"unknown"} error${o?`: ${o}`:""}`),Object.defineProperty(this,"response",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"payload",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"errorDescription",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.error=i,this.errorDescription=o}get status(){return this.response.status}get headers(){return this.response.headers}}t.OAuthResponseError=i},84630:function(e,t,r){var a,i=this&&this.__addDisposableResource||function(e,t,r){if(null!=t){var a,i;if("object"!=typeof t&&"function"!=typeof t)throw TypeError("Object expected.");if(r){if(!Symbol.asyncDispose)throw TypeError("Symbol.asyncDispose is not defined.");a=t[Symbol.asyncDispose]}if(void 0===a){if(!Symbol.dispose)throw TypeError("Symbol.dispose is not defined.");a=t[Symbol.dispose],r&&(i=a)}if("function"!=typeof a)throw TypeError("Object not disposable.");i&&(a=function(){try{i.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:a,async:r})}else r&&e.stack.push({async:!0});return t},o=this&&this.__disposeResources||(a="function"==typeof SuppressedError?SuppressedError:function(e,t,r){var a=Error(r);return a.name="SuppressedError",a.error=e,a.suppressed=t,a},function(e){function t(t){e.error=e.hasError?new a(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}var r,i=0;return function a(){for(;r=e.stack.pop();)try{if(!r.async&&1===i)return i=0,e.stack.push(r),Promise.resolve().then(a);if(r.dispose){var o=r.dispose.call(r.value);if(r.async)return i|=2,Promise.resolve(o).then(a,function(e){return t(e),a()})}else i|=1}catch(e){t(e)}if(1===i)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}()});Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthServerAgent=void 0;let n=r(72094),s=r(31285),d=r(5028),l=r(80580),c=r(47471),u=r(71817),h=r(19951),p=r(44322);class f{constructor(e,t,r,a,i,o,n,d){Object.defineProperty(this,"dpopKey",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"serverMetadata",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"clientMetadata",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"dpopNonces",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"oauthResolver",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"runtime",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"keyset",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"dpopFetch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.dpopFetch=(0,u.dpopFetchWrapper)({fetch:(0,s.bindFetch)(d),iss:r.client_id,key:e,supportedAlgs:t.dpop_signing_alg_values_supported,sha256:async e=>o.sha256(e),nonces:a,isAuthServer:!0})}get issuer(){return this.serverMetadata.issuer}async revoke(e){try{await this.request("revocation",{token:e})}catch{}}async exchangeCode(e,t){let r=Date.now(),a=await this.request("token",{grant_type:"authorization_code",redirect_uri:this.clientMetadata.redirect_uris[0],code:e,code_verifier:t});try{return{aud:await this.verifyIssuer(a.sub),sub:a.sub,iss:this.issuer,scope:a.scope,refresh_token:a.refresh_token,access_token:a.access_token,token_type:a.token_type,expires_at:"number"==typeof a.expires_in?new Date(r+1e3*a.expires_in).toISOString():void 0}}catch(e){throw await this.revoke(a.access_token),e}}async refresh(e){if(!e.refresh_token)throw new c.TokenRefreshError(e.sub,"No refresh token available");let t=await this.verifyIssuer(e.sub),r=Date.now(),a=await this.request("token",{grant_type:"refresh_token",refresh_token:e.refresh_token});return{aud:t,sub:e.sub,iss:this.issuer,scope:a.scope,refresh_token:a.refresh_token,access_token:a.access_token,token_type:a.token_type,expires_at:"number"==typeof a.expires_in?new Date(r+1e3*a.expires_in).toISOString():void 0}}async verifyIssuer(e){let t={stack:[],error:void 0,hasError:!1};try{let r=i(t,(0,p.timeoutSignal)(1e4),!1),a=await this.oauthResolver.resolveFromIdentity(e,{noCache:!0,allowStale:!1,signal:r});if(this.issuer!==a.metadata.issuer)throw TypeError("Issuer mismatch");return a.identity.pds.href}catch(e){t.error=e,t.hasError=!0}finally{o(t)}}async request(e,t){let r=this.serverMetadata[`${e}_endpoint`];if(!r)throw Error(`No ${e} endpoint available`);let a=await this.buildClientAuth(e),{response:i,json:o}=await this.dpopFetch(r,{method:"POST",headers:{...a.headers,"Content-Type":"application/json"},body:JSON.stringify({...t,...a.payload})}).then((0,s.fetchJsonProcessor)());if(i.ok)switch(e){case"token":return d.atprotoTokenResponseSchema.parse(o);case"pushed_authorization_request":return n.oauthParResponseSchema.parse(o);default:return o}else throw new h.OAuthResponseError(i,o)}async buildClientAuth(e){let t=this.serverMetadata.token_endpoint_auth_methods_supported,r=this.clientMetadata.token_endpoint_auth_method;if("private_key_jwt"===r||this.keyset&&!r&&t?.includes("private_key_jwt")){if(!this.keyset)throw Error("No keyset available");try{let e=this.serverMetadata.token_endpoint_auth_signing_alg_values_supported??l.FALLBACK_ALG,t=this.clientMetadata.jwks?.keys.map(({kid:e})=>e).filter(e=>"string"==typeof e);return{payload:{client_id:this.clientMetadata.client_id,client_assertion_type:n.CLIENT_ASSERTION_TYPE_JWT_BEARER,client_assertion:await this.keyset.createJwt({alg:e,kid:t},{iss:this.clientMetadata.client_id,sub:this.clientMetadata.client_id,aud:this.serverMetadata.issuer,jti:await this.runtime.generateNonce(),iat:Math.floor(Date.now()/1e3)})}}}catch(e){if("private_key_jwt"===r)throw e}}if("none"===r||!r&&(t?.includes("none")??!0))return{payload:{client_id:this.clientMetadata.client_id}};throw Error(`Unsupported ${e} authentication method`)}}t.OAuthServerAgent=f},14209:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthServerFactory=void 0;let a=r(84630);class i{constructor(e,t,r,a,i,o){Object.defineProperty(this,"clientMetadata",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"runtime",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"resolver",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"fetch",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"keyset",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"dpopNonceCache",{enumerable:!0,configurable:!0,writable:!0,value:o})}async fromIssuer(e,t,r){let a=await this.resolver.getAuthorizationServerMetadata(e,r);return this.fromMetadata(a,t)}async fromMetadata(e,t){return new a.OAuthServerAgent(t,e,this.clientMetadata,this.dpopNonceCache,this.resolver,this.runtime,this.keyset,this.fetch)}}t.OAuthServerFactory=i},89307:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthSession=void 0;let a=r(31285),i=r(2508),o=r(41190),n=r(71817),s=globalThis.ReadableStream;class d{constructor(e,t,r,i=globalThis.fetch){Object.defineProperty(this,"server",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"sub",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"sessionGetter",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"dpopFetch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.dpopFetch=(0,n.dpopFetchWrapper)({fetch:(0,a.bindFetch)(i),iss:e.clientMetadata.client_id,key:e.dpopKey,supportedAlgs:e.serverMetadata.dpop_signing_alg_values_supported,sha256:async t=>e.runtime.sha256(t),nonces:e.dpopNonces,isAuthServer:!1})}get did(){return this.sub}get serverMetadata(){return this.server.serverMetadata}async getTokenSet(e){let{tokenSet:t}=await this.sessionGetter.get(this.sub,{noCache:!0===e,allowStale:!1===e});return t}async getTokenInfo(e="auto"){let t=await this.getTokenSet(e),r=null==t.expires_at?void 0:new Date(t.expires_at);return{expiresAt:r,get expired(){return null==r?void 0:r.getTime()<Date.now()-5e3},scope:t.scope,iss:t.iss,aud:t.aud,sub:t.sub}}async signOut(){try{let e=await this.getTokenSet(!1);await this.server.revoke(e.access_token)}finally{await this.sessionGetter.delStored(this.sub,new o.TokenRevokedError(this.sub))}}async fetchHandler(e,t){let r;let a=await this.getTokenSet("auto"),o=new URL(e,a.aud),n=`${a.token_type} ${a.access_token}`,d=new Headers(t?.headers);d.set("Authorization",n);let c=await this.dpopFetch(o,{...t,headers:d});if(!l(c))return c;try{r=await this.getTokenSet(!0)}catch(e){return c}if(s&&t?.body instanceof s)return c;let u=`${r.token_type} ${r.access_token}`,h=new URL(e,r.aud);d.set("Authorization",u);let p=await this.dpopFetch(h,{...t,headers:d});return l(p)&&await this.sessionGetter.delStored(this.sub,new i.TokenInvalidError(this.sub)),p}}function l(e){if(401!==e.status)return!1;let t=e.headers.get("WWW-Authenticate");return null!=t&&(t.startsWith("Bearer ")||t.startsWith("DPoP "))&&t.includes('error="invalid_token"')}t.OAuthSession=d},53712:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},57275:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Runtime=void 0;let a=r(59716),i=r(73642);class o{constructor(e){Object.defineProperty(this,"implementation",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"hasImplementationLock",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usingLock",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{requestLock:t}=e;this.hasImplementationLock=null!=t,this.usingLock=t?.bind(e)||i.requestLocalLock}async generateKey(e){let t=Array.from(e).sort(n);return this.implementation.createKey(t)}async sha256(e){let t=new TextEncoder().encode(e),r=await this.implementation.digest(t,{name:"sha256"});return a.base64url.baseEncode(r)}async generateNonce(e=16){let t=await this.implementation.getRandomValues(e);return a.base64url.baseEncode(t)}async generatePKCE(e){let t=await this.generateVerifier(e);return{verifier:t,challenge:await this.sha256(t),method:"S256"}}async calculateJwkThumbprint(e){let t=JSON.stringify(function(e){let t=t=>{let r=e[t];if("string"!=typeof r||!r)throw TypeError(`"${t}" Parameter missing or invalid`);return r};switch(e.kty){case"EC":return{crv:t("crv"),kty:t("kty"),x:t("x"),y:t("y")};case"OKP":return{crv:t("crv"),kty:t("kty"),x:t("x")};case"RSA":return{e:t("e"),kty:t("kty"),n:t("n")};case"oct":return{k:t("k"),kty:t("kty")};default:throw TypeError('"kty" (Key Type) Parameter missing or unsupported')}}(e));return this.sha256(t)}async generateVerifier(e=32){if(e<32||e>96)throw TypeError("Invalid code_verifier length");let t=await this.implementation.getRandomValues(e);return a.base64url.baseEncode(t)}}function n(e,t){if("ES256K"===e)return -1;if("ES256K"===t)return 1;for(let r of["ES","PS","RS"]){if(e.startsWith(r)){if(t.startsWith(r))return parseInt(e.slice(2,5))-parseInt(t.slice(2,5));return -1}if(t.startsWith(r))return 1}return 0}t.Runtime=o},52198:function(e,t,r){var a,i=this&&this.__addDisposableResource||function(e,t,r){if(null!=t){var a,i;if("object"!=typeof t&&"function"!=typeof t)throw TypeError("Object expected.");if(r){if(!Symbol.asyncDispose)throw TypeError("Symbol.asyncDispose is not defined.");a=t[Symbol.asyncDispose]}if(void 0===a){if(!Symbol.dispose)throw TypeError("Symbol.dispose is not defined.");a=t[Symbol.dispose],r&&(i=a)}if("function"!=typeof a)throw TypeError("Object not disposable.");i&&(a=function(){try{i.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:a,async:r})}else r&&e.stack.push({async:!0});return t},o=this&&this.__disposeResources||(a="function"==typeof SuppressedError?SuppressedError:function(e,t,r){var a=Error(r);return a.name="SuppressedError",a.error=e,a.suppressed=t,a},function(e){function t(t){e.error=e.hasError?new a(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}var r,i=0;return function a(){for(;r=e.stack.pop();)try{if(!r.async&&1===i)return i=0,e.stack.push(r),Promise.resolve().then(a);if(r.dispose){var o=r.dispose.call(r.value);if(r.async)return i|=2,Promise.resolve(o).then(a,function(e){return t(e),a()})}else i|=1}catch(e){t(e)}if(1===i)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}()});Object.defineProperty(t,"__esModule",{value:!0}),t.SessionGetter=void 0;let n=r(2032),s=r(2508),d=r(47471),l=r(41190),c=r(19951),u=r(44322);class h extends n.CachedGetter{constructor(e,t,r){super(async(e,a,i)=>{if(void 0===i){let t=new d.TokenRefreshError(e,"The session was deleted by another process");throw this.dispatchEvent("deleted",{sub:e,cause:t}),t}let{dpopKey:o,tokenSet:n}=i;if(e!==n.sub)throw new d.TokenRefreshError(e,"Stored session sub mismatch");if(!n.refresh_token)throw new d.TokenRefreshError(e,"No refresh token available");let s=await t.fromIssuer(n.iss,o);a?.signal?.throwIfAborted();try{let t=await s.refresh(n);if(e!==t.sub)throw new d.TokenRefreshError(e,"Token set sub mismatch");return{dpopKey:o,tokenSet:t}}catch(t){if(t instanceof c.OAuthResponseError&&400===t.status&&"invalid_grant"===t.error){if(!r.hasImplementationLock){await new Promise(e=>setTimeout(e,1e3));let r=await this.getStored(e);if(void 0===r)throw new d.TokenRefreshError(e,"The session was deleted by another process",{cause:t});if(r.tokenSet.access_token!==n.access_token||r.tokenSet.refresh_token!==n.refresh_token)return r}let a=t.errorDescription??"The session was revoked";throw new d.TokenRefreshError(e,a,{cause:t})}throw t}},e,{isStale:(e,{tokenSet:t})=>null!=t.expires_at&&new Date(t.expires_at).getTime()<Date.now()+1e4+3e4*Math.random(),onStoreError:async(e,r,{tokenSet:a,dpopKey:i})=>{let o=await t.fromIssuer(a.iss,i);throw await o.revoke(a.refresh_token??a.access_token),e},deleteOnError:async e=>e instanceof d.TokenRefreshError||e instanceof l.TokenRevokedError||e instanceof s.TokenInvalidError}),Object.defineProperty(this,"runtime",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"eventTarget",{enumerable:!0,configurable:!0,writable:!0,value:new u.CustomEventTarget})}addEventListener(e,t,r){this.eventTarget.addEventListener(e,t,r)}removeEventListener(e,t,r){this.eventTarget.removeEventListener(e,t,r)}dispatchEvent(e,t){return this.eventTarget.dispatchCustomEvent(e,t)}async setStored(e,t){if(e!==t.tokenSet.sub)throw TypeError("Token set does not match the expected sub");await super.setStored(e,t),this.dispatchEvent("updated",{sub:e,...t})}async delStored(e,t){await super.delStored(e,t),this.dispatchEvent("deleted",{sub:e,cause:t})}async getSession(e,t){return this.get(e,{noCache:!0===t,allowStale:!1===t})}async get(e,t){let r=await this.runtime.usingLock(`@atproto-oauth-client-${e}`,async()=>{let r={stack:[],error:void 0,hasError:!1};try{let a=i(r,(0,u.timeoutSignal)(3e4,t),!1),o=i(r,(0,u.combineSignals)([t?.signal,a]),!1);return await super.get(e,{...t,signal:o.signal})}catch(e){r.error=e,r.hasError=!0}finally{o(r)}});if(e!==r.tokenSet.sub)throw Error("Token set does not match the expected sub");return r}}t.SessionGetter=h},88882:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},41043:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clientMetadataSchema=void 0;let a=r(96625),i=r(72094);t.clientMetadataSchema=i.oauthClientMetadataSchema.extend({client_id:a.z.union([i.oauthClientIdDiscoverableSchema,i.oauthClientIdLoopbackSchema])})},44322:function(e,t){var r=this&&this.__classPrivateFieldSet||function(e,t,r,a,i){if("m"===a)throw TypeError("Private method is not writable");if("a"===a&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(e,r):i?i.value=r:t.set(e,r),r},a=this&&this.__classPrivateFieldGet||function(e,t,r,a){if("a"===r&&!a)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.includesSpaceSeparatedValue=t.CustomEventTarget=t.CustomEvent=t.timeoutSignal=t.ifString=void 0,t.contentMime=function(e){return e.get("content-type")?.split(";")[0].trim()},t.combineSignals=function(e){let t=new AbortController,r=function(e){let r=Error("This operation was aborted",{cause:this.reason});t.abort(r)};for(let a of e)if(a){if(a.aborted)throw t.abort(),Error("One of the signals is already aborted",{cause:a.reason});a.addEventListener("abort",r,{signal:t.signal})}return t[Symbol.dispose]=()=>{let e=Error("AbortController was disposed");t.abort(e)},t},Symbol.dispose??(Symbol.dispose=Symbol("@@dispose")),t.ifString=e=>"string"==typeof e?e:void 0,t.timeoutSignal=(e,t)=>{if(!Number.isInteger(e)||e<0)throw TypeError("Expected a positive integer");t?.signal?.throwIfAborted();let r=new AbortController,{signal:a}=r;t?.signal?.addEventListener("abort",e=>r.abort(e),{once:!0,signal:a});let i=setTimeout(e=>r.abort(e),e,Error("Timeout"));return i?.unref?.(),a.addEventListener("abort",()=>clearTimeout(i),{once:!0,signal:a}),Object.defineProperty(a,Symbol.dispose,{value:()=>r.abort()}),a},t.CustomEvent=globalThis.CustomEvent??(()=>{var e;class t extends Event{constructor(t,a){if(!arguments.length)throw TypeError("type argument is required");super(t,a),e.set(this,void 0),r(this,e,a?.detail??null,"f")}get detail(){return a(this,e,"f")}}return e=new WeakMap,Object.defineProperties(t.prototype,{[Symbol.toStringTag]:{writable:!1,enumerable:!1,configurable:!0,value:"CustomEvent"},detail:{enumerable:!0}}),t})();class i{constructor(){Object.defineProperty(this,"eventTarget",{enumerable:!0,configurable:!0,writable:!0,value:new EventTarget})}addEventListener(e,t,r){this.eventTarget.addEventListener(e,t,r)}removeEventListener(e,t,r){this.eventTarget.removeEventListener(e,t,r)}dispatchCustomEvent(e,r,a){return this.eventTarget.dispatchEvent(new t.CustomEvent(e,{...a,detail:r}))}}t.CustomEventTarget=i,t.includesSpaceSeparatedValue=(e,t)=>{let r;if(0===t.length)throw TypeError("Value cannot be empty");if(t.includes(" "))throw TypeError("Value cannot contain spaces");let a=e.length,i=t.length;if(a<i)return!1;let o=e.indexOf(t);for(;-1!==o;){if(r=o+i,(0===o||" "===e[o-1])&&(r===a||" "===e[r]))return!0;o=e.indexOf(t,r+1)}return!1}},92763:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.validateClientMetadata=function(e,t){if(e.jwks){if(!t)throw TypeError("Keyset must not be provided when jwks is provided");for(let r of e.jwks.keys)if(r.kid){if(!t.has(r.kid))throw TypeError(`Key with kid "${r.kid}" not found in keyset`)}else throw TypeError('Key must have a "kid" property')}!e.jwks&&!e.jwks_uri&&t?.size&&(e={...e,jwks:t.toJSON()});let r=i.clientMetadataSchema.parse(e);r.client_id.startsWith("http:")?(0,a.assertOAuthLoopbackClientId)(r.client_id):(0,a.assertOAuthDiscoverableClientId)(r.client_id);let s=r.scope?.split(" ");if(!s?.includes("atproto"))throw TypeError('Client metadata must include the "atproto" scope');if(!r.response_types.includes("code"))throw TypeError('"response_types" must include "code"');if(!r.grant_types.includes("authorization_code"))throw TypeError('"grant_types" must include "authorization_code"');let d=r[o];switch(d){case void 0:throw TypeError(`${o} must be provided`);case"none":if(r[n])throw TypeError(`${n} must not be provided when ${o} is "${d}"`);break;case"private_key_jwt":if(!t?.size)throw TypeError(`A non-empty keyset must be provided when ${o} is "${d}"`);if(!r[n])throw TypeError(`${n} must be provided when ${o} is "${d}"`);break;default:throw TypeError(`Invalid "token_endpoint_auth_method" value: ${d}`)}return r};let a=r(72094),i=r(41043),o="token_endpoint_auth_method",n="token_endpoint_auth_signing_alg"},52689:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.atprotoLoopbackClientMetadata=function(e){let{scope:t="atproto",redirect_uris:r=["http://127.0.0.1/","http://[::1]/"]}=(0,a.parseOAuthLoopbackClientId)(e);return{client_id:e,scope:t,redirect_uris:r,response_types:["code"],grant_types:["authorization_code","refresh_token"],token_endpoint_auth_method:"none",application_type:"native",dpop_bound_access_tokens:!0}};let a=r(14718)},18289:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CLIENT_ASSERTION_TYPE_JWT_BEARER=void 0,t.CLIENT_ASSERTION_TYPE_JWT_BEARER="urn:ietf:params:oauth:client-assertion-type:jwt-bearer"},72094:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(18289),t),i(r(93233),t),i(r(37309),t),i(r(52689),t),i(r(58200),t),i(r(61230),t),i(r(52238),t),i(r(31954),t),i(r(86809),t),i(r(26291),t),i(r(58269),t),i(r(87702),t),i(r(87188),t),i(r(10500),t),i(r(6856),t),i(r(73187),t),i(r(80513),t),i(r(14718),t),i(r(50595),t),i(r(9872),t),i(r(13101),t),i(r(41371),t),i(r(97416),t),i(r(75435),t),i(r(29780),t),i(r(96530),t),i(r(43498),t),i(r(24335),t),i(r(82581),t),i(r(37537),t),i(r(16296),t),i(r(53452),t),i(r(60024),t),i(r(76745),t),i(r(1572),t),i(r(71117),t),i(r(76691),t),i(r(35046),t),i(r(83196),t),i(r(81899),t),i(r(49333),t),i(r(28689),t),i(r(86884),t),i(r(66399),t)},58200:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthAccessTokenSchema=void 0;let a=r(96625);t.oauthAccessTokenSchema=a.z.string().min(1)},61230:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthAuthenticationErrorResponseSchema=void 0;let a=r(96625);t.oauthAuthenticationErrorResponseSchema=a.z.enum(["invalid_request","unauthorized_client","access_denied","unsupported_response_type","invalid_scope","server_error","temporarily_unavailable"])},52238:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthAuthorizationCodeGrantTokenRequestSchema=void 0;let a=r(96625),i=r(82581);t.oauthAuthorizationCodeGrantTokenRequestSchema=a.z.object({grant_type:a.z.literal("authorization_code"),code:a.z.string().min(1),redirect_uri:i.oauthRedirectUriSchema,code_verifier:a.z.string().min(43).max(128).regex(/^[a-zA-Z0-9-._~]+$/).optional()})},31954:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthAuthorizationDetailsSchema=t.oauthAuthorizationDetailSchema=void 0;let a=r(96625),i=r(93233);t.oauthAuthorizationDetailSchema=a.z.object({type:a.z.string(),locations:a.z.array(i.dangerousUriSchema).optional(),actions:a.z.array(a.z.string()).optional(),datatypes:a.z.array(a.z.string()).optional(),identifier:a.z.string().optional(),privileges:a.z.array(a.z.string()).optional()}),t.oauthAuthorizationDetailsSchema=a.z.array(t.oauthAuthorizationDetailSchema)},86809:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthAuthorizationRequestJarSchema=void 0;let a=r(96625),i=r(16516);t.oauthAuthorizationRequestJarSchema=a.z.object({request:a.z.union([i.signedJwtSchema,i.unsignedJwtSchema])})},26291:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthAuthorizationRequestParSchema=void 0;let a=r(96625),i=r(86809),o=r(58269);t.oauthAuthorizationRequestParSchema=a.z.union([o.oauthAuthorizationRequestParametersSchema,i.oauthAuthorizationRequestJarSchema])},58269:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthAuthorizationRequestParametersSchema=void 0;let a=r(96625),i=r(16516),o=r(31954),n=r(50595),s=r(64887),d=r(82581),l=r(60024),c=r(76745),u=r(1572),h=r(49333),p=r(28689),f=r(86884);t.oauthAuthorizationRequestParametersSchema=a.z.object({client_id:n.oauthClientIdSchema,state:a.z.string().optional(),redirect_uri:d.oauthRedirectUriSchema.optional(),scope:u.oauthScopeSchema.optional(),response_type:c.oauthResponseTypeSchema,code_challenge:a.z.string().optional(),code_challenge_method:s.oauthCodeChallengeMethodSchema.default("S256").optional(),dpop_jkt:a.z.string().optional(),response_mode:l.oauthResponseModeSchema.optional(),nonce:a.z.string().optional(),max_age:a.z.number().int().min(0).optional(),claims:a.z.record(f.oidcEntityTypeSchema,a.z.record(h.oidcClaimsParameterSchema,a.z.union([a.z.literal(null),p.oidcClaimsPropertiesSchema]))).optional(),login_hint:a.z.string().min(1).optional(),ui_locales:a.z.string().regex(/^[a-z]{2,3}(-[A-Z]{2})?( [a-z]{2,3}(-[A-Z]{2})?)*$/).optional(),id_token_hint:i.signedJwtSchema.optional(),display:a.z.enum(["page","popup","touch","wap"]).optional(),prompt:a.z.enum(["none","login","consent","select_account"]).optional(),authorization_details:o.oauthAuthorizationDetailsSchema.optional()})},87702:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthAuthorizationRequestQuerySchema=void 0;let a=r(96625),i=r(86809),o=r(58269),n=r(87188);t.oauthAuthorizationRequestQuerySchema=a.z.union([o.oauthAuthorizationRequestParametersSchema,i.oauthAuthorizationRequestJarSchema,n.oauthAuthorizationRequestUriSchema])},87188:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthAuthorizationRequestUriSchema=void 0;let a=r(96625),i=r(53452);t.oauthAuthorizationRequestUriSchema=a.z.object({request_uri:i.oauthRequestUriSchema})},10500:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthAuthorizationServerMetadataValidator=t.oauthAuthorizationServerMetadataSchema=void 0;let a=r(96625),i=r(64887),o=r(29780),n=r(93233);t.oauthAuthorizationServerMetadataSchema=a.z.object({issuer:o.oauthIssuerIdentifierSchema,claims_supported:a.z.array(a.z.string()).optional(),claims_locales_supported:a.z.array(a.z.string()).optional(),claims_parameter_supported:a.z.boolean().optional(),request_parameter_supported:a.z.boolean().optional(),request_uri_parameter_supported:a.z.boolean().optional(),require_request_uri_registration:a.z.boolean().optional(),scopes_supported:a.z.array(a.z.string()).optional(),subject_types_supported:a.z.array(a.z.string()).optional(),response_types_supported:a.z.array(a.z.string()).optional(),response_modes_supported:a.z.array(a.z.string()).optional(),grant_types_supported:a.z.array(a.z.string()).optional(),code_challenge_methods_supported:a.z.array(i.oauthCodeChallengeMethodSchema).min(1).optional(),ui_locales_supported:a.z.array(a.z.string()).optional(),id_token_signing_alg_values_supported:a.z.array(a.z.string()).optional(),display_values_supported:a.z.array(a.z.string()).optional(),request_object_signing_alg_values_supported:a.z.array(a.z.string()).optional(),authorization_response_iss_parameter_supported:a.z.boolean().optional(),authorization_details_types_supported:a.z.array(a.z.string()).optional(),request_object_encryption_alg_values_supported:a.z.array(a.z.string()).optional(),request_object_encryption_enc_values_supported:a.z.array(a.z.string()).optional(),jwks_uri:n.webUriSchema.optional(),authorization_endpoint:n.webUriSchema,token_endpoint:n.webUriSchema,token_endpoint_auth_methods_supported:a.z.array(a.z.string()).optional(),token_endpoint_auth_signing_alg_values_supported:a.z.array(a.z.string()).optional(),revocation_endpoint:n.webUriSchema.optional(),introspection_endpoint:n.webUriSchema.optional(),pushed_authorization_request_endpoint:n.webUriSchema.optional(),require_pushed_authorization_requests:a.z.boolean().optional(),userinfo_endpoint:n.webUriSchema.optional(),end_session_endpoint:n.webUriSchema.optional(),registration_endpoint:n.webUriSchema.optional(),dpop_signing_alg_values_supported:a.z.array(a.z.string()).optional(),protected_resources:a.z.array(n.webUriSchema).optional(),client_id_metadata_document_supported:a.z.boolean().optional()}),t.oauthAuthorizationServerMetadataValidator=t.oauthAuthorizationServerMetadataSchema.superRefine((e,t)=>{e.require_pushed_authorization_requests&&!e.pushed_authorization_request_endpoint&&t.addIssue({code:a.z.ZodIssueCode.custom,message:'"pushed_authorization_request_endpoint" required when "require_pushed_authorization_requests" is true'})}).superRefine((e,t)=>{e.response_types_supported&&!e.response_types_supported.includes("code")&&t.addIssue({code:a.z.ZodIssueCode.custom,message:'Response type "code" is required'})})},6856:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthClientCredentialsGrantTokenRequestSchema=void 0;let a=r(96625);t.oauthClientCredentialsGrantTokenRequestSchema=a.z.object({grant_type:a.z.literal("client_credentials")})},73187:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthClientCredentialsSchema=t.oauthClientCredentialsNoneSchema=t.oauthClientCredentialsSecretPostSchema=t.oauthClientCredentialsJwtBearerSchema=void 0;let a=r(96625),i=r(16516),o=r(18289),n=r(50595);t.oauthClientCredentialsJwtBearerSchema=a.z.object({client_id:n.oauthClientIdSchema,client_assertion_type:a.z.literal(o.CLIENT_ASSERTION_TYPE_JWT_BEARER),client_assertion:i.signedJwtSchema}),t.oauthClientCredentialsSecretPostSchema=a.z.object({client_id:n.oauthClientIdSchema,client_secret:a.z.string()}),t.oauthClientCredentialsNoneSchema=a.z.object({client_id:n.oauthClientIdSchema}),t.oauthClientCredentialsSchema=a.z.union([t.oauthClientCredentialsJwtBearerSchema,t.oauthClientCredentialsSecretPostSchema,t.oauthClientCredentialsNoneSchema])},80513:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.conventionalOAuthClientIdSchema=t.oauthClientIdDiscoverableSchema=void 0,t.isOAuthClientIdDiscoverable=function(e){return t.oauthClientIdDiscoverableSchema.safeParse(e).success},t.isConventionalOAuthClientId=function(e){return t.conventionalOAuthClientIdSchema.safeParse(e).success},t.assertOAuthDiscoverableClientId=function(e){t.oauthClientIdDiscoverableSchema.parse(e)},t.parseOAuthDiscoverableClientId=function(e){return new URL(t.oauthClientIdDiscoverableSchema.parse(e))};let a=r(96625),i=r(50595),o=r(93233),n=r(37309);t.oauthClientIdDiscoverableSchema=a.z.intersection(i.oauthClientIdSchema,o.httpsUriSchema).superRefine((e,t)=>{let r=new URL(e);return r.username||r.password?(t.addIssue({code:a.z.ZodIssueCode.custom,message:"ClientID must not contain credentials"}),!1):r.hash?(t.addIssue({code:a.z.ZodIssueCode.custom,message:"ClientID must not contain a fragment"}),!1):"/"===r.pathname?(t.addIssue({code:a.z.ZodIssueCode.custom,message:'ClientID must contain a path component (e.g. "/client-metadata.json")'}),!1):r.pathname.endsWith("/")?(t.addIssue({code:a.z.ZodIssueCode.custom,message:"ClientID path must not end with a trailing slash"}),!1):(0,n.isHostnameIP)(r.hostname)?(t.addIssue({code:a.z.ZodIssueCode.custom,message:"ClientID hostname must not be an IP address"}),!1):(0,n.extractUrlPath)(e)===r.pathname||(t.addIssue({code:a.z.ZodIssueCode.custom,message:`ClientID must be in canonical form ("${r.href}", got "${e}")`}),!1)}),t.conventionalOAuthClientIdSchema=t.oauthClientIdDiscoverableSchema.superRefine((e,t)=>{let r=new URL(e);return r.port?(t.addIssue({code:a.z.ZodIssueCode.custom,message:"ClientID must not contain a port"}),!1):r.search?(t.addIssue({code:a.z.ZodIssueCode.custom,message:"ClientID must not contain a query string"}),!1):"/oauth-client-metadata.json"===r.pathname||(t.addIssue({code:a.z.ZodIssueCode.custom,message:'ClientID must be "/oauth-client-metadata.json"'}),!1)})},14718:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthClientIdLoopbackSchema=void 0,t.isOAuthClientIdLoopback=function(e){try{return d(e),!0}catch{return!1}},t.assertOAuthLoopbackClientId=function(e){d(e)},t.parseOAuthLoopbackClientId=d;let a=r(96625),i=r(50595),o=r(82581),n=r(1572),s="http://localhost";function d(e){if(e.startsWith(s)){if(e.includes("#",s.length))throw TypeError("Loopback ClientID must not contain a hash component")}else throw TypeError(`Loopback ClientID must start with "${s}"`);let t=e.length>s.length&&"/"===e[s.length]?s.length+1:s.length;if(e.length===t)return{};if("?"!==e[t])throw TypeError("Loopback ClientID must not contain a path component");let r=new URLSearchParams(e.slice(t+1));for(let e of r.keys())if("redirect_uri"!==e&&"scope"!==e)throw TypeError(`Invalid query parameter "${e}" in client ID`);let a=r.get("scope")??void 0;if(null!=a){if(r.getAll("scope").length>1)throw TypeError("Loopback ClientID must contain at most one scope query parameter");if(!n.oauthScopeSchema.safeParse(a).success)throw TypeError("Invalid scope query parameter in client ID")}return{scope:a,redirect_uris:r.has("redirect_uri")?r.getAll("redirect_uri").map(e=>o.oauthLoopbackRedirectURISchema.parse(e)):void 0}}t.oauthClientIdLoopbackSchema=i.oauthClientIdSchema.superRefine((e,t)=>{try{return d(e),!0}catch(e){return t.addIssue({code:a.ZodIssueCode.custom,message:e instanceof TypeError?e.message:"Invalid loopback client ID"}),!1}})},50595:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthClientIdSchema=void 0;let a=r(96625);t.oauthClientIdSchema=a.z.string().min(1)},9872:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthClientMetadataSchema=void 0;let a=r(96625),i=r(16516),o=r(50595),n=r(13101),s=r(97416),d=r(82581),l=r(76745),c=r(1572),u=r(93233);t.oauthClientMetadataSchema=a.z.object({redirect_uris:a.z.array(d.oauthRedirectUriSchema).nonempty(),response_types:a.z.array(l.oauthResponseTypeSchema).nonempty().default(["code"]),grant_types:a.z.array(s.oauthGrantTypeSchema).nonempty().default(["authorization_code"]),scope:c.oauthScopeSchema.optional(),token_endpoint_auth_method:n.oauthEndpointAuthMethod.default("none").optional(),token_endpoint_auth_signing_alg:a.z.string().optional(),userinfo_signed_response_alg:a.z.string().optional(),userinfo_encrypted_response_alg:a.z.string().optional(),jwks_uri:u.webUriSchema.optional(),jwks:i.jwksPubSchema.optional(),application_type:a.z.enum(["web","native"]).default("web").optional(),subject_type:a.z.enum(["public","pairwise"]).default("public").optional(),request_object_signing_alg:a.z.string().optional(),id_token_signed_response_alg:a.z.string().optional(),authorization_signed_response_alg:a.z.string().default("RS256").optional(),authorization_encrypted_response_enc:a.z.enum(["A128CBC-HS256"]).optional(),authorization_encrypted_response_alg:a.z.string().optional(),client_id:o.oauthClientIdSchema.optional(),client_name:a.z.string().optional(),client_uri:u.webUriSchema.optional(),policy_uri:u.webUriSchema.optional(),tos_uri:u.webUriSchema.optional(),logo_uri:u.webUriSchema.optional(),default_max_age:a.z.number().optional(),require_auth_time:a.z.boolean().optional(),contacts:a.z.array(a.z.string().email()).optional(),tls_client_certificate_bound_access_tokens:a.z.boolean().optional(),dpop_bound_access_tokens:a.z.boolean().optional(),authorization_details_types:a.z.array(a.z.string()).optional()})},64887:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthCodeChallengeMethodSchema=void 0;let a=r(96625);t.oauthCodeChallengeMethodSchema=a.z.enum(["S256","plain"])},13101:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthEndpointAuthMethod=void 0;let a=r(96625);t.oauthEndpointAuthMethod=a.z.enum(["client_secret_basic","client_secret_jwt","client_secret_post","none","private_key_jwt","self_signed_tls_client_auth","tls_client_auth"])},41371:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OAUTH_ENDPOINT_NAMES=void 0,t.OAUTH_ENDPOINT_NAMES=["token","revocation","introspection","pushed_authorization_request"]},97416:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthGrantTypeSchema=void 0;let a=r(96625);t.oauthGrantTypeSchema=a.z.enum(["authorization_code","implicit","refresh_token","password","client_credentials","urn:ietf:params:oauth:grant-type:jwt-bearer","urn:ietf:params:oauth:grant-type:saml2-bearer"])},75435:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},29780:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthIssuerIdentifierSchema=void 0;let a=r(96625),i=r(93233);t.oauthIssuerIdentifierSchema=i.webUriSchema.superRefine((e,t)=>{if(e.endsWith("/"))return t.addIssue({code:a.z.ZodIssueCode.custom,message:"Issuer URL must not end with a slash"}),!1;let r=new URL(e);return r.username||r.password?(t.addIssue({code:a.z.ZodIssueCode.custom,message:"Issuer URL must not contain a username or password"}),!1):r.hash||r.search?(t.addIssue({code:a.z.ZodIssueCode.custom,message:"Issuer URL must not contain a query or fragment"}),!1):e===("/"===r.pathname?r.origin:r.href)||(t.addIssue({code:a.z.ZodIssueCode.custom,message:"Issuer URL must be in the canonical form"}),!1)})},96530:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthParResponseSchema=void 0;let a=r(96625);t.oauthParResponseSchema=a.z.object({request_uri:a.z.string(),expires_in:a.z.number().int().positive()})},43498:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthPasswordGrantTokenRequestSchema=void 0;let a=r(96625);t.oauthPasswordGrantTokenRequestSchema=a.z.object({grant_type:a.z.literal("password"),username:a.z.string(),password:a.z.string()})},24335:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthProtectedResourceMetadataSchema=void 0;let a=r(96625),i=r(29780),o=r(93233);t.oauthProtectedResourceMetadataSchema=a.z.object({resource:o.webUriSchema.refine(e=>!e.includes("?"),{message:"Resource URL must not contain query parameters"}).refine(e=>!e.includes("#"),{message:"Resource URL must not contain a fragment"}),authorization_servers:a.z.array(i.oauthIssuerIdentifierSchema).optional(),jwks_uri:o.webUriSchema.optional(),scopes_supported:a.z.array(a.z.string()).optional(),bearer_methods_supported:a.z.array(a.z.enum(["header","body","query"])).optional(),resource_signing_alg_values_supported:a.z.array(a.z.string()).optional(),resource_documentation:o.webUriSchema.optional(),resource_policy_uri:o.webUriSchema.optional(),resource_tos_uri:o.webUriSchema.optional()})},82581:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthRedirectUriSchema=t.oauthPrivateUseRedirectURISchema=t.oauthHttpsRedirectURISchema=t.oauthLoopbackRedirectURISchema=void 0;let a=r(96625),i=r(93233);t.oauthLoopbackRedirectURISchema=i.loopbackUriSchema.superRefine((e,t)=>!e.startsWith("http://localhost")||(t.addIssue({code:a.ZodIssueCode.custom,message:'Use of "localhost" hostname is not allowed (RFC 8252), use a loopback IP such as "127.0.0.1" instead'}),!1)),t.oauthHttpsRedirectURISchema=i.httpsUriSchema,t.oauthPrivateUseRedirectURISchema=i.privateUseUriSchema,t.oauthRedirectUriSchema=a.z.union([t.oauthLoopbackRedirectURISchema,t.oauthHttpsRedirectURISchema,t.oauthPrivateUseRedirectURISchema],{message:'URL must use the "https:" or "http:" protocol, or a private-use URI scheme (RFC 8252)'})},37537:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthRefreshTokenGrantTokenRequestSchema=void 0;let a=r(96625),i=r(16296);t.oauthRefreshTokenGrantTokenRequestSchema=a.z.object({grant_type:a.z.literal("refresh_token"),refresh_token:i.oauthRefreshTokenSchema})},16296:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthRefreshTokenSchema=void 0;let a=r(96625);t.oauthRefreshTokenSchema=a.z.string().min(1)},53452:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthRequestUriSchema=void 0;let a=r(96625);t.oauthRequestUriSchema=a.z.string()},60024:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthResponseModeSchema=void 0;let a=r(96625);t.oauthResponseModeSchema=a.z.enum(["query","fragment","form_post"])},76745:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthResponseTypeSchema=void 0;let a=r(96625);t.oauthResponseTypeSchema=a.z.enum(["code","token","none","code id_token token","code id_token","code token","id_token token","id_token"])},1572:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthScopeSchema=void 0;let a=r(96625);t.oauthScopeSchema=a.z.string().regex(/^[\x21\x23-\x5B\x5D-\x7E]+(?: [\x21\x23-\x5B\x5D-\x7E]+)*$/)},71117:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthTokenIdentificationSchema=void 0;let a=r(96625),i=r(58200),o=r(16296);t.oauthTokenIdentificationSchema=a.z.object({token:a.z.union([i.oauthAccessTokenSchema,o.oauthRefreshTokenSchema]),token_type_hint:a.z.enum(["access_token","refresh_token"]).optional()})},76691:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthTokenRequestSchema=void 0;let a=r(96625),i=r(52238),o=r(6856),n=r(43498),s=r(37537);t.oauthTokenRequestSchema=a.z.discriminatedUnion("grant_type",[i.oauthAuthorizationCodeGrantTokenRequestSchema,s.oauthRefreshTokenGrantTokenRequestSchema,n.oauthPasswordGrantTokenRequestSchema,o.oauthClientCredentialsGrantTokenRequestSchema])},35046:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthTokenResponseSchema=void 0;let a=r(96625),i=r(16516),o=r(31954),n=r(83196);t.oauthTokenResponseSchema=a.z.object({access_token:a.z.string(),token_type:n.oauthTokenTypeSchema,scope:a.z.string().optional(),refresh_token:a.z.string().optional(),expires_in:a.z.number().optional(),id_token:i.signedJwtSchema.optional(),authorization_details:o.oauthAuthorizationDetailsSchema.optional()}).passthrough()},83196:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oauthTokenTypeSchema=void 0;let a=r(96625);t.oauthTokenTypeSchema=a.z.union([a.z.string().regex(/^DPoP$/i).transform(()=>"DPoP"),a.z.string().regex(/^Bearer$/i).transform(()=>"Bearer")])},81899:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oidcAuthenticationErrorResponseSchema=void 0;let a=r(96625);t.oidcAuthenticationErrorResponseSchema=a.z.enum(["interaction_required","login_required","account_selection_required","consent_required","invalid_request_uri","invalid_request_object","request_not_supported","request_uri_not_supported","registration_not_supported"])},49333:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oidcClaimsParameterSchema=void 0;let a=r(96625);t.oidcClaimsParameterSchema=a.z.enum(["auth_time","nonce","acr","name","family_name","given_name","middle_name","nickname","preferred_username","gender","picture","profile","website","birthdate","zoneinfo","locale","updated_at","email","email_verified","phone_number","phone_number_verified","address"])},28689:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oidcClaimsPropertiesSchema=void 0;let a=r(96625),i=a.z.union([a.z.string(),a.z.number(),a.z.boolean()]);t.oidcClaimsPropertiesSchema=a.z.object({essential:a.z.boolean().optional(),value:i.optional(),values:a.z.array(i).optional()})},86884:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oidcEntityTypeSchema=void 0;let a=r(96625);t.oidcEntityTypeSchema=a.z.enum(["userinfo","id_token"])},66399:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.oidcUserinfoSchema=void 0;let a=r(96625);t.oidcUserinfoSchema=a.z.object({sub:a.z.string(),iss:a.z.string().url().optional(),aud:a.z.union([a.z.string(),a.z.array(a.z.string()).min(1)]).optional(),email:a.z.string().email().optional(),email_verified:a.z.boolean().optional(),name:a.z.string().optional(),preferred_username:a.z.string().optional(),picture:a.z.string().url().optional()})},93233:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.privateUseUriSchema=t.webUriSchema=t.httpsUriSchema=t.loopbackUriSchema=t.dangerousUriSchema=void 0;let a=r(96625),i=r(37309),o=URL.canParse??(e=>{try{return new URL(e),!0}catch{return!1}});t.dangerousUriSchema=a.z.string().refine(e=>e.includes(":")&&o(e),{message:"Invalid URL"}),t.loopbackUriSchema=t.dangerousUriSchema.superRefine((e,t)=>{if(!e.startsWith("http://"))return t.addIssue({code:a.ZodIssueCode.custom,message:'URL must use the "http:" protocol'}),!1;let r=new URL(e);return!!(0,i.isLoopbackHost)(r.hostname)||(t.addIssue({code:a.ZodIssueCode.custom,message:'URL must use "localhost", "127.0.0.1" or "[::1]" as hostname'}),!1)}),t.httpsUriSchema=t.dangerousUriSchema.superRefine((e,t)=>{if(!e.startsWith("https://"))return t.addIssue({code:a.ZodIssueCode.custom,message:'URL must use the "https:" protocol'}),!1;let r=new URL(e);if((0,i.isLoopbackHost)(r.hostname))return t.addIssue({code:a.ZodIssueCode.custom,message:"https: URL must not use a loopback host"}),!1;if((0,i.isHostnameIP)(r.hostname));else{if(!r.hostname.includes("."))return t.addIssue({code:a.ZodIssueCode.custom,message:"Domain name must contain at least two segments"}),!1;if(r.hostname.endsWith(".local"))return t.addIssue({code:a.ZodIssueCode.custom,message:'Domain name must not end with ".local"'}),!1}return!0}),t.webUriSchema=a.z.string().superRefine((e,r)=>{if(e.startsWith("http://")){let a=t.loopbackUriSchema.safeParse(e);return a.success||a.error.issues.forEach(r.addIssue,r),a.success}if(e.startsWith("https://")){let a=t.httpsUriSchema.safeParse(e);return a.success||a.error.issues.forEach(r.addIssue,r),a.success}return r.addIssue({code:a.ZodIssueCode.custom,message:'URL must use the "http:" or "https:" protocol'}),!1}),t.privateUseUriSchema=t.dangerousUriSchema.superRefine((e,t)=>{let r=e.indexOf("."),i=e.indexOf(":");if(-1===r||-1===i||r>i)return t.addIssue({code:a.ZodIssueCode.custom,message:'Private-use URI scheme requires a "." as part of the protocol'}),!1;let o=new URL(e);return o.protocol.includes(".")?!o.hostname||(t.addIssue({code:a.ZodIssueCode.custom,message:'Private-use URI schemes must not include a hostname (only one "/" is allowed after the protocol, as per RFC 8252)'}),!1):(t.addIssue({code:a.ZodIssueCode.custom,message:"Invalid private-use URI scheme"}),!1)})},37309:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isHostnameIP=function(e){return!!(e.match(/^\d+\.\d+\.\d+\.\d+$/)||e.startsWith("[")&&e.endsWith("]"))},t.isLoopbackHost=r,t.isLoopbackUrl=function(e){return r(("string"==typeof e?new URL(e):e).hostname)},t.safeUrl=function(e){try{return new URL(e)}catch{return null}},t.extractUrlPath=function(e){let t=e.startsWith("https://")?8:e.startsWith("http://")?7:-1;if(-1===t)throw TypeError('URL must use the "https:" or "http:" protocol');let r=e.indexOf("#",t),a=e.indexOf("?",t),i=-1!==a&&(-1===r||a<r)?a:-1,o=-1===r?-1===i?e.length:i:-1===i?r:Math.min(r,i),n=e.indexOf("/",t),s=-1===n||n>o?o:n;if(t===s)throw TypeError("URL must contain a host");return e.substring(s,o)};function r(e){return"localhost"===e||"127.0.0.1"===e||"[::1]"===e}},27168:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LRUCache=void 0;let r="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,a=new Set,i="object"==typeof process&&process?process:{},o=(e,t,r,a)=>{"function"==typeof i.emitWarning?i.emitWarning(e,t,r,a):console.error(`[${r}] ${t}: ${e}`)},n=globalThis.AbortController,s=globalThis.AbortSignal;if(void 0===n){s=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(e,t){this._onabort.push(t)}},n=class{constructor(){t()}signal=new s;abort(e){if(!this.signal.aborted){for(let t of(this.signal.reason=e,this.signal.aborted=!0,this.signal._onabort))t(e);this.signal.onabort?.(e)}}};let e=i.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1",t=()=>{e&&(e=!1,o("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}let d=e=>!a.has(e);Symbol("type");let l=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),c=e=>l(e)?e<=256?Uint8Array:e<=65536?Uint16Array:e<=4294967296?Uint32Array:e<=Number.MAX_SAFE_INTEGER?u:null:null;class u extends Array{constructor(e){super(e),this.fill(0)}}class h{heap;length;static #e=!1;static create(e){let t=c(e);if(!t)return[];h.#e=!0;let r=new h(e,t);return h.#e=!1,r}constructor(e,t){if(!h.#e)throw TypeError("instantiate Stack using Stack.create(n)");this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}}class p{#t;#r;#a;#i;#o;#n;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#s;#d;#l;#c;#u;#h;#p;#f;#y;#m;#g;#v;#w;#_;#b;#S;#E;static unsafeExposeInternals(e){return{starts:e.#w,ttls:e.#_,sizes:e.#v,keyMap:e.#l,keyList:e.#c,valList:e.#u,next:e.#h,prev:e.#p,get head(){return e.#f},get tail(){return e.#y},free:e.#m,isBackgroundFetch:t=>e.#k(t),backgroundFetch:(t,r,a,i)=>e.#P(t,r,a,i),moveToTail:t=>e.#I(t),indexes:t=>e.#A(t),rindexes:t=>e.#O(t),isStale:t=>e.#T(t)}}get max(){return this.#t}get maxSize(){return this.#r}get calculatedSize(){return this.#d}get size(){return this.#s}get fetchMethod(){return this.#o}get memoMethod(){return this.#n}get dispose(){return this.#a}get disposeAfter(){return this.#i}constructor(e){let{max:t=0,ttl:r,ttlResolution:i=1,ttlAutopurge:n,updateAgeOnGet:s,updateAgeOnHas:u,allowStale:f,dispose:y,disposeAfter:m,noDisposeOnSet:g,noUpdateTTL:v,maxSize:w=0,maxEntrySize:_=0,sizeCalculation:b,fetchMethod:S,memoMethod:E,noDeleteOnFetchRejection:k,noDeleteOnStaleGet:P,allowStaleOnFetchRejection:I,allowStaleOnFetchAbort:A,ignoreFetchAbort:O}=e;if(0!==t&&!l(t))throw TypeError("max option must be a nonnegative integer");let T=t?c(t):Array;if(!T)throw Error("invalid max value: "+t);if(this.#t=t,this.#r=w,this.maxEntrySize=_||this.#r,this.sizeCalculation=b,this.sizeCalculation){if(!this.#r&&!this.maxEntrySize)throw TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if("function"!=typeof this.sizeCalculation)throw TypeError("sizeCalculation set to non-function")}if(void 0!==E&&"function"!=typeof E)throw TypeError("memoMethod must be a function if defined");if(this.#n=E,void 0!==S&&"function"!=typeof S)throw TypeError("fetchMethod must be a function if specified");if(this.#o=S,this.#S=!!S,this.#l=new Map,this.#c=Array(t).fill(void 0),this.#u=Array(t).fill(void 0),this.#h=new T(t),this.#p=new T(t),this.#f=0,this.#y=0,this.#m=h.create(t),this.#s=0,this.#d=0,"function"==typeof y&&(this.#a=y),"function"==typeof m?(this.#i=m,this.#g=[]):(this.#i=void 0,this.#g=void 0),this.#b=!!this.#a,this.#E=!!this.#i,this.noDisposeOnSet=!!g,this.noUpdateTTL=!!v,this.noDeleteOnFetchRejection=!!k,this.allowStaleOnFetchRejection=!!I,this.allowStaleOnFetchAbort=!!A,this.ignoreFetchAbort=!!O,0!==this.maxEntrySize){if(0!==this.#r&&!l(this.#r))throw TypeError("maxSize must be a positive integer if specified");if(!l(this.maxEntrySize))throw TypeError("maxEntrySize must be a positive integer if specified");this.#C()}if(this.allowStale=!!f,this.noDeleteOnStaleGet=!!P,this.updateAgeOnGet=!!s,this.updateAgeOnHas=!!u,this.ttlResolution=l(i)||0===i?i:1,this.ttlAutopurge=!!n,this.ttl=r||0,this.ttl){if(!l(this.ttl))throw TypeError("ttl must be a positive integer if specified");this.#j()}if(0===this.#t&&0===this.ttl&&0===this.#r)throw TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#t&&!this.#r){let e="LRU_CACHE_UNBOUNDED";d(e)&&(a.add(e),o("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",e,p))}}getRemainingTTL(e){return this.#l.has(e)?1/0:0}#j(){let e=new u(this.#t),t=new u(this.#t);this.#_=e,this.#w=t,this.#x=(a,i,o=r.now())=>{if(t[a]=0!==i?o:0,e[a]=i,0!==i&&this.ttlAutopurge){let e=setTimeout(()=>{this.#T(a)&&this.#R(this.#c[a],"expire")},i+1);e.unref&&e.unref()}},this.#D=a=>{t[a]=0!==e[a]?r.now():0},this.#z=(r,o)=>{if(e[o]){let n=e[o],s=t[o];if(!n||!s)return;r.ttl=n,r.start=s,r.now=a||i();let d=r.now-s;r.remainingTTL=n-d}};let a=0,i=()=>{let e=r.now();if(this.ttlResolution>0){a=e;let t=setTimeout(()=>a=0,this.ttlResolution);t.unref&&t.unref()}return e};this.getRemainingTTL=r=>{let o=this.#l.get(r);if(void 0===o)return 0;let n=e[o],s=t[o];return n&&s?n-((a||i())-s):1/0},this.#T=r=>{let o=t[r],n=e[r];return!!n&&!!o&&(a||i())-o>n}}#D=()=>{};#z=()=>{};#x=()=>{};#T=()=>!1;#C(){let e=new u(this.#t);this.#d=0,this.#v=e,this.#M=t=>{this.#d-=e[t],e[t]=0},this.#W=(e,t,r,a)=>{if(this.#k(t))return 0;if(!l(r)){if(a){if("function"!=typeof a)throw TypeError("sizeCalculation must be a function");if(!l(r=a(t,e)))throw TypeError("sizeCalculation return invalid (expect positive integer)")}else throw TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.")}return r},this.#J=(t,r,a)=>{if(e[t]=r,this.#r){let r=this.#r-e[t];for(;this.#d>r;)this.#K(!0)}this.#d+=e[t],a&&(a.entrySize=r,a.totalCalculatedSize=this.#d)}}#M=e=>{};#J=(e,t,r)=>{};#W=(e,t,r,a)=>{if(r||a)throw TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#A({allowStale:e=this.allowStale}={}){if(this.#s)for(let t=this.#y;this.#U(t)&&((e||!this.#T(t))&&(yield t),t!==this.#f);)t=this.#p[t]}*#O({allowStale:e=this.allowStale}={}){if(this.#s)for(let t=this.#f;this.#U(t)&&((e||!this.#T(t))&&(yield t),t!==this.#y);)t=this.#h[t]}#U(e){return void 0!==e&&this.#l.get(this.#c[e])===e}*entries(){for(let e of this.#A())void 0===this.#u[e]||void 0===this.#c[e]||this.#k(this.#u[e])||(yield[this.#c[e],this.#u[e]])}*rentries(){for(let e of this.#O())void 0===this.#u[e]||void 0===this.#c[e]||this.#k(this.#u[e])||(yield[this.#c[e],this.#u[e]])}*keys(){for(let e of this.#A()){let t=this.#c[e];void 0===t||this.#k(this.#u[e])||(yield t)}}*rkeys(){for(let e of this.#O()){let t=this.#c[e];void 0===t||this.#k(this.#u[e])||(yield t)}}*values(){for(let e of this.#A())void 0===this.#u[e]||this.#k(this.#u[e])||(yield this.#u[e])}*rvalues(){for(let e of this.#O())void 0===this.#u[e]||this.#k(this.#u[e])||(yield this.#u[e])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(e,t={}){for(let r of this.#A()){let a=this.#u[r],i=this.#k(a)?a.__staleWhileFetching:a;if(void 0!==i&&e(i,this.#c[r],this))return this.get(this.#c[r],t)}}forEach(e,t=this){for(let r of this.#A()){let a=this.#u[r],i=this.#k(a)?a.__staleWhileFetching:a;void 0!==i&&e.call(t,i,this.#c[r],this)}}rforEach(e,t=this){for(let r of this.#O()){let a=this.#u[r],i=this.#k(a)?a.__staleWhileFetching:a;void 0!==i&&e.call(t,i,this.#c[r],this)}}purgeStale(){let e=!1;for(let t of this.#O({allowStale:!0}))this.#T(t)&&(this.#R(this.#c[t],"expire"),e=!0);return e}info(e){let t=this.#l.get(e);if(void 0===t)return;let a=this.#u[t],i=this.#k(a)?a.__staleWhileFetching:a;if(void 0===i)return;let o={value:i};if(this.#_&&this.#w){let e=this.#_[t],a=this.#w[t];if(e&&a){let t=e-(r.now()-a);o.ttl=t,o.start=Date.now()}}return this.#v&&(o.size=this.#v[t]),o}dump(){let e=[];for(let t of this.#A({allowStale:!0})){let a=this.#c[t],i=this.#u[t],o=this.#k(i)?i.__staleWhileFetching:i;if(void 0===o||void 0===a)continue;let n={value:o};if(this.#_&&this.#w){n.ttl=this.#_[t];let e=r.now()-this.#w[t];n.start=Math.floor(Date.now()-e)}this.#v&&(n.size=this.#v[t]),e.unshift([a,n])}return e}load(e){for(let[t,a]of(this.clear(),e)){if(a.start){let e=Date.now()-a.start;a.start=r.now()-e}this.set(t,a.value,a)}}set(e,t,r={}){if(void 0===t)return this.delete(e),this;let{ttl:a=this.ttl,start:i,noDisposeOnSet:o=this.noDisposeOnSet,sizeCalculation:n=this.sizeCalculation,status:s}=r,{noUpdateTTL:d=this.noUpdateTTL}=r,l=this.#W(e,t,r.size||0,n);if(this.maxEntrySize&&l>this.maxEntrySize)return s&&(s.set="miss",s.maxEntrySizeExceeded=!0),this.#R(e,"set"),this;let c=0===this.#s?void 0:this.#l.get(e);if(void 0===c)c=0===this.#s?this.#y:0!==this.#m.length?this.#m.pop():this.#s===this.#t?this.#K(!1):this.#s,this.#c[c]=e,this.#u[c]=t,this.#l.set(e,c),this.#h[this.#y]=c,this.#p[c]=this.#y,this.#y=c,this.#s++,this.#J(c,l,s),s&&(s.set="add"),d=!1;else{this.#I(c);let r=this.#u[c];if(t!==r){if(this.#S&&this.#k(r)){r.__abortController.abort(Error("replaced"));let{__staleWhileFetching:t}=r;void 0!==t&&!o&&(this.#b&&this.#a?.(t,e,"set"),this.#E&&this.#g?.push([t,e,"set"]))}else!o&&(this.#b&&this.#a?.(r,e,"set"),this.#E&&this.#g?.push([r,e,"set"]));if(this.#M(c),this.#J(c,l,s),this.#u[c]=t,s){s.set="replace";let e=r&&this.#k(r)?r.__staleWhileFetching:r;void 0!==e&&(s.oldValue=e)}}else s&&(s.set="update")}if(0===a||this.#_||this.#j(),this.#_&&(d||this.#x(c,a,i),s&&this.#z(s,c)),!o&&this.#E&&this.#g){let e;let t=this.#g;for(;e=t?.shift();)this.#i?.(...e)}return this}pop(){try{for(;this.#s;){let e=this.#u[this.#f];if(this.#K(!0),this.#k(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(void 0!==e)return e}}finally{if(this.#E&&this.#g){let e;let t=this.#g;for(;e=t?.shift();)this.#i?.(...e)}}}#K(e){let t=this.#f,r=this.#c[t],a=this.#u[t];return this.#S&&this.#k(a)?a.__abortController.abort(Error("evicted")):(this.#b||this.#E)&&(this.#b&&this.#a?.(a,r,"evict"),this.#E&&this.#g?.push([a,r,"evict"])),this.#M(t),e&&(this.#c[t]=void 0,this.#u[t]=void 0,this.#m.push(t)),1===this.#s?(this.#f=this.#y=0,this.#m.length=0):this.#f=this.#h[t],this.#l.delete(r),this.#s--,t}has(e,t={}){let{updateAgeOnHas:r=this.updateAgeOnHas,status:a}=t,i=this.#l.get(e);if(void 0!==i){let e=this.#u[i];if(this.#k(e)&&void 0===e.__staleWhileFetching)return!1;if(!this.#T(i))return r&&this.#D(i),a&&(a.has="hit",this.#z(a,i)),!0;a&&(a.has="stale",this.#z(a,i))}else a&&(a.has="miss");return!1}peek(e,t={}){let{allowStale:r=this.allowStale}=t,a=this.#l.get(e);if(void 0===a||!r&&this.#T(a))return;let i=this.#u[a];return this.#k(i)?i.__staleWhileFetching:i}#P(e,t,r,a){let i=void 0===t?void 0:this.#u[t];if(this.#k(i))return i;let o=new n,{signal:s}=r;s?.addEventListener("abort",()=>o.abort(s.reason),{signal:o.signal});let d={signal:o.signal,options:r,context:a},l=(a,i=!1)=>{let{aborted:n}=o.signal,s=r.ignoreFetchAbort&&void 0!==a;return(r.status&&(n&&!i?(r.status.fetchAborted=!0,r.status.fetchError=o.signal.reason,s&&(r.status.fetchAbortIgnored=!0)):r.status.fetchResolved=!0),!n||s||i)?(this.#u[t]===u&&(void 0===a?u.__staleWhileFetching?this.#u[t]=u.__staleWhileFetching:this.#R(e,"fetch"):(r.status&&(r.status.fetchUpdated=!0),this.set(e,a,d.options))),a):c(o.signal.reason)},c=a=>{let{aborted:i}=o.signal,n=i&&r.allowStaleOnFetchAbort,s=n||r.allowStaleOnFetchRejection,d=s||r.noDeleteOnFetchRejection;if(this.#u[t]!==u||(d&&void 0!==u.__staleWhileFetching?n||(this.#u[t]=u.__staleWhileFetching):this.#R(e,"fetch")),s)return r.status&&void 0!==u.__staleWhileFetching&&(r.status.returnedStale=!0),u.__staleWhileFetching;if(u.__returned===u)throw a};r.status&&(r.status.fetchDispatched=!0);let u=new Promise((t,a)=>{let n=this.#o?.(e,i,d);n&&n instanceof Promise&&n.then(e=>t(void 0===e?void 0:e),a),o.signal.addEventListener("abort",()=>{(!r.ignoreFetchAbort||r.allowStaleOnFetchAbort)&&(t(void 0),r.allowStaleOnFetchAbort&&(t=e=>l(e,!0)))})}).then(l,e=>(r.status&&(r.status.fetchRejected=!0,r.status.fetchError=e),c(e))),h=Object.assign(u,{__abortController:o,__staleWhileFetching:i,__returned:void 0});return void 0===t?(this.set(e,h,{...d.options,status:void 0}),t=this.#l.get(e)):this.#u[t]=h,h}#k(e){return!!this.#S&&!!e&&e instanceof Promise&&e.hasOwnProperty("__staleWhileFetching")&&e.__abortController instanceof n}async fetch(e,t={}){let{allowStale:r=this.allowStale,updateAgeOnGet:a=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,ttl:o=this.ttl,noDisposeOnSet:n=this.noDisposeOnSet,size:s=0,sizeCalculation:d=this.sizeCalculation,noUpdateTTL:l=this.noUpdateTTL,noDeleteOnFetchRejection:c=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:u=this.allowStaleOnFetchRejection,ignoreFetchAbort:h=this.ignoreFetchAbort,allowStaleOnFetchAbort:p=this.allowStaleOnFetchAbort,context:f,forceRefresh:y=!1,status:m,signal:g}=t;if(!this.#S)return m&&(m.fetch="get"),this.get(e,{allowStale:r,updateAgeOnGet:a,noDeleteOnStaleGet:i,status:m});let v={allowStale:r,updateAgeOnGet:a,noDeleteOnStaleGet:i,ttl:o,noDisposeOnSet:n,size:s,sizeCalculation:d,noUpdateTTL:l,noDeleteOnFetchRejection:c,allowStaleOnFetchRejection:u,allowStaleOnFetchAbort:p,ignoreFetchAbort:h,status:m,signal:g},w=this.#l.get(e);if(void 0===w){m&&(m.fetch="miss");let t=this.#P(e,w,v,f);return t.__returned=t}{let t=this.#u[w];if(this.#k(t)){let e=r&&void 0!==t.__staleWhileFetching;return m&&(m.fetch="inflight",e&&(m.returnedStale=!0)),e?t.__staleWhileFetching:t.__returned=t}let i=this.#T(w);if(!y&&!i)return m&&(m.fetch="hit"),this.#I(w),a&&this.#D(w),m&&this.#z(m,w),t;let o=this.#P(e,w,v,f),n=void 0!==o.__staleWhileFetching&&r;return m&&(m.fetch=i?"stale":"refresh",n&&i&&(m.returnedStale=!0)),n?o.__staleWhileFetching:o.__returned=o}}async forceFetch(e,t={}){let r=await this.fetch(e,t);if(void 0===r)throw Error("fetch() returned undefined");return r}memo(e,t={}){let r=this.#n;if(!r)throw Error("no memoMethod provided to constructor");let{context:a,forceRefresh:i,...o}=t,n=this.get(e,o);if(!i&&void 0!==n)return n;let s=r(e,n,{options:o,context:a});return this.set(e,s,o),s}get(e,t={}){let{allowStale:r=this.allowStale,updateAgeOnGet:a=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,status:o}=t,n=this.#l.get(e);if(void 0!==n){let t=this.#u[n],s=this.#k(t);return(o&&this.#z(o,n),this.#T(n))?(o&&(o.get="stale"),s)?(o&&r&&void 0!==t.__staleWhileFetching&&(o.returnedStale=!0),r?t.__staleWhileFetching:void 0):(i||this.#R(e,"expire"),o&&r&&(o.returnedStale=!0),r?t:void 0):(o&&(o.get="hit"),s)?t.__staleWhileFetching:(this.#I(n),a&&this.#D(n),t)}o&&(o.get="miss")}#L(e,t){this.#p[t]=e,this.#h[e]=t}#I(e){e!==this.#y&&(e===this.#f?this.#f=this.#h[e]:this.#L(this.#p[e],this.#h[e]),this.#L(this.#y,e),this.#y=e)}delete(e){return this.#R(e,"delete")}#R(e,t){let r=!1;if(0!==this.#s){let a=this.#l.get(e);if(void 0!==a){if(r=!0,1===this.#s)this.#Z(t);else{this.#M(a);let r=this.#u[a];if(this.#k(r)?r.__abortController.abort(Error("deleted")):(this.#b||this.#E)&&(this.#b&&this.#a?.(r,e,t),this.#E&&this.#g?.push([r,e,t])),this.#l.delete(e),this.#c[a]=void 0,this.#u[a]=void 0,a===this.#y)this.#y=this.#p[a];else if(a===this.#f)this.#f=this.#h[a];else{let e=this.#p[a];this.#h[e]=this.#h[a];let t=this.#h[a];this.#p[t]=this.#p[a]}this.#s--,this.#m.push(a)}}}if(this.#E&&this.#g?.length){let e;let t=this.#g;for(;e=t?.shift();)this.#i?.(...e)}return r}clear(){return this.#Z("delete")}#Z(e){for(let t of this.#O({allowStale:!0})){let r=this.#u[t];if(this.#k(r))r.__abortController.abort(Error("deleted"));else{let a=this.#c[t];this.#b&&this.#a?.(r,a,e),this.#E&&this.#g?.push([r,a,e])}}if(this.#l.clear(),this.#u.fill(void 0),this.#c.fill(void 0),this.#_&&this.#w&&(this.#_.fill(0),this.#w.fill(0)),this.#v&&this.#v.fill(0),this.#f=0,this.#y=0,this.#m.length=0,this.#d=0,this.#s=0,this.#E&&this.#g){let e;let t=this.#g;for(;e=t?.shift();)this.#i?.(...e)}}}t.LRUCache=p}};