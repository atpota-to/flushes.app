(()=>{var e={};e.id=826,e.ids=[826],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},72254:e=>{"use strict";e.exports=require("node:buffer")},6005:e=>{"use strict";e.exports=require("node:crypto")},15673:e=>{"use strict";e.exports=require("node:events")},88849:e=>{"use strict";e.exports=require("node:http")},22286:e=>{"use strict";e.exports=require("node:https")},47261:e=>{"use strict";e.exports=require("node:util")},76211:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>a.a,__next_app__:()=>f,originalPathname:()=>u,pages:()=>c,routeModule:()=>h,tree:()=>d}),r(7488),r(20357),r(35866);var s=r(23191),o=r(88716),n=r(37922),a=r.n(n),i=r(95231),l={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>i[e]);r.d(t,l);let d=["",{children:["feed",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,7488)),"/Users/dame/Library/Mobile Documents/com~apple~CloudDocs/Software/flushes/app/src/app/feed/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,20357)),"/Users/dame/Library/Mobile Documents/com~apple~CloudDocs/Software/flushes/app/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/dame/Library/Mobile Documents/com~apple~CloudDocs/Software/flushes/app/src/app/feed/page.tsx"],u="/feed/page",f={require:r,loadChunk:()=>Promise.resolve()},h=new s.AppPageRouteModule({definition:{kind:o.x.APP_PAGE,page:"/feed/page",pathname:"/feed",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},5245:(e,t,r)=>{Promise.resolve().then(r.bind(r,88603))},88603:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var s=r(10326),o=r(17577),n=r(90434),a=r(36825),i=r.n(a),l=r(78396),d=r(99153);function c(){let[e,t]=(0,o.useState)([]),[r,a]=(0,o.useState)(!0),[c,u]=(0,o.useState)(null),{isAuthenticated:f,handle:h}=(0,d.a)(),p=async(e=!1)=>{try{a(!0),u(null);let r=await fetch(e?"/api/bluesky/feed?refresh=true":"/api/bluesky/feed",{cache:"no-store",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});if(!r.ok)throw Error(`Failed to fetch feed: ${r.status}`);let s=await r.json();t(s.entries)}catch(e){console.error("Error fetching feed:",e),u(e.message||"Failed to load feed")}finally{a(!1)}},_=async()=>{try{let r=document.getElementById("load-more-button"),s=r?.getBoundingClientRect();a(!0),u(null);let o=e[e.length-1];if(!o)return;let n=`/api/bluesky/feed?before=${o.id}`,i=await fetch(n,{cache:"no-store",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});if(!i.ok)throw Error(`Failed to fetch older entries: ${i.status}`);let l=await i.json();l.entries&&l.entries.length>0&&(document.body.scrollHeight,t(e=>[...e,...l.entries]),s&&requestAnimationFrame(()=>{let e=document.getElementById("load-more-button");if(e){let t=e.getBoundingClientRect(),r=window.scrollY+(t.top-s.top);window.scrollTo({top:r,behavior:"instant"})}}))}catch(e){console.error("Error fetching older entries:",e),u(e.message||"Failed to load older entries")}finally{a(!1)}};return(0,s.jsxs)("div",{className:i().container,children:[(0,s.jsxs)("header",{className:i().header,children:[s.jsx("h1",{children:"Flushing Feed"}),s.jsx("p",{className:i().subtitle,children:"See what everyone is doing in the bathroom right now"})]}),(0,s.jsxs)("div",{className:i().controls,children:[s.jsx("button",{onClick:()=>p(!0),className:i().refreshButton,disabled:r,children:r?"Loading...":"Refresh Feed"}),s.jsx(n.default,{href:"/",className:i().homeLink,children:"Go to Dashboard"})]}),c&&(0,s.jsxs)("div",{className:i().error,children:["Error: ",c]}),r&&(0,s.jsxs)("div",{className:i().loadingContainer,children:[s.jsx("div",{className:i().loader}),s.jsx("p",{children:"Loading latest entries..."})]}),s.jsx("div",{className:i().feedList,children:e.length>0?(0,s.jsxs)(s.Fragment,{children:[e.map(e=>(0,s.jsxs)("div",{className:i().feedItem,children:[(0,s.jsxs)("div",{className:i().feedHeader,children:[(0,s.jsxs)("a",{href:`https://bsky.app/profile/${e.authorHandle}`,target:"_blank",rel:"noopener noreferrer",className:i().authorLink,children:["@",e.authorHandle]}),s.jsx("span",{className:i().timestamp,children:(0,l.S)(e.createdAt)})]}),(0,s.jsxs)("div",{className:i().content,children:[s.jsx("span",{className:i().emoji,children:e.emoji}),s.jsx("span",{className:i().text,children:e.text.length>60?`${e.text.substring(0,60)}...`:e.text})]})]},e.id)),(0,s.jsxs)("button",{className:i().loadMoreButton,id:"load-more-button",onClick:e=>{e.preventDefault(),_()},disabled:r,children:[r?"Loading...":"Load older flushes",!r&&(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("polyline",{points:"7 13 12 18 17 13"}),s.jsx("polyline",{points:"7 6 12 11 17 6"})]})]})]}):r?null:(0,s.jsxs)("div",{className:i().emptyState,children:[s.jsx("p",{children:"No entries found. Be the first to share your status!"}),s.jsx(n.default,{href:"/",className:i().createButton,children:"Create Status"})]})})]})}},78396:(e,t,r)=>{"use strict";function s(e){if(!e)return"";let t=new Date(e),r=Math.floor((new Date().getTime()-t.getTime())/1e3);if(r<60)return"just now";let s=Math.floor(r/60);if(s<60)return`${s}m ago`;let o=Math.floor(s/60);if(o<24)return`${o}h ago`;let n=Math.floor(o/24);if(n<7)return`${n}d ago`;let a=Math.floor(n/7);return a<5?`${a}w ago`:t.toLocaleDateString()}r.d(t,{S:()=>s})},36825:e=>{e.exports={container:"feed_container__nG1tI",header:"feed_header__4_ZHf",subtitle:"feed_subtitle__rTQWA",controls:"feed_controls__U5avg",refreshButton:"feed_refreshButton__7Bdqy",homeLink:"feed_homeLink__J_o_Z",error:"feed_error___6sQj",notice:"feed_notice__N9Fj6",noticePersonal:"feed_noticePersonal__EftxR",noticeLink:"feed_noticeLink__wkIBT",loadingContainer:"feed_loadingContainer__VS_Xq",loader:"feed_loader__BiqH5",spin:"feed_spin__G11M7",feedList:"feed_feedList___nxgR",feedItem:"feed_feedItem__c4y8q",feedHeader:"feed_feedHeader__5crAs",authorLink:"feed_authorLink____B3_",timestamp:"feed_timestamp__MUllz",content:"feed_content__9vYaL",emoji:"feed_emoji__yR154",text:"feed_text__6Ecm4",emptyState:"feed_emptyState__m_gzq",loadMoreButton:"feed_loadMoreButton__ax_9T",createButton:"feed_createButton__5Dkqy"}},7488:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(68570).createProxy)(String.raw`/Users/dame/Library/Mobile Documents/com~apple~CloudDocs/Software/flushes/app/src/app/feed/page.tsx#default`)}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,32,568],()=>r(76211));module.exports=s})();