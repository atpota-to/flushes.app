(()=>{var e={};e.id=931,e.ids=[931],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},72254:e=>{"use strict";e.exports=require("node:buffer")},6005:e=>{"use strict";e.exports=require("node:crypto")},15673:e=>{"use strict";e.exports=require("node:events")},88849:e=>{"use strict";e.exports=require("node:http")},22286:e=>{"use strict";e.exports=require("node:https")},47261:e=>{"use strict";e.exports=require("node:util")},25622:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>o.a,__next_app__:()=>p,originalPathname:()=>c,pages:()=>d,routeModule:()=>h,tree:()=>u}),s(35480),s(20357),s(35866);var r=s(23191),a=s(88716),n=s(37922),o=s.n(n),i=s(95231),l={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>i[e]);s.d(t,l);let u=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,35480)),"/Users/dame/Library/Mobile Documents/com~apple~CloudDocs/Software/flushes/app/src/app/page.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,20357)),"/Users/dame/Library/Mobile Documents/com~apple~CloudDocs/Software/flushes/app/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/dame/Library/Mobile Documents/com~apple~CloudDocs/Software/flushes/app/src/app/page.tsx"],c="/page",p={require:s,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:u}})},91721:(e,t,s)=>{Promise.resolve().then(s.bind(s,54497))},54497:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p});var r=s(10326),a=s(17577),n=s(90434),o=s(35047),i=s(55419),l=s.n(i),u=s(99153),d=s(29830),c=s(78396);function p(){(0,o.useRouter)();let{isAuthenticated:e,session:t,signOut:i}=(0,u.a)(),p=t?.sub,[h,g]=(0,a.useState)("is "),[m,_]=(0,a.useState)("\uD83D\uDEBD"),[D,f]=(0,a.useState)(!1),[x,b]=(0,a.useState)(!1),[j,E]=(0,a.useState)(null),[w,v]=(0,a.useState)(null),[y,C]=(0,a.useState)([]),[N,$]=(0,a.useState)(!0),[k,L]=(0,a.useState)(null),[S,A]=(0,a.useState)(new Set),P=e=>{_(e)},B=()=>{if("did:plc:fouf3svmcxzn6bpiw3lgwz22"===p)return console.log("Plumber account detected - bypassing rate limits"),!0;let e=Date.now()-18e5;return y.filter(t=>t.authorDid===p&&new Date(t.createdAt).getTime()>e).length<2},F=async r=>{if(r.preventDefault(),!t||!e){E("Please sign in to post a flush");return}if(h&&(0,d.Lt)(h)){E("Uh oh, looks like you have a potty mouth. Try flushing again, but go a bit easier on the language please... this is a semi-family-friendly restroom");return}if(!B()){E("Trying to make more than 2 flushes in 30 minutes?? Might be time to get the plunger. \uD83E\uDEA0 Regular users are limited to 2 flushes per 30 minutes.");return}b(!0),E(null),v(null);try{let{createPost:e}=await s.e(2).then(s.bind(s,73002)),r=h.trim();r&&"is"!==r?r.toLowerCase().startsWith("is ")||(r=`is ${r}`):r="is flushing";let a=`Someone ${r} ${m}`,n=await e(t,{text:a,langs:["en"]});console.log("Status update result:",n),g("is "),v("Your flushing status has been updated!"),setTimeout(()=>{f(!1)},2e3),setTimeout(()=>{console.log("Refreshing feed to show new entry..."),I(!0)},2500)}catch(e){console.error("Failed to update status:",e),E(`Failed to update status: ${e.message||"Unknown error"}`)}finally{b(!1)}},I=async(e=!1)=>{try{$(!0),L(null);let t=Date.now(),s=e?`/api/bluesky/feed-simple?refresh=true&_t=${t}`:`/api/bluesky/feed-simple?_t=${t}`;console.log(`Fetching feed from ${s} at ${new Date().toISOString()}`);let r=await fetch(s,{method:"GET",cache:"no-store",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});if(!r.ok)throw Error(`Failed to fetch feed: ${r.status}`);let a=await r.json();if(console.log(`Received ${a.entries?.length||0} entries from API`),a.entries&&a.entries.length>0){console.log("Latest entries from API:");for(let e=0;e<Math.min(3,a.entries.length);e++){let t=a.entries[e];console.log(`  ${e+1}. ID: ${t.id}, Handle: @${t.authorHandle}, Text: "${t.text.substring(0,20)}..."`)}}if(y.length>0){let e=new Set(y.map(e=>e.id)),t=a.entries.filter(t=>!e.has(t.id));t.length>0?(console.log(`Found ${t.length} new entries`),A(new Set(t.map(e=>e.id))),setTimeout(()=>{A(new Set)},2e3)):console.log("No new entries found in this update")}C(a.entries)}catch(e){console.error("Error fetching feed:",e),L(e.message||"Failed to load feed")}finally{$(!1)}},T=async()=>{try{let e=window.scrollY;$(!0),L(null);let t=y[y.length-1];if(!t)return;console.log(`Loading older entries before ID ${t.id}`);let s=`/api/bluesky/feed-simple?before=${t.id}&_t=${Date.now()}`,r=await fetch(s,{cache:"no-store",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});if(!r.ok)throw Error(`Failed to fetch older entries: ${r.status}`);let a=await r.json();if(a.entries&&a.entries.length>0){console.log(`Loaded ${a.entries.length} older entries`);for(let e=0;e<Math.min(3,a.entries.length);e++){let t=a.entries[e];console.log(`  Older ${e+1}. ID: ${t.id}, Handle: @${t.authorHandle}, Text: "${t.text.substring(0,20)}..."`)}C([...y,...a.entries]),setTimeout(()=>{window.scrollTo({top:e,behavior:"instant"})},0)}else console.log("No older entries found")}catch(e){console.error("Error fetching older entries:",e),L(e.message||"Failed to load older entries")}finally{$(!1)}};return(0,r.jsxs)("div",{className:l().container,children:[r.jsx("header",{className:l().header,children:(0,r.jsxs)("div",{className:l().headerContent,children:[r.jsx("h1",{className:l().tagline,children:"The Decentralized Toilet Network of Planet Earth & Simulation 12B"}),r.jsx("p",{className:l().description,children:'Share a "flush" whenever you\'re in the bathroom.'}),(0,r.jsxs)("p",{className:l().donateText,children:["Like the app? Donate to ",r.jsx("a",{href:"https://ko-fi.com/dameis",target:"_blank",rel:"noopener noreferrer",className:l().kofiLink,children:"our toilet paper fund"}),"."]}),(0,r.jsxs)("p",{className:l().creditLine,children:["Made by ",r.jsx("a",{href:"https://bsky.app/profile/dame.is",target:"_blank",rel:"noopener noreferrer",children:"@dame.is"})," and ",r.jsx("a",{href:"https://bsky.app/profile/atpota.to",target:"_blank",rel:"noopener noreferrer",children:"@atpota.to"})]})]})}),e&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("button",{className:`${l().toggleButton} ${D?l().toggleButtonActive:""}`,onClick:()=>{f(!D),E(null),v(null)},children:[D?"Close":"Update your status",r.jsx("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:r.jsx("path",{d:"M19 9L12 16L5 9",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]}),r.jsx("div",{className:`${l().statusUpdateContainer} ${D?l().statusUpdateOpen:""}`,children:(0,r.jsxs)("div",{className:l().card,children:[j&&r.jsx("div",{className:l().error,children:j}),w&&r.jsx("div",{className:l().success,children:w}),(0,r.jsxs)("form",{onSubmit:F,className:l().form,children:[(0,r.jsxs)("div",{className:l().formGroup,children:[r.jsx("label",{children:"Select an emoji for your status"}),r.jsx("div",{className:l().emojiGrid,children:["\uD83D\uDEBD","\uD83E\uDDFB","\uD83D\uDCA9","\uD83D\uDCA8","\uD83D\uDEBE","\uD83E\uDDFC","\uD83E\uDEA0","\uD83D\uDEBB","\uD83E\uDE78","\uD83D\uDCA7","\uD83D\uDCA6","\uD83D\uDE0C","\uD83D\uDE23","\uD83E\uDD22","\uD83E\uDD2E","\uD83E\uDD74","\uD83D\uDE2E‍\uD83D\uDCA8","\uD83D\uDE33","\uD83D\uDE35","\uD83C\uDF3E","\uD83C\uDF66","\uD83D\uDCF1","\uD83D\uDCD6","\uD83D\uDCAD","1️⃣","2️⃣","\uD83D\uDFE1","\uD83D\uDFE4"].map(e=>r.jsx("button",{type:"button",className:`${l().emojiButton} ${e===m?l().selectedEmoji:""}`,onClick:()=>P(e),disabled:x,"aria-label":`Select emoji ${e}`,children:e},e))})]}),(0,r.jsxs)("div",{className:l().formGroup,children:[r.jsx("label",{htmlFor:"status",children:"What's your status? (optional)"}),(0,r.jsxs)("div",{className:l().inputWrapper,children:[r.jsx("span",{className:l().inputPrefix,children:"is "}),r.jsx("input",{type:"text",id:"status",value:h.startsWith("is ")?h.substring(3):h,onChange:e=>g(`is ${e.target.value}`),placeholder:"flushing",maxLength:56,className:l().inputWithPrefix,disabled:x})]}),(0,r.jsxs)("div",{className:l().charCount,children:[h.length,"/59"]})]}),r.jsx("button",{type:"submit",className:l().submitButton,disabled:x,children:x?"Flushing...":"Post Flush"})]})]})})]}),(0,r.jsxs)("div",{className:l().feedSection,children:[(0,r.jsxs)("div",{className:l().feedHeader,children:[(0,r.jsxs)("div",{className:l().feedHeaderLeft,children:[r.jsx("h2",{children:"Recent flushes"}),r.jsx("p",{className:l().feedSubheader,children:"Click on a username to see their flushes profile."})]}),r.jsx("button",{onClick:async()=>{try{$(!0),L(null);let e=Date.now(),t=`/api/bluesky/feed-simple?refresh=true&_t=${e}`;console.log(`🔄 MANUAL REFRESH @ ${new Date().toISOString()}`),console.log(`Using simple API URL: ${t}`);let s=await fetch(t,{method:"GET",cache:"no-store",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0","X-Force-Fresh-Data":"true"}});if(!s.ok)throw console.error(`API error: ${s.status}, ${s.statusText}`),Error(`API error: ${s.status}`);console.log("Response headers:",Object.fromEntries(s.headers.entries()));let r=await s.json();if(console.log(`Refresh received ${r.entries?.length||0} entries`),r.entries&&r.entries.length>0){console.log(`🔍 Highest ID from refresh: ${r.entries[0].id}`);for(let e=0;e<Math.min(5,r.entries.length);e++)console.log(`  ${e+1}. ID: ${r.entries[e].id}, Handle: @${r.entries[e].authorHandle}, Text: "${r.entries[e].text.substring(0,20)}..."`);if(y.length>0){let e=y[0].id,t=r.entries[0].id;console.log(`📊 Comparison - Current highest ID: ${e}, New highest ID: ${t}`),t>e?console.log("✅ Refresh successful! New entries are more recent."):t===e?console.log("⚠️ Refresh returned same highest ID - no newer entries available."):console.warn("❌ WARNING: New entries have lower IDs than existing ones!")}}else console.log("No entries returned from refresh");C(r.entries||[])}catch(e){console.error("Manual refresh error:",e),L("Failed to refresh. Try again.")}finally{$(!1)}},className:l().refreshButton,disabled:N,children:N?"Loading...":"Refresh"})]}),k&&r.jsx("div",{className:l().error,children:k}),y&&y.length>0&&r.jsx("div",{className:l().debugInfo,style:{fontSize:"10px",color:"#666",margin:"5px 0",display:"none"},children:(0,r.jsxs)("p",{children:["Debug: Latest entry ID: ",y[0].id,", Count: ",y.length]})}),N?(0,r.jsxs)("div",{className:l().loadingContainer,children:[r.jsx("div",{className:l().loader}),r.jsx("p",{children:"Loading latest entries..."})]}):r.jsx("div",{className:l().feedList,children:y.length>0?(()=>{let e=y.filter(e=>(0,d.$B)(e.emoji));return e.length>0?(0,r.jsxs)(r.Fragment,{children:[e.map(e=>r.jsx("div",{className:`${l().feedItem} ${S.has(e.id)?l().newFeedItem:""}`,children:(0,r.jsxs)("div",{className:l().content,children:[(0,r.jsxs)("div",{className:l().contentLeft,children:[r.jsx("span",{className:l().emoji,children:e.emoji}),(0,r.jsxs)(n.default,{href:`/profile/${e.authorHandle}`,className:l().authorLink,children:["@",e.authorHandle]}),r.jsx("span",{className:l().text,children:e.text?e.authorHandle&&e.authorHandle.endsWith(".is")&&(0,d.oO)(e.text).toLowerCase().startsWith("is ")?e.text.length>63?`${(0,d.oO)(e.text.substring(3,63))}...`:(0,d.oO)(e.text.substring(3)):e.text.length>60?`${(0,d.oO)(e.text.substring(0,60))}...`:(0,d.oO)(e.text):e.authorHandle&&e.authorHandle.endsWith(".is")?"flushing":"is flushing"})]}),r.jsx("span",{className:l().timestamp,children:(0,c.S)(e.createdAt)})]})},e.id)),(0,r.jsxs)("button",{className:l().loadMoreButton,onClick:e=>{e.preventDefault(),T()},disabled:N,children:[N?"Loading...":"Load older flushes",!N&&(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("polyline",{points:"7 13 12 18 17 13"}),r.jsx("polyline",{points:"7 6 12 11 17 6"})]})]})]}):r.jsx("div",{className:l().emptyState,children:r.jsx("p",{children:"No valid entries found. Login and be the first to share your status!"})})})():r.jsx("div",{className:l().emptyState,children:r.jsx("p",{children:"No entries found. Login and be the first to share your status!"})})})]})]})}},29830:(e,t,s)=>{"use strict";s.d(t,{$B:()=>i,Lt:()=>n,oO:()=>o});let r=["slur","racist","bigot","bigotry","homophobic","transphobic","fuck","damn","ass","asshole","bitch","kill","murder","attack","violence","harm","hurt","retard","retarded","idiot","stupid","dumb","penis","vagina","dick","cock","pussy","sex","masturbate","orgasm","horny","erection","blowjob","handjob","viagra","cialis","enlarge","cryptocurrency","bitcoin","ethereum","make money","get rich","earn fast","pyramid","scheme","discord.gg","telegram.me"],a=[/\bc[hH][iIl1][nN][kKsS]?\b/,/\bc[oO]{2}[nN][sS]?\b/,/\bf[aA][gG]{1,2}([oOeE][tT]?|[iIyY][nNeE]?)?s?\b/,/\bk[iIyY][kK][eE][sS]?\b/,/\bn[iIl1oO][gG]{2}([aAeE][rR]?|[lL][eE][tT]|[nNoO][gG])?s?\b/,/\bn[iIl1oO][gG]{2}[aAeE][sS]\b/,/\bt[rR][aA][nN][nN][iIyY][eE]?[sS]?\b/];function n(e){if(!e)return!1;let t=e.toLowerCase().replace(/0/g,"o").replace(/1/g,"i").replace(/3/g,"e").replace(/4/g,"a").replace(/5/g,"s").replace(/\$/g,"s").replace(/@/g,"a").replace(/!/g,"i").replace(/\*/g,"").replace(/\./g,"").replace(/-/g,"").replace(/_/g,"").replace(/\s+/g," ");for(let t of a)if(t.test(e))return!0;return r.some(e=>{if(RegExp(`\\b${e}\\b`,"i").test(t))return!0;let s=e.split("").join("\\s*");return!!RegExp(`\\b${s}\\b`,"i").test(t)||e.length<=4&&RegExp(e,"i").test(t)})}function o(e){if(!e)return e;let t=e;return r.forEach(e=>{let s=RegExp(`\\b${e}\\b`,"gi");t=t.replace(s,"*".repeat(e.length))}),r.forEach(e=>{if(e.length>2){let s=e.split("").join("\\s*"),r=RegExp(`\\b${s}\\b`,"gi");t=t.replace(r,e=>"*".repeat(e.replace(/\s+/g,"").length))}}),r.filter(e=>e.length<=4).forEach(e=>{let s=RegExp(`(?<!\\w)${e}(?!\\w)`,"gi");t=t.replace(s,"*".repeat(e.length))}),t}function i(e){return["\uD83D\uDEBD","\uD83E\uDDFB","\uD83D\uDCA9","\uD83D\uDCA8","\uD83D\uDEBE","\uD83E\uDDFC","\uD83E\uDEA0","\uD83D\uDEBB","\uD83E\uDE78","\uD83D\uDCA7","\uD83D\uDCA6","\uD83D\uDE0C","\uD83D\uDE23","\uD83E\uDD22","\uD83E\uDD2E","\uD83E\uDD74","\uD83D\uDE2E‍\uD83D\uDCA8","\uD83D\uDE33","\uD83D\uDE35","\uD83C\uDF3E","\uD83C\uDF66","\uD83D\uDCF1","\uD83D\uDCD6","\uD83D\uDCAD","1️⃣","2️⃣","\uD83D\uDFE1","\uD83D\uDFE4"].includes(e)}},78396:(e,t,s)=>{"use strict";function r(e){if(!e)return"";let t=new Date(e),s=Math.floor((new Date().getTime()-t.getTime())/1e3);if(s<60)return"just now";let r=Math.floor(s/60);if(r<60)return`${r}m ago`;let a=Math.floor(r/60);if(a<24)return`${a}h ago`;let n=Math.floor(a/24);if(n<7)return`${n}d ago`;let o=Math.floor(n/7);return o<5?`${o}w ago`:t.toLocaleDateString()}s.d(t,{S:()=>r})},55419:e=>{e.exports={container:"page_container__aoG4z",header:"page_header__kVzhN",headerContent:"page_headerContent__bPi_q",tagline:"page_tagline___8E6T",description:"page_description__86bsR",donateText:"page_donateText__y1qOw",creditLine:"page_creditLine__KP9GN",kofiLink:"page_kofiLink__3Ydr6",userInfo:"page_userInfo__EuccZ",logoutButton:"page_logoutButton__K4PKs",loginButton:"page_loginButton__KoiDv",statusUpdateContainer:"page_statusUpdateContainer__gmQ6p",statusUpdateOpen:"page_statusUpdateOpen__OjVrc",toggleButton:"page_toggleButton__8cAdz",toggleButtonActive:"page_toggleButtonActive__yVpt8",card:"page_card__QV0Om",form:"page_form__Ou5d6",formGroup:"page_formGroup__z71No",emojiNote:"page_emojiNote__EC6g5",input:"page_input___cVLA",inputWrapper:"page_inputWrapper__ApSA2",inputPrefix:"page_inputPrefix__80yQZ",inputWithPrefix:"page_inputWithPrefix__1V0o8",charCount:"page_charCount__pvQ1F",emojiGrid:"page_emojiGrid__OJb8z",emojiButton:"page_emojiButton__MpF11",selectedEmoji:"page_selectedEmoji__RwgbL",preview:"page_preview__ltt8S",previewTitle:"page_previewTitle__q11Le",previewContent:"page_previewContent__rZ9k8",previewEmoji:"page_previewEmoji__EYnc0",submitButton:"page_submitButton__6O8qB",success:"page_success__Xb9nl",feedSection:"page_feedSection__KCj_s",newFeedItem:"page_newFeedItem__k_9xP",slideIn:"page_slideIn__TYhrx",feedHeader:"page_feedHeader__Qudm2",feedHeaderLeft:"page_feedHeaderLeft__Oj10v",feedSubheader:"page_feedSubheader__LTbXG",statsLink:"page_statsLink__iZWzV",refreshButton:"page_refreshButton__DY9Yq",feedList:"page_feedList__ZPOTQ",feedItem:"page_feedItem__Arq8J",content:"page_content__kDoxQ",contentLeft:"page_contentLeft__HX8F4",userLine:"page_userLine___F_qs",emoji:"page_emoji__AOGjQ",authorLink:"page_authorLink__P8odq",text:"page_text__LcLL2",timestamp:"page_timestamp__JCy7J",loadingContainer:"page_loadingContainer__pshup",loader:"page_loader__g9BIl",spin:"page_spin__W_8_q",emptyState:"page_emptyState__Zyc7X",loadMoreButton:"page_loadMoreButton__f010N",error:"page_error__Jil8M",notice:"page_notice__83mqD",noticePersonal:"page_noticePersonal__YlkeM",noticeLink:"page_noticeLink__l4Q1x"}},35480:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(68570).createProxy)(String.raw`/Users/dame/Library/Mobile Documents/com~apple~CloudDocs/Software/flushes/app/src/app/page.tsx#default`)}};var t=require("../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,32,568],()=>s(25622));module.exports=r})();